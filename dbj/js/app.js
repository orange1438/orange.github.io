function isAndroid(){return/Android/i.test(navigator.userAgent)}var atype="",atype=isAndroid()?".ogg":".mp3",res={role_plist:"res/roles.plist",role_png:"res/roles.png",light_plist:"http://orange1438.github.io/dbj/res/light.plist",light_png:"http://orange1438.github.io/dbj/res/light.png",blood_plist:"res/blood.plist",blood_png:"res/blood.png",game_png:"res/games.png",game_plist:"res/games.plist",num_png:"res/num50.png",bg:"res/gamebg.png",shareword:"res/shareword.png"},g_mainmenu=[res.game_plist,res.game_png,res.role_png,res.role_plist,res.light_png,res.light_plist,res.blood_png,res.blood_plist,res.num_png,res.bg,res.shareword];var GD=GD||{};GD.GAME_STATE={HOME:0,PLAY:1,OVER:2};GD.UNIT_TAG={ENEMY:100,PLAYER:1000,PET:1010,BLOOD:1020};GD.ACTIVE_PETS=0;GD.ACTIVE_ENEMIES=0;GD.CONTAINER={ENEMIES:[],BLOOD:[],LIGHT:[],LIGHT2:[],BACKSKYS:[],HitMo:[],PET:[],BACKTILEMAPS:[]};GD.ENEMIES={};GD.ENEMIES.DATA=[{power:0.6,live:1,speed:4,fimg:"npc1",bimg:"npc2"},{power:1,live:1,speed:4,fimg:"npc3",bimg:"npc4"}];GD.LIFE=10;GD.PETKIND=0;GD.SHOWLEVEL=0;GD.SCORE=0;var winSize,centerPos;GD.word=["0","1"];var BitNumLayer=cc.Layer.extend({timeLabel:null,scoreLabel:null,time:null,timeAction:null,_bg:null,ctor:function(){this._super()},step:function(b){this.time+=b},init:function(){this._super();this.scoreLabel=cc.LabelAtlas.create("0",res.num_png,65,87,"0");this.addChild(this.scoreLabel);this.scoreLabel.anchorX=0.5;this.scoreLabel.x=winSize.width/2;this.scoreLabel.y=-120+winSize.height;var b=cc.ScaleBy.create(0.1,1.2);this.scoreLabel.scale=0.8;cc.ScaleBy.create(2,0.25,4.5);this.timeAction=cc.Sequence.create(b,b.reverse());this.schedule(this.step);this.setTimeNum(0)},setNum:function(b){GD.SCORE+=b;trace("--------SCORE---"+GD.SCORE);this.scoreLabel.scale=0.8;this.scoreLabel.runAction(this.timeAction);this.scoreLabel.setString(GD.SCORE+"")},setTimeNum:function(b){}});BitNumLayer.create=function(){var b=new BitNumLayer;b.init();return b};var Fire=cc.Layer.extend({_tao:null,_live:3,_action:null,_hp:null,_barRenderer:null,_barsize:null,barbg:null,ctor:function(b){this._super()},setLive:function(b){0!=this._live&&(this._live-=b,0>=this._live&&(this._live=0,this.toEnd()),b=100*(this._live/GD.LIFE)|0,b=Math.min(b,100),this._barRenderer&&this._barRenderer.setTextureRect(cc.rect(0,0,95*b/100,10)))},step:function(b){this.time+=b},init:function(){this._super();this._barRenderer=new cc.Sprite.create("#bar.png");this._barsize=[this._barRenderer.width,this._barRenderer.height];this._live=GD.LIFE;var e=new cc.Sprite.create("#bar.png");e.color=cc.color(25,25,25,150);e.anchorX=this._barRenderer.anchorX=0;e.anchorY=this._barRenderer.anchorY=0;e.x=this._barRenderer.x=-50;e.y=this._barRenderer.y=160;e.y-=3;this.addChild(e);this.barbg=e;this._barRenderer.color=cc.color.RED;this.addChild(this._barRenderer);this._tao=new cc.Sprite.create("#ta0001.png");this._tao.anchorY=0.4;this._tao.anchorX=0.55;this.addChild(this._tao);for(var e=[],d=1;12>=d;d++){var f=cc.spriteFrameCache.getSpriteFrame("ta00"+(9<d?d:"0"+d)+".png");e.push(f)}this._action=cc.Sequence.create(cc.Animate.create(cc.Animation.create(e,0.06)),cc.CallFunc.create(this.gameOver,this));this.setLive(0)},toEnd:function(){this.barbg.visible=!1;this._tao.runAction(this._action);g_sharedGameLayer.loseGame()},gameOver:function(){}});Fire.create=function(){var b=new Fire;b.init();return b};var Helo=cc.Sprite.extend({eID:0,active:!0,direct:1,hurtAction:null,standAction:null,hasFired:!1,attactKind:0,lock:!1,ax:0,ay:0,ox:0,oy:0,apot:null,addpot:null,speednum:20,speedp:null,nextaim:null,isOpen:!1,roadlist:[],_draw:null,circle:140,_linep:null,ctor:function(){this._super("#role0001.png");this.install();this.anchorY=this.anchorX=0.5;this.runAction(this.frameObj.round);this.isOpen=!0;this.scale=1.1},install:function(){this.apot=this.getPosition();this.attactActionList=[];var j=[[[2,9],"round"],[[10,42],"die"]],h;this.frameObj={};for(var o=[],m,n=0;n<j.length;n++){for(var o=[],l=j[n][0],k=l[0];k<l[1];k++){h=k,h=10>h?"00"+h:100>h?"0"+h:h,str="role0"+h+".png",h=cc.spriteFrameCache.getSpriteFrame(str),o.push(h),h=j[n][1],"round"==h?m=cc.RepeatForever.create(cc.Animate.create(cc.Animation.create(o,0.025))):"die"==h&&(m=cc.Sequence.create(cc.Animate.create(cc.Animation.create(o,0.05)),cc.CallFunc.create(this.destroy,this))),m.retain(),this.frameObj[j[n][1]]=m}}},setDirect:function(b){this.scaleX=this.direct=b},setNewPot:function(b){b.x==this.apot.x&&b.y==this.apot.y||(this.apot=b,this.findRoad())},update:function(b){this.nextaim&&(cc.pDistance(this.nextaim,this.getPosition())>this.speednum?(b=cc.pAdd(this.getPosition(),this.speedp),this.setPosition(b)):(this.setPosition(this.nextaim),this.roadlist.shift(),this.refreshNext()),this.scale=(1000-this.y)/1000+0.7,this.scale=1.2<this.scale?1.2:this.scale)},refreshNext:function(){1<this.roadlist.length?(this.nextaim=this.roadlist[1],this.speedp=cc.pMult(cc.pNormalize(cc.pSub(this.nextaim,this.getPosition())),this.speednum),this.drawdot(this.roadlist)):(this._draw.clear(),this.nextaim=null)},findRoad:function(){this.roadlist=[];this.roadlist.push(this.getPosition());cc.pDistance(this.getPosition(),this.apot);var h=cc.pDistance(centerPos,this.getPosition());this._linep=cc.pSub(this.apot,this.getPosition());var g=cc.pSub(centerPos,this.getPosition()),m=cc.pNormalize(this._linep),k=cc.pAngle(g,this._linep),l=Math.floor(h*Math.sin(k)),h=Math.floor(h*Math.cos(k));cc.pDistance(centerPos,this.apot)<this.circle?(g=Math.sqrt(this.circle*this.circle-l*l),cc.pSub(centerPos,this._linep),this.apot=cc.pAdd(this.getPosition(),cc.pMult(m,h-g))):(k=180*cc.pAngle(cc.pSub(this.apot,centerPos),cc.pSub(this.getPosition(),centerPos))/Math.PI,l<this.circle&&90<k&&(m=cc.pSub(cc.pMult(m,h),g),m=cc.pAdd(centerPos,cc.pMult(cc.pNormalize(m),this.circle)),this.roadlist.push(m)));this.roadlist.push(this.apot);m=[];for(g=0;g<this.roadlist.length-1;g++){if(l=cc.pDistance(this.roadlist[g+1],this.roadlist[g]),25<l){l=Math.floor(l/25);h=cc.pNormalize(cc.pSub(this.roadlist[g+1],this.roadlist[g]));for(k=0;k<=l;k++){var j=cc.pAdd(this.roadlist[g],cc.pMult(h,25*k));m.push(j)}}else{m.push(this.roadlist[g])}}this.roadlist=m;this.drawdot(this.roadlist);this.refreshNext()},drawdot:function(d){this._draw||(this._draw=cc.DrawNode.create(),g_sharedGameLayer.addRoad(this._draw));this._draw.clear();for(var c=0;c<d.length-1;c++){this._draw.drawDot(d[c],5,cc.color(0,255,255,50))}},destroy:function(){this.scheduleOnce(this.callBackOver,0.5);this.attactActionList=[];this.stopAllActions()},callBackOver:function(){g_sharedGameLayer.onGameOver()},attactRect:function(){return cc.rect(this.x,this.y,100,100)},toDie:function(){this.stopAllActions();this.runAction(this.frameObj.die)}});Helo.create=function(){return new Helo};var BgLayer=cc.Layer.extend({_bgs:null,_start:null,_bglist:[],_bgfshow:[],_bgbshow:[],_lefttx:-350,_fid:0,_imgw:853,_bid:0,ctor:function(){this._super()},step:function(b){this.time+=b},init:function(){this._super();this._lefttx=-this._imgw/2;this._bgs=cc.Node.create();this.addChild(this._bgs);for(var e=[res.bg_png,res.bg_png],d=0;2>d;d++){var f=cc.Sprite.create(e[d]);f.anchorY=0;this._bgs.addChild(f);f.visible=!0;f.y=0;this._bglist.push(f)}this._bgfshow.push(this._bglist[0]);this._bgfshow.push(this._bglist[1]);this._bgfshow[1].x=this._bgfshow[0].x+this._imgw;this._fid=1;for(d=0;1>=d;d++){this._bgfshow[d].visible=!0}},update:function(e,d){for(var f=0;2>f;f++){this._bgfshow[f].x+=e}this._bgfshow[0].x<this._lefttx&&(f=this._bgfshow.shift(),f.visible=!1,this._fid+=1,this._bgfshow.push(f),this._bgfshow[1].x=this._bgfshow[0].x+this._imgw,this._bgfshow[1].visible=!0)},setIndex:function(d,c){}});BgLayer.create=function(){var b=new BgLayer;b.init();return b};var Light2=cc.Sprite.extend({active:!1,ctor:function(){this._super("#l20001.png")},destroy:function(){this.active=this.visible=!1},init:function(){this._super()},playMo:function(){this.scale=1.3;this.active=this.visible=!0;this.runAction(cc.Sequence.create(cc.Animate.create(cc.animationCache.getAnimation("l22")),cc.CallFunc.create(this.destroy,this)))}});Light2.addNew=function(b){Light2.getOrCreate(b).playMo()};Light2.getOrCreate=function(e){for(var d=null,f=0;f<GD.CONTAINER.LIGHT2.length;f++){if(d=GD.CONTAINER.LIGHT2[f],!1==d.active){return d.setPosition(e),d}}d=Light2.create();d.setPosition(e);return d};Light2.shared=function(){for(var e=[],d=1;7>=d;d++){var f=cc.spriteFrameCache.getSpriteFrame("l2000"+d+".png");e.push(f)}cc.animationCache.addAnimation(cc.Animation.create(e,0.02),"l22")};Light2.create=function(b){b=new Light2(b);g_sharedGameLayer.addLight2(b);GD.CONTAINER.LIGHT2.push(b);return b};var Blood=cc.Sprite.extend({active:!1,ctor:function(){this._super("#blood0001.png");this.anchorX=0;this.anchorY=0.5},destroy:function(){this.active=this.visible=!1},init:function(){this._super()},playMo:function(){this.active=this.visible=!0;this.runAction(cc.Sequence.create(cc.Animate.create(cc.animationCache.getAnimation("Blood")),cc.CallFunc.create(this.destroy,this)))}});Blood.addNew=function(e,d){var f=Blood.getOrCreate();f.setPosition(e);f.rotation=360-d;f.playMo()};Blood.getOrCreate=function(){for(var d=null,c=0;c<GD.CONTAINER.BLOOD.length;c++){if(d=GD.CONTAINER.BLOOD[c],!1==d.active){return d}}return d=Blood.create()};Blood.shared=function(){for(var e=[],d=2;9>=d;d++){var f=cc.spriteFrameCache.getSpriteFrame("blood000"+d+".png");e.push(f)}cc.animationCache.addAnimation(cc.Animation.create(e,0.1),"Blood")};Blood.create=function(b){b=new Blood(b);g_sharedGameLayer.addBlood(b);GD.CONTAINER.BLOOD.push(b);return b};var Enemy=cc.Sprite.extend({aimX:0,speedx:5,speedy:0,rightsidex:0,leftsidex:0,showLevel:0,hasFired:!1,race:1,kind:1,power:1,liveAction:null,dieAction:null,attactSpace:6,attactAction:null,speednum:1,state:"no",dirx:1,diry:1,live:1,angle:null,speedp:null,orip:null,race:null,attactLen:150,oripot:null,angle:null,money:null,ctor:function(h,g){this.diry=2<g?1:-1;1==this.diry&&(this.attactLen=160);this.dirx=1==g%2?1:-1;this.race=h;-1==this.diry?this._super("#"+GD.ENEMIES.DATA[h].fimg+"0001.png"):this._super("#"+GD.ENEMIES.DATA[h].bimg+"0001.png");1==h?(this.attactLen+=10,this.money=40):1==this.diry?(this.money=19,this.attactLen-=30):(this.money=16,this.attactLen-=10);this.kind=g;this.anchorY=this.anchorX=0.5;this.rightsidex=winSize.width;this.power=GD.ENEMIES.DATA[h].power;this.speednum=GD.ENEMIES.DATA[h].speed;this.live=GD.ENEMIES.DATA[h].live;for(var m=[],k=[],l=1;6>=l;l++){var j=cc.spriteFrameCache.getSpriteFrame(-1==this.diry?""+GD.ENEMIES.DATA[h].fimg+"000"+l+".png":""+GD.ENEMIES.DATA[h].bimg+"000"+l+".png");3>=l?m.push(j):k.push(j)}this.liveAction=cc.RepeatForever.create(cc.Animate.create(cc.Animation.create(m,0.1)));this.attactAction=cc.Sequence.create(cc.Animate.create(cc.Animation.create(k,0.1)),cc.CallFunc.create(this.attactEnd,this));this.scaleX=this.dirx},toGetNewPot:function(){this.angle=8*(6*Math.random()-3)+[135,45,225,315][this.kind-1];for(var d=0;d<GD.CONTAINER.ENEMIES.length;d++){var c=GD.CONTAINER.ENEMIES[d];if("run"==c.state&&this.angle==c.angle){this.toGetNewPot();return}}d=cc.pForAngle(this.angle/360*2*Math.PI);c=cc.pMult(d,500);this.orip=d;this.oripot=cc.pAdd(centerPos,c);this.speedp=cc.pNeg(cc.pMult(d,this.speednum))},toActive:function(b){this.speednum=b+GD.ENEMIES.DATA[this.race].speed;this.toGetNewPot();this.dieAction=cc.Sequence.create(cc.MoveTo.create(0.1,this.oripot),cc.CallFunc.create(this.destroy,this));this.setPosition(this.oripot);this.visible=!0;this.alpha=1;this.toRun()},update:function(b){"run"==this.state&&(cc.pDistance(centerPos,this.getPosition())>this.attactLen?(b=cc.pAdd(this.getPosition(),this.speedp),this.setPosition(b)):this.toAttact())},toAttact:function(){"run"!=this.state&&"attact"!=this.state||(this.state="attact",this.stopAllActions(),this.runAction(this.attactAction))},attactEnd:function(){this.scheduleOnce(this.toAttact,1);g_sharedGameLayer.enemyAttact(this.power,this.orip)},toRun:function(){this.state="run";this.stopAllActions();this.runAction(this.liveAction)},toBeHurt:function(d,c){this.state="hurt";this.kill(c)},kill:function(b){this.state="die";this.stopAllActions();this.runAction(this.dieAction);g_sharedGameLayer.killOneEnemy(this)},destroy:function(){this.active=this.visible=!1;GD.ACTIVE_ENEMIES--;this.stopAllActions();g_sharedGameLayer.oneEnemyDie(this)},gameOver:function(){},attactRect:function(){return cc.rect(this.x,-1,60,-1)},collideRect:function(d,c){return cc.rect(this.x,-1,50,-1)}});Enemy.addNewEnemy=function(e,d){if(!(20<=GD.ACTIVE_ENEMIES)){GD.SHOWLEVEL+=1;var f=0.7<Math.random()?1:0;Enemy.getOrCreateEnemy(f,e).toActive(d)}};Enemy.getOrCreateEnemy=function(f,d){for(var h=null,g=0;g<GD.CONTAINER.ENEMIES.length;g++){if(h=GD.CONTAINER.ENEMIES[g],h.race==f&&h.kind==d&&"no"==h.state){return GD.ACTIVE_ENEMIES++,h}}h=Enemy.create(f,d);GD.ACTIVE_ENEMIES++;return h};Enemy.create=function(e,d){var f=new Enemy(e,d);g_sharedGameLayer.addEnemy(f,GD.UNIT_TAG.ENEMY,f.zOrder);GD.CONTAINER.ENEMIES.push(f);return f};Enemy.preSet=function(){for(var e=null,e=1,d,f=0;8>f;f++){e=3<f?1:0,d=f%4,e=Enemy.create(e,d+1),e.visible=!1,e.state="no",e.stopAllActions(),e.unscheduleAllCallbacks()}};function ShakeCls(){this.shakeee=null;var b=this;this.bool=!1;this.hitAndShake=function(g,l,j,k,h){this.bool=!0;this.shakeee=g;null==this.shakeee.basex&&(this.shakeee.basex=this.shakeee.x);null==this.shakeee.basey&&(this.shakeee.basey=this.shakeee.y);this.shakeee.rangeX=null==l?20:l;this.shakeee.rangeY=null==j?20:j;this.shakeee.x=this.shakeee.basex-this.shakeee.rangeX/2+this.shakeee.rangeX*Math.random();this.shakeee.y=this.shakeee.basey-this.shakeee.rangeY+2*this.shakeee.rangeY*Math.random();this.shakeee.flashTime=6;this.shakeee.funcCall=null==h?null:h;this.shakeee.shakeTimeCount=0;this.shakeee.cframe=0};this.update=function(){this.bool&&(this.shakeee.cframe+=1,2>this.shakeee.cframe||(this.shakeee.cframe=0,5==this.shakeee.shakeTimeCount?b.cancelHitAndShake(this.shakeee):(this.shakeee.shakeTimeCount++,this.shakeee.x+=1.7*(this.shakeee.basex-this.shakeee.x),this.shakeee.y+=1.7*(this.shakeee.basey-this.shakeee.y))))};this.cancelHitAndShake=function(c){this.bool=!1;c||(c=this.shakeee);c.x=c.basex;c.y=c.basey}}var shake=new ShakeCls;var MenuLayer=cc.Layer.extend({menu:null,ctor:function(){this._super()},init:function(){this._super();cc.spriteFrameCache.addSpriteFrames(res.game_plist);centerPos=cc.p(winSize.width/2,winSize.height/2);var b=cc.Sprite.create("#gameintro.png");this.addChild(b);this.menu=cc.Sprite.create("#start.png");this.menu.x=winSize.width/2;this.addChild(this.menu);b.y=winSize.height/2+351.5-274;this.menu.y=b.y-351.5;b.x=winSize.width/2;this.initEvent();b=cc.Sprite.create(cc.tglogotexture2d);b.y=50;b.anchorX=0.5;b.x=winSize.width/2;this.addChild(b)},initEvent:function(){var d=this,c=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(a,h){var j=h.getCurrentTarget(),g=j.convertToNodeSpace(a.getLocation()),j=j.getContentSize(),j=cc.rect(0,0,j.width,j.height);return cc.rectContainsPoint(j,g)?(d.menu.y-=3,d.menu.color=cc.color(150,150,150,150),d.onPlayG(),!0):!1},onTouchEnded:function(f,e){return !1}});cc.eventManager.addListener(c,d.menu)},onPlayG:function(){cc.director.runScene(cc.TransitionFade.create(0.3,GameScene.create()))}}),MenuScene=cc.Scene.extend({onEnter:function(){this._super();var b=new MenuLayer;b.init();this.addChild(b)}});MenuScene.create=function(){var b=new MenuScene;return b&&b.init()?b:null};STATE_PLAYING=0;STATE_GAMEOVER=1;var g_sharedGameLayer,GameLayer=cc.Layer.extend({_size:0,_helo:null,_roles:null,_time:GD.MAXTIME,_midx:0,_leftmidx:0,_rightmidx:0,_attactzone:[],_npcontainer:null,_introscene:null,_live:0,_blood:null,_attackLeft:null,_attackRight:null,_dataLayer:null,_state:STATE_PLAYING,_hitUI:null,numLayer:null,_hitNum:0,_liveBar:null,_barRenderer:null,_time2:0,_others:null,_BtnColor:null,_space:60,_barsize:[168,17],_locktime:3,_ta:null,emyspd:0,moved:!0,ctor:function(){this._super()},init:function(){this._super()&&(this._space=0,GD.SCORE=0,this._time=GD.MAXTIME,GD.CONTAINER.ENEMIES=[],GD.CONTAINER.BLOOD=[],GD.CONTAINER.PET=[],GD.ACTIVE_PETS=0,GD.ACTIVE_ENEMIES=0,this._midx=winSize.width/2,this._leftmidx=this._midx/2-120,this._rightmidx=this._midx+120,g_sharedGameLayer=this,this.initBg(),this.initRoles(),this.initUserControl(),this.initData(),this._state=STATE_PLAYING,this.schedule(this.clockCounter2,0.1),this.scheduleUpdate())},initRoles:function(){cc.spriteFrameCache.addSpriteFrames(res.role_plist);cc.spriteFrameCache.addSpriteFrames(res.light_plist);cc.spriteFrameCache.addSpriteFrames(res.blood_plist);var b=cc.textureCache.addImage(res.role_png);this._roles=cc.SpriteBatchNode.create(b);this._roles.setBlendFunc(cc.SRC_ALPHA,cc.ONE);this._ta=Fire.create();this._ta.x=winSize.width/2;this._ta.y=winSize.height/2;this.addChild(this._ta,10);this.addChild(this._roles,11);this._helo=Helo.create();this._roles.addChild(this._helo);this._helo.y=winSize.height/3;this._helo.x=winSize.width/2;b=cc.textureCache.addImage(res.blood_png);this._blood=cc.SpriteBatchNode.create(b);this.addChild(this._blood);Light2.shared();Blood.shared();Enemy.preSet()},initData:function(){this._time=this._time2=GD.MAXTIME;this._dataLayer=BitNumLayer.create();this.addChild(this._dataLayer,100)},setLive:function(b){this._ta.setLive(b)},enemyAttact:function(d,c){this._state==STATE_PLAYING&&(Light2.addNew(cc.pAdd(centerPos,cc.pMult(c,30))),this.setLive(d))},killOneEnemy:function(b){this._dataLayer.setNum(b.money);Blood.addNew(b.getPosition(),b.angle)},oneEnemyDie:function(b){},initUserControl:function(){var d=this,c=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(a,f){d._helo.setNewPot(a.getLocation());return !0},onTouchMoved:function(a,f){d.moved&&(d._helo.setNewPot(a.getLocation()),d.moved=!1)},onTouchEnded:function(f,e){return !0}});cc.eventManager.addListener(c,this)},initBg:function(){this._bg=new cc.Sprite(res.bg);this._bg.x=winSize.width/2;this._bg.y=winSize.height/2;this._bg.anchorX=this._bg.anchorY=0.5;this.addChild(this._bg,0);var b=new cc.Sprite("#quan.png");this.addChild(b);b.x=winSize.width/2;b.y=winSize.height/2},addEnemy:function(e,d,f){this._roles.addChild(e,d,f)},addBlood:function(d,c){this._blood.addChild(d,c)},addLight:function(d,c){this._blood.addChild(d,c)},addLight2:function(d,c){this.addChild(d,110)},toAddBlood:function(b){},clockCounter2:function(){if(this._state==STATE_PLAYING){if(this._time2-=0.1,0>this._time2&&(this._time2=0),this._time=Math.floor(this._time2),this._time2=Math.floor(10*this._time2)/10,GD.USETIME=GD.MAXTIME-this._time2,0>=this._space){this.emyspd=0.08*Math.floor(GD.USETIME/10);this.emyspd=10<this.emyspd?10:this.emyspd;if(GD.SCORE>5000){this.emyspd=this.emyspd+5}else{if(GD.SCORE>1000){this.emyspd=this.emyspd+3}}this._space=10-Math.floor(0.2*GD.USETIME);var b=Math.floor(4*Math.random());Enemy.addNewEnemy(b+1,this.emyspd)}else{this._space--}}},update:function(b){this._state==STATE_PLAYING&&(this.moved=!0,this.checkIsCollide(b),this.updateUI(),this.toReorderChild())},checkIsCollide:function(h){var g,m=this._helo.getPosition(),k={},l=!1;for(g=0;g<GD.CONTAINER.ENEMIES.length;g++){if(h=GD.CONTAINER.ENEMIES[g],"run"==h.state||"attact"==h.state){h.update(k);var j=h.getPosition();140>cc.pDistance(m,j)&&(l=cc.pNormalize(cc.pSub(j,m)),h.toBeHurt(1,l),l=!0)}}l&&shake.hitAndShake(this,10,10)},toReorderChild:function(){this._helo.y>winSize.height/2+50?this.reorderChild(this._roles,9):this.reorderChild(this._roles,11)},updateUI:function(){shake&&shake.update();this._helo.update()},clearEmeny:function(){for(i=0;i<GD.CONTAINER.ENEMIES.length;i++){var b=GD.CONTAINER.ENEMIES[i];b&&this._roles.removeChild(b)}GD.CONTAINER.ENEMIES=[]},addRoad:function(b){this.addChild(b,0)},loseGame:function(){this._helo.toDie();this.toGameEnd()},winGame:function(){this.toGameEnd();this.onGameOver()},toGameEnd:function(){this._state=STATE_GAMEOVER;this.unschedule(this.clockCounter2,0.1);cc.eventManager.removeAllListeners()},onGameOver:function(){this._state=STATE_GAMEOVER;this.clearEmeny();this._roles.removeAllChildren();this._blood.removeAllChildren();this._helo=null;cc.spriteFrameCache.removeSpriteFramesFromFile(res.role_plist);cc.spriteFrameCache.removeSpriteFramesFromFile(res.blood_plist);cc.spriteFrameCache.removeSpriteFramesFromFile(res.light_plist);cc.director.runScene(cc.TransitionFade.create(0.6,GameOverScene.create()))},reStart:function(){this.init()}}),GameScene=cc.Scene.extend({onEnter:function(){this._super();var b=new GameLayer;b.init();this.addChild(b)}});GameScene.create=function(){var b=new GameScene;return b&&b.init()?b:null};var GameOverLayer=cc.Layer.extend({_time:null,_bg:null,_scoreLabel:null,_sharelayer:null,_viewB:null,sharemenu:null,againmenu:null,downmenu:null,_commentLabel:null,_iconLabel:null,moremenu:null,ctor:function(){this._super()},init:function(){cc.spriteFrameCache.addSpriteFrames(res.gameover_plist);this.initBg();this.initMenu();var b=cc.Sprite.create(cc.tglogotexture2d);b.y=70;b.anchorX=0.5;b.x=winSize.width/2;this.addChild(b)},initEvent:function(){var d=this,c=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(a,k){var l=k.getCurrentTarget(),j=l.convertToNodeSpace(a.getLocation()),h=l.getContentSize(),h=cc.rect(0,0,h.width,h.height);if(cc.rectContainsPoint(h,j)){l.y-=2;if(l==d.sharemenu){d.onShare()}else{if(l==d.againmenu){d.onAgain()}else{if(l==d.moremenu){d.onMore()}}}return !0}return !1},onTouchEnded:function(f,e){var g=e.getCurrentTarget();g.y+=2}});cc.eventManager.addListener(c,d.sharemenu);cc.eventManager.addListener(c.clone(),d.againmenu);cc.eventManager.addListener(c.clone(),d.moremenu)},initMenu:function(){this.sharemenu=cc.Sprite.create("#share.png");this.againmenu=cc.Sprite.create("#again.png");this.moremenu=cc.Sprite.create("#more.png");this.addChild(this.sharemenu);this.addChild(this.againmenu);this._bg.x=winSize.width/2;this._bg.y=winSize.height/2+307-265.5+70;this._scoreLabel.x=this._bg.x;this._scoreLabel.y=this._bg.y-50;this._commentLabel.y=this._bg.y-130;this._commentLabel.x=this._bg.x+90;this._iconLabel.x=this._bg.x+30;this._iconLabel.y=this._bg.y-188;this.sharemenu.x=this._bg.x+138;this.againmenu.y=this.sharemenu.y=this._bg.y-307+5;this.againmenu.x=this._bg.x-138;this.moremenu.y=this._bg.y-307-90;this.moremenu.x=this._bg.x;var b=this;setTimeout(function(){b.initEvent()},500)},initBg:function(){this._sharelayer=null;trace("initBg");var d=cc.DrawNode.create();this.addChild(d,0);d.drawRect(cc.p(-56,-10),cc.p(800,winSize.height+20),cc.color(25,25,25,24),0,0);this._bg=new cc.Sprite("#over.png");this.addChild(this._bg);this._scoreLabel=cc.LabelAtlas.create("0",res.num_png,65,87,"0");this.addChild(this._scoreLabel);this._scoreLabel.anchorX=0.5;this._scoreLabel.setString(GD.SCORE);this._commentLabel=cc.LabelTTF.create("","Arial",40);this.addChild(this._commentLabel);var c="爹，就差那么一点点，流量 第一滴血，爹这顿斩获5豆币 爹正在大杀特杀，这顿斩获 爹已超神了，这顿斩获15豆".split(" ");var d="在召唤，别放弃，来继续！ ，累计50豆币可以换流量哦~ 10豆币，累计50豆币可以换流量哦~ 币，累计50豆币可以兑换流量哦~".split(" ");if(GD.SCORE<5000){c=c[0];d=d[0];this._commentLabel.anchorX=0.7;this._commentLabel.setString(c);this._commentLabel.color=cc.color.YELLOW;this._iconLabel=cc.LabelTTF.create("","Arial",40);this._iconLabel.color=cc.color.YELLOW;this._iconLabel.anchorX=0.55;this.addChild(this._iconLabel);this._iconLabel.setString(d);d=cc.LabelTTF.create("","Arial",40)}else{if(GD.SCORE<10000){c=c[1];d=d[1];this._commentLabel.anchorX=0.7;this._commentLabel.setString(c);this._commentLabel.color=cc.color.YELLOW;this._iconLabel=cc.LabelTTF.create("","Arial",40);this._iconLabel.color=cc.color.YELLOW;this._iconLabel.anchorX=0.58;this.addChild(this._iconLabel);this._iconLabel.setString(d);d=cc.LabelTTF.create("","Arial",40)}else{if(GD.SCORE<20000){c=c[2];d=d[2];this._commentLabel.anchorX=0.7;this._commentLabel.setString(c);this._commentLabel.color=cc.color.YELLOW;this._iconLabel=cc.LabelTTF.create("","Arial",32);this._iconLabel.color=cc.color.YELLOW;this._iconLabel.anchorX=0.55;this.addChild(this._iconLabel);this._iconLabel.setString(d);d=cc.LabelTTF.create("","Arial",20)}else{if(GD.SCORE>=20000){c=c[3];d=d[3];this._commentLabel.anchorX=0.7;this._commentLabel.setString(c);this._commentLabel.color=cc.color.YELLOW;this._iconLabel=cc.LabelTTF.create("","Arial",35);this._iconLabel.color=cc.color.YELLOW;this._iconLabel.anchorX=0.55;this.addChild(this._iconLabel);this._iconLabel.setString(d);d=cc.LabelTTF.create("","Arial",40)}}}}c=cc.LabelTTF.create("","Arial",40);d.anchorX=0.5;c.anchorX=0.5;this.addChild(d);this.addChild(c);d.x=winSize.width/2-170;c.x=winSize.width/2+170;d.y=c.y=winSize.height/2-75},onAgain:function(){cc.spriteFrameCache.removeSpriteFramesFromFile(res.npc_plist);cc.director.runScene(cc.TransitionFade.create(0.3,MenuScene.create()))},onMore:function(){},onShare:function(){cc.eventManager.removeAllListeners();trace("onShare");cc.director.runScene(ShareScene.create())},onOver:function(){}}),GameOverScene=cc.Scene.extend({onEnter:function(){this._super();var b=new GameOverLayer;b.init();this.addChild(b)}});GameOverScene.create=function(){var b=new GameOverScene;return b&&b.init()?b:null};var ShareLayer=cc.Layer.extend({_time:null,_bg:null,_scoreLabel:null,menu:null,listener4:null,ctor:function(){this._super()},init:function(){this.initBg();this.initMenu();var b=cc.Sprite.create(cc.tglogotexture2d);b.y=70;b.anchorX=0.5;b.x=winSize.width/2;this.addChild(b)},initMenu:function(){this.menu=cc.Sprite.create("#return.png");this.menu.x=winSize.width/2;this.menu.y=180;this.addChild(this.menu);var b=this;this.listener4=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(g,l){var j=l.getCurrentTarget(),k=j.convertToNodeSpace(g.getLocation()),h=j.getContentSize(),h=cc.rect(0,0,h.width,h.height);cc.rectContainsPoint(h,k)&&(j.y-=2);return !0},onTouchEnded:function(a,d){b.onReturn()}});cc.eventManager.addListener(this.listener4,this.menu)},onReturn:function(){cc.eventManager.removeListener(this.listener4,this.menu);cc.director.runScene(GameOverScene.create())},initBg:function(){trace("initBg");this._bg=new cc.Sprite(res.shareword);this._bg.x=winSize.width/2;this._bg.y=winSize.height/2+200;this.addChild(this._bg)}}),ShareScene=cc.Scene.extend({onEnter:function(){this._super();var b=new ShareLayer;b.init();this.addChild(b)}});ShareScene.create=function(){var b=new ShareScene;return b&&b.init()?b:null};cc.game.onStart=function(){cc.sys.isMobile?cc.view.setDesignResolutionSize(640,1008,cc.ResolutionPolicy.FIXED_HEIGHT):cc.view.setDesignResolutionSize(640,1008,cc.ResolutionPolicy.SHOW_ALL);winSize=cc.director.getWinSize();centerPos=cc.p(winSize.width/2,winSize.height/2);cc.LoaderScene.preload(g_mainmenu,function(){cc.director.runScene(MenuScene.create())},this)};