var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};_p=window;_p=Object.prototype;delete window._p;cc.newElement=function(a){return document.createElement(a)};cc._addEventListener=function(c,d,a,b){c.addEventListener(d,a,b)};cc._isNodeJs="undefined"!==typeof require&&require("fs");cc.each=function(d,e,a){if(d){if(d instanceof Array){for(var b=0,c=d.length;b<c&&!1!==e.call(a,d[b],b);b++){}}else{for(b in d){if(!1===e.call(a,d[b],b)){break}}}}};cc.isCrossOrigin=function(a){if(!a){return cc.log("invalid URL"),!1}var b=a.indexOf("://");if(-1==b){return !1}b=a.indexOf("/",b+3);return(-1==b?a:a.substring(0,b))!=location.origin};cc.async={_counterFunc:function(g){var h=this.counter;if(!h.err){var k=h.length,m=h.results,a=h.option,b=a.cb,c=a.cbTarget,d=a.trigger,a=a.triggerTarget;if(g){if(h.err=g,b){return b.call(c,g)}}else{var e=Array.apply(null,arguments).slice(1),f=e.length;0==f?e=null:1==f&&(e=e[0]);m[this.index]=e;h.count--;d&&d.call(a,e,k-h.count,k);0==h.count&&b&&b.apply(c,[null,m])}}},_emptyFunc:function(){},parallel:function(e,f,a){var b=cc.async;if(void 0!==a){"function"==typeof f&&(f={trigger:f}),f.cb=a||f.cb}else{if(void 0!==f){"function"==typeof f&&(f={cb:f})}else{if(void 0!==e){f={}}else{throw"arguments error!"}}}var c=(a=e instanceof Array)?e.length:Object.keys(e).length;if(0==c){f.cb&&f.cb.call(f.cbTarget,null)}else{var d={length:c,count:c,option:f,results:a?[]:{}};cc.each(e,function(g,h){if(d.err){return !1}var i=!f.cb&&!f.trigger?b._emptyFunc:b._counterFunc.bind({counter:d,index:h});g(i,h)})}},map:function(d,e,f){var g=this,a=arguments.length;"function"==typeof e&&(e={iterator:e});if(3===a){e.cb=f||e.cb}else{if(2>a){throw"arguments error!"}}"function"==typeof e&&(e={iterator:e});if(void 0!==f){e.cb=f||e.cb}else{if(void 0===d){throw"arguments error!"}}var b=(a=d instanceof Array)?d.length:Object.keys(d).length;if(0===b){e.cb&&e.cb.call(e.cbTarget,null)}else{var c={length:b,count:b,option:e,results:a?[]:{}};cc.each(d,function(h,i){if(c.err){return !1}var j=!e.cb?g._emptyFunc:g._counterFunc.bind({counter:c,index:i});e.iterator.call(e.iteratorTarget,h,i,j)})}}};cc.path={join:function(){for(var b=arguments.length,c="",a=0;a<b;a++){c=(c+(""==c?"":"/")+arguments[a]).replace(/(\/|\\\\)$/,"")}return c},extname:function(a){return(a=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(a))?a[1]:null},mainFileName:function(a){if(a){var b=a.lastIndexOf(".");if(-1!==b){return a.substring(0,b)}}return a},basename:function(b,c){var a=b.indexOf("?");0<a&&(b=b.substring(0,a));a=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(b.replace(/(\/|\\\\)$/,""));if(!a){return null}a=a[2];return c&&b.substring(b.length-c.length).toLowerCase()==c.toLowerCase()?a.substring(0,a.length-c.length):a},dirname:function(a){return a.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(c,d){d=d||"";var a=c.indexOf("?"),b="";0<a&&(b=c.substring(a),c=c.substring(0,a));a=c.lastIndexOf(".");return 0>a?c+d+b:c.substring(0,a)+d+b},changeBasename:function(d,e,a){if(0==e.indexOf(".")){return this.changeExtname(d,e)}var b=d.indexOf("?"),c="";a=a?this.extname(d):"";0<b&&(c=d.substring(b),d=d.substring(0,b));b=d.lastIndexOf("/");return d.substring(0,0>=b?0:b+1)+e+a+c}};cc.loader={_jsCache:{},_register:{},_langPathCache:{},_aliases:{},resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(d){var e=d[0],a=d[1],b=d[2],c=["",null,null];if(1===d.length){c[1]=e instanceof Array?e:[e]}else{if(2===d.length){"function"==typeof a?(c[1]=e instanceof Array?e:[e],c[2]=a):(c[0]=e||"",c[1]=a instanceof Array?a:[a])}else{if(3===d.length){c[0]=e||"",c[1]=a instanceof Array?a:[a],c[2]=b}else{throw"arguments error to load js!"}}}return c},loadJs:function(e,f,a){var b=this,c=b._jsCache,d=b._getArgs4Js(arguments);-1<navigator.userAgent.indexOf("Trident/5")?b._loadJs4Dependency(d[0],d[1],0,d[2]):cc.async.map(d[1],function(h,i,g){h=cc.path.join(d[0],h);if(c[h]){return g(null)}b._createScript(h,!1,g)},d[2])},loadJsWithImg:function(d,e,a){var b=this._loadJsImg(),c=this._getArgs4Js(arguments);this.loadJs(c[0],c[1],function(f){if(f){throw f}b.parentNode.removeChild(b);if(c[2]){c[2]()}})},_createScript:function(d,e,a){var b=document,c=cc.newElement("script");c.async=e;c.src=d;this._jsCache[d]=!0;cc._addEventListener(c,"load",function(){this.removeEventListener("load",arguments.callee,!1);a()},!1);cc._addEventListener(c,"error",function(){a("Load "+d+" failed!")},!1);b.body.appendChild(c)},_loadJs4Dependency:function(d,e,a,b){if(a>=e.length){b&&b()}else{var c=this;c._createScript(cc.path.join(d,e[a]),!1,function(f){if(f){return b(f)}c._loadJs4Dependency(d,e,a+1,b)})}},_loadJsImg:function(){var b=document,c=b.getElementById("cocos2d_loadJsImg");if(!c){c=cc.newElement("img");cc._loadingImage&&(c.src=cc._loadingImage);b=b.getElementById(cc.game.config.id);b.style.backgroundColor="black";b.parentNode.appendChild(c);var a=getComputedStyle?getComputedStyle(b):b.currentStyle;a||(a={width:b.width,height:b.height});c.style.left=b.offsetLeft+(parseFloat(a.width)-c.width)/2+"px";c.style.top=b.offsetTop+(parseFloat(a.height)-c.height)/2+"px";c.style.position="absolute"}return c},loadTxt:function(c,d){if(cc._isNodeJs){require("fs").readFile(c,function(e,f){e?d(e):d(null,f.toString())})}else{var a=this.getXMLHttpRequest(),b="load "+c+" failed!";a.open("GET",c,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(a.setRequestHeader("Accept-Charset","utf-8"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?d(null,a.responseText):d(b)}):(a.overrideMimeType&&a.overrideMimeType("text/plain; charset\x3dutf-8"),a.onload=function(){4==a.readyState&&200==a.status?d(null,a.responseText):d(b)});a.send(null)}},_loadTxtSync:function(a){if(cc._isNodeJs){return require("fs").readFileSync(a).toString()}var b=this.getXMLHttpRequest();b.open("GET",a,!1);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?b.setRequestHeader("Accept-Charset","utf-8"):b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dutf-8");b.send(null);return 4==!b.readyState||200!=b.status?null:b.responseText},loadJson:function(a,b){this.loadTxt(a,function(e,c){try{e?b(e):b(null,JSON.parse(c))}catch(d){throw"load json ["+a+"] failed : "+d}})},_checkIsImageURL:function(a){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(a)},loadImg:function(d,e,a){var b=!0;void 0!==a?b=null==e.isCrossOrigin?b:e.isCrossOrigin:void 0!==e&&(a=e);var c=new Image;b&&"file://"!=location.origin&&(c.crossOrigin="Anonymous");cc._addEventListener(c,"load",function(){this.removeEventListener("load",arguments.callee,!1);this.removeEventListener("error",arguments.callee,!1);a&&a(null,c)});cc._addEventListener(c,"error",function(){this.removeEventListener("error",arguments.callee,!1);a&&a("load image failed")});c.src=d;return c},_loadResIterator:function(e,f,a){var b=this,c=null,d=e.type;d?(d="."+d.toLowerCase(),c=e.src?e.src:e.name+d):(c=e,d=cc.path.extname(c));if(f=b.cache[c]){return a(null,f)}f=b._register[d.toLowerCase()];if(!f){return cc.error("loader for ["+d+"] not exists!"),a()}d=f.getBasePath?f.getBasePath():b.resPath;d=b.getUrl(d,c);f.load(d,c,e,function(g,h){g?(cc.log(g),b.cache[c]=null,delete b.cache[c],a()):(b.cache[c]=h,a(null,h))})},getUrl:function(d,e){var a=this._langPathCache,b=cc.path;if(void 0!==d&&void 0===e){e=d;var c=b.extname(e),c=c?c.toLowerCase():"";d=(c=this._register[c])?c.getBasePath?c.getBasePath():this.resPath:this.resPath}e=cc.path.join(d||"",e);if(e.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(a[e]){return a[e]}b=b.extname(e)||"";e=a[e]=e.substring(0,e.length-b.length)+"_"+cc.sys.language+b}return e},load:function(b,c,a){if(void 0!==a){"function"==typeof c&&(c={trigger:c})}else{if(void 0!==c){"function"==typeof c&&(a=c,c={})}else{if(void 0!==b){c={}}else{throw"arguments error!"}}}c.cb=function(d,e){d&&cc.log(d);a&&a(e)};b instanceof Array||(b=[b]);c.iterator=this._loadResIterator;c.iteratorTarget=this;cc.async.map(b,c)},_handleAliases:function(e,f){var a=this._aliases,b=[],c;for(c in e){var d=e[c];a[c]=d;b.push(d)}this.load(b,f)},loadAliases:function(c,d){var a=this,b=a.getRes(c);b?a._handleAliases(b.filenames,d):a.load(c,function(e){a._handleAliases(e[0].filenames,d)})},register:function(c,d){if(c&&d){if("string"==typeof c){return this._register[c.trim().toLowerCase()]=d}for(var a=0,b=c.length;a<b;a++){this._register["."+c[a].trim().toLowerCase()]=d}}},getRes:function(a){return this.cache[a]||this.cache[this._aliases[a]]},release:function(b){var c=this.cache,a=this._aliases;delete c[b];delete c[a[b]];delete a[b]},releaseAll:function(){var b=this.cache,c=this._aliases,a;for(a in b){delete b[a]}for(a in c){delete c[a]}}};(function(){var d=window,e,a;"undefined"!==typeof document.hidden?(e="hidden",a="visibilitychange"):"undefined"!==typeof document.mozHidden?(e="mozHidden",a="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(e="msHidden",a="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",a="webkitvisibilitychange");var b=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},c=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow)};e?cc._addEventListener(document,a,function(){document[e]?b():c()},!1):(cc._addEventListener(d,"blur",b,!1),cc._addEventListener(d,"focus",c,!1));"onpageshow" in window&&"onpagehide" in window&&(cc._addEventListener(d,"pagehide",b,!1),cc._addEventListener(d,"pageshow",c,!1));a=d=null})();cc.log=cc.warn=cc.error=cc.assert=function(){};cc.create3DContext=function(e,f){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],b=null,c=0;c<a.length;++c){try{b=e.getContext(a[c],f)}catch(d){}if(b){break}}return b};cc._initSys=function(a,b){cc._RENDER_TYPE_CANVAS=0;cc._RENDER_TYPE_WEBGL=1;var c=cc.sys={};c.LANGUAGE_ENGLISH="en";c.LANGUAGE_CHINESE="zh";c.LANGUAGE_FRENCH="fr";c.LANGUAGE_ITALIAN="it";c.LANGUAGE_GERMAN="de";c.LANGUAGE_SPANISH="es";c.LANGUAGE_RUSSIAN="ru";c.LANGUAGE_KOREAN="ko";c.LANGUAGE_JAPANESE="ja";c.LANGUAGE_HUNGARIAN="hu";c.LANGUAGE_PORTUGUESE="pt";c.LANGUAGE_ARABIC="ar";c.LANGUAGE_NORWEGIAN="no";c.LANGUAGE_POLISH="pl";c.OS_WINDOWS="Windows";c.OS_IOS="iOS";c.OS_OSX="OS X";c.OS_UNIX="UNIX";c.OS_LINUX="Linux";c.OS_ANDROID="Android";c.OS_UNKNOWN="Unknown";c.BROWSER_TYPE_WECHAT="wechat";c.BROWSER_TYPE_ANDROID="androidbrowser";c.BROWSER_TYPE_IE="ie";c.BROWSER_TYPE_QQ="qqbrowser";c.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";c.BROWSER_TYPE_UC="ucbrowser";c.BROWSER_TYPE_360="360browser";c.BROWSER_TYPE_BAIDU_APP="baiduboxapp";c.BROWSER_TYPE_BAIDU="baidubrowser";c.BROWSER_TYPE_MAXTHON="maxthon";c.BROWSER_TYPE_OPERA="opera";c.BROWSER_TYPE_MIUI="miuibrowser";c.BROWSER_TYPE_FIREFOX="firefox";c.BROWSER_TYPE_SAFARI="safari";c.BROWSER_TYPE_CHROME="chrome";c.BROWSER_TYPE_UNKNOWN="unknown";c.isNative=!1;var e=[c.BROWSER_TYPE_BAIDU,c.BROWSER_TYPE_OPERA,c.BROWSER_TYPE_FIREFOX,c.BROWSER_TYPE_CHROME,c.BROWSER_TYPE_SAFARI],h=[c.BROWSER_TYPE_BAIDU,c.BROWSER_TYPE_OPERA,c.BROWSER_TYPE_FIREFOX,c.BROWSER_TYPE_CHROME,c.BROWSER_TYPE_SAFARI,c.BROWSER_TYPE_UC,c.BROWSER_TYPE_QQ,c.BROWSER_TYPE_MOBILE_QQ,c.BROWSER_TYPE_IE],k=window,m=k.navigator,n=document.documentElement,q=m.userAgent.toLowerCase();c.isMobile=-1!=q.indexOf("mobile")||-1!=q.indexOf("android");var s=m.language,s=(s=s?s:m.browserLanguage)?s.split("-")[0]:c.LANGUAGE_ENGLISH;c.language=s;var s=c.BROWSER_TYPE_UNKNOWN,d=q.match(/micromessenger|qqbrowser|mqqbrowser|ucbrowser|360browser|baiduboxapp|baidubrowser|maxthon|trident|opera|miuibrowser|firefox/i)||q.match(/chrome|safari/i);d&&0<d.length&&(s=d[0].toLowerCase(),"micromessenger"==s?s=c.BROWSER_TYPE_WECHAT:"safari"===s&&q.match(/android.*applewebkit/)?s=c.BROWSER_TYPE_ANDROID:"trident"==s&&(s=c.BROWSER_TYPE_IE));c.browserType=s;c._supportMultipleAudio=-1<h.indexOf(c.browserType);h=parseInt(a[b.renderMode]);s=cc._RENDER_TYPE_WEBGL;d=cc.newElement("Canvas");cc._supportRender=!0;e=-1==e.indexOf(c.browserType);if(1===h||0===h&&(c.isMobile||e)){s=cc._RENDER_TYPE_CANVAS}if(s==cc._RENDER_TYPE_WEBGL&&(!k.WebGLRenderingContext||!cc.create3DContext(d,{stencil:!0,preserveDrawingBuffer:!0}))){0==h?s=cc._RENDER_TYPE_CANVAS:cc._supportRender=!1}if(s==cc._RENDER_TYPE_CANVAS){try{d.getContext("2d")}catch(f){cc._supportRender=!1}}cc._renderType=s;try{c._supportWebAudio=!!new (k.AudioContext||k.webkitAudioContext||k.mozAudioContext)}catch(r){c._supportWebAudio=!1}try{var g=c.localStorage=k.localStorage;g.setItem("storage","");g.removeItem("storage");g=null}catch(u){("SECURITY_ERR"===u.name||"QuotaExceededError"===u.name)&&cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option"),c.localStorage=function(){}}g=c.capabilities={canvas:!0};cc._renderType==cc._RENDER_TYPE_WEBGL&&(g.opengl=!0);void 0!==n.ontouchstart||m.msPointerEnabled?g.touches=!0:void 0!==n.onmouseup&&(g.mouse=!0);void 0!==n.onkeyup&&(g.keyboard=!0);if(k.DeviceMotionEvent||k.DeviceOrientationEvent){g.accelerometer=!0}k=q.match(/(iPad|iPhone|iPod)/i)?!0:!1;q=q.match(/android/i)||m.platform.match(/android/i)?!0:!1;n=c.OS_UNKNOWN;-1!=m.appVersion.indexOf("Win")?n=c.OS_WINDOWS:k?n=c.OS_IOS:-1!=m.appVersion.indexOf("Mac")?n=c.OS_OSX:-1!=m.appVersion.indexOf("X11")?n=c.OS_UNIX:-1!=m.appVersion.indexOf("Linux")?n=c.OS_LINUX:q&&(n=c.OS_ANDROID);c.os=n;c.garbageCollect=function(){};c.dumpRoot=function(){};c.restartVM=function(){};c.dump=function(){var i;i=""+("isMobile : "+this.isMobile+"\r\n");i+="language : "+this.language+"\r\n";i+="browserType : "+this.browserType+"\r\n";i+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";i+="os : "+this.os+"\r\n";cc.log(i)}};cc.ORIENTATION_PORTRAIT=0;cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;cc.ORIENTATION_LANDSCAPE_LEFT=2;cc.ORIENTATION_LANDSCAPE_RIGHT=3;cc._drawingUtil=null;cc._renderContext=null;cc._canvas=null;cc._gameDiv=null;cc._rendererInitialized=!1;cc._setupCalled=!1;cc._setup=function(e,f,a){if(!cc._setupCalled){cc._setupCalled=!0;var b=window;b.requestAnimFrame=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame;var c=cc.$(e)||cc.$("#"+e),d;"CANVAS"==c.tagName?(f=f||c.width,a=a||c.height,d=cc.container=cc.newElement("DIV"),e=cc._canvas=c,e.parentNode.insertBefore(d,e),e.appendTo(d),d.setAttribute("id","Cocos2dGameContainer")):("DIV"!=c.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),f=f||c.clientWidth,a=a||c.clientHeight,d=cc.container=c,e=cc._canvas=cc.$(cc.newElement("CANVAS")),c.appendChild(e));e.addClass("gameCanvas");e.setAttribute("width",f||480);e.setAttribute("height",a||320);e.setAttribute("tabindex",99);e.style.outline="none";c=d.style;c.width=(f||480)+"px";c.height=(a||320)+"px";c.margin="0 auto";c.position="relative";c.overflow="hidden";d.top="100%";cc._renderType==cc._RENDER_TYPE_WEBGL&&(cc._renderContext=cc.webglContext=cc.create3DContext(e,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!1}));cc._renderContext?(b.gl=cc._renderContext,cc._drawingUtil=new cc.DrawingPrimitiveWebGL(cc._renderContext),cc._rendererInitialized=!0,cc.textureCache._initializingRenderer(),cc.shaderCache._init()):(cc._renderContext=e.getContext("2d"),cc._mainRenderContextBackup=cc._renderContext,cc._renderContext.translate(0,e.height),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(cc._renderContext):null);cc._gameDiv=d;cc.log(cc.ENGINE_VERSION);cc._setContextMenuEnable(!1);cc.sys.isMobile&&(f=cc.newElement("style"),f.type="text/css",document.body.appendChild(f),f.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");cc.view=cc.EGLView._getInstance();cc.inputManager.registerSystemEvent(cc._canvas);cc.director=cc.Director._getInstance();cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view);cc.winSize=cc.director.getWinSize();cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser}};cc._checkWebGLRenderMode=function(){if(cc._renderType!==cc._RENDER_TYPE_WEBGL){throw"This feature supports WebGL render mode only."}};cc._isContextMenuEnable=!1;cc._setContextMenuEnable=function(a){cc._isContextMenuEnable=a;cc._canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable){return !1}}};cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",_eventHide:null,_eventShow:null,_onBeforeStartArr:[],CONFIG_KEY:{engineDir:"engineDir",dependencies:"dependencies",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList",classReleaseMode:"classReleaseMode"},_prepareCalled:!0,_prepared:!0,_paused:!0,_intervalId:null,config:null,onStart:null,onStop:null,setFrameRate:function(a){this.config[this.CONFIG_KEY.frameRate]=a;this._intervalId&&clearInterval(this._intervalId);this._paused=!0;this._runMainLoop()},_runMainLoop:function(){var d=this,e,f=d.config,g=d.CONFIG_KEY,a=window,b=f[g.frameRate],c=cc.director;c.setDisplayStats(f[g.showFPS]);a.requestAnimFrame&&60==b?(e=function(){d._paused||(c.mainLoop(),a.requestAnimFrame(e))},a.requestAnimFrame(e)):(e=function(){c.mainLoop()},d._intervalId=setInterval(e,1000/b));d._paused=!1},run:function(b){var c=this,a=function(){b&&(c.config[c.CONFIG_KEY.id]=b);c._prepareCalled?cc._supportRender&&(c._checkPrepare=setInterval(function(){c._prepared&&(cc._setup(c.config[c.CONFIG_KEY.id]),c._runMainLoop(),c._eventHide=c._eventHide||new cc.EventCustom(c.EVENT_HIDE),c._eventHide.setUserData(c),c._eventShow=c._eventShow||new cc.EventCustom(c.EVENT_SHOW),c._eventShow.setUserData(c),c.onStart(),clearInterval(c._checkPrepare))},10)):c.prepare(function(){cc._supportRender&&(cc._setup(c.config[c.CONFIG_KEY.id]),c._runMainLoop(),c._eventHide=c._eventHide||new cc.EventCustom(c.EVENT_HIDE),c._eventHide.setUserData(c),c._eventShow=c._eventShow||new cc.EventCustom(c.EVENT_SHOW),c._eventShow.setUserData(c),c.onStart())})};document.body?a():cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);a()},!1)},_initConfig:function(){var g=this.CONFIG_KEY,h=function(i){i[g.engineDir]=i[g.engineDir]||"frameworks/cocos2d-html5";null==i[g.debugMode]&&(i[g.debugMode]=0);i[g.frameRate]=i[g.frameRate]||60;null==i[g.renderMode]&&(i[g.renderMode]=1);return i};if(document.ccConfig){this.config=h(document.ccConfig)}else{try{for(var k=document.getElementsByTagName("script"),m=0;m<k.length;m++){var a=k[m].getAttribute("cocos");if(""==a||a){break}}var b,c,d;if(m<k.length){if(b=k[m].src){d=/(.*)\//.exec(b)[0],cc.loader.resPath=d,b=cc.path.join(d,"project.json")}c=cc.loader._loadTxtSync(b)}c||(c=cc.loader._loadTxtSync("project.json"));var e=JSON.parse(c);this.config=h(e||{})}catch(f){cc.log("Failed to read or parse project.json"),this.config=h({})}}cc._initSys(this.config,g)},_jsAddedCache:{},_getJsListOfModule:function(g,h,k){var m=this._jsAddedCache;if(m[h]){return null}k=k||"";var a=[],b=g[h];if(!b){throw"can not find module ["+h+"]"}h=cc.path;for(var c=0,d=b.length;c<d;c++){var e=b[c];if(!m[e]){var f=h.extname(e);f?".js"==f.toLowerCase()&&a.push(h.join(k,e)):(f=this._getJsListOfModule(g,e,k))&&(a=a.concat(f));m[e]=1}}return a},prepare:function(d){var e=this,f=e.config,g=e.CONFIG_KEY,a=f[g.engineDir],b=cc.loader;if(cc._supportRender){e._prepareCalled=!0;var c=f[g.jsList]||[];cc.Class?b.loadJsWithImg("",c,function(h){if(h){throw h}e._prepared=!0;d&&d()}):(g=cc.path.join(a,"moduleConfig.json"),b.loadJson(g,function(k,m){if(k){throw k}var j=f.modules||[],i=m.module,n=[];cc._renderType==cc._RENDER_TYPE_WEBGL?j.splice(0,0,"shaders"):0>j.indexOf("core")&&j.splice(0,0,"core");for(var q=0,o=j.length;q<o;q++){var h=e._getJsListOfModule(i,j[q],a);h&&(n=n.concat(h))}n=n.concat(c);cc.loader.loadJsWithImg(n,function(r){if(r){throw r}e._prepared=!0;d&&d()})}))}else{cc.error("Can not support render!")}}};cc.game._initConfig();cc.loader.loadBinary=function(d,e){var a=this,b=this.getXMLHttpRequest(),c="load "+d+" failed!";b.open("GET",d,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(b.setRequestHeader("Accept-Charset","x-user-defined"),b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var f=cc._convertResponseBodyToText(b.responseBody);e(null,a._str2Uint8Array(f))}else{e(c)}}):(b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dx-user-defined"),b.onload=function(){4==b.readyState&&200==b.status?e(null,a._str2Uint8Array(b.responseText)):e(c)});b.send(null)};cc.loader._str2Uint8Array=function(b){if(!b){return null}for(var c=new Uint8Array(b.length),a=0;a<b.length;a++){c[a]=b.charCodeAt(a)&255}return c};cc.loader.loadBinarySync=function(b){var c=this.getXMLHttpRequest(),a="load "+b+" failed!";c.open("GET",b,!1);b=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){c.setRequestHeader("Accept-Charset","x-user-defined");c.send(null);if(200!=c.status){return cc.log(a),null}(c=cc._convertResponseBodyToText(c.responseBody))&&(b=this._str2Uint8Array(c))}else{c.overrideMimeType&&c.overrideMimeType("text/plain; charset\x3dx-user-defined");c.send(null);if(200!=c.status){return cc.log(a),null}b=this._str2Uint8Array(c.responseText)}return b};var Uint8Array=Uint8Array||Array;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var IEBinaryToArray_ByteStr_Script='\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr \x3d CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex \x3d LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last \x3d Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last \x3d ""\r\n   End If\r\nEnd Function\r\n',myVBScript=cc.newElement("script");myVBScript.type="text/vbscript";myVBScript.textContent=IEBinaryToArray_ByteStr_Script;document.body.appendChild(myVBScript);cc._convertResponseBodyToText=function(c){for(var d={},a=0;256>a;a++){for(var b=0;256>b;b++){d[String.fromCharCode(a+256*b)]=String.fromCharCode(a)+String.fromCharCode(b)}}a=IEBinaryToArray_ByteStr(c);c=IEBinaryToArray_ByteStr_Last(c);return a.replace(/[\s\S]/g,function(e){return d[e]})+c}}var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),compileSuper:function(d,e,f){d=d.toString();var g=d.indexOf("("),a=d.indexOf(")"),g=d.substring(g+1,a),g=g.trim(),a=d.indexOf("{"),b=d.lastIndexOf("}");for(d=d.substring(a+1,b);-1!=d.indexOf("this._super");){var a=d.indexOf("this._super"),b=d.indexOf("(",a),c=d.indexOf(")",b),c=d.substring(b+1,c),c=(c=c.trim())?",":"";d=d.substring(0,a)+"ClassManager["+f+"]."+e+".call(this"+c+d.substring(b+1)}return Function(g,d)},getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};ClassManager.compileSuper.ClassManager=ClassManager;(function(){var a=/\b_super\b/,b=cc.game.config[cc.game.CONFIG_KEY.classReleaseMode];b&&console.log("release Mode");cc.Class=function(){};cc.Class.extend=function(d){function e(){this.__instanceId=ClassManager.getNewInstanceId();this.ctor&&this.ctor.apply(this,arguments)}var g=this.prototype,m=Object.create(g),q=ClassManager.getNewID();ClassManager[q]=g;var s={writable:!0,enumerable:!1,configurable:!0};m.__instanceId=null;e.id=q;s.value=q;Object.defineProperty(m,"__pid",s);e.prototype=m;s.value=e;Object.defineProperty(e.prototype,"constructor",s);this.__getters__&&(e.__getters__=cc.clone(this.__getters__));this.__setters__&&(e.__setters__=cc.clone(this.__setters__));for(var f=0,h=arguments.length;f<h;++f){var k=arguments[f],n;for(n in k){var t="function"===typeof k[n],r="function"===typeof g[n],v=a.test(k[n]);b&&t&&r&&v?(s.value=ClassManager.compileSuper(k[n],n,q),Object.defineProperty(m,n,s)):t&&r&&v?(s.value=function(i,j){return function(){var o=this._super;this._super=g[i];var x=j.apply(this,arguments);this._super=o;return x}}(n,k[n]),Object.defineProperty(m,n,s)):t?(s.value=k[n],Object.defineProperty(m,n,s)):m[n]=k[n];if(t){var u,w;if(this.__getters__&&this.__getters__[n]){var t=this.__getters__[n],c;for(c in this.__setters__){if(this.__setters__[c]==t){w=c;break}}cc.defineGetterSetter(m,t,k[n],k[w]?k[w]:m[w],n,w)}if(this.__setters__&&this.__setters__[n]){t=this.__setters__[n];for(c in this.__getters__){if(this.__getters__[c]==t){u=c;break}}cc.defineGetterSetter(m,t,k[u]?k[u]:m[u],k[n],u,n)}}}}e.extend=cc.Class.extend;e.implement=function(i){for(var j in i){m[j]=i[j]}};return e};Function.prototype.bind=Function.prototype.bind||function(c){var d=this;return function(){var e=Array.prototype.slice.call(arguments);return d.apply(c||null,e)}}})();cc.defineGetterSetter=function(e,f,g,h,k,m){if(e.__defineGetter__){g&&e.__defineGetter__(f,g),h&&e.__defineSetter__(f,h)}else{if(Object.defineProperty){var n={enumerable:!1,configurable:!0};g&&(n.get=g);h&&(n.set=h);Object.defineProperty(e,f,n)}else{throw Error("browser does not support getters")}}if(!k&&!m){for(var n=null!=g,q=void 0!=h,a=Object.getOwnPropertyNames(e),b=0;b<a.length;b++){var c=a[b];if(!((e.__lookupGetter__?e.__lookupGetter__(c):Object.getOwnPropertyDescriptor(e,c))||"function"!==typeof e[c])){var d=e[c];if(n&&d===g&&(k=c,!q||m)){break}if(q&&d===h&&(m=c,!n||k)){break}}}}e=e.constructor;k&&(e.__getters__||(e.__getters__={}),e.__getters__[k]=f);m&&(e.__setters__||(e.__setters__={}),e.__setters__[m]=f)};cc.clone=function(c){var d=c.constructor?new c.constructor:{},a;for(a in c){var b=c[a];d[a]="object"==typeof b&&b&&!(b instanceof cc.Node)&&!(b instanceof HTMLElement)?cc.clone(b):b}return d};cc=cc||{};cc._tmp=cc._tmp||{};cc.associateWithNative=function(a,b){};cc.KEY={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,Delete:46,"0":48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,",":186,equal:187,"\x3d":187,";":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,"]":221,closebracket:221,backslash:220,quote:222,space:32};cc.FMT_JPG=0;cc.FMT_PNG=1;cc.FMT_TIFF=2;cc.FMT_RAWDATA=3;cc.FMT_WEBP=4;cc.FMT_UNKNOWN=5;cc.getImageFormatByData=function(a){return 8<a.length&&137==a[0]&&80==a[1]&&78==a[2]&&71==a[3]&&13==a[4]&&10==a[5]&&26==a[6]&&10==a[7]?cc.FMT_PNG:2<a.length&&(73==a[0]&&73==a[1]||77==a[0]&&77==a[1]||255==a[0]&&216==a[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN};cc.inherits=function(b,c){function a(){}a.prototype=c.prototype;b.superClass_=c.prototype;b.prototype=new a;b.prototype.constructor=b};cc.base=function(d,e,f){var g=arguments.callee.caller;if(g.superClass_){return ret=g.superClass_.constructor.apply(d,Array.prototype.slice.call(arguments,1))}for(var a=Array.prototype.slice.call(arguments,2),b=!1,c=d.constructor;c;c=c.superClass_&&c.superClass_.constructor){if(c.prototype[e]===g){b=!0}else{if(b){return c.prototype[e].apply(d,a)}}}if(d[e]===g){return d.constructor.prototype[e].apply(d,a)}throw Error("cc.base called from a method of one name to a method of a different name")};cc.Point=function(a,b){this.x=a||0;this.y=b||0};cc.p=function(a,b){return void 0==a?{x:0,y:0}:void 0==b?{x:a.x,y:a.y}:{x:a,y:b}};cc.pointEqualToPoint=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y};cc.Size=function(a,b){this.width=a||0;this.height=b||0};cc.size=function(a,b){return void 0===a?{width:0,height:0}:void 0===b?{width:a.width,height:a.height}:{width:a,height:b}};cc.sizeEqualToSize=function(a,b){return a&&b&&a.width==b.width&&a.height==b.height};cc.Rect=function(c,d,a,b){this.x=c||0;this.y=d||0;this.width=a||0;this.height=b||0};cc.rect=function(c,d,a,b){return void 0===c?{x:0,y:0,width:0,height:0}:void 0===d?{x:c.x,y:c.y,width:c.width,height:c.height}:{x:c,y:d,width:a,height:b}};cc.rectEqualToRect=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height};cc._rectEqualToZero=function(a){return a&&0===a.x&&0===a.y&&0===a.width&&0===a.height};cc.rectContainsRect=function(a,b){return !a||!b?!1:!(a.x>=b.x||a.y>=b.y||a.x+a.width<=b.x+b.width||a.y+a.height<=b.y+b.height)};cc.rectGetMaxX=function(a){return a.x+a.width};cc.rectGetMidX=function(a){return a.x+a.width/2};cc.rectGetMinX=function(a){return a.x};cc.rectGetMaxY=function(a){return a.y+a.height};cc.rectGetMidY=function(a){return a.y+a.height/2};cc.rectGetMinY=function(a){return a.y};cc.rectContainsPoint=function(a,b){return b.x>=cc.rectGetMinX(a)&&b.x<=cc.rectGetMaxX(a)&&b.y>=cc.rectGetMinY(a)&&b.y<=cc.rectGetMaxY(a)};cc.rectIntersectsRect=function(d,e){var a=d.y+d.height,b=e.x+e.width,c=e.y+e.height;return !(d.x+d.width<e.x||b<d.x||a<e.y||c<d.y)};cc.rectOverlapsRect=function(a,b){return !(a.x+a.width<b.x||b.x+b.width<a.x||a.y+a.height<b.y||b.y+b.height<a.y)};cc.rectUnion=function(b,c){var a=cc.rect(0,0,0,0);a.x=Math.min(b.x,c.x);a.y=Math.min(b.y,c.y);a.width=Math.max(b.x+b.width,c.x+c.width)-a.x;a.height=Math.max(b.y+b.height,c.y+c.height)-a.y;return a};cc.rectIntersection=function(b,c){var a=cc.rect(Math.max(cc.rectGetMinX(b),cc.rectGetMinX(c)),Math.max(cc.rectGetMinY(b),cc.rectGetMinY(c)),0,0);a.width=Math.min(cc.rectGetMaxX(b),cc.rectGetMaxX(c))-cc.rectGetMinX(a);a.height=Math.min(cc.rectGetMaxY(b),cc.rectGetMaxY(c))-cc.rectGetMinY(a);return a};cc._tmp.PrototypeColor=function(){var a=cc.color;a._getWhite=function(){return a(255,255,255)};a._getYellow=function(){return a(255,255,0)};a._getBlue=function(){return a(0,0,255)};a._getGreen=function(){return a(0,255,0)};a._getRed=function(){return a(255,0,0)};a._getMagenta=function(){return a(255,0,255)};a._getBlack=function(){return a(0,0,0)};a._getOrange=function(){return a(255,127,0)};a._getGray=function(){return a(166,166,166)};cc.defineGetterSetter(a,"WHITE",a._getWhite);cc.defineGetterSetter(a,"YELLOW",a._getYellow);cc.defineGetterSetter(a,"BLUE",a._getBlue);cc.defineGetterSetter(a,"GREEN",a._getGreen);cc.defineGetterSetter(a,"RED",a._getRed);cc.defineGetterSetter(a,"MAGENTA",a._getMagenta);cc.defineGetterSetter(a,"BLACK",a._getBlack);cc.defineGetterSetter(a,"ORANGE",a._getOrange);cc.defineGetterSetter(a,"GRAY",a._getGray)};cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(a){return this._parseXML(a)},_parseXML:function(a){var b;this._isSupportDOMParser?b=this._parser.parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a));return b}});cc.PlistParser=cc.SAXParser.extend({parse:function(c){c=this._parseXML(c).documentElement;if("plist"!=c.tagName){throw"Not a plist file!"}for(var d=null,a=0,b=c.childNodes.length;a<b&&!(d=c.childNodes[a],1==d.nodeType);a++){}return this._parseNode(d)},_parseNode:function(b){var c=null,a=b.tagName;if("dict"==a){c=this._parseDict(b)}else{if("array"==a){c=this._parseArray(b)}else{if("string"==a){if(1==b.childNodes.length){c=b.firstChild.nodeValue}else{c="";for(a=0;a<b.childNodes.length;a++){c+=b.childNodes[a].nodeValue}}}else{"false"==a?c=!1:"true"==a?c=!0:"real"==a?c=parseFloat(b.firstChild.nodeValue):"integer"==a&&(c=parseInt(b.firstChild.nodeValue,10))}}}return c},_parseArray:function(d){for(var e=[],a=0,b=d.childNodes.length;a<b;a++){var c=d.childNodes[a];1==c.nodeType&&e.push(this._parseNode(c))}return e},_parseDict:function(e){for(var f={},a=null,b=0,c=e.childNodes.length;b<c;b++){var d=e.childNodes[b];1==d.nodeType&&("key"==d.tagName?a=d.firstChild.nodeValue:f[a]=this._parseNode(d))}return f}});cc._txtLoader={load:function(c,d,a,b){cc.loader.loadTxt(c,b)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(c,d,a,b){cc.loader.loadJson(c,b)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._imgLoader={load:function(c,d,a,b){cc.loader.cache[d]=cc.loader.loadImg(c,function(e,f){if(e){return b(e)}cc.textureCache.handleLoadedTexture(d);b(null,f)})}};cc.loader.register("png jpg bmp jpeg gif ico".split(" "),cc._imgLoader);cc._serverImgLoader={load:function(c,d,a,b){cc.loader.cache[d]=cc.loader.loadImg(a.src,function(e,f){if(e){return b(e)}cc.textureCache.handleLoadedTexture(d);b(null,f)})}};cc.loader.register(["serverImg"],cc._serverImgLoader);cc._plistLoader={load:function(c,d,a,b){cc.loader.loadTxt(c,function(e,f){if(e){return b(e)}b(null,cc.plistParser.parse(f))})}};cc.loader.register(["plist"],cc._plistLoader);cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(g,h,k){var m=document,a=cc.path,b=this.TYPE,c=cc.newElement("style");c.type="text/css";m.body.appendChild(c);var d="@font-face { font-family:"+g+"; src:";if(h instanceof Array){for(var e=0,f=h.length;e<f;e++){k=a.extname(h[e]).toLowerCase(),d+="url('"+h[e]+"') format('"+b[k]+"')",d+=e==f-1?";":","}}else{d+="url('"+h+"') format('"+b[k]+"');"}c.textContent+=d+"};";h=cc.newElement("div");k=h.style;k.fontFamily=g;h.innerHTML=".";k.position="absolute";k.left="-100px";k.top="-100px";m.body.appendChild(h)},load:function(c,d,a,b){d=a.type;c=a.name;d=a.srcs;"string"==typeof a?(d=cc.path.extname(a),c=cc.path.basename(a,d),this._loadFont(c,a,d)):this._loadFont(c,d);b(null,!0)}};cc.loader.register(["font","eot","ttf","woff","svg"],cc._fontLoader);cc._binaryLoader={load:function(c,d,a,b){cc.loader.loadBinary(c,b)}};window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-html5-v3.0 beta";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=0.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=0;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_SUPPORT=1;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;cc.SPRITEBATCHNODE_DEBUG_DRAW=0;cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.IS_RETINA_DISPLAY_SUPPORTED=1;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(a){var b=this==cc?document:this;if(a=a instanceof HTMLElement?a:b.querySelector(a)){a.find=a.find||cc.$,a.hasClass=a.hasClass||function(c){return this.className.match(RegExp("(\\s|^)"+c+"(\\s|$)"))},a.addClass=a.addClass||function(c){this.hasClass(c)||(this.className&&(this.className+=" "),this.className+=c);return this},a.removeClass=a.removeClass||function(c){this.hasClass(c)&&(this.className=this.className.replace(c,""));return this},a.remove=a.remove||function(){this.parentNode&&this.parentNode.removeChild(this);return this},a.appendTo=a.appendTo||function(c){c.appendChild(this);return this},a.prependTo=a.prependTo||function(c){c.childNodes[0]?c.insertBefore(this,c.childNodes[0]):c.appendChild(this);return this},a.transforms=a.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this},a.position=a.position||{x:0,y:0},a.rotation=a.rotation||0,a.scale=a.scale||{x:1,y:1},a.skew=a.skew||{x:0,y:0},a.translates=function(c,d){this.position.x=c;this.position.y=d;this.transforms();return this},a.rotate=function(c){this.rotation=c;this.transforms();return this},a.resize=function(c,d){this.scale.x=c;this.scale.y=d;this.transforms();return this},a.setSkew=function(c,d){this.skew.x=c;this.skew.y=d;this.transforms();return this}}return a};switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform";cc.$.translate=cc.$.hd?function(a){return"translate3d("+a.x+"px, "+a.y+"px, 0) "}:function(a){return"translate("+a.x+"px, "+a.y+"px) "};cc.$.rotate=cc.$.hd?function(a){return"rotateZ("+a+"deg) "}:function(a){return"rotate("+a+"deg) "};cc.$.scale=function(a){return"scale("+a.x+", "+a.y+") "};cc.$.skew=function(a){return"skewX("+-a.x+"deg) skewY("+a.y+"deg)"};cc.$new=function(a){return cc.$(document.createElement(a))};cc.$.findpos=function(b){var c=0,a=0;do{c+=b.offsetLeft,a+=b.offsetTop}while(b=b.offsetParent);return{x:c,y:a}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(c,d,a){if("object"==typeof a&&"undefined"!=typeof a.x&&"undefined"!=typeof a.y){var b=a[c];a[c]=a[d];a[d]=b}else{cc.log(cc._LogInfos.swap)}};cc.lerp=function(b,c,a){return b+(c-b)*a};cc.rand=function(){return 16777215*Math.random()};cc.randomMinus1To1=function(){return 2*(Math.random()-0.5)};cc.random0To1=Math.random;cc.degreesToRadians=function(a){return a*cc.RAD};cc.radiansToDegrees=function(a){return a*cc.DEG};cc.radiansToDegress=function(a){cc.log(cc._LogInfos.radiansToDegress);return a*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770;cc.BLEND_DST=771;cc.nodeDrawSetup=function(a){a._shaderProgram&&(a._shaderProgram.use(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};cc.enableDefaultGLStates=function(){};cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(a){cc.g_NumberOfDraws+=a};cc.FLT_EPSILON=1.192092896e-7;cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1};cc.pointPointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.p(a.x*b,a.y*b)};cc.pointPixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.p(a.x/b,a.y/b)};cc._pointPixelsToPointsOut=function(b,c){var a=cc.contentScaleFactor();c.x=b.x/a;c.y=b.y/a};cc.sizePointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.size(a.width*b,a.height*b)};cc.sizePixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.size(a.width/b,a.height/b)};cc._sizePixelsToPointsOut=function(b,c){var a=cc.contentScaleFactor();c.width=b.width/a;c.height=b.height/a};cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var b=cc.contentScaleFactor();return cc.rect(a.x/b,a.y/b,a.width/b,a.height/b)}:function(a){return a};cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(a){var b=cc.contentScaleFactor();return cc.rect(a.x*b,a.y*b,a.width*b,a.height*b)}:function(a){return a};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.checkGLErrorDebug=function(){if(cc.renderMode==cc._RENDER_TYPE_WEBGL){var a=cc._renderContext.getError();a&&cc.log(CC._localZOrder.checkGLErrorDebug,a)}};cc.DEVICE_ORIENTATION_PORTRAIT=0;cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1;cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2;cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3;cc.DEVICE_MAX_ORIENTATIONS=2;cc.VERTEX_ATTRIB_FLAG_NONE=0;cc.VERTEX_ATTRIB_FLAG_POSITION=1;cc.VERTEX_ATTRIB_FLAG_COLOR=2;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=3;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;cc.NORMAL_TAG=8801;cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc.Color=function(c,d,a,b){this.r=c||0;this.g=d||0;this.b=a||0;this.a=b||255};cc.color=function(c,d,a,b){return void 0===c?{r:0,g:0,b:0,a:255}:"string"===typeof c?cc.hexToColor(c):"object"===typeof c?{r:c.r,g:c.g,b:c.b,a:c.a||255}:{r:c,g:d,b:a,a:b||255}};cc.colorEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};cc.Acceleration=function(c,d,a,b){this.x=c||0;this.y=d||0;this.z=a||0;this.timestamp=b||0};cc.Vertex2F=function(a,b){this.x=a||0;this.y=b||0};cc.vertex2=function(a,b){return new cc.Vertex2F(a,b)};cc.Vertex3F=function(b,c,a){this.x=b||0;this.y=c||0;this.z=a||0};cc.vertex3=function(b,c,a){return new cc.Vertex3F(b,c,a)};cc.Tex2F=function(a,b){this.u=a||0;this.v=b||0};cc.tex2=function(a,b){return new cc.Tex2F(a,b)};cc.BlendFunc=function(a,b){this.src=a;this.dst=b};cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(a){a=a.replace(/^#?/,"0x");a=parseInt(a);return cc.color(a>>16,(a>>8)%256,a%256)};cc.colorToHex=function(c){var d=c.r.toString(16),a=c.g.toString(16),b=c.b.toString(16);return"#"+(16>c.r?"0"+d:d)+(16>c.g?"0"+a:a)+(16>c.b?"0"+b:b)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|10*Math.random())},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(b,c){if(null!=c){var a=this.__getKey();this._keyMapTb[a]=c;this._valueMapTb[a]=b}},objectForKey:function(b){if(null==b){return null}var c=this._keyMapTb,a;for(a in c){if(c[a]===b){return this._valueMapTb[a]}}return null},valueForKey:function(a){return this.objectForKey(a)},removeObjectForKey:function(b){if(null!=b){var c=this._keyMapTb,a;for(a in c){if(c[a]===b){delete this._valueMapTb[a];delete c[a];break}}}},removeObjectsForKeys:function(a){if(null!=a){for(var b=0;b<a.length;b++){this.removeObjectForKey(a[b])}}},allKeys:function(){var b=[],c=this._keyMapTb,a;for(a in c){b.push(c[a])}return b},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});cc.FontDefinition=function(){this.fontName="Arial";this.fontSize=12;this.textAlign=cc.TEXT_ALIGNMENT_CENTER;this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this.fillStyle=cc.color(255,255,255,255);this.boundingHeight=this.boundingWidth=0;this.strokeEnabled=!1;this.strokeStyle=cc.color(255,255,255,255);this.lineWidth=1;this.shadowEnabled=!1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowOpacity=1};cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert("function"===typeof cc._tmp.WebGLColor,cc._LogInfos.MissingFile,"CCTypesWebGL.js"),cc._tmp.WebGLColor(),delete cc._tmp.WebGLColor);cc.assert("function"===typeof cc._tmp.PrototypeColor,cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();delete cc._tmp.PrototypeColor;cc.Touches=[];cc.TouchesIntergerDict={};cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!0,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_supportTouch:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,ctor:function(){var c=document,d=cc.ContainerStrategy,a=cc.ContentStrategy;this._frame=cc.container.parentNode===c.body?c.documentElement:cc.container.parentNode;this._frameSize=cc.size(0,0);this._initFrameSize();var c=cc._canvas.width,b=cc._canvas.height;this._designResolutionSize=cc.size(c,b);this._originalDesignResolutionSize=cc.size(c,b);this._viewPortRect=cc.rect(0,0,c,b);this._visibleRect=cc.rect(0,0,c,b);this._contentTranslateLeftTop={left:0,top:0};this._viewName="Cocos2dHTML5";c=cc.sys;this.enableRetina(c.os==c.OS_IOS||c.os==c.OS_OSX);cc.visibleRect&&cc.visibleRect.init(this._visibleRect);this._rpExactFit=new cc.ResolutionPolicy(d.EQUAL_TO_FRAME,a.EXACT_FIT);this._rpShowAll=new cc.ResolutionPolicy(d.PROPORTION_TO_FRAME,a.SHOW_ALL);this._rpNoBorder=new cc.ResolutionPolicy(d.EQUAL_TO_FRAME,a.NO_BORDER);this._rpFixedHeight=new cc.ResolutionPolicy(d.EQUAL_TO_FRAME,a.FIXED_HEIGHT);this._rpFixedWidth=new cc.ResolutionPolicy(d.EQUAL_TO_FRAME,a.FIXED_WIDTH);this._hDC=cc._canvas;this._hRC=cc._renderContext},_resizeEvent:function(){var a=this._originalDesignResolutionSize.width,b=this._originalDesignResolutionSize.height;this._resizeCallback&&(this._initFrameSize(),this._resizeCallback.call());0<a&&this.setDesignResolutionSize(a,b,this._resolutionPolicy)},resizeWithBrowserSize:function(a){a?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,a=this._resizeEvent.bind(this),cc._addEventListener(window,"resize",a,!1)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!0,a=this._resizeEvent.bind(this),window.removeEventListener("resize",a,!1))},setResizeCallback:function(a){if("function"==typeof a||null==a){this._resizeCallback=a}},_initFrameSize:function(){var a=this._frameSize;a.width=this._frame.clientWidth;a.height=this._frame.clientHeight},_adjustSizeKeepCanvasSize:function(){var a=this._originalDesignResolutionSize.width,b=this._originalDesignResolutionSize.height;0<a&&this.setDesignResolutionSize(a,b,this._resolutionPolicy)},_setViewPortMeta:function(e,f){if(this._isAdjustViewPort){var a={"user-scalable":"no","maximum-scale":"1.0",width:"device-width"},b=document.getElementsByName("viewport"),c;0==b.length?(b=cc.newElement("meta"),b.name="viewport",b.content="",document.head.appendChild(b)):b=b[0];c=b.content;for(var d in a){RegExp(d).test(c)||(c+=(""==c?"":",")+d+"\x3d"+a[d])}b.content=c}},_setScaleXYForRenderTexture:function(){var a=cc.contentScaleFactor();this._scaleY=this._scaleX=a},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(a){this._isAdjustViewPort=a},enableRetina:function(a){this._retinaEnabled=a?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(a){this._autoFullScreen=a?!0:!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return null!=this._hDC&&null!=this._hRC},setFrameZoomFactor:function(a){this._frameZoomFactor=a;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(a){},setContentTranslateLeftTop:function(a,b){this._contentTranslateLeftTop={left:a,top:b}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(a,b){this._frameSize.width=a;this._frameSize.height=b;this._frame.style.width=a+"px";this._frame.style.height=b+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},canSetContentScaleFactor:function(){return !0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(a){if(a instanceof cc.ResolutionPolicy){this._resolutionPolicy=a}else{var b=cc.ResolutionPolicy;a===b.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit);a===b.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll);a===b.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder);a===b.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight);a===b.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(e,f,a){if(isNaN(e)||0==e||isNaN(f)||0==f){cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)}else{this.setResolutionPolicy(a);var b=this._resolutionPolicy;if(b){b.preApply(this);var c=this._frameSize.width,d=this._frameSize.height;cc.sys.isMobile&&this._setViewPortMeta(this._frameSize.width,this._frameSize.height);this._initFrameSize();a==this._resolutionPolicy&&e==this._originalDesignResolutionSize.width&&f==this._originalDesignResolutionSize.height&&c==this._frameSize.width&&d==this._frameSize.height||(this._designResolutionSize=cc.size(e,f),this._originalDesignResolutionSize=cc.size(e,f),e=b.apply(this,this._designResolutionSize),e.scale&&2==e.scale.length&&(this._scaleX=e.scale[0],this._scaleY=e.scale[1]),e.viewport&&(e=this._viewPortRect=e.viewport,f=this._visibleRect,f.width=cc._canvas.width/this._scaleX,f.height=cc._canvas.height/this._scaleY,f.x=-e.x/this._scaleX,f.y=-e.y/this._scaleY),e=cc.director,cc.winSize.width=e._winSizeInPoints.width=this._visibleRect.width,cc.winSize.height=e._winSizeInPoints.height=this._visibleRect.height,b.postApply(this),cc._renderType==cc._RENDER_TYPE_WEBGL&&(e._createStatsLabel(),e.setGLDefaultValues()),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect))}else{cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2)}}},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setViewPortInPoints:function(d,e,f,g){var a=this._frameZoomFactor,b=this._scaleX,c=this._scaleY;cc._renderContext.viewport(d*b*a+this._viewPortRect.x*a,e*c*a+this._viewPortRect.y*a,f*b*a,g*c*a)},setScissorInPoints:function(d,e,f,g){var a=this._frameZoomFactor,b=this._scaleX,c=this._scaleY;cc._renderContext.scissor(d*b*a+this._viewPortRect.x*a,e*c*a+this._viewPortRect.y*a,f*b*a,g*c*a)},isScissorEnabled:function(){var a=cc._renderContext;return a.isEnabled(a.SCISSOR_TEST)},getScissorRect:function(){var b=cc._renderContext,c=this._scaleX,a=this._scaleY,b=b.getParameter(b.SCISSOR_BOX);return cc.rect((b[0]-this._viewPortRect.x)/c,(b[1]-this._viewPortRect.y)/a,b[2]/c,b[3]/a)},setViewName:function(a){null!=a&&0<a.length&&(this._viewName=a)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(b,c,a){return{x:this._devicePixelRatio*(b-a.left),y:this._devicePixelRatio*(a.top+a.height-c)}},_convertMouseToLocationInView:function(b,c){var a=this._viewPortRect;b.x=(this._devicePixelRatio*(b.x-c.left)-a.x)/this._scaleX;b.y=(this._devicePixelRatio*(c.top+c.height-b.y)-a.y)/this._scaleY},_convertTouchesWithScale:function(c){for(var d=this._viewPortRect,e=this._scaleX,f=this._scaleY,g,h,a,b=0;b<c.length;b++){g=c[b],h=g._point,a=g._prevPoint,g._setPoint((h.x-d.x)/e,(h.y-d.y)/f),g._setPrevPoint((a.x-d.x)/e,(a.y-d.y)/f)}}});cc.EGLView._getInstance=function(){this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize());return this._instance};cc.ContainerStrategy=cc.Class.extend({preApply:function(a){},apply:function(a,b){},postApply:function(a){},_setupContainer:function(e,f,a){var b=cc._canvas,c=cc.container;c.style.width=b.style.width=f+"px";c.style.height=b.style.height=a+"px";c=e._devicePixelRatio=1;e.isRetinaEnabled()&&(c=e._devicePixelRatio=window.devicePixelRatio||1);b.width=f*c;b.height=a*c;e=document.body;var d;if(e&&(d=e.style)){d.paddingTop=d.paddingTop||"0px",d.paddingRight=d.paddingRight||"0px",d.paddingBottom=d.paddingBottom||"0px",d.paddingLeft=d.paddingLeft||"0px",d.borderTop=d.borderTop||"0px",d.borderRight=d.borderRight||"0px",d.borderBottom=d.borderBottom||"0px",d.borderLeft=d.borderLeft||"0px",d.marginTop=d.marginTop||"0px",d.marginRight=d.marginRight||"0px",d.marginBottom=d.marginBottom||"0px",d.marginLeft=d.marginLeft||"0px"}},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var a=document.body.style;a.width=window.innerWidth+"px";a.height=window.innerHeight+"px";a.overflow="hidden";a=cc.container.style;a.position="fixed";a.left=a.top="0px";document.body.scrollTop=0}});cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(e,f,a,b,c,d){2>Math.abs(e-a)&&(a=e);2>Math.abs(f-b)&&(b=f);e=cc.rect(Math.round((e-a)/2),Math.round((f-b)/2),a,b);cc._renderType==cc._RENDER_TYPE_CANVAS&&cc._renderContext.translate(e.x,e.y+b);this._result.scale=[c,d];this._result.viewport=e;return this._result},preApply:function(a){},apply:function(a,b){return{scale:[1,1]}},postApply:function(a){}});(function(){var d=cc.ContainerStrategy.extend({apply:function(f){this._setupContainer(f,f._frameSize.width,f._frameSize.height)}}),e=cc.ContainerStrategy.extend({apply:function(q,r){var s=q._frameSize.width,t=q._frameSize.height,u=cc.container.style,i=r.width,j=r.height,f=s/i,n=t/j,h,g;f<n?(h=s,g=j*f):(h=i*n,g=t);i=Math.round((s-h)/2);g=Math.round((t-g)/2);this._setupContainer(q,s-2*i,t-2*g);u.marginLeft=i+"px";u.marginRight=i+"px";u.marginTop=g+"px";u.marginBottom=g+"px"}});d.extend({preApply:function(f){this._super(f);f._frame=document.documentElement},apply:function(f){this._super(f);this._fixContainer()}});e.extend({preApply:function(f){this._super(f);f._frame=document.documentElement},apply:function(f,g){this._super(f,g);this._fixContainer()}});var a=cc.ContainerStrategy.extend({apply:function(f){this._setupContainer(f,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new d;cc.ContainerStrategy.PROPORTION_TO_FRAME=new e;cc.ContainerStrategy.ORIGINAL_CONTAINER=new a;var d=cc.ContentStrategy.extend({apply:function(g,h){var i=cc._canvas.width,f=cc._canvas.height;return this._buildResult(i,f,i,f,i/h.width,f/h.height)}}),e=cc.ContentStrategy.extend({apply:function(q,r){var s=cc._canvas.width,t=cc._canvas.height,u=r.width,i=r.height,j=s/u,f=t/i,n=0,h,g;j<f?(n=j,h=s,g=i*n):(n=f,h=u*n,g=t);return this._buildResult(s,t,h,g,n,n)}}),a=cc.ContentStrategy.extend({apply:function(q,r){var s=cc._canvas.width,t=cc._canvas.height,u=r.width,i=r.height,j=s/u,f=t/i,n,h,g;j<f?(n=f,h=u*n,g=t):(n=j,h=s,g=i*n);return this._buildResult(s,t,h,g,n,n)}}),b=cc.ContentStrategy.extend({apply:function(f,g){var h=cc._canvas.width,i=cc._canvas.height,j=i/g.height;return this._buildResult(h,i,h,i,j,j)},postApply:function(f){cc.director._winSizeInPoints=f.getVisibleSize()}}),c=cc.ContentStrategy.extend({apply:function(f,g){var h=cc._canvas.width,i=cc._canvas.height,j=h/g.width;return this._buildResult(h,i,h,i,j,j)},postApply:function(f){cc.director._winSizeInPoints=f.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new d;cc.ContentStrategy.SHOW_ALL=new e;cc.ContentStrategy.NO_BORDER=new a;cc.ContentStrategy.FIXED_HEIGHT=new b;cc.ContentStrategy.FIXED_WIDTH=new c})();cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(a,b){this.setContainerStrategy(a);this.setContentStrategy(b)},preApply:function(a){this._containerStrategy.preApply(a);this._contentStrategy.preApply(a)},apply:function(a,b){this._containerStrategy.apply(a,b);return this._contentStrategy.apply(a,b)},postApply:function(a){this._containerStrategy.postApply(a);this._contentStrategy.postApply(a)},setContainerStrategy:function(a){a instanceof cc.ContainerStrategy&&(this._containerStrategy=a)},setContentStrategy:function(a){a instanceof cc.ContentStrategy&&(this._contentStrategy=a)}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var c,d,a=this._fnMap,b;c=0;for(l=a.length;c<l;c++){if((d=a[c])&&d[1] in document){c=0;for(b=d.length;c<b;c++){this._fn[a[0][c]]=d[c]}break}}this._supportsFullScreen=void 0!=this._fn.requestFullscreen;this._touchEvent="ontouchstart" in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen&&document[this._fn.fullscreenEnabled]},requestFullScreen:function(b,c){if(this._supportsFullScreen){b=b||document.documentElement;b[this._fn.requestFullscreen]();if(c){var a=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(a,this._preOnFullScreenChange);this._preOnFullScreenChange=c;cc._addEventListener(document,a,c,!1)}return b[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(d,e){function a(){c.requestFullScreen(d,e);b.removeEventListener(c._touchEvent,a)}d=d||document.body;var b=cc._canvas||d,c=this;this.requestFullScreen(d,e);cc._addEventListener(b,this._touchEvent,a)}};cc.screen.init();cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(e){var f=this.width=e.width,a=this.height=e.height,b=e.x;e=e.y;var c=e+a,d=b+f;this.topLeft.x=b;this.topLeft.y=c;this.topRight.x=d;this.topRight.y=c;this.top.x=b+f/2;this.top.y=c;this.bottomLeft.x=b;this.bottomLeft.y=e;this.bottomRight.x=d;this.bottomRight.y=e;this.bottom.x=b+f/2;this.bottom.y=e;this.center.x=b+f/2;this.center.y=e+a/2;this.left.x=b;this.left.y=e+a/2;this.right.x=d;this.right.y=e+a/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var a=this._indexBitsUsed,b=0;b<this._maxTouches;b++){if(!(a&1)){return this._indexBitsUsed|=1<<b,b}a>>=1}return -1},_removeUsedIndexBit:function(a){0>a||a>=this._maxTouches||(a=~(1<<a),this._indexBitsUsed&=a)},_glView:null,handleTouchesBegin:function(c){for(var d,e,f,g=[],h=this._touchesIntegerDict,a=0,b=c.length;a<b;a++){d=c[a],f=d.getID(),e=h[f],null==e&&(e=this._getUnUsedIndex(),-1==e?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,e):(d=this._touches[e]=d,h[f]=e,g.push(d)))}0<g.length&&(this._glView._convertTouchesWithScale(g),c=new cc.EventTouch(g),c._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(c))},handleTouchesMove:function(d){for(var e,f,g=[],a=this._touches,b=0,c=d.length;b<c;b++){e=d[b],f=e.getID(),f=this._touchesIntegerDict[f],null!=f&&a[f]&&(a[f]._setPoint(e._point),a[f]._setPrevPoint(e._prevPoint),g.push(a[f]))}0<g.length&&(this._glView._convertTouchesWithScale(g),d=new cc.EventTouch(g),d._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(d))},handleTouchesEnd:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(a))},handleTouchesCancel:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(a))},getSetOfTouchesEndOrCancel:function(h){for(var k,a,b,c=[],d=this._touches,e=this._touchesIntegerDict,f=0,g=h.length;f<g;f++){k=h[f],b=k.getID(),a=e[b],null!=a&&d[a]&&(d[a]._setPoint(k._point),d[a]._setPrevPoint(k._prevPoint),c.push(d[a]),this._removeUsedIndexBit(a),delete e[b])}return c},getHTMLElementPosition:function(c){var d=document.documentElement,a=window,b=null,b="function"===typeof c.getBoundingClientRect?c.getBoundingClientRect():c instanceof HTMLCanvasElement?{left:0,top:0,width:c.width,height:c.height}:{left:0,top:0,width:parseInt(c.style.width),height:parseInt(c.style.height)};return{left:b.left+a.pageXOffset-d.clientLeft,top:b.top+a.pageYOffset-d.clientTop,width:b.width,height:b.height}},getPreTouch:function(d){for(var e=null,a=this._preTouchPool,b=d.getId(),c=a.length-1;0<=c;c--){if(a[c].getId()==b){e=a[c];break}}e||(e=d);return e},setPreTouch:function(d){for(var e=!1,a=this._preTouchPool,b=d.getId(),c=a.length-1;0<=c;c--){if(a[c].getId()==b){a[c]=d;e=!0;break}}e||(50>=a.length?a.push(d):(a[this._preTouchPoolPointer]=d,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(c,d,a){var b=this._preTouchPoint;c=this._glView.convertToLocationInView(c,d,a);d=new cc.Touch(c.x,c.y);d._setPrevPoint(b.x,b.y);b.x=c.x;b.y=c.y;return d},getMouseEvent:function(c,d,a){var b=this._prevMousePoint;this._glView._convertMouseToLocationInView(c,d);d=new cc.EventMouse(a);d.setLocation(c.x,c.y);d._setPrevCursor(b.x,b.y);b.x=c.x;b.y=c.y;return d},getPointByEvent:function(a,b){if(null!=a.pageX){return{x:a.pageX,y:a.pageY}}b.left-=document.body.scrollLeft;b.top-=document.body.scrollTop;return{x:a.clientX,y:a.clientY}},getTouchesByEvent:function(g,h){for(var k=[],m=this._glView,a,b,c=this._preTouchPoint,d=g.changedTouches.length,e=0;e<d;e++){if(a=g.changedTouches[e]){var f;f=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?m.convertToLocationInView(a.pageX,a.pageY,h):m.convertToLocationInView(a.clientX,a.clientY,h);null!=a.identifier?(a=new cc.Touch(f.x,f.y,a.identifier),b=this.getPreTouch(a).getLocation(),a._setPrevPoint(b.x,b.y),this.setPreTouch(a)):(a=new cc.Touch(f.x,f.y),a._setPrevPoint(c.x,c.y));c.x=f.x;c.y=f.y;k.push(a)}}return k},registerSystemEvent:function(e){if(!this._isRegisterEvent){var f=this._glView=cc.view,a=this,b="touches" in cc.sys.capabilities;"mouse" in cc.sys.capabilities&&(cc._addEventListener(window,"mousedown",function(){a._mousePressed=!0},!1),cc._addEventListener(window,"mouseup",function(g){var h=a._mousePressed;a._mousePressed=!1;if(h){var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h);cc.rectContainsPoint(new cc.Rect(h.left,h.top,h.width,h.height),i)||(b||a.handleTouchesEnd([a.getTouchByXY(i.x,i.y,h)]),h=a.getMouseEvent(i,h,cc.EventMouse.UP),h.setButton(g.button),cc.eventManager.dispatchEvent(h))}},!1),cc._addEventListener(e,"mousedown",function(g){a._mousePressed=!0;var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h);b||a.handleTouchesBegin([a.getTouchByXY(i.x,i.y,h)]);h=a.getMouseEvent(i,h,cc.EventMouse.DOWN);h.setButton(g.button);cc.eventManager.dispatchEvent(h);g.stopPropagation();g.preventDefault();e.focus()},!1),cc._addEventListener(e,"mouseup",function(g){a._mousePressed=!1;var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h);b||a.handleTouchesEnd([a.getTouchByXY(i.x,i.y,h)]);h=a.getMouseEvent(i,h,cc.EventMouse.UP);h.setButton(g.button);cc.eventManager.dispatchEvent(h);g.stopPropagation();g.preventDefault()},!1),cc._addEventListener(e,"mousemove",function(g){var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h);b||a.handleTouchesMove([a.getTouchByXY(i.x,i.y,h)]);h=a.getMouseEvent(i,h,cc.EventMouse.MOVE);a._mousePressed?h.setButton(g.button):h.setButton(null);cc.eventManager.dispatchEvent(h);g.stopPropagation();g.preventDefault()},!1),cc._addEventListener(e,"mousewheel",function(g){var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h),h=a.getMouseEvent(i,h,cc.EventMouse.SCROLL);h.setButton(g.button);h.setScrollData(0,g.wheelDelta);cc.eventManager.dispatchEvent(h);g.stopPropagation();g.preventDefault()},!1),cc._addEventListener(e,"DOMMouseScroll",function(g){var h=a.getHTMLElementPosition(e),i=a.getPointByEvent(g,h),h=a.getMouseEvent(i,h,cc.EventMouse.SCROLL);h.setButton(g.button);h.setScrollData(0,-120*g.detail);cc.eventManager.dispatchEvent(h);g.stopPropagation();g.preventDefault()},!1));if(window.navigator.msPointerEnabled){var c={MSPointerDown:a.handleTouchesBegin,MSPointerMove:a.handleTouchesMove,MSPointerUp:a.handleTouchesEnd,MSPointerCancel:a.handleTouchesCancel},d;for(d in c){(function(g,h){cc._addEventListener(e,g,function(j){var i=a.getHTMLElementPosition(e);i.left-=document.documentElement.scrollLeft;i.top-=document.documentElement.scrollTop;h.call(a,[a.getTouchByXY(j.clientX,j.clientY,i)]);j.stopPropagation();j.preventDefault()},!1)})(d,c[d])}}b&&(cc._addEventListener(e,"touchstart",function(g){if(g.changedTouches){var h=a.getHTMLElementPosition(e);h.left-=document.body.scrollLeft;h.top-=document.body.scrollTop;a.handleTouchesBegin(a.getTouchesByEvent(g,h));g.stopPropagation();g.preventDefault();e.focus()}},!1),cc._addEventListener(e,"touchmove",function(g){if(g.changedTouches){var h=a.getHTMLElementPosition(e);h.left-=document.body.scrollLeft;h.top-=document.body.scrollTop;a.handleTouchesMove(a.getTouchesByEvent(g,h));g.stopPropagation();g.preventDefault()}},!1),cc._addEventListener(e,"touchend",function(g){if(g.changedTouches){var h=a.getHTMLElementPosition(e);h.left-=document.body.scrollLeft;h.top-=document.body.scrollTop;a.handleTouchesEnd(a.getTouchesByEvent(g,h));g.stopPropagation();g.preventDefault()}},!1),cc._addEventListener(e,"touchcancel",function(g){if(g.changedTouches){var h=a.getHTMLElementPosition(e);h.left-=document.body.scrollLeft;h.top-=document.body.scrollTop;f.handleTouchesCancel(a.getTouchesByEvent(g,h));g.stopPropagation();g.preventDefault()}},!1));this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(a){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration)));this._accelCurTime+=a}};var _p=cc.inputManager;_p.setAccelerometerEnabled=function(a){this._accelEnabled!==a&&(this._accelEnabled=a,a=cc.director.getScheduler(),this._accelEnabled?(this._accelCurTime=0,a.scheduleUpdateForTarget(this)):(this._accelCurTime=0,a.unscheduleUpdateForTarget(this)))};_p.setAccelerometerInterval=function(a){this._accelInterval!==a&&(this._accelInterval=a)};_p._registerKeyboardEvent=function(){cc._addEventListener(cc._canvas,"keydown",function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!0));a.stopPropagation();a.preventDefault()},!1);cc._addEventListener(cc._canvas,"keyup",function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!1));a.stopPropagation();a.preventDefault()},!1)};_p._registerAccelerometerEvent=function(){var b=window;this._acceleration=new cc.Acceleration;this._accelDeviceEvent=b.DeviceMotionEvent||b.DeviceOrientationEvent;cc.sys.browserType==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var c=this._accelDeviceEvent==b.DeviceMotionEvent?"devicemotion":"deviceorientation",a=navigator.userAgent;if(/Android/.test(a)||/Adr/.test(a)&&cc.sys.browserType==cc.BROWSER_TYPE_UC){this._minus=-1}cc._addEventListener(b,c,this.didAccelerate.bind(this),!1)};_p.didAccelerate=function(c){var d=window;if(this._accelEnabled){var a=this._acceleration;if(this._accelDeviceEvent==window.DeviceMotionEvent){var b=c.accelerationIncludingGravity;a.x=0.1*this._accelMinus*b.x;a.y=0.1*this._accelMinus*b.y;a.z=0.1*b.z}else{a.x=0.981*(c.gamma/90),a.y=0.981*-(c.beta/90),a.z=0.981*(c.alpha/90)}a.timestamp=c.timeStamp||Date.now();c=a.x;d.orientation===cc.UIInterfaceOrientationLandscapeRight?(a.x=-a.y,a.y=c):d.orientation===cc.UIInterfaceOrientationLandscapeLeft?(a.x=a.y,a.y=-c):d.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(a.x=-a.x,a.y=-a.y)}};delete _p;cc.AffineTransform=function(e,f,a,b,c,d){this.a=e;this.b=f;this.c=a;this.d=b;this.tx=c;this.ty=d};cc.AffineTransformMake=function(e,f,a,b,c,d){return{a:e,b:f,c:a,d:b,tx:c,ty:d}};cc.PointApplyAffineTransform=function(a,b){return{x:b.a*a.x+b.c*a.y+b.tx,y:b.b*a.x+b.d*a.y+b.ty}};cc._PointApplyAffineTransform=function(b,c,a){return{x:a.a*b+a.c*c+a.tx,y:a.b*b+a.d*c+a.ty}};cc.SizeApplyAffineTransform=function(a,b){return{width:b.a*a.width+b.c*a.height,height:b.b*a.width+b.d*a.height}};cc.AffineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.AffineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.RectApplyAffineTransform=function(h,k){var a=cc.rectGetMinY(h),b=cc.rectGetMinX(h),c=cc.rectGetMaxX(h),d=cc.rectGetMaxY(h),e=cc._PointApplyAffineTransform(b,a,k),a=cc._PointApplyAffineTransform(c,a,k),b=cc._PointApplyAffineTransform(b,d,k),f=cc._PointApplyAffineTransform(c,d,k),c=Math.min(e.x,a.x,b.x,f.x),d=Math.max(e.x,a.x,b.x,f.x),g=Math.min(e.y,a.y,b.y,f.y),e=Math.max(e.y,a.y,b.y,f.y);return cc.rect(c,g,d-c,e-g)};cc._RectApplyAffineTransformIn=function(h,k){var a=cc.rectGetMinY(h),b=cc.rectGetMinX(h),c=cc.rectGetMaxX(h),d=cc.rectGetMaxY(h),e=cc._PointApplyAffineTransform(b,a,k),a=cc._PointApplyAffineTransform(c,a,k),b=cc._PointApplyAffineTransform(b,d,k),f=cc._PointApplyAffineTransform(c,d,k),c=Math.min(e.x,a.x,b.x,f.x),d=Math.max(e.x,a.x,b.x,f.x),g=Math.min(e.y,a.y,b.y,f.y),e=Math.max(e.y,a.y,b.y,f.y);h.x=c;h.y=g;h.width=d-c;h.height=e-g;return h};cc.AffineTransformTranslate=function(b,c,a){return{a:b.a,b:b.b,c:b.c,d:b.d,tx:b.tx+b.a*c+b.c*a,ty:b.ty+b.b*c+b.d*a}};cc.AffineTransformScale=function(b,c,a){return{a:b.a*c,b:b.b*c,c:b.c*a,d:b.d*a,tx:b.tx,ty:b.ty}};cc.AffineTransformRotate=function(c,d){var a=Math.sin(d),b=Math.cos(d);return{a:c.a*b+c.c*a,b:c.b*b+c.d*a,c:c.c*b-c.a*a,d:c.d*b-c.b*a,tx:c.tx,ty:c.ty}};cc.AffineTransformConcat=function(a,b){return{a:a.a*b.a+a.b*b.c,b:a.a*b.b+a.b*b.d,c:a.c*b.a+a.d*b.c,d:a.c*b.b+a.d*b.d,tx:a.tx*b.a+a.ty*b.c+b.tx,ty:a.tx*b.b+a.ty*b.d+b.ty}};cc.AffineTransformEqualToTransform=function(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty};cc.AffineTransformInvert=function(a){var b=1/(a.a*a.d-a.b*a.c);return{a:b*a.d,b:-b*a.b,c:-b*a.c,d:b*a.a,tx:b*(a.c*a.ty-a.d*a.tx),ty:b*(a.b*a.tx-a.a*a.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(a){return cc.p(-a.x,-a.y)};cc.pAdd=function(a,b){return cc.p(a.x+b.x,a.y+b.y)};cc.pSub=function(a,b){return cc.p(a.x-b.x,a.y-b.y)};cc.pMult=function(a,b){return cc.p(a.x*b,a.y*b)};cc.pMidpoint=function(a,b){return cc.pMult(cc.pAdd(a,b),0.5)};cc.pDot=function(a,b){return a.x*b.x+a.y*b.y};cc.pCross=function(a,b){return a.x*b.y-a.y*b.x};cc.pPerp=function(a){return cc.p(-a.y,a.x)};cc.pRPerp=function(a){return cc.p(a.y,-a.x)};cc.pProject=function(a,b){return cc.pMult(b,cc.pDot(a,b)/cc.pDot(b,b))};cc.pRotate=function(a,b){return cc.p(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x)};cc.pUnrotate=function(a,b){return cc.p(a.x*b.x+a.y*b.y,a.y*b.x-a.x*b.y)};cc.pLengthSQ=function(a){return cc.pDot(a,a)};cc.pDistanceSQ=function(a,b){return cc.pLengthSQ(cc.pSub(a,b))};cc.pLength=function(a){return Math.sqrt(cc.pLengthSQ(a))};cc.pDistance=function(a,b){return cc.pLength(cc.pSub(a,b))};cc.pNormalize=function(a){return cc.pMult(a,1/cc.pLength(a))};cc.pForAngle=function(a){return cc.p(Math.cos(a),Math.sin(a))};cc.pToAngle=function(a){return Math.atan2(a.y,a.x)};cc.clampf=function(c,d,a){if(d>a){var b=d;d=a;a=b}return c<d?d:c<a?c:a};cc.pClamp=function(b,c,a){return cc.p(cc.clampf(b.x,c.x,a.x),cc.clampf(b.y,c.y,a.y))};cc.pFromSize=function(a){return cc.p(a.width,a.height)};cc.pCompOp=function(a,b){return cc.p(b(a.x),b(a.y))};cc.pLerp=function(b,c,a){return cc.pAdd(cc.pMult(b,1-a),cc.pMult(c,a))};cc.pFuzzyEqual=function(b,c,a){return b.x-a<=c.x&&c.x<=b.x+a&&b.y-a<=c.y&&c.y<=b.y+a?!0:!1};cc.pCompMult=function(a,b){return cc.p(a.x*b.x,a.y*b.y)};cc.pAngleSigned=function(c,d){var a=cc.pNormalize(c),b=cc.pNormalize(d),a=Math.atan2(a.x*b.y-a.y*b.x,cc.pDot(a,b));return Math.abs(a)<cc.POINT_EPSILON?0:a};cc.pAngle=function(b,c){var a=Math.acos(cc.pDot(cc.pNormalize(b),cc.pNormalize(c)));return Math.abs(a)<cc.POINT_EPSILON?0:a};cc.pRotateByAngle=function(d,e,a){d=cc.pSub(d,e);var b=Math.cos(a);a=Math.sin(a);var c=d.x;d.x=c*b-d.y*a+e.x;d.y=c*a+d.y*b+e.y;return d};cc.pLineIntersect=function(c,d,e,f,g){if(c.x==d.x&&c.y==d.y||e.x==f.x&&e.y==f.y){return !1}var h=d.x-c.x;d=d.y-c.y;var a=f.x-e.x;f=f.y-e.y;var b=c.x-e.x;c=c.y-e.y;e=f*h-a*d;g.x=a*c-f*b;g.y=h*c-d*b;if(0==e){return 0==g.x||0==g.y?!0:!1}g.x/=e;g.y/=e;return !0};cc.pSegmentIntersect=function(d,e,a,b){var c=cc.p(0,0);return cc.pLineIntersect(d,e,a,b,c)&&0<=c.x&&1>=c.x&&0<=c.y&&1>=c.y?!0:!1};cc.pIntersectPoint=function(d,e,a,b){var c=cc.p(0,0);return cc.pLineIntersect(d,e,a,b,c)?(a=cc.p(0,0),a.x=d.x+c.x*(e.x-d.x),a.y=d.y+c.x*(e.y-d.y),a):cc.p(0,0)};cc.pSameAs=function(a,b){return null!=a&&null!=b?a.x==b.x&&a.y==b.y:!1};cc.pZeroIn=function(a){a.x=0;a.y=0};cc.pIn=function(a,b){a.x=b.x;a.y=b.y};cc.pMultIn=function(a,b){a.x*=b;a.y*=b};cc.pSubIn=function(a,b){a.x-=b.x;a.y-=b.y};cc.pAddIn=function(a,b){a.x+=b.x;a.y+=b.y};cc.pNormalizeIn=function(a){cc.pMultIn(a,1/Math.sqrt(a.x*a.x+a.y*a.y))};cc.vertexLineToPolygon=function(b,c,e,h,k){k+=h;if(!(1>=k)){c*=0.5;for(var m,n=k-1,q=h;q<k;q++){m=2*q;var r=cc.p(b[2*q],b[2*q+1]),s;if(0===q){s=cc.pPerp(cc.pNormalize(cc.pSub(r,cc.p(b[2*(q+1)],b[2*(q+1)+1]))))}else{if(q===n){s=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(b[2*(q-1)],b[2*(q-1)+1]),r)))}else{s=cc.p(b[2*(q-1)],b[2*(q-1)+1]);var d=cc.p(b[2*(q+1)],b[2*(q+1)+1]),f=cc.pNormalize(cc.pSub(d,r)),a=cc.pNormalize(cc.pSub(s,r)),g=Math.acos(cc.pDot(f,a));s=g<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(f,a))):g<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(f,a)):cc.pPerp(cc.pNormalize(cc.pSub(d,s)))}}s=cc.pMult(s,c);e[2*m]=r.x+s.x;e[2*m+1]=r.y+s.y;e[2*(m+1)]=r.x-s.x;e[2*(m+1)+1]=r.y-s.y}for(q=0==h?0:h-1;q<n;q++){m=2*q;b=m+2;c=cc.vertex2(e[2*m],e[2*m+1]);k=cc.vertex2(e[2*(m+1)],e[2*(m+1)+1]);m=cc.vertex2(e[2*b],e[2*b]);h=cc.vertex2(e[2*(b+1)],e[2*(b+1)+1]);c=!cc.vertexLineIntersect(c.x,c.y,h.x,h.y,k.x,k.y,m.x,m.y);if(!c.isSuccess&&(0>c.value||1<c.value)){c.isSuccess=!0}c.isSuccess&&(e[2*b]=h.x,e[2*b+1]=h.y,e[2*(b+1)]=m.x,e[2*(b+1)+1]=m.y)}}};cc.vertexLineIntersect=function(c,d,e,f,g,h,a,b){if(c==e&&d==f||g==a&&h==b){return{isSuccess:!1,value:0}}e-=c;f-=d;g-=c;h-=d;a-=c;b-=d;c=Math.sqrt(e*e+f*f);e/=c;f/=c;d=g*e+h*f;h=h*e-g*f;g=d;d=a*e+b*f;b=b*e-a*f;a=d;return h==b?{isSuccess:!1,value:0}:{isSuccess:!0,value:(a+(g-a)*b/(b-h))/c}};cc.vertexListIsClockwise=function(d){for(var e=0,a=d.length;e<a;e++){var b=d[(e+1)%a],c=d[(e+2)%a];if(0<cc.pCross(cc.pSub(b,d[e]),cc.pSub(c,b))){return !1}}return !0};cc.CGAffineToGL=function(a,b){b[2]=b[3]=b[6]=b[7]=b[8]=b[9]=b[11]=b[14]=0;b[10]=b[15]=1;b[0]=a.a;b[4]=a.c;b[12]=a.tx;b[1]=a.b;b[5]=a.d;b[13]=a.ty};cc.GLToCGAffine=function(a,b){b.a=a[0];b.c=a[4];b.tx=a[12];b.b=a[1];b.d=a[5];b.ty=a[13]};cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(b,c,a){this._point=cc.p(b||0,c||0);this._id=a||0},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return this._id},setTouchInfo:function(b,c,a){this._prevPoint=this._point;this._point=cc.p(c||0,a||0);this._id=b;this._startPointCaptured||(this._startPoint=cc.p(this._point),this._startPointCaptured=!0)},_setPoint:function(a,b){void 0===b?(this._point.x=a.x,this._point.y=a.y):(this._point.x=a,this._point.y=b)},_setPrevPoint:function(a,b){this._prevPoint=void 0===b?cc.p(a.x,a.y):cc.p(a||0,b||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(a){this._currentTarget=a},ctor:function(a){this._type=a},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.CUSTOM=4;cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=a},setUserData:function(a){this._userData=a},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=a},setScrollData:function(a,b){this._scrollX=a;this._scrollY=b},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(a,b){this._x=a;this._y=b},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(a,b){this._prevX=a;this._prevY=b},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(a){this._button=a},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=a||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(a){this._eventCode=a},_setTouches:function(a){this._touches=a}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!1,_isEnabled:!0,ctor:function(b,c,a){this._onEvent=a;this._type=b||0;this._listenerID=c||""},_setPaused:function(a){this._paused=a},_isPaused:function(){return this._paused},_setRegistered:function(a){this._registered=a},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(a){this._fixedPriority=a},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(a){this._node=a},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!=this._onEvent},clone:function(){return null},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=5;cc.EventListener.CUSTOM=6;cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(b,c){this._onCustomEvent=c;var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,b,function(d){null!=a._onCustomEvent&&a._onCustomEvent(d)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!=this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});cc._EventListenerCustom.create=function(a,b){return new cc._EventListenerCustom(a,b)};cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(b){var c=cc.EventMouse;switch(b._eventType){case c.DOWN:if(a.onMouseDown){a.onMouseDown(b)}break;case c.UP:if(a.onMouseUp){a.onMouseUp(b)}break;case c.MOVE:if(a.onMouseMove){a.onMouseMove(b)}break;case c.SCROLL:if(a.onMouseScroll){a.onMouseScroll(b)}}})},clone:function(){var a=new cc._EventListenerMouse;a.onMouseDown=this.onMouseDown;a.onMouseUp=this.onMouseUp;a.onMouseMove=this.onMouseMove;a.onMouseScroll=this.onMouseScroll;return a},checkAvailable:function(){return !0}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(a){this.swallowTouches=a},clone:function(){var a=new cc._EventListenerTouchOneByOne;a.onTouchBegan=this.onTouchBegan;a.onTouchMoved=this.onTouchMoved;a.onTouchEnded=this.onTouchEnded;a.onTouchCancelled=this.onTouchCancelled;a.swallowTouches=this.swallowTouches;return a},checkAvailable:function(){return !this.onTouchBegan?(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1):!0}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var a=new cc._EventListenerTouchAllAtOnce;a.onTouchesBegan=this.onTouchesBegan;a.onTouchesMoved=this.onTouchesMoved;a.onTouchesEnded=this.onTouchesEnded;a.onTouchesCancelled=this.onTouchesCancelled;return a},checkAvailable:function(){return null==this.onTouchesBegan&&null==this.onTouchesMoved&&null==this.onTouchesEnded&&null==this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};cc.EventListener.create=function(c){cc.assert(c&&c.event,cc._LogInfos.EventListener_create);var d=c.event;delete c.event;var a=null;d===cc.EventListener.TOUCH_ONE_BY_ONE?a=new cc._EventListenerTouchOneByOne:d===cc.EventListener.TOUCH_ALL_AT_ONCE?a=new cc._EventListenerTouchAllAtOnce:d===cc.EventListener.MOUSE?a=new cc._EventListenerMouse:d===cc.EventListener.CUSTOM?(a=new cc._EventListenerCustom(c.eventName,c.callback),delete c.eventName,delete c.callback):d===cc.EventListener.KEYBOARD?a=new cc._EventListenerKeyboard:d===cc.EventListener.ACCELERATION&&(a=new cc._EventListenerAcceleration(c.callback),delete c.callback);for(var b in c){a[b]=c[b]}return a};cc.copyArray=function(c){var d,a=c.length,b=Array(a);for(d=0;d<a;d+=1){b[d]=c[d]}return b};cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(a){0==a._getFixedPriority()?this._sceneGraphListeners.push(a):this._fixedListeners.push(a)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});cc.__getListenerID=function(b){var c=cc.Event,a=b.getType();if(a===c.ACCELERATION){return cc._EventListenerAcceleration.LISTENER_ID}if(a===c.CUSTOM){return b.getEventName()}if(a===c.KEYBOARD){return cc._EventListenerKeyboard.LISTENER_ID}if(a===c.MOUSE){return cc._EventListenerMouse.LISTENER_ID}a===c.TOUCH&&cc.log(cc._LogInfos.__getListenerID);return""};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(b){null!=this._nodeListenersMap[b.__instanceId]&&this._dirtyNodes.push(b);b=b.getChildren();for(var c=0,a=b.length;c<a;c++){this._setDirtyForNode(b[c])}},pauseTarget:function(d,e){var a=this._nodeListenersMap[d.__instanceId],b,c;if(a){b=0;for(c=a.length;b<c;b++){a[b]._setPaused(!0)}}if(!0===e){a=d.getChildren();b=0;for(c=a.length;b<c;b++){this.pauseTarget(a[b],!0)}}},resumeTarget:function(d,e){var a=this._nodeListenersMap[d.__instanceId],b,c;if(a){b=0;for(c=a.length;b<c;b++){a[b]._setPaused(!1)}}this._setDirtyForNode(d);if(!0===e){a=d.getChildren();b=0;for(c=a.length;b<c;b++){this.resumeTarget(a[b],!0)}}},_addListener:function(a){0===this._inDispatch?this._forceAddEventListener(a):this._toAddedListeners.push(a)},_forceAddEventListener:function(b){var c=b._getListenerID(),a=this._listenersMap[c];a||(a=new cc._EventListenerVector,this._listenersMap[c]=a);a.push(b);0==b._getFixedPriority()?(this._setDirty(c,this.DIRTY_SCENE_GRAPH_PRIORITY),c=b._getSceneGraphPriority(),null==c&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(c,b),c.isRunning()&&this.resumeTarget(c)):this._setDirty(c,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(a){return this._listenersMap[a]},_updateDirtyFlagForSceneGraph:function(){if(0!=this._dirtyNodes.length){for(var c=this._dirtyNodes,d,e,f=this._nodeListenersMap,g=0,h=c.length;g<h;g++){if(d=f[c[g].__instanceId]){for(var a=0,b=d.length;a<b;a++){(e=d[a])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY)}}}this._dirtyNodes.length=0}},_removeAllListenersInVector:function(b){if(b){for(var c,a=0;a<b.length;){c=b[a],c._setRegistered(!1),null!=c._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),c),c._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(b,c):++a}}},_removeListenersForListenerID:function(c){var d=this._listenersMap[c];if(d){var a=d.getFixedPriorityListeners(),b=d.getSceneGraphPriorityListeners();this._removeAllListenersInVector(b);this._removeAllListenersInVector(a);delete this._priorityDirtyFlagMap[c];this._inDispatch||(d.clear(),delete this._listenersMap[c])}a=this._toAddedListeners;for(d=0;d<a.length;){(b=a[d])&&b._getListenerID()==c?cc.arrayRemoveObject(a,b):++d}},_sortEventListeners:function(b){var c=this.DIRTY_NONE,a=this._priorityDirtyFlagMap;a[b]&&(c=a[b]);c!=this.DIRTY_NONE&&(a[b]=this.DIRTY_NONE,c&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(b),c&this.DIRTY_SCENE_GRAPH_PRIORITY&&((c=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(b,c):a[b]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(c,d){var a=this._getListeners(c);if(a){var b=a.getSceneGraphPriorityListeners();b&&0!==b.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(d,!0),a.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(b,c){var a=cc.eventManager._nodePriorityMap;return a[c._getSceneGraphPriority().__instanceId]-a[b._getSceneGraphPriority().__instanceId]},_sortListenersOfFixedPriority:function(c){if(c=this._listenersMap[c]){var d=c.getFixedPriorityListeners();if(d&&0!==d.length){d.sort(this._sortListenersOfFixedPriorityAsc);for(var a=0,b=d.length;a<b&&!(0<=d[a]._getFixedPriority());){++a}c.gt0Index=a}}},_sortListenersOfFixedPriorityAsc:function(a,b){return a._getFixedPriority()-b._getFixedPriority()},_onUpdateListeners:function(d){if(d=this._listenersMap[d]){var e=d.getFixedPriorityListeners(),a=d.getSceneGraphPriorityListeners(),b,c;if(a){for(b=0;b<a.length;){c=a[b],c._isRegistered()?++b:cc.arrayRemoveObject(a,c)}}if(e){for(b=0;b<e.length;){c=e[b],c._isRegistered()?++b:cc.arrayRemoveObject(e,c)}}a&&0===a.length&&d.clearSceneGraphListeners();e&&0===e.length&&d.clearFixedListeners()}},_updateListeners:function(b){var c=this._inDispatch;cc.assert(0<c,cc._LogInfos.EventManager__updateListeners);b.getType()==cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(b));if(!(1<c)){cc.assert(1==c,cc._LogInfos.EventManager__updateListeners_2);b=this._listenersMap;var c=this._priorityDirtyFlagMap,a;for(a in b){b[a].empty()&&(delete c[a],delete b[a])}a=this._toAddedListeners;if(0!==a.length){b=0;for(c=a.length;b<c;b++){this._forceAddEventListener(a[b])}this._toAddedListeners.length=0}}},_onTouchEventCallback:function(c,d){if(!c._isRegistered){return !1}var e=d.event,f=d.selTouch;e._setCurrentTarget(c._node);var g=!1,h,a=e.getEventCode(),b=cc.EventTouch.EventCode;if(a==b.BEGAN){c.onTouchBegan&&(g=c.onTouchBegan(f,e))&&c._registered&&c._claimedTouches.push(f)}else{if(0<c._claimedTouches.length&&-1!=(h=c._claimedTouches.indexOf(f))){if(g=!0,a===b.MOVED&&c.onTouchMoved){c.onTouchMoved(f,e)}else{if(a===b.ENDED){if(c.onTouchEnded){c.onTouchEnded(f,e)}c._registered&&c._claimedTouches.splice(h,1)}else{if(a===b.CANCELLED){if(c.onTouchCancelled){c.onTouchCancelled(f,e)}c._registered&&c._claimedTouches.splice(h,1)}}}}}return e.isStopped()?(cc.eventManager._updateListeners(e),!0):g&&c._registered&&c.swallowTouches?(d.needsMutableSet&&d.touches.splice(f,1),!0):!1},_dispatchTouchEvent:function(d){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),f=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(!(null==e&&null==f)){var g=d.getTouches(),a=cc.copyArray(g),b={event:d,needsMutableSet:e&&f,touches:a,selTouch:null};if(e){for(var c=0;c<g.length;c++){if(b.selTouch=g[c],this._dispatchEventToListeners(e,this._onTouchEventCallback,b),d.isStopped()){return}}}if(f&&0<a.length&&(this._dispatchEventToListeners(f,this._onTouchesEventCallback,{event:d,touches:a}),d.isStopped())){return}this._updateListeners(d)}},_onTouchesEventCallback:function(e,f){if(!e._registered){return !1}var a=cc.EventTouch.EventCode,b=f.event,c=f.touches,d=b.getEventCode();b._setCurrentTarget(e._node);if(d==a.BEGAN&&e.onTouchesBegan){e.onTouchesBegan(c,b)}else{if(d==a.MOVED&&e.onTouchesMoved){e.onTouchesMoved(c,b)}else{if(d==a.ENDED&&e.onTouchesEnded){e.onTouchesEnded(c,b)}else{if(d==a.CANCELLED&&e.onTouchesCancelled){e.onTouchesCancelled(c,b)}}}}return b.isStopped()?(cc.eventManager._updateListeners(b),!0):!1},_associateNodeAndEventListener:function(b,c){var a=this._nodeListenersMap[b.__instanceId];a||(a=[],this._nodeListenersMap[b.__instanceId]=a);a.push(c)},_dissociateNodeAndEventListener:function(b,c){var a=this._nodeListenersMap[b.__instanceId];a&&(cc.arrayRemoveObject(a,c),0===a.length&&delete this._nodeListenersMap[b.__instanceId])},_dispatchEventToListeners:function(c,d,e){var f=!1,g=c.getFixedPriorityListeners(),h=c.getSceneGraphPriorityListeners(),a=0,b;if(g&&0!==g.length){for(;a<c.gt0Index;++a){if(b=g[a],b.isEnabled()&&!b._isPaused()&&b._isRegistered()&&d(b,e)){f=!0;break}}}if(h&&!f){for(c=0;c<h.length;c++){if(b=h[c],b.isEnabled()&&!b._isPaused()&&b._isRegistered()&&d(b,e)){f=!0;break}}}if(g&&!f){for(;a<g.length&&!(b=g[a],b.isEnabled()&&!b._isPaused()&&b._isRegistered()&&d(b,e));++a){}}},_setDirty:function(b,c){var a=this._priorityDirtyFlagMap;a[b]=null==a[b]?c:c|a[b]},_visitTarget:function(h,k){var a=h.getChildren(),b=0,c=a.length,d=this._globalZOrderNodeMap,e=this._nodeListenersMap;if(0<c){for(var f;b<c;b++){if((f=a[b])&&0>f.getLocalZOrder()){this._visitTarget(f,!1)}else{break}}null!=e[h.__instanceId]&&(d[h.getGlobalZOrder()]||(d[h.getGlobalZOrder()]=[]),d[h.getGlobalZOrder()].push(h.__instanceId));for(;b<c;b++){(f=a[b])&&this._visitTarget(f,!1)}}else{null!=e[h.__instanceId]&&(d[h.getGlobalZOrder()]||(d[h.getGlobalZOrder()]=[]),d[h.getGlobalZOrder()].push(h.__instanceId))}if(k){var a=[],g;for(g in d){a.push(g)}a.sort(this._sortNumberAsc);g=a.length;f=this._nodePriorityMap;for(b=0;b<g;b++){c=d[a[b]];for(e=0;e<c.length;e++){f[c[e]]=++this._nodePriorityIndex}}this._globalZOrderNodeMap={}}},_sortNumberAsc:function(a,b){return a-b},addListener:function(a,b){cc.assert(a&&b,cc._LogInfos.eventManager_addListener_2);if(a instanceof cc.EventListener){if(a._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}}else{cc.assert("number"!==typeof b,cc._LogInfos.eventManager_addListener_3),a=cc.EventListener.create(a)}a.checkAvailable()&&("number"==typeof b?0==b?cc.log(cc._LogInfos.eventManager_addListener):(a._setSceneGraphPriority(null),a._setFixedPriority(b),a._setRegistered(!0),a._setPaused(!1),this._addListener(a)):(a._setSceneGraphPriority(b),a._setFixedPriority(0),a._setRegistered(!0),this._addListener(a)))},addCustomListener:function(b,c){var a=cc._EventListenerCustom.create(b,c);this.addListener(a,1);return a},removeListener:function(e){if(null!=e){var f,a=this._listenersMap,b;for(b in a){var c=a[b],d=c.getFixedPriorityListeners();f=c.getSceneGraphPriorityListeners();(f=this._removeListenerInVector(f,e))?this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(f=this._removeListenerInVector(d,e))&&this._setDirty(e._getListenerID(),this.DIRTY_FIXED_PRIORITY);c.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete a[b]);if(f){break}}if(!f){a=this._toAddedListeners;b=0;for(c=a.length;b<c;b++){if(d=a[b],d==e){cc.arrayRemoveObject(a,d);break}}}}},_removeListenerInVector:function(d,e){if(null==d){return !1}for(var a=0,b=d.length;a<b;a++){var c=d[a];if(c==e){return c._setRegistered(!1),null!=c._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),c),c._setSceneGraphPriority(null)),0==this._inDispatch&&cc.arrayRemoveObject(d,c),!0}}return !1},removeListeners:function(d,e){if(d instanceof cc.Node){delete this._nodePriorityMap[d.__instanceId];cc.arrayRemoveObject(this._dirtyNodes,d);var a=this._nodeListenersMap[d.__instanceId];if(a){for(var b=cc.copyArray(a),a=0;a<b.length;a++){this.removeListener(b[a])}b.length=0;b=this._toAddedListeners;for(a=0;a<b.length;){var c=b[a];c._getSceneGraphPriority()==d?(c._setSceneGraphPriority(null),c._setRegistered(!1),b.splice(a,1)):++a}if(!0===e){b=d.getChildren();a=0;for(c=b.length;a<c;a++){this.removeListeners(b[a],!0)}}}}else{d==cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):d==cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):d==cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):d==cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):d==cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)}},removeCustomListeners:function(a){this._removeListenersForListenerID(a)},removeAllListeners:function(){var b=this._listenersMap,c=this._internalCustomListenerIDs,a;for(a in b){-1===c.indexOf(a)&&this._removeListenersForListenerID(a)}},setPriority:function(d,e){if(null!=d){var a=this._listenersMap,b;for(b in a){var c=a[b].getFixedPriorityListeners();if(c&&-1!=c.indexOf(d)){null!=d._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority);d._getFixedPriority()!==e&&(d._setFixedPriority(e),this._setDirty(d._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},dispatchEvent:function(a){if(this._isEnabled){this._updateDirtyFlagForSceneGraph();this._inDispatch++;if(!a||!a.getType){throw"event is undefined"}if(a.getType()==cc.Event.TOUCH){this._dispatchTouchEvent(a)}else{var b=cc.__getListenerID(a);this._sortEventListeners(b);b=this._listenersMap[b];null!=b&&this._dispatchEventToListeners(b,this._onListenerCallback,a);this._updateListeners(a)}this._inDispatch--}},_onListenerCallback:function(a,b){b._setCurrentTarget(a._getSceneGraphPriority());a._onEvent(b);return b.isStopped()},dispatchCustomEvent:function(b,c){var a=new cc.EventCustom(b);a.setUserData(c);this.dispatchEvent(a)}};cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION);this._acc=a}});cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(a,b){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD);this._keyCode=a;this._isPressed=b}});cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(a){this._onAccelerationEvent=a;var b=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(c){b._onAccelerationEvent(c._acc,c)})},checkAvailable:function(){cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable);return !0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}});cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";cc._EventListenerAcceleration.create=function(a){return new cc._EventListenerAcceleration(a)};cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(b){if(b._isPressed){if(a.onKeyPressed){a.onKeyPressed(b._keyCode,b)}}else{if(a.onKeyReleased){a.onKeyReleased(b._keyCode,b)}}})},clone:function(){var a=new cc._EventListenerKeyboard;a.onKeyPressed=this.onKeyPressed;a.onKeyReleased=this.onKeyReleased;return a},checkAvailable:function(){return null==this.onKeyPressed&&null==this.onKeyReleased?(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}});cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};cc._tmp.PrototypeCCNode=function(){var a=cc.Node.prototype;cc.defineGetterSetter(a,"x",a.getPositionX,a.setPositionX);cc.defineGetterSetter(a,"y",a.getPositionY,a.setPositionY);cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight);cc.defineGetterSetter(a,"anchorX",a._getAnchorX,a._setAnchorX);cc.defineGetterSetter(a,"anchorY",a._getAnchorY,a._setAnchorY);cc.defineGetterSetter(a,"skewX",a.getSkewX,a.setSkewX);cc.defineGetterSetter(a,"skewY",a.getSkewY,a.setSkewY);cc.defineGetterSetter(a,"zIndex",a.getLocalZOrder,a.setLocalZOrder);cc.defineGetterSetter(a,"vertexZ",a.getVertexZ,a.setVertexZ);cc.defineGetterSetter(a,"rotation",a.getRotation,a.setRotation);cc.defineGetterSetter(a,"rotationX",a.getRotationX,a.setRotationX);cc.defineGetterSetter(a,"rotationY",a.getRotationY,a.setRotationY);cc.defineGetterSetter(a,"scale",a.getScale,a.setScale);cc.defineGetterSetter(a,"scaleX",a.getScaleX,a.setScaleX);cc.defineGetterSetter(a,"scaleY",a.getScaleY,a.setScaleY);cc.defineGetterSetter(a,"children",a.getChildren);cc.defineGetterSetter(a,"childrenCount",a.getChildrenCount);cc.defineGetterSetter(a,"parent",a.getParent,a.setParent);cc.defineGetterSetter(a,"visible",a.isVisible,a.setVisible);cc.defineGetterSetter(a,"running",a.isRunning);cc.defineGetterSetter(a,"ignoreAnchor",a.isIgnoreAnchorPointForPosition,a.ignoreAnchorPointForPosition);cc.defineGetterSetter(a,"actionManager",a.getActionManager,a.setActionManager);cc.defineGetterSetter(a,"scheduler",a.getScheduler,a.setScheduler);cc.defineGetterSetter(a,"shaderProgram",a.getShaderProgram,a.setShaderProgram);cc.defineGetterSetter(a,"glServerState",a.getGLServerState,a.setGLServerState)};cc._tmp.PrototypeCCNodeRGBA=function(){var a=cc.NodeRGBA.prototype;cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"cascadeOpacity",a.isCascadeOpacityEnabled,a.setCascadeOpacityEnabled);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"cascadeColor",a.isCascadeColorEnabled,a.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_anchorPointInPoints:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_transformDirty:!0,_inverseDirty:!0,_cacheDirty:!0,_cachedParent:null,_transformGLDirty:null,_transform:null,_inverse:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_initializedNode:!1,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_rotationRadiansX:0,_rotationRadiansY:0,_className:"Node",_showNode:!1,_initNode:function(){this._anchorPoint=cc.p(0,0);this._anchorPointInPoints=cc.p(0,0);this._contentSize=cc.size(0,0);this._position=cc.p(0,0);this._children=[];this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};var a=cc.director;this._actionManager=a.getActionManager();this._scheduler=a.getScheduler();this._initializedNode=!0;this._additionalTransform=cc.AffineTransformMakeIdentity();cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this))},init:function(){!1===this._initializedNode&&this._initNode();return !0},_arrayMakeObjectsPerformSelector:function(d,e){if(d&&0!==d.length){var a,b=d.length,c;a=cc.Node.StateCallbackType;switch(e){case a.onEnter:for(a=0;a<b;a++){if(c=d[a]){c.onEnter()}}break;case a.onExit:for(a=0;a<b;a++){if(c=d[a]){c.onExit()}}break;case a.onEnterTransitionDidFinish:for(a=0;a<b;a++){if(c=d[a]){c.onEnterTransitionDidFinish()}}break;case a.cleanup:for(a=0;a<b;a++){(c=d[a])&&c.cleanup()}break;case a.updateTransform:for(a=0;a<b;a++){(c=d[a])&&c.updateTransform()}break;case a.onExitTransitionDidStart:for(a=0;a<b;a++){if(c=d[a]){c.onExitTransitionDidStart()}}break;case a.sortAllChildren:for(a=0;a<b;a++){(c=d[a])&&c.sortAllChildren()}break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},setNodeDirty:null,attr:function(a){for(var b in a){this[b]=a[b]}},getSkewX:function(){return this._skewX},setSkewX:function(a){this._skewX=a;this.setNodeDirty()},getSkewY:function(){return this._skewY},setSkewY:function(a){this._skewY=a;this.setNodeDirty()},setLocalZOrder:function(a){this._localZOrder=a;this._parent&&this._parent.reorderChild(this,a);cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(a){this._localZOrder=a},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(a){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(a)},setGlobalZOrder:function(a){this._globalZOrder!=a&&(this._globalZOrder=a,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(a){this._vertexZ=a},getRotation:function(){this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(a){this._rotationX=this._rotationY=a;this._rotationRadiansX=0.017453292519943295*this._rotationX;this._rotationRadiansY=0.017453292519943295*this._rotationY;this.setNodeDirty()},getRotationX:function(){return this._rotationX},setRotationX:function(a){this._rotationX=a;this._rotationRadiansX=0.017453292519943295*this._rotationX;this.setNodeDirty()},getRotationY:function(){return this._rotationY},setRotationY:function(a){this._rotationY=a;this._rotationRadiansY=0.017453292519943295*this._rotationY;this.setNodeDirty()},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX},setScale:function(a,b){this._scaleX=a;this._scaleY=b||0===b?b:a;this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(a){this._scaleX=a;this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(a){this._scaleY=a;this.setNodeDirty()},setPosition:function(b,c){var a=this._position;void 0===c?(a.x=b.x,a.y=b.y):(a.x=b,a.y=c);this.setNodeDirty()},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(a){this._position.x=a;this.setNodeDirty()},getPositionY:function(){return this._position.y},setPositionY:function(a){this._position.y=a;this.setNodeDirty()},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(a){this._visible=a;this.setNodeDirty()},getAnchorPoint:function(){return this._anchorPoint},setAnchorPoint:function(d,e){var a=this._anchorPoint;if(void 0===e){if(d.x===a.x&&d.y===a.y){return}a.x=d.x;a.y=d.y}else{if(d===a.x&&e===a.y){return}a.x=d;a.y=e}var b=this._anchorPointInPoints,c=this._contentSize;b.x=c.width*a.x;b.y=c.height*a.y;this.setNodeDirty()},_getAnchor:function(){return this._anchorPoint},_setAnchor:function(a){var b=a.x;a=a.y;this._anchorPoint.x!==b&&(this._anchorPoint.x=b,this._anchorPointInPoints.x=this._contentSize.width*b);this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._anchorPointInPoints.y=this._contentSize.height*a);this.setNodeDirty()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(a){this._anchorPoint.x!==a&&(this._anchorPoint.x=a,this._anchorPointInPoints.x=this._contentSize.width*a,this.setNodeDirty())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(a){this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._anchorPointInPoints.y=this._contentSize.height*a,this.setNodeDirty())},getAnchorPointInPoints:function(){return this._anchorPointInPoints},_getWidth:function(){return this._contentSize.width},_setWidth:function(a){this._contentSize.width=a;this._anchorPointInPoints.x=a*this._anchorPoint.x;this.setNodeDirty()},_getHeight:function(){return this._contentSize.height},_setHeight:function(a){this._contentSize.height=a;this._anchorPointInPoints.y=a*this._anchorPoint.y;this.setNodeDirty()},getContentSize:function(){return this._contentSize},setContentSize:function(d,e){var a=this._contentSize;if(void 0===e){if(d.width===a.width&&d.height===a.height){return}a.width=d.width;a.height=d.height}else{if(d===a.width&&e===a.height){return}a.width=d;a.height=e}var b=this._anchorPointInPoints,c=this._anchorPoint;b.x=a.width*c.x;b.y=a.height*c.y;this.setNodeDirty()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(a){this._parent=a},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(a){a!=this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=a,this.setNodeDirty())},getTag:function(){return this.tag},setTag:function(a){this.tag=a},getUserData:function(){return this.userData},setUserData:function(a){this.userData=a},getUserObject:function(){return this.userObject},setUserObject:function(a){this.userObject!=a&&(this.userObject=a)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(a){this.arrivalOrder=a},getActionManager:function(){this._actionManager||(this._actionManager=cc.director.getActionManager());return this._actionManager},setActionManager:function(a){this._actionManager!=a&&(this.stopAllActions(),this._actionManager=a)},getScheduler:function(){this._scheduler||(this._scheduler=cc.director.getScheduler());return this._scheduler},setScheduler:function(a){this._scheduler!=a&&(this.unscheduleAllCallbacks(),this._scheduler=a)},getBoundingBox:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._RectApplyAffineTransformIn(a,this.nodeToParentTransform())},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},getChildByTag:function(c){var d=this._children;if(null!=d){for(var a=0;a<d.length;a++){var b=d[a];if(b&&b.tag==c){return b}}}return null},addChild:function(b,c,a){cc.assert(b,cc._LogInfos.Node_addChild_3);if(b===this){cc.log(cc._LogInfos.Node_addChild)}else{if(null!==b._parent){cc.log(cc._LogInfos.Node_addChild_2)}else{if(c=null!=c?c:b._localZOrder,b.tag=null!=a?a:b.tag,this._insertChild(b,c),b._parent=this,this._cachedParent&&(b._cachedParent=this._cachedParent),this._running&&(b.onEnter(),this._isTransitionFinished)){b.onEnterTransitionDidFinish()}}}},removeFromParent:function(a){this._parent&&(null==a&&(a=!0),this._parent.removeChild(this,a))},removeFromParentAndCleanup:function(a){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);this.removeFromParent(a)},removeChild:function(a,b){0!==this._children.length&&(null==b&&(b=!0),-1<this._children.indexOf(a)&&this._detachChild(a,b),this.setNodeDirty())},removeChildByTag:function(b,c){b===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var a=this.getChildByTag(b);null==a?cc.log(cc._LogInfos.Node_removeChildByTag_2,b):this.removeChild(a,c)},removeAllChildrenWithCleanup:function(a){cc.log(cc._LogInfos.Node_removeAllChildrenWithCleanup);this.removeAllChildren(a)},removeAllChildren:function(c){var d=this._children;if(null!=d){null==c&&(c=!0);for(var a=0;a<d.length;a++){var b=d[a];b&&(this._running&&(b.onExitTransitionDidStart(),b.onExit()),c&&b.cleanup(),b.parent=null)}this._children.length=0}},_detachChild:function(a,b){this._running&&(a.onExitTransitionDidStart(),a.onExit());b&&a.cleanup();a.parent=null;cc.arrayRemoveObject(this._children,a)},_insertChild:function(a,b){this._reorderChildDirty=!0;this._children.push(a);a._setLocalZOrder(b)},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.Node_reorderChild);this._reorderChildDirty=!0;a.arrivalOrder=cc.s_globalOrderOfArrival;cc.s_globalOrderOfArrival++;a._setLocalZOrder(b);this.setNodeDirty()},sortAllChildren:function(){if(this._reorderChildDirty){var d=this._children,e=d.length,a,b,c;for(a=1;a<e;a++){c=d[a];for(b=a-1;0<=b;){if(c._localZOrder<d[b]._localZOrder){d[b+1]=d[b]}else{if(c._localZOrder===d[b]._localZOrder&&c.arrivalOrder<d[b].arrivalOrder){d[b+1]=d[b]}else{break}}b--}d[b+1]=c}this._reorderChildDirty=!1}},draw:function(a){},transformAncestors:function(){null!=this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1;this._running=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter);this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1;this.pause();this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExit);this._componentContainer&&this._componentContainer.removeAll()},runAction:function(a){cc.assert(a,cc._LogInfos.Node_runAction);this.actionManager.addAction(a,this,!this._running);return a},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(a){this.actionManager.removeAction(a)},stopActionByTag:function(a){a===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(a,this)},getActionByTag:function(a){return a===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(a,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(a){this.scheduler.scheduleUpdateForTarget(this,a,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdateForTarget(this)},schedule:function(c,d,a,b){d=d||0;cc.assert(c,cc._LogInfos.Node_schedule);cc.assert(0<=d,cc._LogInfos.Node_schedule_2);a=null==a?cc.REPEAT_FOREVER:a;this.scheduler.scheduleCallbackForTarget(this,c,d,a,b||0,!this._running)},scheduleOnce:function(a,b){this.schedule(a,0,0,b)},unschedule:function(a){a&&this.scheduler.unscheduleCallbackForTarget(this,a)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllCallbacksForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);this.resume()},resume:function(){this.scheduler.resumeTarget(this);this.actionManager&&this.actionManager.resumeTarget(this);cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(a){this._additionalTransform=a;this._additionalTransformDirty=this._transformDirty=!0},parentToNodeTransform:function(){this._inverseDirty&&(this._inverse=cc.AffineTransformInvert(this.nodeToParentTransform()),this._inverseDirty=!1);return this._inverse},nodeToWorldTransform:function(){for(var a=this.nodeToParentTransform(),b=this._parent;null!=b;b=b.parent){a=cc.AffineTransformConcat(a,b.nodeToParentTransform())}return a},worldToNodeTransform:function(){return cc.AffineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(a){return cc.PointApplyAffineTransform(a,this.worldToNodeTransform())},convertToWorldSpace:function(a){return cc.PointApplyAffineTransform(a,this.nodeToWorldTransform())},convertToNodeSpaceAR:function(a){return cc.pSub(this.convertToNodeSpace(a),this._anchorPointInPoints)},convertToWorldSpaceAR:function(a){a=cc.pAdd(a,this._anchorPointInPoints);return this.convertToWorldSpace(a)},_convertToWindowSpace:function(a){a=this.convertToWorldSpace(a);return cc.director.convertToUI(a)},convertTouchToNodeSpace:function(a){a=a.getLocation();return this.convertToNodeSpace(a)},convertTouchToNodeSpaceAR:function(a){a=a.getLocation();a=cc.director.convertToGL(a);return this.convertToNodeSpaceAR(a)},update:function(a){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(a)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(a){return this._componentContainer.getComponent(a)},addComponent:function(a){this._componentContainer.add(a)},removeComponent:function(a){return this._componentContainer.remove(a)},removeAllComponents:function(){this._componentContainer.removeAll()},grid:null,ctor:null,visit:null,transform:null,nodeToParentTransform:null,_setNodeDirtyForCache:function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var a=this._cachedParent;a&&a!=this&&a._setNodeDirtyForCache()}},_setCachedParent:function(c){if(this._cachedParent!=c){this._cachedParent=c;for(var d=this._children,a=0,b=d.length;a<b;a++){d[a]._setCachedParent(c)}}},getCamera:function(){this._camera||(this._camera=new cc.Camera);return this._camera},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(a){this._shaderProgram=a},getGLServerState:function(){return this._glServerState},setGLServerState:function(a){this._glServerState=a},getBoundingBoxToWorld:function(){var d=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.nodeToWorldTransform(),d=cc.RectApplyAffineTransform(d,this.nodeToWorldTransform());if(!this._children){return d}for(var a=this._children,b=0;b<a.length;b++){var c=a[b];c&&c._visible&&(c=c._getBoundingBoxToCurrentNode(e))&&(d=cc.rectUnion(d,c))}return d},_getBoundingBoxToCurrentNode:function(d){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);d=null==d?this.nodeToParentTransform():cc.AffineTransformConcat(this.nodeToParentTransform(),d);e=cc.RectApplyAffineTransform(e,d);if(!this._children){return e}for(var a=this._children,b=0;b<a.length;b++){var c=a[b];c&&c._visible&&(c=c._getBoundingBoxToCurrentNode(d))&&(e=cc.rectUnion(e,c))}return e},_nodeToParentTransformForWebGL:function(){if(this._transformDirty){var b=this._position.x,c=this._position.y,e=this._anchorPointInPoints.x,h=-e,k=this._anchorPointInPoints.y,m=-k,n=this._scaleX,q=this._scaleY;this._ignoreAnchorPointForPosition&&(b+=e,c+=k);var r=1,s=0,d=1,f=0;if(0!==this._rotationX||0!==this._rotationY){r=Math.cos(-this._rotationRadiansX),s=Math.sin(-this._rotationRadiansX),d=Math.cos(-this._rotationRadiansY),f=Math.sin(-this._rotationRadiansY)}var a=this._skewX||this._skewY;if(!a&&(0!==e||0!==k)){b+=d*h*n+-s*m*q,c+=f*h*n+r*m*q}var g=this._transform;g.a=d*n;g.b=f*n;g.c=-s*q;g.d=r*q;g.tx=b;g.ty=c;if(a&&(g=cc.AffineTransformConcat({a:1,b:Math.tan(cc.degreesToRadians(this._skewY)),c:Math.tan(cc.degreesToRadians(this._skewX)),d:1,tx:0,ty:0},g),0!==e||0!==k)){g=cc.AffineTransformTranslate(g,h,m)}this._additionalTransformDirty&&(g=cc.AffineTransformConcat(g,this._additionalTransform),this._additionalTransformDirty=!1);this._transform=g;this._transformDirty=!1}return this._transform}});cc.Node.create=function(){return new cc.Node};cc.Node.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Node.prototype,_p.ctor=function(){this._initNode()},_p.setNodeDirty=function(){this._setNodeDirtyForCache();!1===this._transformDirty&&(this._transformDirty=this._inverseDirty=!0)},_p.visit=function(d){if(this._visible){d=d||cc._renderContext;var e,a=this._children,b;d.save();this.transform(d);var c=a.length;if(0<c){this.sortAllChildren();for(e=0;e<c;e++){if(b=a[e],0>b._localZOrder){b.visit(d)}else{break}}for(this.draw(d);e<c;e++){a[e].visit(d)}}else{this.draw(d)}this._cacheDirty=!1;this.arrivalOrder=0;d.restore()}},_p.transform=function(b){b=b||cc._renderContext;var c=cc.view,a=this.nodeToParentTransform();b.transform(a.a,a.c,a.b,a.d,a.tx*c.getScaleX(),-a.ty*c.getScaleY())},_p.nodeToParentTransform=function(){if(this._transformDirty){var d=this._transform;d.tx=this._position.x;d.ty=this._position.y;var g=1,h=0;this._rotationX&&(g=Math.cos(this._rotationRadiansX),h=Math.sin(this._rotationRadiansX));d.a=d.d=g;d.b=-h;d.c=h;var k=this._scaleX,m=this._scaleY,n=this._anchorPointInPoints.x,q=this._anchorPointInPoints.y,s=0.000001>k&&-0.000001<k?0.000001:k,a=0.000001>m&&-0.000001<m?0.000001:m;if(this._skewX||this._skewY){var c=Math.tan(-this._skewX*Math.PI/180),e=Math.tan(-this._skewY*Math.PI/180);Infinity===c&&(c=99999999);Infinity===e&&(e=99999999);var f=q*c*s,b=n*e*a;d.a=g+-h*e;d.b=g*c+-h;d.c=h+g*e;d.d=h*c+g;d.tx+=g*f+-h*b;d.ty+=h*f+g*b}if(1!==k||1!==m){d.a*=s,d.c*=s,d.b*=a,d.d*=a}d.tx+=g*-n*s+-h*q*a;d.ty-=h*-n*s+g*q*a;this._ignoreAnchorPointForPosition&&(d.tx+=n,d.ty+=q);this._additionalTransformDirty&&(this._transform=cc.AffineTransformConcat(d,this._additionalTransform),this._additionalTransformDirty=!1);this._transformDirty=!1}return this._transform},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLCCNode,cc._LogInfos.MissingFile,"BaseNodesWebGL.js"),cc._tmp.WebGLCCNode(),delete cc._tmp.WebGLCCNode);cc.assert("function"===typeof cc._tmp.PrototypeCCNode,cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.NodeRGBA=cc.Node.extend({RGBAProtocol:!0,_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,ctor:function(){cc.Node.prototype.ctor.call(this);this._realOpacity=this._displayedOpacity=255;this._displayedColor=cc.color(255,255,255,255);this._realColor=cc.color(255,255,255,255);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(b){this._displayedOpacity=this._realOpacity=b;var c=255,a=this._parent;a&&(a.RGBAProtocol&&a.cascadeOpacity)&&(c=a.getDisplayedOpacity());this.updateDisplayedOpacity(c);this._displayedColor.a=this._realColor.a=b},updateDisplayedOpacity:function(b){this._displayedOpacity=this._realOpacity*b/255;if(this._cascadeOpacityEnabled){b=this._children;for(var c=0;c<b.length;c++){var a=b[c];a&&a.RGBAProtocol&&a.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled!==a&&((this._cascadeOpacityEnabled=a)?this._enableCascadeOpacity():this._disableCascadeOpacity())},_enableCascadeOpacity:function(){var a=255,b=this._parent;b&&(b.RGBAProtocol&&b.cascadeOpacity)&&(a=b.getDisplayedOpacity());this.updateDisplayedOpacity(a)},_disableCascadeOpacity:function(){this._displayedOpacity=this._realOpacity;for(var b=this._children,c=0;c<b.length;c++){var a=b[c];a&&a.RGBAProtocol&&a.updateDisplayedOpacity(255)}},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){var a=this._displayedColor;return cc.color(a.r,a.g,a.b,a.a)},setColor:function(b){var c=this._displayedColor,a=this._realColor;c.r=a.r=b.r;c.g=a.g=b.g;c.b=a.b=b.b;c=(c=this._parent)&&c.RGBAProtocol&&c.cascadeColor?c.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(c);void 0!==b.a&&!b.a_undefined&&this.setOpacity(b.a)},updateDisplayedColor:function(c){var d=this._displayedColor,a=this._realColor;d.r=0|a.r*c.r/255;d.g=0|a.g*c.g/255;d.b=0|a.b*c.b/255;if(this._cascadeColorEnabled){c=this._children;for(a=0;a<c.length;a++){var b=c[a];b&&b.RGBAProtocol&&b.updateDisplayedColor(d)}}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(a){this._cascadeColorEnabled!==a&&((this._cascadeColorEnabled=a)?this._enableCascadeColor():this._disableCascadeColor())},_enableCascadeColor:function(){var a;a=(a=this._parent)&&a.RGBAProtocol&&a.cascadeColor?a.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(a)},_disableCascadeColor:function(){var c=this._displayedColor,d=this._realColor;c.r=d.r;c.g=d.g;c.b=d.b;for(var c=this._children,d=cc.color.WHITE,a=0;a<c.length;a++){var b=c[a];b&&b.RGBAProtocol&&b.updateDisplayedColor(d)}},addChild:function(b,c,a){cc.Node.prototype.addChild.call(this,b,c,a);this._cascadeColorEnabled&&this._enableCascadeColor();this._cascadeOpacityEnabled&&this._enableCascadeOpacity()},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return !1}});cc.NodeRGBA.create=function(){var a=new cc.NodeRGBA;a.init();return a};cc.assert("function"===typeof cc._tmp.PrototypeCCNodeRGBA,cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNodeRGBA();delete cc._tmp.PrototypeCCNodeRGBA;cc.Node.ON_ENTER=0;cc.Node.ON_EXIT=1;cc.Node.ON_ENTER_TRANSITION_DID_FINISH=2;cc.Node.ON_EXIT_TRANSITOIN_DID_START=3;cc.Node.ON_CLEAN_UP=4;cc.AtlasNode=cc.NodeRGBA.extend({textureAtlas:null,quadsToDraw:0,RGBAProtocol:!0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:null,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",ctor:function(c,d,a,b){cc.NodeRGBA.prototype.ctor.call(this);this._colorUnmodified=cc.color.WHITE;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._ignoreContentScaleFactor=!1;void 0!==b&&this.initWithTileFile(c,d,a,b)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._colorUnmodified:cc.NodeRGBA.prototype.getColor.call(this)},setOpacityModifyRGB:function(a){var b=this.color;this._opacityModifyRGB=a;this.color=b},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b}},setTextureAtlas:function(a){this.textureAtlas=a},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(a){this.quadsToDraw=a},_textureForCanvas:null,_originalTexture:null,_uniformColor:null,_colorF32Array:null,initWithTileFile:function(c,d,a,b){if(!c){throw"cc.AtlasNode.initWithTileFile(): title should not be null"}c=cc.textureCache.addImage(c);return this.initWithTexture(c,d,a,b)},initWithTexture:null,_initWithTextureForCanvas:function(c,d,a,b){this._itemWidth=d;this._itemHeight=a;this._opacityModifyRGB=!0;this._originalTexture=c;if(!this._originalTexture){return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1}this._textureForCanvas=this._originalTexture;this._calculateMaxItems();this.quadsToDraw=b;return !0},_initWithTextureForWebGL:function(c,d,a,b){this._itemWidth=d;this._itemHeight=a;this._colorUnmodified=cc.color.WHITE;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;d=this._realColor;this._colorF32Array=new Float32Array([d.r/255,d.g/255,d.b/255,this._realOpacity/255]);this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(c,b);if(!this.textureAtlas){return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1}this._updateBlendFunc();this._updateOpacityModifyRGB();this._calculateMaxItems();this.quadsToDraw=b;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);this._uniformColor=cc._renderContext.getUniformLocation(this.shaderProgram.getProgram(),"u_color");return !0},draw:null,_drawForWebGL:function(a){a=a||cc._renderContext;cc.nodeDrawSetup(this);cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst);a.uniform4fv(this._uniformColor,this._colorF32Array);this.textureAtlas.drawNumberOfQuads(this.quadsToDraw,0)},setColor:null,_setColorForCanvas:function(b){var c=this._realColor;if(!(c.r==b.r&&c.g==b.g&&c.b==b.b)){c=cc.color(b.r,b.g,b.b);this._colorUnmodified=b;if(this._opacityModifyRGB){var a=this._displayedOpacity;c.r=c.r*a/255;c.g=c.g*a/255;c.b=c.b*a/255}cc.NodeRGBA.prototype.setColor.call(this,b);if(this.texture&&(b=this._originalTexture.getHtmlElementObj())){if(c=cc.textureCache.getTextureColors(b)){a=cc.rect(0,0,b.width,b.height),b=cc.generateTintImage(b,c,this._realColor,a),c=new cc.Texture2D,c.initWithElement(b),c.handleLoadedTexture(),this.texture=c}}}},_setColorForWebGL:function(b){var c=cc.color(b.r,b.g,b.b);this._colorUnmodified=b;var a=this._displayedOpacity;this._opacityModifyRGB&&(c.r=c.r*a/255,c.g=c.g*a/255,c.b=c.b*a/255);cc.NodeRGBA.prototype.setColor.call(this,b);b=this._displayedColor;this._colorF32Array=new Float32Array([b.r/255,b.g/255,b.b/255,a/255])},setOpacity:function(a){},_setOpacityForCanvas:function(a){cc.NodeRGBA.prototype.setOpacity.call(this,a);this._opacityModifyRGB&&(this.color=this._colorUnmodified)},_setOpacityForWebGL:function(a){cc.NodeRGBA.prototype.setOpacity.call(this,a);this._opacityModifyRGB?this.color=this._colorUnmodified:(a=this._displayedColor,this._colorF32Array=new Float32Array([a.r/255,a.g/255,a.b/255,this._displayedOpacity/255]))},getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this.textureAtlas.texture},setTexture:null,_setTextureForCanvas:function(a){this._textureForCanvas=a},_setTextureForWebGL:function(a){this.textureAtlas.texture=a;this._updateBlendFunc();this._updateOpacityModifyRGB()},_calculateMaxItems:null,_calculateMaxItemsForCanvas:function(){var a=this.texture.getContentSize();this._itemsPerColumn=0|a.height/this._itemHeight;this._itemsPerRow=0|a.width/this._itemWidth},_calculateMaxItemsForWebGL:function(){var a=this.texture,b=a.getContentSize();this._ignoreContentScaleFactor&&(b=a.getContentSizeInPixels());this._itemsPerColumn=0|b.height/this._itemHeight;this._itemsPerRow=0|b.width/this._itemWidth},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},_updateOpacityModifyRGB:function(){this._opacityModifyRGB=this.textureAtlas.texture.hasPremultipliedAlpha()},_setIgnoreContentScaleFactor:function(a){this._ignoreContentScaleFactor=a}});_p=cc.AtlasNode.prototype;cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.initWithTexture=_p._initWithTextureForWebGL,_p.draw=_p._drawForWebGL,_p.setColor=_p._setColorForWebGL,_p.setOpacity=_p._setOpacityForWebGL,_p.getTexture=_p._getTextureForWebGL,_p.setTexture=_p._setTextureForWebGL,_p._calculateMaxItems=_p._calculateMaxItemsForWebGL):(_p.initWithTexture=_p._initWithTextureForCanvas,_p.draw=cc.Node.prototype.draw,_p.setColor=_p._setColorForCanvas,_p.setOpacity=_p._setOpacityForCanvas,_p.getTexture=_p._getTextureForCanvas,_p.setTexture=_p._setTextureForCanvas,_p._calculateMaxItems=_p._calculateMaxItemsForCanvas);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.AtlasNode.create=function(c,d,a,b){return new cc.AtlasNode(c,d,a,b)};cc._tmp.PrototypeTexture2D=function(){var a=cc.Texture2D;a.PVRImagesHavePremultipliedAlpha=function(c){cc.PVRHaveAlphaPremultiplied_=c};a.PIXEL_FORMAT_RGBA8888=2;a.PIXEL_FORMAT_RGB888=3;a.PIXEL_FORMAT_RGB565=4;a.PIXEL_FORMAT_A8=5;a.PIXEL_FORMAT_I8=6;a.PIXEL_FORMAT_AI88=7;a.PIXEL_FORMAT_RGBA4444=8;a.PIXEL_FORMAT_RGB5A1=7;a.PIXEL_FORMAT_PVRTC4=9;a.PIXEL_FORMAT_PVRTC2=10;a.PIXEL_FORMAT_DEFAULT=a.PIXEL_FORMAT_RGBA8888;var b=cc.Texture2D._M={};b[a.PIXEL_FORMAT_RGBA8888]="RGBA8888";b[a.PIXEL_FORMAT_RGB888]="RGB888";b[a.PIXEL_FORMAT_RGB565]="RGB565";b[a.PIXEL_FORMAT_A8]="A8";b[a.PIXEL_FORMAT_I8]="I8";b[a.PIXEL_FORMAT_AI88]="AI88";b[a.PIXEL_FORMAT_RGBA4444]="RGBA4444";b[a.PIXEL_FORMAT_RGB5A1]="RGB5A1";b[a.PIXEL_FORMAT_PVRTC4]="PVRTC4";b[a.PIXEL_FORMAT_PVRTC2]="PVRTC2";b=cc.Texture2D._B={};b[a.PIXEL_FORMAT_RGBA8888]=32;b[a.PIXEL_FORMAT_RGB888]=24;b[a.PIXEL_FORMAT_RGB565]=16;b[a.PIXEL_FORMAT_A8]=8;b[a.PIXEL_FORMAT_I8]=8;b[a.PIXEL_FORMAT_AI88]=16;b[a.PIXEL_FORMAT_RGBA4444]=16;b[a.PIXEL_FORMAT_RGB5A1]=16;b[a.PIXEL_FORMAT_PVRTC4]=4;b[a.PIXEL_FORMAT_PVRTC2]=3;b=cc.Texture2D.prototype;cc.defineGetterSetter(b,"name",b.getName);cc.defineGetterSetter(b,"pixelFormat",b.getPixelFormat);cc.defineGetterSetter(b,"pixelsWidth",b.getPixelsWide);cc.defineGetterSetter(b,"pixelsHeight",b.getPixelsHigh);cc.defineGetterSetter(b,"width",b._getWidth);cc.defineGetterSetter(b,"height",b._getHeight);a.defaultPixelFormat=a.PIXEL_FORMAT_DEFAULT};cc._tmp.PrototypeTextureAtlas=function(){var a=cc.TextureAtlas.prototype;cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads);cc.defineGetterSetter(a,"capacity",a.getCapacity);cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads)};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=!1;cc._renderType===cc._RENDER_TYPE_CANVAS?cc.Texture2D=cc.Class.extend({_contentSize:null,_isLoaded:!1,_htmlElementObj:null,_loadedEventListeners:null,url:null,ctor:function(){this._contentSize=cc.size(0,0);this._isLoaded=!1;this._htmlElementObj=null},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var a=cc.contentScaleFactor();return cc.size(this._contentSize.width/a,this._contentSize.height/a)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(a){a&&(this._htmlElementObj=a)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){if(!this._isLoaded){if(!this._htmlElementObj){var a=cc.loader.getRes(this.url);if(!a){return}this.initWithElement(a)}this._isLoaded=!0;a=this._htmlElementObj;this._contentSize.width=a.width;this._contentSize.height=a.height;this._callLoadedEventCallbacks()}},description:function(){return"\x3ccc.Texture2D | width \x3d "+this._contentSize.width+" height "+this._contentSize.height+"\x3e"},initWithData:function(d,e,a,b,c){return !1},initWithImage:function(a){return !1},initWithString:function(e,f,a,b,c,d){return !1},releaseTexture:function(){},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(a){},getMaxT:function(){return 1},setMaxT:function(a){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(a){},hasPremultipliedAlpha:function(){return !1},hasMipmaps:function(){return !1},releaseData:function(a){},keepData:function(a,b){return a},drawAtPoint:function(a){},drawInRect:function(a){},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return !1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);return !1},initWithPVRTCData:function(e,f,a,b,c,d){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return !1},setTexParameters:function(a){},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(a){return -1},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},removeLoadedEventListener:function(b){if(this._loadedEventListeners){for(var c=this._loadedEventListeners,a=0;a<c.length;a++){c[a].eventTarget==b&&c.splice(a,1)}}},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var c=this._loadedEventListeners,d=0,a=c.length;d<a;d++){var b=c[d];b.eventCallback.call(b.eventTarget,this)}c.length=0}}}):(cc.assert("function"===typeof cc._tmp.WebGLTexture2D,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.assert("function"===typeof cc._tmp.PrototypeTexture2D,cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D;cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1000*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var c,d=this._loadedTexturesBefore,a=this._textures;for(c in d){var b=d[c];b.handleLoadedTexture();a[c]=b}this._loadedTexturesBefore={}},addPVRTCImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(a){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"\x3cTextureCache | Number of textures \x3d "+this._textures.length+"\x3e"},textureForKey:function(a){return this._textures[a]||this._textures[cc.loader._aliases[a]]},getKeyByTexture:function(a){for(var b in this._textures){if(this._textures[b]==a){return b}}return null},_generalTextureKey:function(){this._textureKeySeq++;return"_textureKey_"+this._textureKeySeq},getTextureColors:function(a){var b=this.getKeyByTexture(a);b||(b=a instanceof HTMLImageElement?a.src:this._generalTextureKey());this._textureColorsCache[b]||(this._textureColorsCache[b]=cc.generateTextureCacheForColor(a));return this._textureColorsCache[b]},addPVRImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var a=this._textures,b;for(b in a){a[b]&&a[b].releaseTexture()}this._textures={}},removeTexture:function(b){if(b){var c=this._textures,a;for(a in c){c[a]==b&&(c[a].releaseTexture(),delete c[a])}}},removeTextureForKey:function(a){null!=a&&this._textures[a]&&delete this._textures[a]},cacheImage:function(b,c){if(c instanceof cc.Texture2D){this._textures[b]=c}else{var a=new cc.Texture2D;a.initWithElement(c);a.handleLoadedTexture();this._textures[b]=a}},addUIImage:function(b,c){cc.assert(b,cc._LogInfos.textureCache_addUIImage_2);if(c&&this._textures[c]){return this._textures[c]}var a=new cc.Texture2D;a.initWithImage(b);null!=c&&null!=a?this._textures[c]=a:cc.log(cc._LogInfos.textureCache_addUIImage);return a},dumpCachedTextureInfo:function(){var d=0,e=0,f=this._textures,g;for(g in f){var a=f[g];d++;a.getHtmlElementObj() instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,g,a.getHtmlElementObj().src,a.pixelsWidth,a.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,g,a.pixelsWidth,a.pixelsHeight);e+=4*a.pixelsWidth*a.pixelsHeight}f=this._textureColorsCache;for(g in f){var a=f[g],b;for(b in a){var c=a[b];d++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,g,c.width,c.height);e+=4*c.width*c.height}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,d,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache={};this._textureKeySeq=0|1000*Math.random();this._loadedTexturesBefore={}}};cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.textureCache,_p.handleLoadedTexture=function(b){var c=this._textures,a=c[b];a||(a=c[b]=new cc.Texture2D,a.url=b);a.handleLoadedTexture()},_p.addImage=function(d,e,a){cc.assert(d,cc._LogInfos.Texture2D_addImage);var b=this._textures,c=b[d]||b[cc.loader._aliases[d]];if(c){return e&&e.call(a),c}c=b[d]=new cc.Texture2D;c.url=d;cc.loader.getRes(d)?c.handleLoadedTexture():cc.loader._checkIsImageURL(d)?cc.loader.load(d,function(f){e&&e.call(a)}):cc.loader.cache[d]=cc.loader.loadImg(d,function(f,g){if(f){return e?e(f):f}cc.textureCache.handleLoadedTexture(d);e&&e(null,g)});return c},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLTextureCache,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache);cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(a,b){this._buffersVBO=[];"string"==typeof a?this.initWithFile(a,b):a instanceof cc.Texture2D&&this.initWithTexture(a,b)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(a){this.texture=a},setDirty:function(a){this.dirty=a},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(a){this._quads=a},_copyQuadsToTextureAtlas:function(b,c){if(b){for(var a=0;a<b.length;a++){this._setQuadToArray(b[a],c+a)}}},_setQuadToArray:function(b,c){var a=this._quads;a[c]?(a[c].bl=b.bl,a[c].br=b.br,a[c].tl=b.tl,a[c].tr=b.tr):a[c]=new cc.V3F_C4B_T2F_Quad(b.tl,b.bl,b.tr,b.br,this._quadsArrayBuffer,c*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"\x3ccc.TextureAtlas | totalQuads \x3d"+this._totalQuads+"\x3e"},_setupIndices:function(){if(0!==this._capacity){for(var b=this._indices,c=this._capacity,a=0;a<c;a++){cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(b[6*a+0]=4*a+0,b[6*a+1]=4*a+0,b[6*a+2]=4*a+2,b[6*a+3]=4*a+1,b[6*a+4]=4*a+3,b[6*a+5]=4*a+3):(b[6*a+0]=4*a+0,b[6*a+1]=4*a+1,b[6*a+2]=4*a+2,b[6*a+3]=4*a+3,b[6*a+4]=4*a+2,b[6*a+5]=4*a+1)}}},_setupVBO:function(){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();this._buffersVBO[1]=a.createBuffer();this._quadsWebBuffer=a.createBuffer();this._mapBuffers()},_mapBuffers:function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._quadsWebBuffer);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW)},initWithFile:function(b,c){var a=cc.textureCache.addImage(b);if(a){return this.initWithTexture(a,c)}cc.log(cc._LogInfos.TextureAtlas_initWithFile,b);return !1},initWithTexture:function(d,e){cc.assert(d,cc._LogInfos.TextureAtlas_initWithTexture);this._capacity=e|=0;this._totalQuads=0;this.texture=d;this._quads=[];this._indices=new Uint16Array(6*e);var a=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(a*e);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if((!this._quads||!this._indices)&&0<e){return !1}for(var b=this._quads,c=0;c<e;c++){b[c]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,c*a)}this._setupIndices();this._setupVBO();return this.dirty=!0},updateQuad:function(a,b){cc.assert(a,cc._LogInfos.TextureAtlas_updateQuad);cc.assert(0<=b&&b<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2);this._totalQuads=Math.max(b+1,this._totalQuads);this._setQuadToArray(a,b);this.dirty=!0},insertQuad:function(d,e){cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2);this._totalQuads++;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad)}else{var a=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b=e*a,c=(this._totalQuads-1-e)*a;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*a);this._quadsReader.set(this._quadsReader.subarray(b,b+c),b+a);this._setQuadToArray(d,e);this.dirty=!0}},insertQuads:function(c,d,e){e=e||c.length;cc.assert(d+e<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var f=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=e;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad)}else{var g=d*f,h=(this._totalQuads-1-d-e)*f,a=this._totalQuads-1-e,b;for(b=0;b<e;b++){this._quads[a+b]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*f)}this._quadsReader.set(this._quadsReader.subarray(g,g+h),g+f*e);for(b=0;b<e;b++){this._setQuadToArray(c[b],d+b)}this.dirty=!0}},insertQuadFromIndex:function(e,f){if(e!==f){cc.assert(0<=f||f<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex);cc.assert(0<=e||e<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var a=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b=this._quadsReader,c=b.subarray(e*a,a),d;e>f?(d=f*a,b.set(b.subarray(d,d+(e-f)*a),d+a),b.set(c,d)):(d=(e+1)*a,b.set(b.subarray(d,d+(f-e)*a),d-a),b.set(c,f*a));this.dirty=!0}},removeQuadAtIndex:function(b){cc.assert(b<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--;this._quads.length=this._totalQuads;if(b!==this._totalQuads){var a=(b+1)*c;this._quadsReader.set(this._quadsReader.subarray(a,a+(this._totalQuads-b)*c),a-c)}this.dirty=!0},removeQuadsAtIndex:function(c,d){cc.assert(c+d<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex);this._totalQuads-=d;if(c!==this._totalQuads){var a=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b=(c+d)*a;this._quadsReader.set(this._quadsReader.subarray(b,b+(this._totalQuads-c)*a),c*a)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(a){this.dirty=a},resizeCapacity:function(c){if(c==this._capacity){return !0}var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=this._capacity;this._totalQuads=Math.min(this._totalQuads,c);var f=this._capacity=0|c,g=this._totalQuads;if(null==this._quads){this._quads=[];this._quadsArrayBuffer=new ArrayBuffer(d*f);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);for(c=0;c<f;c++){this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,c*d)}}else{var h,a,b=this._quads;if(f>e){h=[];a=new ArrayBuffer(d*f);for(c=0;c<g;c++){h[c]=new cc.V3F_C4B_T2F_Quad(b[c].tl,b[c].bl,b[c].tr,b[c].br,a,c*d)}for(;c<f;c++){h[c]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,a,c*d)}}else{g=Math.max(g,f);h=[];a=new ArrayBuffer(d*f);for(c=0;c<g;c++){h[c]=new cc.V3F_C4B_T2F_Quad(b[c].tl,b[c].bl,b[c].tr,b[c].br,a,c*d)}}this._quadsReader=new Uint8Array(a);this._quads=h;this._quadsArrayBuffer=a}null==this._indices?this._indices=new Uint16Array(6*f):f>e?(d=new Uint16Array(6*f),d.set(this._indices,0),this._indices=d):this._indices=this._indices.subarray(0,6*f);this._setupIndices();this._mapBuffers();return this.dirty=!0},increaseTotalQuadsWith:function(a){this._totalQuads+=a},moveQuadsFromIndex:function(h,k,a){if(void 0===a){if(a=k,k=this._totalQuads-h,cc.assert(a+(this._totalQuads-h)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===k){return}}else{if(cc.assert(a+k<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(h<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),h==a){return}}var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,c=h*b,d=k*b,e=this._quadsReader,f=e.subarray(c,c+d),g=a*b;a<h?(k=a*b,e.set(e.subarray(k,k+(h-a)*b),k+d)):(k=(h+k)*b,e.set(e.subarray(k,k+(a-h)*b),c));e.set(f,g);this.dirty=!0},fillWithEmptyQuadsFromIndex:function(d,e){for(var a=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,b=new Uint8Array(this._quadsArrayBuffer,d*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,a),c=0;c<a;c++){b[c]=0}},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var a=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&a.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&a.deleteBuffer(this._buffersVBO[1]));this._quadsWebBuffer&&a.deleteBuffer(this._quadsWebBuffer)}});_p=cc.TextureAtlas.prototype;cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);cc.defineGetterSetter(_p,"capacity",_p.getCapacity);cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);cc.TextureAtlas.create=function(a,b){return new cc.TextureAtlas(a,b)};cc._renderType===cc._RENDER_TYPE_WEBGL&&(cc.assert("function"===typeof cc._tmp.WebGLTextureAtlas,cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas);cc.assert("function"===typeof cc._tmp.PrototypeTextureAtlas,cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTextureAtlas();delete cc._tmp.PrototypeTextureAtlas;cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,barWidth:265,barHeight:25,logoWidth:160,logoHeight:200,_className:"LoaderScene",init:function(){var b=this;this.barWidth=cc.barWidth;this.barHeight=cc.barHeight;var c=b._bgLayer=cc.LayerColor.create(cc.color(cc.bglayerColor[0],cc.bglayerColor[1],cc.bglayerColor[2],cc.bglayerColor[3]));c.setPosition(cc.visibleRect.bottomLeft);b.addChild(c,0);c=-this.logoHeight/2+100;cc._loaderImage&&cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(d,e){this.logoWidth=e.width;this.logoHeight=e.height;b._initStage(e,cc.visibleRect.center)});cc._loadingbar&&(cc.loader.loadImg(cc._loadingbar,{isCrossOrigin:!1},function(d,e){b._initBar(e,cc.visibleRect.center)}),c=-50);cc.tgideasLogo&&cc.loader.loadImg(cc.tgideasLogo,{isCrossOrigin:!1},function(d,e){cc.tglogotexture2d=new cc.Texture2D;cc.tglogotexture2d.initWithElement(e);cc.tglogotexture2d.handleLoadedTexture();b.foot=cc.Sprite.create(cc.tglogotexture2d);b._bgLayer.addChild(b.foot,11);b.foot.y=10;b.foot.anchorX=0.5;b.foot.anchorY=0;b.foot.x=cc.visibleRect.center.x});var a=b._label=cc.LabelTTF.create("Loading... ","Arial",24);a.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,c)));a.setColor(cc.color(0,0,0));return !0},_initBar:function(b,c){var a=this._texture2d=new cc.Texture2D;a.initWithElement(b);a.handleLoadedTexture();this._bar=cc.Sprite.create(a);this._bar.color=cc.color(cc.barColor[0],cc.barColor[1],cc.barColor[2],cc.barColor[3]);this._barbg=cc.Sprite.create(a);this._barbg.color=cc.color(cc.barBgColor[0],cc.barBgColor[1],cc.barBgColor[2],cc.barBgColor[3]);this._bar.setScale(cc.contentScaleFactor());this._barbg.setScale(cc.contentScaleFactor());this._bar.anchorY=0;this._bar.anchorX=0;this._barbg.anchorY=0;this._barbg.anchorX=0;this._bar.setTextureRect(cc.rect(0,0,0,this.barHeight));this._barbg.x=this._bar.x=c.x-this.barWidth/2;this._barbg.y=this._bar.y=c.y-this.barHeight/2;this._barbg.y-=2;this._bgLayer.addChild(this._barbg,10);this._bgLayer.addChild(this._bar,11)},_initStage:function(b,c){var a=this._texture2d=new cc.Texture2D;a.initWithElement(b);a.handleLoadedTexture();a=this._logo=cc.Sprite.create(a);a.setScale(cc.contentScaleFactor());a.x=c.x;a.y=c.y+a.height/2+35;this._bgLayer.addChild(a,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,0.3)},onExit:function(){cc.Node.prototype.onExit.call(this)},initWithResources:function(a,b){"string"==typeof a&&(a=[a]);this.resources=a||[];this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;a._length=b.length;a._count=0;cc.loader.load(b,function(c,d){a._count=d},function(){a.cb&&a.cb()});a.schedule(a._updatePercent)},_updatePercent:function(){var b=this._count,c=this._length,a;a=Math.min(100*(b/c)|0,100);this._bar&&this._bar.setTextureRect(cc.rect(0,0,this.barWidth*a/100,this.barHeight));this._label.setString("Loading... ");b>=c&&this.unschedule(this._updatePercent)}});cc.LoaderScene.preload=function(b,c){var a=cc;a.loaderScene||(a.loaderScene=new cc.LoaderScene,a.loaderScene.init());a.loaderScene.initWithResources(b,c);cc.director.runScene(a.loaderScene);return a.loaderScene};cc._tmp.PrototypeLayerRGBA=function(){var a=cc.LayerRGBA.prototype;cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"cascadeOpacity",a.isCascadeOpacityEnabled,a.setCascadeOpacityEnabled);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"cascadeColor",a.isCascadeColorEnabled,a.setCascadeColorEnabled)};cc._tmp.PrototypeLayerColor=function(){var a=cc.LayerColor.prototype;cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight)};cc._tmp.PrototypeLayerGradient=function(){var a=cc.LayerGradient.prototype;cc.defineGetterSetter(a,"startColor",a.getStartColor,a.setStartColor);cc.defineGetterSetter(a,"endColor",a.getEndColor,a.setEndColor);cc.defineGetterSetter(a,"startOpacity",a.getStartOpacity,a.setStartOpacity);cc.defineGetterSetter(a,"endOpacity",a.getEndOpacity,a.setEndOpacity);cc.defineGetterSetter(a,"vector",a.getVector,a.setVector)};cc.Layer=cc.Node.extend({_isBaked:!1,_bakeSprite:null,_className:"Layer",ctor:function(){var a=cc.Node.prototype;a.ctor.call(this);this._ignoreAnchorPointForPosition=!0;a.setAnchorPoint.call(this,0.5,0.5);a.setContentSize.call(this,cc.winSize)},bake:null,unbake:null,isBaked:function(){return this._isBaked},visit:null});cc.Layer.create=function(){return new cc.Layer};if(cc._renderType===cc._RENDER_TYPE_CANVAS){var p=cc.Layer.prototype;p.bake=function(){if(!this._isBaked){this._isBaked=this._cacheDirty=!0;this._cachedParent=this;for(var b=this._children,c=0,a=b.length;c<a;c++){b[c]._setCachedParent(this)}this._bakeSprite||(this._bakeSprite=new cc.BakeSprite)}};p.unbake=function(){if(this._isBaked){this._isBaked=!1;this._cacheDirty=!0;this._cachedParent=null;for(var b=this._children,c=0,a=b.length;c<a;c++){b[c]._setCachedParent(null)}}};p.visit=function(d){if(this._isBaked){d=d||cc._renderContext;var e,f=this._children,g=f.length;if(this._visible&&0!==g){var a=this._bakeSprite;d.save();this.transform(d);if(this._cacheDirty){e=this._getBoundingBoxForBake();e.width|=0;e.height|=0;var b=a.getCacheContext();a.resetCanvasSize(e.width,e.height);b.translate(0-e.x,e.height+e.y);var c=a.getAnchorPointInPoints();a.setPosition(c.x+e.x,c.y+e.y);this.sortAllChildren();for(e=0;e<g;e++){f[e].visit(b)}this._cacheDirty=!1}a.visit(d);this.arrivalOrder=0;d.restore()}}else{cc.Node.prototype.visit.call(this,d)}};p._getBoundingBoxForBake=function(){var c=null;if(!this._children||0===this._children.length){return cc.rect(0,0,10,10)}for(var d=this._children,a=0;a<d.length;a++){var b=d[a];b&&b._visible&&(c?(b=b._getBoundingBoxToCurrentNode())&&(c=cc.rectUnion(c,b)):c=b._getBoundingBoxToCurrentNode())}return c};p=null}else{cc.assert("function"===typeof cc._tmp.LayerDefineForWebGL,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),cc._tmp.LayerDefineForWebGL(),delete cc._tmp.LayerDefineForWebGL}cc.LayerRGBA=cc.Layer.extend({RGBAProtocol:!0,_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeOpacityEnabled:!1,_cascadeColorEnabled:!1,_className:"LayerRGBA",ctor:function(){cc.Layer.prototype.ctor.call(this);this._displayedColor=cc.color(255,255,255,255);this._realColor=cc.color(255,255,255,255)},init:function(){var a=cc.Layer.prototype;this._ignoreAnchorPointForPosition=!0;a.setAnchorPoint.call(this,0.5,0.5);a.setContentSize.call(this,cc.winSize);this.cascadeColor=this.cascadeOpacity=!1;return !0},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(b){this._displayedOpacity=this._realOpacity=b;var c=255,a=this._parent;a&&(a.RGBAProtocol&&a.cascadeOpacity)&&(c=a.getDisplayedOpacity());this.updateDisplayedOpacity(c);this._displayedColor.a=this._realColor.a=b},updateDisplayedOpacity:function(b){this._displayedOpacity=0|this._realOpacity*b/255;if(this._cascadeOpacityEnabled){b=this._children;for(var c,a=0;a<b.length;a++){(c=b[a])&&c.RGBAProtocol&&c.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled!==a&&((this._cascadeOpacityEnabled=a)?this._enableCascadeOpacity():this._disableCascadeOpacity())},_enableCascadeOpacity:function(){var a=255,b=this._parent;b&&(b.RGBAProtocol&&b.cascadeOpacity)&&(a=b.getDisplayedOpacity());this.updateDisplayedOpacity(a)},_disableCascadeOpacity:function(){this._displayedOpacity=this._realOpacity;for(var b=this._children,c,a=0;a<b.length;a++){(c=b[a])&&c.RGBAProtocol&&c.updateDisplayedOpacity(255)}},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){var a=this._displayedColor;return cc.color(a.r,a.g,a.b)},setColor:function(b){var c=this._displayedColor,a=this._realColor;c.r=a.r=b.r;c.g=a.g=b.g;c.b=a.b=b.b;c=(c=this._parent)&&c.RGBAProtocol&&c.cascadeColor?c.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(c);void 0!==b.a&&!b.a_undefined&&this.setOpacity(b.a)},updateDisplayedColor:function(c){var d=this._displayedColor,a=this._realColor;d.r=0|a.r*c.r/255;d.g=0|a.g*c.g/255;d.b=0|a.b*c.b/255;if(this._cascadeColorEnabled){c=this._children;for(var b=0;b<c.length;b++){(a=c[b])&&a.RGBAProtocol&&a.updateDisplayedColor(d)}}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(a){this._cascadeColorEnabled!==a&&((this._cascadeColorEnabled=a)?this._enableCascadeColor():this._disableCascadeColor())},_enableCascadeColor:function(){var a;a=(a=this._parent)&&a.RGBAProtocol&&a.cascadeColor?a.getDisplayedColor():cc.color.WHITE;this.updateDisplayedColor(a)},_disableCascadeColor:function(){var c=this._displayedColor,d=this._realColor;c.r=d.r;c.g=d.g;c.b=d.b;var c=this._children,d=cc.color.WHITE,a,b;for(b=0;b<c.length;b++){(a=c[b])&&a.RGBAProtocol&&a.updateDisplayedColor(d)}},addChild:function(b,c,a){cc.Node.prototype.addChild.call(this,b,c,a);this._cascadeColorEnabled&&this._enableCascadeColor();this._cascadeOpacityEnabled&&this._enableCascadeOpacity()},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return !1}});cc.assert("function"===typeof cc._tmp.PrototypeLayerRGBA,cc._LogInfos.MissingFile,"CCLayerPropertyDefine.js");cc._tmp.PrototypeLayerRGBA();delete cc._tmp.PrototypeLayerRGBA;cc.LayerColor=cc.LayerRGBA.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(a,b){this.width=a;this.height=b},changeWidth:function(a){this.width=a},changeHeight:function(a){this.height=a},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return !1},setColor:function(a){cc.LayerRGBA.prototype.setColor.call(this,a);this._updateColor()},setOpacity:function(a){cc.LayerRGBA.prototype.setOpacity.call(this,a);this._updateColor()},_isLighterMode:!1,ctor:null,init:function(c,d,a){cc._renderType!==cc._RENDER_TYPE_CANVAS&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR));var b=cc.director.getWinSize();c=c||cc.color(0,0,0,255);d=void 0===d?b.width:d;a=void 0===a?b.height:a;b=this._displayedColor;b.r=c.r;b.g=c.g;b.b=c.b;b=this._realColor;b.r=c.r;b.g=c.g;b.b=c.b;this._realOpacity=this._displayedOpacity=c.a;c=cc.LayerColor.prototype;c.setContentSize.call(this,d,a);c._updateColor.call(this);return !0},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b};cc._renderType===cc._RENDER_TYPE_CANVAS&&(this._isLighterMode=this._blendFunc&&1==this._blendFunc.src&&771==this._blendFunc.dst)},_setWidth:null,_setHeight:null,_updateColor:null,updateDisplayedColor:function(a){cc.LayerRGBA.prototype.updateDisplayedColor.call(this,a);this._updateColor()},updateDisplayedOpacity:function(a){cc.LayerRGBA.prototype.updateDisplayedOpacity.call(this,a);this._updateColor()},draw:null});cc.LayerColor.create=function(b,c,a){return new cc.LayerColor(b,c,a)};cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LayerColor.prototype,_p.ctor=function(b,c,a){cc.LayerRGBA.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);cc.LayerColor.prototype.init.call(this,b,c,a)},_p._setWidth=cc.LayerRGBA.prototype._setWidth,_p._setHeight=cc.LayerRGBA.prototype._setHeight,_p._updateColor=function(){},_p.draw=function(b){b=b||cc._renderContext;var c=cc.view,a=this._displayedColor;b.fillStyle="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+this._displayedOpacity/255+")";b.fillRect(0,0,this.width*c.getScaleX(),-this.height*c.getScaleY());cc.g_NumberOfDraws++},_p.visit=function(g){if(this._isBaked){g=g||cc._renderContext;var h,k=this._children,m=k.length;if(this._visible){var a=this._bakeSprite;g.save();this.transform(g);if(this._cacheDirty){h=this._getBoundingBoxForBake();h.width|=0;h.height|=0;var b=a.getCacheContext();a.resetCanvasSize(h.width,h.height);var c=a.getAnchorPointInPoints(),d=this._position;if(this._ignoreAnchorPointForPosition){b.translate(0-h.x+d.x,h.height+h.y-d.y),a.setPosition(c.x+h.x-d.x,c.y+h.y-d.y)}else{var e=this.getAnchorPointInPoints(),f=d.x-e.x,d=d.y-e.y;b.translate(0-h.x+f,h.height+h.y-d);a.setPosition(c.x+h.x-f,c.y+h.y-d)}if(0<m){this.sortAllChildren();for(h=0;h<m;h++){if(c=k[h],0>c._localZOrder){c.visit(b)}else{break}}for(this.draw(b);h<m;h++){k[h].visit(b)}}else{this.draw(b)}this._cacheDirty=!1}a.visit(g);this.arrivalOrder=0;g.restore()}}else{cc.Node.prototype.visit.call(this,g)}},_p._getBoundingBoxForBake=function(){var d=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.nodeToWorldTransform(),d=cc.RectApplyAffineTransform(d,this.nodeToWorldTransform());if(!this._children||0===this._children.length){return d}for(var a=this._children,b=0;b<a.length;b++){var c=a[b];c&&c._visible&&(c=c._getBoundingBoxToCurrentNode(e),d=cc.rectUnion(d,c))}return d},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLayerColor,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),cc._tmp.WebGLLayerColor(),delete cc._tmp.WebGLLayerColor);cc.assert("function"===typeof cc._tmp.PrototypeLayerColor,cc._LogInfos.MissingFile,"CCLayerPropertyDefine.js");cc._tmp.PrototypeLayerColor();delete cc._tmp.PrototypeLayerColor;cc.LayerGradient=cc.LayerColor.extend({_startColor:null,_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_gradientStartPoint:null,_gradientEndPoint:null,_className:"LayerGradient",ctor:function(b,c,a){cc.LayerColor.prototype.ctor.call(this);this._startColor=cc.color(0,0,0,255);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._endOpacity=this._startOpacity=255;this._gradientStartPoint=cc.p(0,0);this._gradientEndPoint=cc.p(0,0);cc.LayerGradient.prototype.init.call(this,b,c,a)},init:function(d,e,a){d=d||cc.color(0,0,0,255);e=e||cc.color(0,0,0,255);a=a||cc.p(0,-1);var b=this._startColor,c=this._endColor;b.r=d.r;b.g=d.g;b.b=d.b;this._startOpacity=d.a;c.r=e.r;c.g=e.g;c.b=e.b;this._endOpacity=e.a;this._alongVector=a;this._compressedInterpolation=!0;this._gradientStartPoint=cc.p(0,0);this._gradientEndPoint=cc.p(0,0);cc.LayerColor.prototype.init.call(this,cc.color(d.r,d.g,d.b,255));cc.LayerGradient.prototype._updateColor.call(this);return !0},setContentSize:function(a,b){cc.LayerColor.prototype.setContentSize.call(this,a,b);this._updateColor()},_setWidth:function(a){cc.LayerColor.prototype._setWidth.call(this,a);this._updateColor()},_setHeight:function(a){cc.LayerColor.prototype._setHeight.call(this,a);this._updateColor()},getStartColor:function(){return this._realColor},setStartColor:function(a){this.color=a},setEndColor:function(a){this._endColor=a;this._updateColor()},getEndColor:function(){return this._endColor},setStartOpacity:function(a){this._startOpacity=a;this._updateColor()},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(a){this._endOpacity=a;this._updateColor()},getEndOpacity:function(){return this._endOpacity},setVector:function(a){this._alongVector.x=a.x;this._alongVector.y=a.y;this._updateColor()},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(a){this._compressedInterpolation=a;this._updateColor()},_draw:null,_updateColor:null});cc.LayerGradient.create=function(b,c,a){return new cc.LayerGradient(b,c,a)};cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LayerGradient.prototype,_p.draw=function(d){d=d||cc._renderContext;this._isLighterMode&&(d.globalCompositeOperation="lighter");d.save();var e=cc.view,f=this._displayedOpacity/255,g=this.width*e.getScaleX(),e=this.height*e.getScaleY(),a=d.createLinearGradient(this._gradientStartPoint.x,this._gradientStartPoint.y,this._gradientEndPoint.x,this._gradientEndPoint.y),b=this._displayedColor,c=this._endColor;a.addColorStop(0,"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+(f*(this._startOpacity/255)).toFixed(4)+")");a.addColorStop(1,"rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+(f*(this._endOpacity/255)).toFixed(4)+")");d.fillStyle=a;d.fillRect(0,0,g,-e);0!=this._rotation&&d.rotate(this._rotationRadians);d.restore()},_p._updateColor=function(){var b=this._alongVector,c=0.5*this.width,a=0.5*this.height;this._gradientStartPoint.x=c*-b.x+c;this._gradientStartPoint.y=a*b.y-a;this._gradientEndPoint.x=c*b.x+c;this._gradientEndPoint.y=a*-b.y-a},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLayerGradient,cc._LogInfos.MissingFile,"CCLayerWebGL.js"),cc._tmp.WebGLLayerGradient(),delete cc._tmp.WebGLLayerGradient);cc.assert("function"===typeof cc._tmp.PrototypeLayerGradient,cc._LogInfos.MissingFile,"CCLayerPropertyDefine.js");cc._tmp.PrototypeLayerGradient();delete cc._tmp.PrototypeLayerGradient;cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(a){cc.Layer.prototype.ctor.call(this);a&&cc.LayerMultiplex.prototype.initWithLayers.call(this,a)},initWithLayers:function(a){0<a.length&&null==a[a.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=a;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);return !0},switchTo:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=a,this.addChild(this._layers[a]))},switchToAndReleaseMe:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=a,this.addChild(this._layers[a]))},addLayer:function(a){a?this._layers.push(a):cc.log(cc._LogInfos.LayerMultiplex_addLayer)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(arguments)};cc._tmp.PrototypeSprite=function(){var a=cc.Sprite.prototype;cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"flippedX",a.isFlippedX,a.setFlippedX);cc.defineGetterSetter(a,"flippedY",a.isFlippedY,a.setFlippedY);cc.defineGetterSetter(a,"offsetX",a._getOffsetX);cc.defineGetterSetter(a,"offsetY",a._getOffsetY);cc.defineGetterSetter(a,"texture",a.getTexture,a.setTexture);cc.defineGetterSetter(a,"textureRectRotated",a.isTextureRectRotated);cc.defineGetterSetter(a,"batchNode",a.getBatchNode,a.setBatchNode);cc.defineGetterSetter(a,"quad",a.getQuad)};cc.generateTextureCacheForColor=function(c){function d(){var q=cc.generateTextureCacheForColor,s=c.width,e=c.height;a[0].width=s;a[0].height=e;a[1].width=s;a[1].height=e;a[2].width=s;a[2].height=e;a[3].width=s;a[3].height=e;q.canvas.width=s;q.canvas.height=e;var f=q.canvas.getContext("2d");f.drawImage(c,0,0);q.tempCanvas.width=s;q.tempCanvas.height=e;for(var f=f.getImageData(0,0,s,e).data,g=0;4>g;g++){var h=a[g].getContext("2d");h.getImageData(0,0,s,e).data;q.tempCtx.drawImage(c,0,0);for(var k=q.tempCtx.getImageData(0,0,s,e),m=k.data,n=0;n<f.length;n+=4){m[n]=0===g?f[n]:0,m[n+1]=1===g?f[n+1]:0,m[n+2]=2===g?f[n+2]:0,m[n+3]=f[n+3]}h.putImageData(k,0,0)}c.onload=null}if(c.channelCache){return c.channelCache}var a=[cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas"),cc.newElement("canvas")];try{d()}catch(b){c.onload=d}return c.channelCache=a};cc.generateTextureCacheForColor.canvas=cc.newElement("canvas");cc.generateTextureCacheForColor.tempCanvas=cc.newElement("canvas");cc.generateTextureCacheForColor.tempCtx=cc.generateTextureCacheForColor.tempCanvas.getContext("2d");cc.generateTintImage2=function(d,e,a){a||(a=cc.rect(0,0,d.width,d.height),a=cc.rectPixelsToPoints(a));var b=cc.newElement("canvas"),c=b.getContext("2d");b.width!=a.width&&(b.width=a.width);b.height!=a.height&&(b.height=a.height);c.save();c.drawImage(d,a.x,a.y,a.width,a.height,0,0,a.width,a.height);c.globalCompositeOperation="source-in";c.globalAlpha=e.a/255;c.fillStyle="rgb("+e.r+","+e.g+","+e.b+")";c.fillRect(0,0,a.width,a.height);c.restore();return b};cc.generateTintImage=function(g,h,k,m,a){m||(m=cc.rect(0,0,g.width,g.height));g=k.r/255;var b=k.g/255;k=k.b/255;var c=Math.min(m.width,h[0].width),d=Math.min(m.height,h[0].height),e;a?(e=a.getContext("2d"),e.clearRect(0,0,c,d)):(a=cc.newElement("canvas"),a.width=c,a.height=d,e=a.getContext("2d"));e.save();e.globalCompositeOperation="lighter";var f=e.globalAlpha;0<g&&(e.globalAlpha=g*f,e.drawImage(h[0],m.x,m.y,c,d,0,0,c,d));0<b&&(e.globalAlpha=b*f,e.drawImage(h[1],m.x,m.y,c,d,0,0,c,d));0<k&&(e.globalAlpha=k*f,e.drawImage(h[2],m.x,m.y,c,d,0,0,c,d));1>g+b+k&&(e.globalAlpha=f,e.drawImage(h[3],m.x,m.y,c,d,0,0,c,d));e.restore();return a};cc.cutRotateImageToCanvas=function(c,d){if(!c){return null}if(!d){return c}var a=cc.newElement("canvas");a.width=d.width;a.height=d.height;var b=a.getContext("2d");b.translate(a.width/2,a.height/2);b.rotate(-1.5707963267948966);b.drawImage(c,d.x,d.y,d.height,d.width,-d.height/2,-d.width/2,d.height,d.width);return a};cc.Sprite=cc.NodeRGBA.extend({RGBAProtocol:!0,dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_loadedEventListeners:null,_newTextureWhenChangeColor:null,_className:"Sprite",textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){for(var c=this._loadedEventListeners,d=0,a=c.length;d<a;d++){var b=c[d];b.eventCallback.call(b.eventTarget,this)}c.length=0}},isDirty:function(){return this.dirty},setDirty:function(a){this.dirty=a},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(a){this.atlasIndex=a},getTextureRect:function(){return cc.rect(this._rect.x,this._rect.y,this._rect.width,this._rect.height)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a},getOffsetPosition:function(){return this._offsetPosition},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrame);a.textureLoaded()||(this._textureLoaded=!1,a.addLoadedEventListener(this._spriteFrameLoadedCallback,this));var b=cc._renderType===cc._RENDER_TYPE_CANVAS?!1:a._rotated,b=this.initWithTexture(a.getTexture(),a.getRect(),b);this.setSpriteFrame(a);return b},_spriteFrameLoadedCallback:null,initWithSpriteFrameName:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrameName);var b=cc.spriteFrameCache.getSpriteFrame(a);cc.assert(b,a+cc._LogInfos.Sprite_initWithSpriteFrameName1);return this.initWithSpriteFrame(b)},useBatchNode:function(a){this.textureAtlas=a.textureAtlas;this._batchNode=a},setVertexRect:function(a){this._rect.x=a.x;this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height},sortAllChildren:function(){if(this._reorderChildDirty){var d=this._children,e=d.length,a,b,c;for(a=1;a<e;a++){c=d[a];for(b=a-1;0<=b;){if(c._localZOrder<d[b]._localZOrder){d[b+1]=d[b]}else{if(c._localZOrder===d[b]._localZOrder&&c.arrivalOrder<d[b].arrivalOrder){d[b+1]=d[b]}else{break}}b--}d[b+1]=c}this._batchNode&&this._arrayMakeObjectsPerformSelector(d,cc.Node.StateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.Sprite_reorderChild_2);-1===this._children.indexOf(a)?cc.log(cc._LogInfos.Sprite_reorderChild):b!==a.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,a,b))},removeChild:function(a,b){this._batchNode&&this._batchNode.removeSpriteFromAtlas(a);cc.Node.prototype.removeChild.call(this,a,b)},removeAllChildren:function(d){var e=this._children,a=this._batchNode;if(a&&null!=e){for(var b=0,c=e.length;b<c;b++){a.removeSpriteFromAtlas(e[b])}}cc.Node.prototype.removeAllChildren.call(this,d);this._hasChildren=!1},setDirtyRecursively:function(c){this.dirty=this._recursiveDirty=c;c=this._children;for(var d,a=c?c.length:0,b=0;b<a;b++){d=c[b],d instanceof cc.Sprite&&d.setDirtyRecursively(!0)}},setNodeDirty:function(a){cc.Node.prototype.setNodeDirty.call(this);!a&&(this._batchNode&&!this._recursiveDirty)&&(this._hasChildren?this.setDirtyRecursively(!0):this.dirty=this._recursiveDirty=!0)},ignoreAnchorPointForPosition:function(a){this._batchNode?cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):cc.Node.prototype.ignoreAnchorPointForPosition.call(this,a)},setFlippedX:function(a){this._flippedX!=a&&(this._flippedX=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(a){this._flippedY!=a&&(this._flippedY=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:null,isOpacityModifyRGB:function(){return this._opacityModifyRGB},updateDisplayedOpacity:null,setDisplayFrameWithAnimationName:function(b,c){cc.assert(b,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var a=cc.animationCache.getAnimation(b);a?(a=a.getFrames()[c])?this.setSpriteFrame(a.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var a=this._parent;a&&a!=this._batchNode;){a._setReorderChildDirtyRecursively(),a=a.parent}}},getTexture:function(){return this._texture},_quad:null,_quadWebBuffer:null,_quadDirty:!1,_colorized:!1,_isLighterMode:!1,_originalTexture:null,_textureRect_Canvas:null,_drawSize_Canvas:null,ctor:null,_softInit:function(b,c,a){if(void 0===b){cc.Sprite.prototype.init.call(this)}else{if("string"===typeof b){"#"===b[0]?(b=b.substr(1,b.length-1),b=cc.spriteFrameCache.getSpriteFrame(b),this.initWithSpriteFrame(b)):cc.Sprite.prototype.init.call(this,b,c)}else{if("object"===typeof b){if(b instanceof cc.Texture2D){this.initWithTexture(b,c,a)}else{if(b instanceof cc.SpriteFrame){this.initWithSpriteFrame(b)}else{if(b instanceof HTMLImageElement||b instanceof HTMLCanvasElement){c=new cc.Texture2D,c.initWithElement(b),c.handleLoadedTexture(),this.initWithTexture(c)}}}}}}},getQuad:function(){return this._quad},setBlendFunc:null,init:null,initWithFile:function(c,d){cc.assert(c,cc._LogInfos.Sprite_initWithFile);var a=cc.textureCache.textureForKey(c);if(a){if(!d){var b=a.getContentSize();d=cc.rect(0,0,b.width,b.height)}return this.initWithTexture(a,d)}a=cc.textureCache.addImage(c);return this.initWithTexture(a,d||cc.rect(0,0,a._contentSize.width,a._contentSize.height))},initWithTexture:null,_textureLoadedCallback:null,setTextureRect:null,updateTransform:null,addChild:null,updateColor:function(){var a=this._displayedColor,b=this._displayedOpacity,a={r:a.r,g:a.g,b:a.b,a:b};this._opacityModifyRGB&&(a.r*=b/255,a.g*=b/255,a.b*=b/255);b=this._quad;b.bl.colors=a;b.br.colors=a;b.tl.colors=a;b.tr.colors=a;this._batchNode&&(this.atlasIndex!=cc.Sprite.INDEX_NOT_INITIALIZED?this.textureAtlas.updateQuad(b,this.atlasIndex):this.dirty=!0);this._quadDirty=!0},setOpacity:null,setColor:null,updateDisplayedColor:null,setSpriteFrame:null,setDisplayFrame:function(a){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(a)},isFrameDisplayed:null,displayFrame:function(){return cc.SpriteFrame.create(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:null,setTexture:null,_updateBlendFunc:function(){this._batchNode?cc.log(cc._LogInfos.Sprite__updateBlendFunc):!this._texture||!this._texture.hasPremultipliedAlpha()?(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA,this.opacityModifyRGB=!1):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.opacityModifyRGB=!0)},_changeTextureColor:function(){var b,c=this._texture,a=this._textureRect_Canvas;if(c&&(a.validRect&&this._originalTexture)&&(b=c.getHtmlElementObj())){if(c=cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj())){this._colorized=!0,b instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?cc.generateTintImage(b,c,this._displayedColor,a,b):(b=cc.generateTintImage(b,c,this._displayedColor,a),c=new cc.Texture2D,c.initWithElement(b),c.handleLoadedTexture(),this.texture=c)}}},_setTextureCoords:function(e){e=cc.rectPointsToPixels(e);var f=this._batchNode?this.textureAtlas.texture:this._texture;if(f){var a=f.pixelsWidth,b=f.pixelsHeight,c,d=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*e.x+1)/(2*a),a=f+(2*e.height-2)/(2*a),c=(2*e.y+1)/(2*b),e=c+(2*e.width-2)/(2*b)):(f=e.x/a,a=(e.x+e.height)/a,c=e.y/b,e=(e.y+e.width)/b),this._flippedX&&(b=c,c=e,e=b),this._flippedY&&(b=f,f=a,a=b),d.bl.texCoords.u=f,d.bl.texCoords.v=c,d.br.texCoords.u=f,d.br.texCoords.v=e,d.tl.texCoords.u=a,d.tl.texCoords.v=c,d.tr.texCoords.u=a,d.tr.texCoords.v=e):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*e.x+1)/(2*a),a=f+(2*e.width-2)/(2*a),c=(2*e.y+1)/(2*b),e=c+(2*e.height-2)/(2*b)):(f=e.x/a,a=(e.x+e.width)/a,c=e.y/b,e=(e.y+e.height)/b),this._flippedX&&(b=f,f=a,a=b),this._flippedY&&(b=c,c=e,e=b),d.bl.texCoords.u=f,d.bl.texCoords.v=e,d.br.texCoords.u=a,d.br.texCoords.v=e,d.tl.texCoords.u=f,d.tl.texCoords.v=c,d.tr.texCoords.u=a,d.tr.texCoords.v=c);this._quadDirty=!0}},draw:null});cc.Sprite.create=function(b,c,a){return new cc.Sprite(b,c,a)};cc.Sprite.INDEX_NOT_INITIALIZED=-1;cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Sprite.prototype,_p._spriteFrameLoadedCallback=function(a){this.setNodeDirty(!0);this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize());a=this.color;(255!==a.r||255!==a.g||255!==a.b)&&this._changeTextureColor();this._callLoadedEventCallbacks()},_p.setOpacityModifyRGB=function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this.setNodeDirty(!0))},_p.updateDisplayedOpacity=function(a){cc.NodeRGBA.prototype.updateDisplayedOpacity.call(this,a);this._setNodeDirtyForCache()},_p.ctor=function(b,c,a){cc.NodeRGBA.prototype.ctor.call(this);this._shouldBeHidden=!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._newTextureWhenChangeColor=!1;this._textureLoaded=!0;this._textureRect_Canvas={x:0,y:0,width:0,height:0,validRect:!1};this._drawSize_Canvas=cc.size(0,0);this._softInit(b,c,a)},_p.setBlendFunc=function(b,c){var a=this._blendFunc;void 0===c?(a.src=b.src,a.dst=b.dst):(a.src=b,a.dst=c);this._isLighterMode=a&&(a.src==cc.SRC_ALPHA&&a.dst==cc.ONE||a.src==cc.ONE&&a.dst==cc.ONE)},_p.init=function(){if(0<arguments.length){return this.initWithFile(arguments[0],arguments[1])}cc.NodeRGBA.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._textureLoaded=!0;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0));return !0},_p.initWithTexture=function(d,e,a){cc.assert(0!=arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture);if((a=a||!1)&&d.isLoaded()){var b=d.getHtmlElementObj(),b=cc.cutRotateImageToCanvas(b,e),c=new cc.Texture2D;c.initWithElement(b);c.handleLoadedTexture();d=c;this._rect=cc.rect(0,0,e.width,e.height)}if(!cc.NodeRGBA.prototype.init.call(this)){return !1}this._batchNode=null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this._textureLoaded=b=d.isLoaded();if(!b){return this._rectRotated=a,e&&(this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height),d.addLoadedEventListener(this._textureLoadedCallback,this),!0}e||(e=cc.rect(0,0,d.width,d.height));d&&(b=e.y+e.height,e.x+e.width>d.width&&cc.error(cc._LogInfos.RectWidth,d.url),b>d.height&&cc.error(cc._LogInfos.RectHeight,d.url));this.texture=this._originalTexture=d;this.setTextureRect(e,a);this.batchNode=null;return !0},_p._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=!0;var b=this._rect;b?cc._rectEqualToZero(b)&&(b.width=a.width,b.height=a.height):b=cc.rect(0,0,a.width,a.height);this.texture=this._originalTexture=a;this.setTextureRect(b,this._rectRotated);this.batchNode=this._batchNode;this._callLoadedEventCallbacks()}},_p.setTextureRect=function(b,c,a){this._rectRotated=c||!1;this.setContentSize(a||b);this.setVertexRect(b);c=this._textureRect_Canvas;a=cc.contentScaleFactor();c.x=0|b.x*a;c.y=0|b.y*a;c.width=0|b.width*a;c.height=0|b.height*a;c.validRect=!(0===c.width||0===c.height||0>c.x||0>c.y);b=this._unflippedOffsetPositionFromCenter;this._flippedX&&(b.x=-b.x);this._flippedY&&(b.y=-b.y);this._offsetPosition.x=b.x+(this._contentSize.width-this._rect.width)/2;this._offsetPosition.y=b.y+(this._contentSize.height-this._rect.height)/2;this._batchNode&&(this.dirty=!0)},_p.updateTransform=function(){if(this.dirty){var a=this._parent;!this._visible||a&&a!=this._batchNode&&a._shouldBeHidden?this._shouldBeHidden=!0:(this._shouldBeHidden=!1,this._transformToBatch=!a||a==this._batchNode?this.nodeToParentTransform():cc.AffineTransformConcat(this.nodeToParentTransform(),a._transformToBatch));this.dirty=this._recursiveDirty=!1}this._hasChildren&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},_p.addChild=function(b,c,a){cc.assert(b,cc._LogInfos.CCSpriteBatchNode_addChild_2);null==c&&(c=b._localZOrder);null==a&&(a=b.tag);cc.NodeRGBA.prototype.addChild.call(this,b,c,a);this._hasChildren=!0},_p.setOpacity=function(a){cc.NodeRGBA.prototype.setOpacity.call(this,a);this._setNodeDirtyForCache()},_p.setColor=function(a){var b=this.color;b.r===a.r&&b.g===a.g&&b.b===a.b||(cc.NodeRGBA.prototype.setColor.call(this,a),this._changeTextureColor(),this._setNodeDirtyForCache())},_p.updateDisplayedColor=function(a){var b=this.color;cc.NodeRGBA.prototype.updateDisplayedColor.call(this,a);a=this._displayedColor;b.r===a.r&&b.g===a.g&&b.b===a.b||(this._changeTextureColor(),this._setNodeDirtyForCache())},_p.setSpriteFrame=function(c){var d=this;"string"==typeof c&&(c=cc.spriteFrameCache.getSpriteFrame(c),cc.assert(c,cc._LogInfos.CCSpriteBatchNode_setSpriteFrame));d.setNodeDirty(!0);var a=c.getOffset();d._unflippedOffsetPositionFromCenter.x=a.x;d._unflippedOffsetPositionFromCenter.y=a.y;d._rectRotated=c.isRotated();var a=c.getTexture(),b=c.textureLoaded();b||(d._textureLoaded=!1,c.addLoadedEventListener(function(e){d._textureLoaded=!0;var f=e.getTexture();f!=d._texture&&(d.texture=f);d.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize());d._callLoadedEventCallbacks()},d));a!=d._texture&&(d.texture=a);d._rectRotated&&(d._originalTexture=a);d.setTextureRect(c.getRect(),d._rectRotated,c.getOriginalSize());d._colorized=!1;b&&(c=d.color,(255!==c.r||255!==c.g||255!==c.b)&&d._changeTextureColor())},_p.isFrameDisplayed=function(a){return a.getTexture()!=this._texture?!1:cc.rectEqualToRect(a.getRect(),this._rect)},_p.setBatchNode=function(a){(this._batchNode=a)?(this._transformToBatch=cc.AffineTransformIdentity(),this.textureAtlas=this._batchNode.textureAtlas):(this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,this.textureAtlas=null,this.dirty=this._recursiveDirty=!1)},_p.setTexture=function(a){a&&"string"===typeof a?(a=cc.textureCache.addImage(a),this.setTexture(a),a=a.getContentSize(),this.setTextureRect(cc.rect(0,0,a.width,a.height))):(cc.assert(!a||a instanceof cc.Texture2D,cc._LogInfos.CCSpriteBatchNode_setTexture),this._texture!=a&&(a&&a.getHtmlElementObj() instanceof HTMLImageElement&&(this._originalTexture=a),this._texture=a))},_p.draw=function(g){if(this._textureLoaded){g=g||cc._renderContext;this._isLighterMode&&(g.globalCompositeOperation="lighter");var h=cc.view.getScaleX(),k=cc.view.getScaleY();g.globalAlpha=this._displayedOpacity/255;var m=this._rect,a=this._contentSize,b=this._offsetPosition,c=this._drawSize_Canvas,d=0|b.x,e=-b.y-m.height,f=this._textureRect_Canvas;c.width=m.width*h;c.height=m.height*k;if(this._flippedX||this._flippedY){g.save(),this._flippedX&&(d=-b.x-m.width,g.scale(-1,1)),this._flippedY&&(e=b.y,g.scale(1,-1))}d*=h;e*=k;this._texture&&f.validRect?(a=this._texture.getHtmlElementObj(),this._colorized?g.drawImage(a,0,0,f.width,f.height,d,e,c.width,c.height):g.drawImage(a,f.x,f.y,f.width,f.height,d,e,c.width,c.height)):!this._texture&&f.validRect&&(c=this.color,g.fillStyle="rgba("+c.r+","+c.g+","+c.b+",1)",g.fillRect(d,e,a.width*h,a.height*k));1===cc.SPRITE_DEBUG_DRAW||this._showNode?(g.strokeStyle="rgba(0,255,0,1)",d/=h,e=-(e/k),d=[cc.p(d,e),cc.p(d+m.width,e),cc.p(d+m.width,e-m.height),cc.p(d,e-m.height)],cc._drawingUtil.drawPoly(d,4,!0)):2===cc.SPRITE_DEBUG_DRAW&&(g.strokeStyle="rgba(0,255,0,1)",h=this._rect,e=-e,d=[cc.p(d,e),cc.p(d+h.width,e),cc.p(d+h.width,e-h.height),cc.p(d,e-h.height)],cc._drawingUtil.drawPoly(d,4,!0));(this._flippedX||this._flippedY)&&g.restore();cc.g_NumberOfDraws++}},delete _p):(cc.assert("function"===typeof cc._tmp.WebGLSprite,cc._LogInfos.MissingFile,"SpritesWebGL.js"),cc._tmp.WebGLSprite(),delete cc._tmp.WebGLSprite);cc.assert("function"===typeof cc._tmp.PrototypeSprite,cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(b,c,a){this._spriteFrame=b||null;this._delayPerUnit=c||0;this._userInfo=a||null},clone:function(){var a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},copyWithZone:function(a){return cc.clone(this)},copy:function(a){a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},initWithSpriteFrame:function(b,c,a){this._spriteFrame=b;this._delayPerUnit=c;this._userInfo=a;return !0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(a){this._spriteFrame=a},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(a){this._delayPerUnit=a},getUserInfo:function(){return this._userInfo},setUserInfo:function(a){this._userInfo=a}});cc.AnimationFrame.create=function(b,c,a){return new cc.AnimationFrame(b,c,a)};cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(c,d,a){this._frames=[];if(void 0===c){this.initWithSpriteFrames(null,0)}else{var b=c[0];b&&(b instanceof cc.SpriteFrame?this.initWithSpriteFrames(c,d,a):b instanceof cc.AnimationFrame&&this.initWithAnimationFrames(c,d,a))}},getFrames:function(){return this._frames},setFrames:function(a){this._frames=a},addSpriteFrame:function(a){var b=new cc.AnimationFrame;b.initWithSpriteFrame(a,1,null);this._frames.push(b);this._totalDelayUnits++},addSpriteFrameWithFile:function(a){a=cc.textureCache.addImage(a);var b=cc.rect(0,0,0,0);b.width=a.width;b.height=a.height;a=cc.SpriteFrame.create(a,b);this.addSpriteFrame(a)},addSpriteFrameWithTexture:function(b,c){var a=cc.SpriteFrame.create(b,c);this.addSpriteFrame(a)},initWithAnimationFrames:function(c,d,a){cc.arrayVerifyType(c,cc.AnimationFrame);this._delayPerUnit=d;this._loops=void 0===a?1:a;this._totalDelayUnits=0;d=this._frames;for(a=d.length=0;a<c.length;a++){var b=c[a];d.push(b);this._totalDelayUnits+=b.getDelayUnits()}return !0},clone:function(){var a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},copyWithZone:function(a){a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},_copyFrames:function(){for(var a=[],b=0;b<this._frames.length;b++){a.push(this._frames[b].clone())}return a},copy:function(a){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(a){this._loops=a},setRestoreOriginalFrame:function(a){this._restoreOriginalFrame=a},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(a){this._delayPerUnit=a},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(d,e,a){cc.arrayVerifyType(d,cc.SpriteFrame);this._loops=void 0===a?1:a;this._delayPerUnit=e||0;this._totalDelayUnits=0;e=this._frames;e.length=0;if(d){for(a=0;a<d.length;a++){var b=d[a],c=new cc.AnimationFrame;c.initWithSpriteFrame(b,1,null);e.push(c)}this._totalDelayUnits+=d.length}return !0},retain:function(){},release:function(){}});cc.Animation.create=function(b,c,a){return new cc.Animation(b,c,a)};cc.animationCache={_animations:{},addAnimation:function(a,b){this._animations[b]=a},removeAnimation:function(a){a&&this._animations[a]&&delete this._animations[a]},getAnimation:function(a){return this._animations[a]?this._animations[a]:null},_addAnimationsWithDictionary:function(c,d){var e=c.animations;if(e){var f=1,g=c.properties;if(g){for(var f=null!=g.format?parseInt(g.format):f,g=g.spritesheets,h=cc.spriteFrameCache,a=cc.path,b=0;b<g.length;b++){h.addSpriteFrames(a.changeBasename(d,g[b]))}}switch(f){case 1:this._parseVersion1(e);break;case 2:this._parseVersion2(e);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else{cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)}},addAnimations:function(a){cc.assert(a,cc._LogInfos.animationCache_addAnimations_2);var b=cc.loader.getRes(a);b?this._addAnimationsWithDictionary(b,a):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(h){var k=cc.spriteFrameCache,a;for(a in h){var b=h[a],c=b.frames,b=parseFloat(b.delay)||0,d=null;if(c){for(var d=[],e=0;e<c.length;e++){var f=k.getSpriteFrame(c[e]);if(f){var g=new cc.AnimationFrame;g.initWithSpriteFrame(f,1,null);d.push(g)}else{cc.log(cc._LogInfos.animationCache__parseVersion1_2,a,c[e])}}0===d.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,a):(d.length!=c.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,a),d=cc.Animation.create(d,b,1),cc.animationCache.addAnimation(d,a))}else{cc.log(cc._LogInfos.animationCache__parseVersion1,a)}}},_parseVersion2:function(d){var g=cc.spriteFrameCache,h;for(h in d){var k=d[h],m=k.loop,n=parseInt(k.loops),m=m?cc.REPEAT_FOREVER:isNaN(n)?1:n,n=k.restoreOriginalFrame&&!0==k.restoreOriginalFrame?!0:!1,q=k.frames;if(q){for(var s=[],a=0;a<q.length;a++){var c=q[a],e=c.spriteframe,f=g.getSpriteFrame(e);if(f){var e=parseFloat(c.delayUnits)||0,c=c.notification,b=new cc.AnimationFrame;b.initWithSpriteFrame(f,e,c);s.push(b)}else{cc.log(cc._LogInfos.animationCache__parseVersion2_2,h,e)}}k=parseFloat(k.delayPerUnit)||0;q=new cc.Animation;q.initWithAnimationFrames(s,k,m);q.setRestoreOriginalFrame(n);cc.animationCache.addAnimation(q,h)}else{cc.log(cc._LogInfos.animationCache__parseVersion2,h)}}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,_eventListeners:null,ctor:function(d,e,a,b,c){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=!1;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=!1;void 0!==d&&void 0!==e&&(void 0===a||void 0===b||void 0===c?this.initWithTexture(d,e):this.initWithTexture(d,e,a,b,c))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){null==this._eventListeners&&(this._eventListeners=[]);this._eventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){var c=this._eventListeners;if(c){for(var d=0,a=c.length;d<a;d++){var b=c[d];b.eventCallback.call(b.eventTarget,this)}c.length=0}},getRectInPixels:function(){var a=this._rectInPixels;return cc.rect(a.x,a.y,a.width,a.height)},setRectInPixels:function(a){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0));this._rectInPixels.x=a.x;this._rectInPixels.y=a.y;this._rectInPixels.width=a.width;this._rectInPixels.height=a.height;this._rect=cc.rectPixelsToPoints(a)},isRotated:function(){return this._rotated},setRotated:function(a){this._rotated=a},getRect:function(){var a=this._rect;return cc.rect(a.x,a.y,a.width,a.height)},setRect:function(a){this._rect||(this._rect=cc.rect(0,0,0,0));this._rect.x=a.x;this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return this._offsetInPixels},setOffsetInPixels:function(a){this._offsetInPixels.x=a.x;this._offsetInPixels.y=a.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return this._originalSizeInPixels},setOriginalSizeInPixels:function(a){this._originalSizeInPixels.width=a.width;this._originalSizeInPixels.height=a.height},getOriginalSize:function(){return this._originalSize},setOriginalSize:function(a){this._originalSize.width=a.width;this._originalSize.height=a.height},getTexture:function(){if(this._texture){return this._texture}if(""!==this._textureFilename){var a=cc.textureCache.addImage(this._textureFilename);a&&(this._textureLoaded=a.isLoaded());return a}return null},setTexture:function(a){if(this._texture!=a){var b=a.isLoaded();this._textureLoaded=b;this._texture=a;b||a.addLoadedEventListener(function(d){this._textureLoaded=!0;if(this._rotated&&cc._renderType===cc._RENDER_TYPE_CANVAS){var e=d.getHtmlElementObj(),e=cc.cutRotateImageToCanvas(e,this.getRect()),c=new cc.Texture2D;c.initWithElement(e);c.handleLoadedTexture();this.setTexture(c);e=this.getRect();this.setRect(cc.rect(0,0,e.width,e.height))}e=this._rect;0===e.width&&0===e.height&&(e=d.width,d=d.height,this._rect.width=e,this._rect.height=d,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=e,this._originalSize.height=d);this._callLoadedEventCallbacks()},this)}},getOffset:function(){return this._offset},setOffset:function(a){this._offset.x=a.x;this._offset.y=a.y},clone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copyWithZone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copy:function(){return this.copyWithZone()},initWithTexture:function(d,e,f,g,a){2===arguments.length&&(e=cc.rectPointsToPixels(e));g=g||cc.p(0,0);a=a||e;f=f||!1;"string"==typeof d?(this._texture=null,this._textureFilename=d):d instanceof cc.Texture2D&&this.setTexture(d);if(d=this.getTexture()){var b,c;f?(b=e.x+e.height,c=e.y+e.width):(b=e.x+e.width,c=e.y+e.height);b>d.width&&cc.error(cc._LogInfos.RectWidth,d.url);c>d.height&&cc.error(cc._LogInfos.RectHeight,d.url)}this._rectInPixels=e;this._rect=cc.rectPixelsToPoints(e);this._offsetInPixels.x=g.x;this._offsetInPixels.y=g.y;cc._pointPixelsToPointsOut(g,this._offset);this._originalSizeInPixels.width=a.width;this._originalSizeInPixels.height=a.height;cc._sizePixelsToPointsOut(a,this._originalSize);this._rotated=f;return !0}});cc.SpriteFrame.create=function(d,e,a,b,c){return new cc.SpriteFrame(d,e,a,b,c)};cc.SpriteFrame._frameWithTextureForCanvas=function(e,f,a,b,c){var d=new cc.SpriteFrame;d._texture=e;d._rectInPixels=f;d._rect=cc.rectPixelsToPoints(f);d._offsetInPixels.x=b.x;d._offsetInPixels.y=b.y;cc._pointPixelsToPointsOut(d._offsetInPixels,d._offset);d._originalSizeInPixels.width=c.width;d._originalSizeInPixels.height=c.height;cc._sizePixelsToPointsOut(d._originalSizeInPixels,d._originalSize);d._rotated=a;return d};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(a){a=this._CCNS_REG2.exec(a);return !a?cc.rect(0,0,0,0):cc.rect(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4]))},_pointFromString:function(a){a=this._CCNS_REG1.exec(a);return !a?cc.p(0,0):cc.p(parseFloat(a[1]),parseFloat(a[2]))},_sizeFromString:function(a){a=this._CCNS_REG1.exec(a);return !a?cc.size(0,0):cc.size(parseFloat(a[1]),parseFloat(a[2]))},_getFrameConfig:function(g){var h=cc.loader.getRes(g);cc.assert(h,cc._LogInfos.spriteFrameCache__getFrameConfig_2,g);cc.loader.release(g);if(h._inited){return this._frameConfigCache[g]=h}var k=h.frames,m=h.metadata||h.meta,h={},a={},b=0;m&&(b=m.format,b=1>=b.length?parseInt(b):b,a.image=m.textureFileName||m.textureFileName||m.image);for(var c in k){var d=k[c];if(d){m={};if(0==b){m.rect=cc.rect(d.x,d.y,d.width,d.height);m.rotated=!1;m.offset=cc.p(d.offsetX,d.offsetY);var e=d.originalWidth,d=d.originalHeight;(!e||!d)&&cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig);e=Math.abs(e);d=Math.abs(d);m.size=cc.size(e,d)}else{if(1==b||2==b){m.rect=this._rectFromString(d.frame),m.rotated=d.rotated||!1,m.offset=this._pointFromString(d.offset),m.size=this._sizeFromString(d.sourceSize)}else{if(3==b){var e=this._sizeFromString(d.spriteSize),f=this._rectFromString(d.textureRect);e&&(f=cc.rect(f.x,f.y,e.width,e.height));m.rect=f;m.rotated=d.textureRotated||!1;m.offset=this._pointFromString(d.spriteOffset);m.size=this._sizeFromString(d.spriteSourceSize);m.aliases=d.aliases}else{e=d.frame,f=d.sourceSize,c=d.filename||c,m.rect=cc.rect(e.x,e.y,e.w,e.h),m.rotated=d.rotated||!1,m.offset=cc.p(0,0),m.size=cc.size(f.w,f.h)}}}h[c]=m}}return this._frameConfigCache[g]={_inited:!0,frames:h,meta:a}},addSpriteFrames:function(f,g){cc.assert(f,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var h=this._frameConfigCache[f]||cc.loader.getRes(f);if(h&&h.frames){var k=this._frameConfigCache[f]||this._getFrameConfig(f),h=k.frames,k=k.meta;g?g instanceof cc.Texture2D||("string"==typeof g?g=cc.textureCache.addImage(g):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(k=cc.path.changeBasename(f,k.image||".png"),g=cc.textureCache.addImage(k));var k=this._spriteFramesAliases,m=this._spriteFrames,n;for(n in h){var a=h[n],b=m[n];if(!b){b=cc.SpriteFrame.create(g,a.rect,a.rotated,a.offset,a.size);if(a=a.aliases){for(var c=0,d=a.length;c<d;c++){var e=a[c];k[e]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,e);k[e]=n}}cc._renderType===cc._RENDER_TYPE_CANVAS&&b.isRotated()&&b.getTexture().isLoaded()&&(a=b.getTexture().getHtmlElementObj(),a=cc.cutRotateImageToCanvas(a,b.getRectInPixels()),c=new cc.Texture2D,c.initWithElement(a),c.handleLoadedTexture(),b.setTexture(c),a=b._rect,b.setRect(cc.rect(0,0,a.width,a.height)));m[n]=b}}}},_checkConflict:function(a){a=a.frames;for(var b in a){this._spriteFrames[b]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,b)}},addSpriteFrame:function(a,b){this._spriteFrames[b]=a},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(a){a&&(this._spriteFramesAliases[a]&&delete this._spriteFramesAliases[a],this._spriteFrames[a]&&delete this._spriteFrames[a])},removeSpriteFramesFromFile:function(d){var e=this._spriteFrames,a=this._spriteFramesAliases;if(d=this._frameConfigCache[d]){d=d.frames;for(var b in d){if(e[b]){delete e[b];for(var c in a){a[c]==b&&delete a[c]}}}}},removeSpriteFramesFromTexture:function(e){var f=this._spriteFrames,a=this._spriteFramesAliases,b;for(b in f){var c=f[b];if(c&&c.getTexture()==e){delete f[b];for(var d in a){a[d]==b&&delete a[d]}}}},getSpriteFrame:function(b){var c=this._spriteFrames[b];if(!c){var a=this._spriteFramesAliases[b];a&&((c=this._spriteFrames[a.toString()])||delete this._spriteFramesAliases[b])}c||cc.log(cc._LogInfos.spriteFrameCache_getSpriteFrame,b);return c},_clear:function(){this._spriteFrames={};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.DEFAULT_SPRITE_BATCH_CAPACITY=29;cc.SpriteBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_descendants:null,_className:"SpriteBatchNode",addSpriteWithoutQuad:function(d,e,f){cc.assert(d,cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad_2);if(!(d instanceof cc.Sprite)){return cc.log(cc._LogInfos.SpriteBatchNode_addSpriteWithoutQuad),null}d.atlasIndex=e;var g=0,a=this._descendants;if(a&&0<a.length){for(var b=0;b<a.length;b++){var c=a[b];c&&c.atlasIndex>=e&&++g}}a.splice(g,0,d);cc.Node.prototype.addChild.call(this,d,e,f);this.reorderBatch(!1);return this},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){a!=this.textureAtlas&&(this.textureAtlas=a)},getDescendants:function(){return this._descendants},initWithFile:function(b,c){var a=cc.textureCache.textureForKey(b);a||(a=cc.textureCache.addImage(b));return this.initWithTexture(a,c)},_setNodeDirtyForCache:function(){this._cacheDirty=!0},init:function(b,c){var a=cc.textureCache.textureForKey(b);a||(a=cc.textureCache.addImage(b));return this.initWithTexture(a,c)},increaseAtlasCapacity:function(){var a=this.textureAtlas.capacity,b=Math.floor(4*(a+1)/3);cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity,a,b);this.textureAtlas.resizeCapacity(b)||cc.log(cc._LogInfos.SpriteBatchNode_increaseAtlasCapacity_2)},removeChildAtIndex:function(a,b){this.removeChild(this._children[a],b)},rebuildIndexInOrder:function(d,e){var a=d.children;if(a&&0<a.length){for(var b=0;b<a.length;b++){var c=a[b];c&&0>c.zIndex&&(e=this.rebuildIndexInOrder(c,e))}}!d==this&&(d.atlasIndex=e,e++);if(a&&0<a.length){for(b=0;b<a.length;b++){(c=a[b])&&0<=c.zIndex&&(e=this.rebuildIndexInOrder(c,e))}}return e},highestAtlasIndexInChild:function(a){var b=a.children;return !b||0==b.length?a.atlasIndex:this.highestAtlasIndexInChild(b[b.length-1])},lowestAtlasIndexInChild:function(a){var b=a.children;return !b||0==b.length?a.atlasIndex:this.lowestAtlasIndexInChild(b[b.length-1])},atlasIndexForChild:function(e,f){var a=e.parent,b=a.children,c=b.indexOf(e),d=null;0<c&&c<cc.UINT_MAX&&(d=b[c-1]);return a==this?0==c?0:this.highestAtlasIndexInChild(d)+1:0==c?0>f?a.atlasIndex:a.atlasIndex+1:0>d.zIndex&&0>f||0<=d.zIndex&&0<=f?this.highestAtlasIndexInChild(d)+1:a.atlasIndex+1},reorderBatch:function(a){this._reorderChildDirty=a},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b}},getBlendFunc:function(){return this._blendFunc},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.SpriteBatchNode_reorderChild_2);-1===this._children.indexOf(a)?cc.log(cc._LogInfos.SpriteBatchNode_reorderChild):b!==a.zIndex&&(cc.Node.prototype.reorderChild.call(this,a,b),this.setNodeDirty())},removeChild:function(a,b){null!=a&&(-1===this._children.indexOf(a)?cc.log(cc._LogInfos.SpriteBatchNode_removeChild):(this.removeSpriteFromAtlas(a),cc.Node.prototype.removeChild.call(this,a,b)))},_mvpMatrix:null,_textureForCanvas:null,_useCache:!1,_originalTexture:null,ctor:null,_ctorForCanvas:function(b,c){cc.Node.prototype.ctor.call(this);var a;c=c||cc.DEFAULT_SPRITE_BATCH_CAPACITY;"string"==typeof b?(a=cc.textureCache.textureForKey(b))||(a=cc.textureCache.addImage(b)):b instanceof cc.Texture2D&&(a=b);a&&this.initWithTexture(a,c)},_ctorForWebGL:function(b,c){cc.Node.prototype.ctor.call(this);this._mvpMatrix=new cc.kmMat4;var a;c=c||cc.DEFAULT_SPRITE_BATCH_CAPACITY;"string"==typeof b?(a=cc.textureCache.textureForKey(b))||(a=cc.textureCache.addImage(b)):b instanceof cc.Texture2D&&(a=b);a&&this.initWithTexture(a,c)},updateQuadFromSprite:null,_updateQuadFromSpriteForCanvas:function(a,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2);a instanceof cc.Sprite?(a.batchNode=this,a.atlasIndex=b,a.dirty=!0,a.updateTransform()):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},_updateQuadFromSpriteForWebGL:function(b,c){cc.assert(b,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite);if(b instanceof cc.Sprite){for(var a=this.textureAtlas.capacity;c>=a||a==this.textureAtlas.totalQuads;){this.increaseAtlasCapacity()}b.batchNode=this;b.atlasIndex=c;b.dirty=!0;b.updateTransform()}else{cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)}},_swap:function(d,e){var f=this._descendants,g=this.textureAtlas,a=g.quads,b=f[d],c=cc.V3F_C4B_T2F_QuadCopy(a[d]);f[e].atlasIndex=d;f[d]=f[e];g.updateQuad(a[e],d);f[e]=b;g.updateQuad(c,e)},insertQuadFromSprite:null,_insertQuadFromSpriteForCanvas:function(a,b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite_2);a instanceof cc.Sprite?(a.batchNode=this,a.atlasIndex=b,a.dirty=!0,a.updateTransform(),this._children.splice(b,0,a)):cc.log(cc._LogInfos.CCSpriteBatchNode_insertQuadFromSprite)},_insertQuadFromSpriteForWebGL:function(b,c){cc.assert(b,cc._LogInfos.Sprite_insertQuadFromSprite_2);if(b instanceof cc.Sprite){for(var a=this.textureAtlas;c>=a.capacity||a.capacity===a.totalQuads;){this.increaseAtlasCapacity()}b.batchNode=this;b.atlasIndex=c;a.insertQuad(b.quad,c);b.dirty=!0;b.updateTransform()}else{cc.log(cc._LogInfos.Sprite_insertQuadFromSprite)}},_updateAtlasIndex:function(e,f){var a=0,b=e.children;b&&(a=b.length);var c=0;if(0===a){c=e.atlasIndex,e.atlasIndex=f,e.arrivalOrder=0,c!=f&&this._swap(c,f),f++}else{c=!0;0<=b[0].zIndex&&(c=e.atlasIndex,e.atlasIndex=f,e.arrivalOrder=0,c!=f&&this._swap(c,f),f++,c=!1);for(a=0;a<b.length;a++){var d=b[a];c&&0<=d.zIndex&&(c=e.atlasIndex,e.atlasIndex=f,e.arrivalOrder=0,c!=f&&this._swap(c,f),f++,c=!1);f=this._updateAtlasIndex(d,f)}c&&(c=e.atlasIndex,e.atlasIndex=f,e.arrivalOrder=0,c!=f&&this._swap(c,f),f++)}return f},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},initWithTexture:null,_initWithTextureForCanvas:function(a,b){this._children=[];this._descendants=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this._textureForCanvas=this._originalTexture=a;return !0},_initWithTextureForWebGL:function(a,b){this._children=[];this._descendants=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);b=b||cc.DEFAULT_SPRITE_BATCH_CAPACITY;this.textureAtlas=new cc.TextureAtlas;this.textureAtlas.initWithTexture(a,b);this._updateBlendFunc();this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);return !0},insertChild:function(e,f){e.batchNode=this;e.atlasIndex=f;e.dirty=!0;var a=this.textureAtlas;a.totalQuads>=a.capacity&&this.increaseAtlasCapacity();a.insertQuad(e.quad,f);this._descendants.splice(f,0,e);var a=f+1,b=this._descendants;if(b&&0<b.length){for(;a<b.length;a++){b[a].atlasIndex++}}var b=e.children,c;if(b){a=0;for(l=b.length||0;a<l;a++){if(c=b[a]){var d=this.atlasIndexForChild(c,c.zIndex);this.insertChild(c,d)}}}},appendChild:null,_appendChildForCanvas:function(b){this._reorderChildDirty=!0;b.batchNode=this;b.dirty=!0;this._descendants.push(b);b.atlasIndex=this._descendants.length-1;b=b.children;for(var c=0,a=b.length||0;c<a;c++){this.appendChild(b[c])}},_appendChildForWebGL:function(b){this._reorderChildDirty=!0;b.batchNode=this;b.dirty=!0;this._descendants.push(b);var c=this._descendants.length-1;b.atlasIndex=c;var a=this.textureAtlas;a.totalQuads==a.capacity&&this.increaseAtlasCapacity();a.insertQuad(b.quad,c);b=b.children;c=0;for(a=b.length||0;c<a;c++){this.appendChild(b[c])}},removeSpriteFromAtlas:null,_removeSpriteFromAtlasForCanvas:function(c){c.batchNode=null;var d=this._descendants,a=d.indexOf(c);if(-1!=a){d.splice(a,1);for(var b=d.length;a<b;++a){d[a].atlasIndex--}}if(c=c.children){d=0;for(a=c.length||0;d<a;d++){c[d]&&this.removeSpriteFromAtlas(c[d])}}},_removeSpriteFromAtlasForWebGL:function(c){this.textureAtlas.removeQuadAtIndex(c.atlasIndex);c.batchNode=null;var d=this._descendants,a=d.indexOf(c);if(-1!=a){d.splice(a,1);for(var b=d.length;a<b;++a){d[a].atlasIndex--}}if(c=c.children){d=0;for(a=c.length||0;d<a;d++){c[d]&&this.removeSpriteFromAtlas(c[d])}}},getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this.textureAtlas.texture},setTexture:null,_setTextureForCanvas:function(b){this._textureForCanvas=b;for(var c=this._children,a=0;a<c.length;a++){c[a].texture=b}},_setTextureForWebGL:function(a){this.textureAtlas.texture=a;this._updateBlendFunc()},visit:null,_visitForCanvas:function(b){var c=b||cc._renderContext;if(this._visible){c.save();this.transform(b);var a=this._children;if(a){this.sortAllChildren();for(b=0;b<a.length;b++){a[b]&&a[b].visit(c)}}c.restore()}},_visitForWebGL:function(a){a=a||cc._renderContext;if(this._visible){cc.kmGLPushMatrix();var b=this.grid;b&&b.isActive()&&(b.beforeDraw(),this.transformAncestors());this.sortAllChildren();this.transform(a);this.draw(a);b&&b.isActive()&&b.afterDraw(this);cc.kmGLPopMatrix();this.arrivalOrder=0}},addChild:null,_addChildForCanvas:function(b,c,a){cc.assert(null!=b,cc._LogInfos.CCSpriteBatchNode_addChild_3);b instanceof cc.Sprite?(c=null==c?b.zIndex:c,a=null==a?b.tag:a,cc.Node.prototype.addChild.call(this,b,c,a),this.appendChild(b),this.setNodeDirty()):cc.log(cc._LogInfos.CCSpriteBatchNode_addChild)},_addChildForWebGL:function(b,c,a){cc.assert(null!=b,cc._LogInfos.Sprite_addChild_6);b instanceof cc.Sprite?b.texture!=this.textureAtlas.texture?cc.log(cc._LogInfos.Sprite_addChild_5):(c=null==c?b.zIndex:c,a=null==a?b.tag:a,cc.Node.prototype.addChild.call(this,b,c,a),this.appendChild(b),this.setNodeDirty()):cc.log(cc._LogInfos.Sprite_addChild_4)},removeAllChildren:null,_removeAllChildrenForCanvas:function(c){var d=this._descendants;if(d&&0<d.length){for(var a=0,b=d.length;a<b;a++){d[a]&&(d[a].batchNode=null)}}cc.Node.prototype.removeAllChildren.call(this,c);this._descendants.length=0},_removeAllChildrenForWebGL:function(c){var d=this._descendants;if(d&&0<d.length){for(var a=0,b=d.length;a<b;a++){d[a]&&(d[a].batchNode=null)}}cc.Node.prototype.removeAllChildren.call(this,c);this._descendants.length=0;this.textureAtlas.removeAllQuads()},sortAllChildren:null,_sortAllChildrenForCanvas:function(){if(this._reorderChildDirty){var e,f=0,a=this._children,b=a.length,c;for(e=1;e<b;e++){var d=a[e],f=e-1;for(c=a[f];0<=f&&(d._localZOrder<c._localZOrder||d._localZOrder==c._localZOrder&&d.arrivalOrder<c.arrivalOrder);){a[f+1]=c,f-=1,c=a[f]}a[f+1]=d}0<a.length&&this._arrayMakeObjectsPerformSelector(a,cc.Node.StateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},_sortAllChildrenForWebGL:function(){if(this._reorderChildDirty){var e=this._children,f,a=0,b=e.length,c;for(f=1;f<b;f++){var d=e[f],a=f-1;for(c=e[a];0<=a&&(d._localZOrder<c._localZOrder||d._localZOrder==c._localZOrder&&d.arrivalOrder<c.arrivalOrder);){e[a+1]=c,a-=1,c=e[a]}e[a+1]=d}if(0<e.length){this._arrayMakeObjectsPerformSelector(e,cc.Node.StateCallbackType.sortAllChildren);for(f=a=0;f<e.length;f++){a=this._updateAtlasIndex(e[f],a)}}this._reorderChildDirty=!1}},draw:null,_drawForWebGL:function(){0!==this.textureAtlas.totalQuads&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this.textureAtlas.drawQuads())}});_p=cc.SpriteBatchNode.prototype;cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.updateQuadFromSprite=_p._updateQuadFromSpriteForWebGL,_p.insertQuadFromSprite=_p._insertQuadFromSpriteForWebGL,_p.initWithTexture=_p._initWithTextureForWebGL,_p.appendChild=_p._appendChildForWebGL,_p.removeSpriteFromAtlas=_p._removeSpriteFromAtlasForWebGL,_p.getTexture=_p._getTextureForWebGL,_p.setTexture=_p._setTextureForWebGL,_p.visit=_p._visitForWebGL,_p.addChild=_p._addChildForWebGL,_p.removeAllChildren=_p._removeAllChildrenForWebGL,_p.sortAllChildren=_p._sortAllChildrenForWebGL,_p.draw=_p._drawForWebGL):(_p.ctor=_p._ctorForCanvas,_p.updateQuadFromSprite=_p._updateQuadFromSpriteForCanvas,_p.insertQuadFromSprite=_p._insertQuadFromSpriteForCanvas,_p.initWithTexture=_p._initWithTextureForCanvas,_p.appendChild=_p._appendChildForCanvas,_p.removeSpriteFromAtlas=_p._removeSpriteFromAtlasForCanvas,_p.getTexture=_p._getTextureForCanvas,_p.setTexture=_p._setTextureForCanvas,_p.visit=_p._visitForCanvas,_p.removeAllChildren=_p._removeAllChildrenForCanvas,_p.addChild=_p._addChildForCanvas,_p.sortAllChildren=_p._sortAllChildrenForCanvas,_p.draw=cc.Node.prototype.draw);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.defineGetterSetter(_p,"descendants",_p.getDescendants);cc.SpriteBatchNode.create=function(a,b){return new cc.SpriteBatchNode(a,b)};cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION;a["cocos2d.x.compiled_with_profiler"]=!1;a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE;this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return !1},supportsS3TC:function(){return !1},supportsATITC:function(){return !1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return -1<this._GlExtensions.indexOf(a)},getValue:function(b,c){this._inited||this._init();var a=this._valueDict;return a[b]?a[b]:c},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc._RENDER_TYPE_CANVAS){this._inited||this._init();var c=cc._renderContext,d=this._valueDict;d["gl.vendor"]=c.getParameter(c.VENDOR);d["gl.renderer"]=c.getParameter(c.RENDERER);d["gl.version"]=c.getParameter(c.VERSION);this._GlExtensions="";for(var a=c.getSupportedExtensions(),b=0;b<a.length;b++){this._GlExtensions+=a[b]+" "}this._maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE);d["gl.max_texture_size"]=this._maxTextureSize;this._maxTextureUnits=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS);d["gl.max_texture_units"]=this._maxTextureUnits;this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc");d["gl.supports_PVRTC"]=this._supportsPVRTC;this._supportsNPOT=!1;d["gl.supports_NPOT"]=this._supportsNPOT;this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888");d["gl.supports_BGRA8888"]=this._supportsBGRA8888;this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer");d["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer;this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object");d["gl.supports_vertex_array_object"]=this._supportsShareableVAO;cc.checkGLErrorDebug()}},loadConfigFile:function(b){this._inited||this._init();var c=cc.loader.getRes(b);if(!c){throw"Please load the resource first : "+b}cc.assert(c,cc._LogInfos.configuration_loadConfigFile_2,b);if(c=c.data){for(var a in c){this._valueDict[a]=c[a]}}else{cc.log(cc._LogInfos.configuration_loadConfigFile,b)}}};cc.g_NumberOfDraws=0;cc.GLToClipTransform=function(b){var c=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,c);var a=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,a);cc.kmMat4Multiply(b,c,a)};cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames:0,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterDraw:null,_eventAfterVisit:null,_eventAfterUpdate:null,ctor:function(){var a=this;a._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){a._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._frameRate=this._accumDt=0;this._displayStats=!1;this._totalFrames=this._frames=0;this._lastUpdate=Date.now();this._purgeDirectorInNextLoop=this._paused=!1;this._winSizeInPoints=cc.size(0,0);this._openGLView=null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;this._actionManager=cc.ActionManager?new cc.ActionManager:null;this._scheduler.scheduleUpdateForTarget(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);this._eventProjectionChanged.setUserData(this);return !0},calculateDeltaTime:function(){var a=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(a-this._lastUpdate)/1000;0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&0.2<this._deltaTime&&(this._deltaTime=1/60);this._lastUpdate=a},drawScene:function(){this.calculateDeltaTime();this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate));this._clear();this._nextScene&&this.setNextScene();this._beforeVisitScene&&this._beforeVisitScene();this._runningScene&&(this._runningScene.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit));this._notificationNode&&this._notificationNode.visit();this._displayStats&&this._showStats();this._afterVisitScene&&this._afterVisitScene();cc.eventManager.dispatchEvent(this._eventAfterDraw);this._totalFrames++;this._displayStats&&this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return this._winSizeInPoints},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(0.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var a=this._scenesStack.length;0==a?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[a-1])},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAllCallbacks();cc.eventManager&&cc.eventManager.setEnabled(!1);this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup());this._nextScene=this._runningScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);this._sendCleanupToScene=!1;this._scenesStack.push(a);this._nextScene=a},runScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);if(this._runningScene){var b=this._scenesStack.length;0===b?(this._sendCleanupToScene=!0,this._scenesStack[b]=a):(this._sendCleanupToScene=!0,this._scenesStack[b-1]=a);this._nextScene=a}else{this.pushScene(a),this.startAnimation()}},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(a){a!=this._contentScaleFactor&&(this._contentScaleFactor=a,this._createStatsLabel())},setDefaultValues:function(){},setNextDeltaTimeZero:function(a){this._nextDeltaTimeZero=a},setNextScene:function(){var a=!1,b=!1;cc.TransitionScene&&(a=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,b=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!b){if(b=this._runningScene){b.onExitTransitionDidStart(),b.onExit()}this._sendCleanupToScene&&b&&b.cleanup()}this._runningScene=this._nextScene;this._nextScene=null;!a&&null!=this._runningScene&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(a){this._notificationNode=a},getDelegate:function(){return this._projectionDelegate},setDelegate:function(a){this._projectionDelegate=a},_showStats:function(){this._frames++;this._accumDt+=this._deltaTime;this._FPSLabel&&this._SPFLabel&&this._drawsLabel?(this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.string=this._secondsPerFrame.toFixed(3),this._frameRate=this._frames/this._accumDt,this._accumDt=this._frames=0,this._FPSLabel.string=this._frameRate.toFixed(1),this._drawsLabel.string=(0|cc.g_NumberOfDraws).toString()),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel();cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return this._displayStats},setDisplayStats:function(a){this._displayStats=a},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(c){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var d=this._scenesStack,a=d.length;if(0==a){this.end()}else{if(!(c>a)){for(;a>c;){var b=d.pop();b.running&&(b.onExitTransitionDidStart(),b.onExit());b.cleanup();a--}this._nextScene=d[d.length-1];this._sendCleanupToScene=!1}}},getScheduler:function(){return this._scheduler},setScheduler:function(a){this._scheduler!=a&&(this._scheduler=a)},getActionManager:function(){return this._actionManager},setActionManager:function(a){this._actionManager!=a&&(this._actionManager=a)},getDeltaTime:function(){return this._deltaTime},_createStatsLabel:null,_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1000}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.Director.EVENT_AFTER_VISIT="director_after_visit";cc.Director.EVENT_AFTER_UPDATE="director_after_update";cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0;this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(a){this._animationInterval=a;this.invalid||(this.stopAnimation(),this.startAnimation())}});cc.Director.sharedDirector=null;cc.Director.firstUseDirector=!0;cc.Director._getInstance=function(){cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init());return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_3D;cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.Director.prototype,_p.setProjection=function(a){this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged)},_p.setDepthTest=function(){},_p.setOpenGLView=function(a){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;cc.eventManager&&cc.eventManager.setEnabled(!0)},_p._clear=function(){var a=this._openGLView.getViewPortRect();cc._renderContext.clearRect(-a.x,a.y,a.width,-a.height)},_p._createStatsLabel=function(){var a=0,a=this._winSizeInPoints.width>this._winSizeInPoints.height?0|24*(this._winSizeInPoints.height/320):0|24*(this._winSizeInPoints.width/320);this._FPSLabel=cc.LabelTTF.create("000.0","Arial",a);this._SPFLabel=cc.LabelTTF.create("0.000","Arial",a);this._drawsLabel=cc.LabelTTF.create("0000","Arial",a);a=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(this._drawsLabel.width/2+a.x,5*this._drawsLabel.height/2+a.y);this._SPFLabel.setPosition(this._SPFLabel.width/2+a.x,3*this._SPFLabel.height/2+a.y);this._FPSLabel.setPosition(this._FPSLabel.width/2+a.x,this._FPSLabel.height/2+a.y)},_p.getVisibleSize=function(){return this.getWinSize()},_p.getVisibleOrigin=function(){return cc.p(0,0)}):(cc.Director._fpsImage=new Image,cc._addEventListener(cc.Director._fpsImage,"load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage),cc.assert("function"===typeof cc._tmp.DirectorWebGL,cc._LogInfos.MissingFile,"CCDirectorWebGL.js"),cc._tmp.DirectorWebGL(),delete cc._tmp.DirectorWebGL);cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:null,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new cc.kmMat4;this.restore()},description:function(){return"\x3cCCCamera | center \x3d("+this._centerX+","+this._centerY+","+this._centerZ+")\x3e"},setDirty:function(a){this._dirty=a},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0;this._eyeZ=cc.Camera.getZEye();this._upX=this._centerX=this._centerY=this._centerZ=0;this._upY=1;this._upZ=0;cc.kmMat4Identity(this._lookupMatrix);this._dirty=!1},locate:function(){if(this._dirty){var b=new cc.kmVec3,c=new cc.kmVec3,a=new cc.kmVec3;cc.kmVec3Fill(b,this._eyeX,this._eyeY,this._eyeZ);cc.kmVec3Fill(c,this._centerX,this._centerY,this._centerZ);cc.kmVec3Fill(a,this._upX,this._upY,this._upZ);cc.kmMat4LookAt(this._lookupMatrix,b,c,a);this._dirty=!1}cc.kmGLMultMatrix(this._lookupMatrix)},setEyeXYZ:function(b,c,a){this.setEye(b,c,a)},setEye:function(b,c,a){this._eyeX=b;this._eyeY=c;this._eyeZ=a;this._dirty=!0},setCenterXYZ:function(b,c,a){this.setCenter(b,c,a)},setCenter:function(b,c,a){this._centerX=b;this._centerY=c;this._centerZ=a;this._dirty=!0},setUpXYZ:function(b,c,a){this.setUp(b,c,a)},setUp:function(b,c,a){this._upX=b;this._upY=c;this._upZ=a;this._dirty=!0},getEyeXYZ:function(b,c,a){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(b,c,a){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(b,c,a){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(a){}});cc.Camera.getZEye=function(){return cc.FLT_EPSILON};cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1;cc.arrayVerifyType=function(b,c){if(b&&0<b.length){for(var a=0;a<b.length;a++){if(!(b[a] instanceof c)){return cc.log(cc._LogInfos.arrayVerifyType),!1}}}return !0};cc.arrayRemoveObject=function(c,d){for(var a=0,b=c.length;a<b;a++){if(c[a]==d){c.splice(a,1);break}}};cc.arrayRemoveArray=function(c,d){for(var a=0,b=d.length;a<b;a++){cc.arrayRemoveObject(c,d[a])}};cc.arrayAppendObjectsToIndex=function(b,c,a){b.splice.apply(b,[a,0].concat(c));return b};cc.ListEntry=function(e,f,a,b,c,d){this.prev=e;this.next=f;this.target=a;this.priority=b;this.paused=c;this.markedForDeletion=d};cc.HashUpdateEntry=function(c,d,a,b){this.list=c;this.entry=d;this.target=a;this.hh=b};cc.HashTimerEntry=function(d,e,f,g,a,b,c){this.timers=d;this.target=e;this.timerIndex=f;this.currentTimer=g;this.currentTimerSalvaged=a;this.paused=b;this.hh=c};cc.Timer=cc.Class.extend({_interval:0,_callback:null,_target:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,getInterval:function(){return this._interval},setInterval:function(a){this._interval=a},getCallback:function(){return this._callback},ctor:function(d,e,a,b,c){this._target=d;this._callback=e;this._elapsed=-1;this._interval=a||0;this._delay=c||0;this._useDelay=0<this._delay;this._repeat=null==b?cc.REPEAT_FOREVER:b;this._runForever=this._repeat==cc.REPEAT_FOREVER},_doCallback:function(){if("string"==typeof this._callback){this._target[this._callback](this._elapsed)}else{this._callback.call(this._target,this._elapsed)}},update:function(b){if(-1==this._elapsed){this._timesExecuted=this._elapsed=0}else{var c=this._target,a=this._callback;this._elapsed+=b;this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(c&&a&&this._doCallback(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(c&&a&&this._doCallback(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(c&&a&&this._doCallback(),this._elapsed=0,this._timesExecuted+=1),this._timesExecuted>this._repeat&&cc.director.getScheduler().unscheduleCallbackForTarget(c,a))}}});cc.Scheduler=cc.Class.extend({_timeScale:1,_updates:null,_hashForUpdates:null,_arrayForUpdates:null,_hashForTimers:null,_arrayForTimes:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1;this._updates=[[],[],[]];this._hashForUpdates={};this._arrayForUpdates=[];this._hashForTimers={};this._arrayForTimers=[];this._currentTarget=null;this._updateHashLocked=this._currentTargetSalvaged=!1},_removeHashElement:function(a){delete this._hashForTimers[a.target.__instanceId];cc.arrayRemoveObject(this._arrayForTimers,a);a.Timer=null;a.target=null},_removeUpdateFromHash:function(a){if(a=this._hashForUpdates[a.target.__instanceId]){cc.arrayRemoveObject(a.list,a.entry),delete this._hashForUpdates[a.target.__instanceId],cc.arrayRemoveObject(this._arrayForUpdates,a),a.entry=null,a.target=null}},_priorityIn:function(e,f,a,b){b=new cc.ListEntry(null,null,f,a,b,!1);if(e){for(var c=e.length-1,d=0;d<=c&&!(a<e[d].priority);d++){}e.splice(d,0,b)}else{e=[],e.push(b)}a=new cc.HashUpdateEntry(e,b,f,null);this._arrayForUpdates.push(a);this._hashForUpdates[f.__instanceId]=a;return e},_appendIn:function(b,c,a){a=new cc.ListEntry(null,null,c,0,a,!1);b.push(a);b=new cc.HashUpdateEntry(b,a,c,null);this._arrayForUpdates.push(b);this._hashForUpdates[c.__instanceId]=b},setTimeScale:function(a){this._timeScale=a},getTimeScale:function(){return this._timeScale},update:function(h){var k=this._updates,a=this._arrayForTimers,b,c,d;this._updateHashLocked=!0;1!=this._timeScale&&(h*=this._timeScale);c=0;for(d=k.length;c<d&&0<=c;c++){for(var e=this._updates[c],f=0,g=e.length;f<g;f++){b=e[f],!b.paused&&!b.markedForDeletion&&b.target.update(h)}}c=0;for(d=a.length;c<d;c++){b=a[c];if(!b){break}this._currentTarget=b;this._currentTargetSalvaged=!1;if(!b.paused){for(b.timerIndex=0;b.timerIndex<b.timers.length;b.timerIndex++){b.currentTimer=b.timers[b.timerIndex],b.currentTimerSalvaged=!1,b.currentTimer.update(h),b.currentTimer=null}}this._currentTargetSalvaged&&0==b.timers.length&&(this._removeHashElement(b),c--)}c=0;for(d=k.length;c<d;c++){e=this._updates[c];f=0;for(g=e.length;f<g;){b=e[f];if(!b){break}b.markedForDeletion?this._removeUpdateFromHash(b):f++}}this._updateHashLocked=!1;this._currentTarget=null},scheduleCallbackForTarget:function(c,d,e,f,g,h){cc.assert(d,cc._LogInfos.Scheduler_scheduleCallbackForTarget_2);cc.assert(c,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);e=e||0;f=null==f?cc.REPEAT_FOREVER:f;g=g||0;h=h||!1;var a=this._hashForTimers[c.__instanceId];a||(a=new cc.HashTimerEntry(null,c,0,null,null,h,null),this._arrayForTimers.push(a),this._hashForTimers[c.__instanceId]=a);if(null==a.timers){a.timers=[]}else{for(var b=0;b<a.timers.length;b++){if(h=a.timers[b],d==h._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,h.getInterval().toFixed(4),e.toFixed(4));h._interval=e;return}}}h=new cc.Timer(c,d,e,f,g);a.timers.push(h)},scheduleUpdateForTarget:function(d,e,a){if(null!==d){var b=this._updates,c=this._hashForUpdates[d.__instanceId];c?c.entry.markedForDeletion=!1:0==e?this._appendIn(b[1],d,a):0>e?b[0]=this._priorityIn(b[0],d,e,a):b[2]=this._priorityIn(b[2],d,e,a)}},unscheduleCallbackForTarget:function(d,e){if(!(null==d||null==e)){var f=this._hashForTimers[d.__instanceId];if(f){for(var g=f.timers,a=0,b=g.length;a<b;a++){var c=g[a];if(e==c._callback){c==f.currentTimer&&!f.currentTimerSalvaged&&(f.currentTimerSalvaged=!0);g.splice(a,1);f.timerIndex>=a&&f.timerIndex--;0==g.length&&(this._currentTarget==f?this._currentTargetSalvaged=!0:this._removeHashElement(f));break}}}}},unscheduleUpdateForTarget:function(a){null!=a&&(a=this._hashForUpdates[a.__instanceId],null!=a&&(this._updateHashLocked?a.entry.markedForDeletion=!0:this._removeUpdateFromHash(a.entry)))},unscheduleAllCallbacksForTarget:function(b){if(null!=b){var c=this._hashForTimers[b.__instanceId];if(c){var a=c.timers;!c.currentTimerSalvaged&&0<=a.indexOf(c.currentTimer)&&(c.currentTimerSalvaged=!0);a.length=0;this._currentTarget==c?this._currentTargetSalvaged=!0:this._removeHashElement(c)}this.unscheduleUpdateForTarget(b)}},unscheduleAllCallbacks:function(){this.unscheduleAllCallbacksWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(e){for(var f=this._arrayForTimers,a=this._updates,b=0,c=f.length;b<c;b++){this.unscheduleAllCallbacksForTarget(f[b].target)}for(b=2;0<=b;b--){if(!(1==b&&0<e||0==b&&0<=e)){for(var f=a[b],c=0,d=f.length;c<d;c++){this.unscheduleUpdateForTarget(f[c].target)}}}},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(c){c=[];for(var d,e=this._arrayForTimers,f=this._updates,g=0,h=e.length;g<h;g++){if(d=e[g]){d.paused=!0,c.push(d.target)}}g=0;for(h=f.length;g<h;g++){for(var e=f[g],a=0,b=e.length;a<b;a++){if(d=e[a]){d.paused=!0,c.push(d.target)}}}return c},resumeTargets:function(a){if(a){for(var b=0;b<a.length;b++){this.resumeTarget(a[b])}}},pauseTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_pauseTarget);var b=this._hashForTimers[a.__instanceId];b&&(b.paused=!0);if(a=this._hashForUpdates[a.__instanceId]){a.entry.paused=!0}},resumeTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_resumeTarget);var b=this._hashForTimers[a.__instanceId];b&&(b.paused=!1);if(a=this._hashForUpdates[a.__instanceId]){a.entry.paused=!1}},isTargetPaused:function(a){cc.assert(a,cc._LogInfos.Scheduler_isTargetPaused);return(a=this._hashForTimers[a.__instanceId])?a.paused:!1}});cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc._tmp.PrototypeLabelTTF=function(){var a=cc.LabelTTF.prototype;cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"string",a.getString,a.setString);cc.defineGetterSetter(a,"textAlign",a.getHorizontalAlignment,a.setHorizontalAlignment);cc.defineGetterSetter(a,"verticalAlign",a.getVerticalAlignment,a.setVerticalAlignment);cc.defineGetterSetter(a,"fontSize",a.getFontSize,a.setFontSize);cc.defineGetterSetter(a,"fontName",a.getFontName,a.setFontName);cc.defineGetterSetter(a,"font",a._getFont,a._setFont);cc.defineGetterSetter(a,"boundingWidth",a._getBoundingWidth,a._setBoundingWidth);cc.defineGetterSetter(a,"boundingHeight",a._getBoundingHeight,a._setBoundingHeight);cc.defineGetterSetter(a,"fillStyle",a._getFillStyle,a.setFontFillColor);cc.defineGetterSetter(a,"strokeStyle",a._getStrokeStyle,a._setStrokeStyle);cc.defineGetterSetter(a,"lineWidth",a._getLineWidth,a._setLineWidth);cc.defineGetterSetter(a,"shadowOffsetX",a._getShadowOffsetX,a._setShadowOffsetX);cc.defineGetterSetter(a,"shadowOffsetY",a._getShadowOffsetY,a._setShadowOffsetY);cc.defineGetterSetter(a,"shadowOpacity",a._getShadowOpacity,a._setShadowOpacity);cc.defineGetterSetter(a,"shadowBlur",a._getShadowBlur,a._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_isMultiLine:!1,_fontStyleStr:null,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColorStr:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_strokeColorStr:null,_textFillColor:null,_fillColorStr:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_labelCanvas:null,_labelContext:null,_lineWidths:null,_className:"LabelTTF",ctor:function(e,f,a,b,c,d){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._fontStyleStr="";this._fontName="Arial";this._shadowEnabled=this._isMultiLine=!1;this._shadowOffset=cc.p(0,0);this._shadowBlur=this._shadowOpacity=0;this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeEnabled=!1;this._strokeColor=cc.color(255,255,255,255);this._strokeSize=0;this._strokeColorStr="";this._textFillColor=cc.color(255,255,255,255);this._fillColorStr="rgba(255,255,255,1)";this._strokeShadowOffsetY=this._strokeShadowOffsetX=0;this._needUpdateTexture=!1;this._lineWidths=[];this._setColorsString();f&&f instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(e,f):cc.LabelTTF.prototype.initWithString.call(this,e,f,a,b,c,d)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},_measureConfig:function(){this._getLabelContext().font=this._fontStyleStr},_measure:function(a){return this._getLabelContext().measureText(a).width},_checkNextline:function(e,f){var g=this._measure(e),h=Math.floor(e.length*f/g),k=e.indexOf("\n");if(0.8*h>=k&&0<k){return k+1}if(g<f){return e.length}for(var g=!1,m=f+1,k=-1,n=h,q,a=cc.LabelTTF._checkRegEx,b=cc.LabelTTF._reverseCheckRegEx,c=cc.LabelTTF._checkEnRegEx,d=e.substr(h);q=a.exec(d);){n+=q[0].length;m=e.substr(0,n);m=this._measure(m);if("\n"==q[2]&&m<f){g=!0;k=n;break}if(m>f){-1!=k&&(g=!0);break}k=n;d=e.substr(n)}if(g){return k}d=e.substr(0,h);for(k=h;q=b.exec(d);){if(k=q[1].length,d=q[1],m=this._measure(d),m<f){c.test(q[2])&&k++;break}}return k||1},description:function(){return"\x3ccc.LabelTTF | FontName \x3d"+this._fontName+" FontSize \x3d "+this._fontSize.toFixed(1)+"\x3e"},setColor:null,_setColorsString:null,updateDisplayedColor:null,setOpacity:null,updateDisplayedOpacity:null,updateDisplayedOpacityForCanvas:function(a){cc.NodeRGBA.prototype.updateDisplayedOpacity.call(this,a);this._setColorsString()},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions.width,this._dimensions.height)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithString:function(e,f,a,b,c,d){e=e?e+"":"";a=a||16;b=b||cc.size(0,a);c=c||cc.TEXT_ALIGNMENT_LEFT;d=d||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._dimensions=cc.size(b.width,b.height);this._fontName=f||"Arial";this._hAlignment=c;this._vAlignment=d;this._fontSize=a;this._fontStyleStr=this._fontSize+"px '"+f+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(f,this._fontSize);this.string=e;this._setColorsString();this._updateTexture();this._needUpdateTexture=!1;return !0},initWithStringAndTextDefinition:null,setTextDefinition:function(a){a&&this._updateWithTextDefinition(a,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(d,e,a,b){a=a||0.5;!1===this._shadowEnabled&&(this._shadowEnabled=!0);var c=this._shadowOffset;if(c&&c.x!=d||c._y!=e){c.x=d,c.y=e}this._shadowOpacity!=a&&(this._shadowOpacity=a);this._setColorsString();this._shadowBlur!=b&&(this._shadowBlur=b);this._needUpdateTexture=!0},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset.x!=a&&(this._shadowOffset.x=a,this._needUpdateTexture=!0)},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset._y!=a&&(this._shadowOffset._y=a,this._needUpdateTexture=!0)},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);if(this._shadowOffset.x!=a.x||this._shadowOffset.y!=a.y){this._shadowOffset.x=a.x,this._shadowOffset.y=a.y,this._needUpdateTexture=!0}},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOpacity!=a&&(this._shadowOpacity=a,this._setColorsString(),this._needUpdateTexture=!0)},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowBlur!=a&&(this._shadowBlur=a,this._needUpdateTexture=!0)},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._needUpdateTexture=!0)},enableStroke:function(b,c){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var a=this._strokeColor;if(a.r!==b.r||a.g!==b.g||a.b!==b.b){a.r=b.r,a.g=b.g,a.b=b.b,this._setColorsString()}this._strokeSize!==c&&(this._strokeSize=c||0);this._needUpdateTexture=!0},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var b=this._strokeColor;if(b.r!==a.r||b.g!==a.g||b.b!==a.b){b.r=a.r,b.g=a.g,b.b=a.b,this._setColorsString(),this._needUpdateTexture=!0}},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);this._strokeSize!==a&&(this._strokeSize=a||0,this._needUpdateTexture=!0)},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._needUpdateTexture=!0)},setFontFillColor:null,_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(a,b){a.fontDimensions?(this._dimensions.width=a.boundingWidth,this._dimensions.height=a.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0);this._hAlignment=a.textAlign;this._vAlignment=a.verticalAlign;this._fontName=a.fontName;this._fontSize=a.fontSize||12;this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize);a.shadowEnabled&&this.enableShadow(a.shadowOffsetX,a.shadowOffsetY,a.shadowOpacity,a.shadowBlur);a.strokeEnabled&&this.enableStroke(a.strokeStyle,a.lineWidth);this.setFontFillColor(a.fillStyle);b&&this._updateTexture()},_prepareTextDefinition:function(b){var c=new cc.FontDefinition;b?(c.fontSize=this._fontSize,c.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,c.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(c.fontSize=this._fontSize,c.boundingWidth=this._dimensions.width,c.boundingHeight=this._dimensions.height);c.fontName=this._fontName;c.textAlign=this._hAlignment;c.verticalAlign=this._vAlignment;if(this._strokeEnabled){c.strokeEnabled=!0;var a=this._strokeColor;c.strokeStyle=cc.color(a.r,a.g,a.b);c.lineWidth=this._strokeSize}else{c.strokeEnabled=!1}this._shadowEnabled?(c.shadowEnabled=!0,c.shadowBlur=this._shadowBlur,c.shadowOpacity=this._shadowOpacity,c.shadowOffsetX=(b?cc.contentScaleFactor():1)*this._shadowOffset.x,c.shadowOffsetY=(b?cc.contentScaleFactor():1)*this._shadowOffset.y):c._shadowEnabled=!1;b=this._textFillColor;c.fillStyle=cc.color(b.r,b.g,b.b);return c},_fontClientHeight:18,setString:function(a){a=String(a);this._originalText!=a&&(this._originalText=a+"",this._updateString(),this._needUpdateTexture=!0)},_updateString:function(){this._string=this._originalText},setHorizontalAlignment:function(a){a!==this._hAlignment&&(this._hAlignment=a,this._needUpdateTexture=!0)},setVerticalAlignment:function(a){a!=this._vAlignment&&(this._vAlignment=a,this._needUpdateTexture=!0)},setDimensions:function(a){if(a.width!=this._dimensions.width||a.height!=this._dimensions.height){this._dimensions=a,this._updateString(),this._needUpdateTexture=!0}},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(a){a!=this._dimensions.width&&(this._dimensions.width=a,this._updateString(),this._needUpdateTexture=!0)},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(a){a!=this._dimensions.height&&(this._dimensions.height=a,this._updateString(),this._needUpdateTexture=!0)},setFontSize:function(a){this._fontSize!==a&&(this._fontSize=a,this._fontStyleStr=a+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,a),this._needUpdateTexture=!0)},setFontName:function(a){this._fontName&&this._fontName!=a&&(this._fontName=a,this._fontStyleStr=this._fontSize+"px '"+a+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a,this._fontSize),this._needUpdateTexture=!0)},_getFont:function(){return this._fontStyleStr},_setFont:function(a){var b=cc.LabelTTF._fontStyleRE.exec(a);b&&(this._fontSize=parseInt(b[1]),this._fontName=b[2],this._fontStyleStr=a,this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),this._needUpdateTexture=!0)},_drawTTFInCanvas:function(g){if(g){var h=this._strokeShadowOffsetX,k=this._strokeShadowOffsetY,m=this._contentSize.height-k,a=this._vAlignment,b=this._hAlignment,c=this._fontClientHeight,d=this._strokeSize;g.setTransform(1,0,0,1,0+0.5*h,m+0.5*k);g.font!=this._fontStyleStr&&(g.font=this._fontStyleStr);g.fillStyle=this._fillColorStr;var e=k=0,f=this._strokeEnabled;f&&(g.lineWidth=2*d,g.strokeStyle=this._strokeColorStr);this._shadowEnabled&&(d=this._shadowOffset,g.shadowColor=this._shadowColorStr,g.shadowOffsetX=d.x,g.shadowOffsetY=-d.y,g.shadowBlur=this._shadowBlur);g.textBaseline=cc.LabelTTF._textBaseline[a];g.textAlign=cc.LabelTTF._textAlign[b];h=this._contentSize.width-h;k=b===cc.TEXT_ALIGNMENT_RIGHT?k+h:b===cc.TEXT_ALIGNMENT_CENTER?k+h/2:k+0;if(this._isMultiLine){b=this._strings.length;a===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?e=c+m-c*b:a===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(e=c/2+(m-c*b)/2);for(a=0;a<b;a++){h=this._strings[a],d=-m+c*a+e,f&&g.strokeText(h,k,d),g.fillText(h,k,d)}}else{a!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(e=a===cc.VERTICAL_TEXT_ALIGNMENT_TOP?e-m:e-0.5*m),f&&g.strokeText(this._string,k,e),g.fillText(this._string,k,e)}}},_getLabelContext:function(){if(this._labelContext){return this._labelContext}if(!this._labelCanvas){var a=cc.newElement("canvas"),b=new cc.Texture2D;b.initWithElement(a);this.texture=b;this._labelCanvas=a}return this._labelContext=this._labelCanvas.getContext("2d")},_updateTTF:function(){var d=this._dimensions.width,e,f,g=this._lineWidths;g.length=0;this._isMultiLine=!1;this._measureConfig();if(0!==d){var a=this._string;this._strings=[];e=0;for(f=this._string.length;e<f;){var b=this._checkNextline(a.substr(e),d),c=a.substr(e,b);this._strings.push(c);e+=b}}else{this._strings=this._string.split("\n");e=0;for(f=this._strings.length;e<f;e++){g.push(this._measure(this._strings[e]))}}0<this._strings.length&&(this._isMultiLine=!0);f=e=0;this._strokeEnabled&&(e=f=2*this._strokeSize);this._shadowEnabled&&(a=this._shadowOffset,e+=2*Math.abs(a.x),f+=2*Math.abs(a.y));d=0===d?this._isMultiLine?cc.size(0|Math.max.apply(Math,g)+e,0|this._fontClientHeight*this._strings.length+f):cc.size(0|this._measure(this._string)+e,0|this._fontClientHeight+f):0===this._dimensions.height?this._isMultiLine?cc.size(0|d+e,0|this._fontClientHeight*this._strings.length+f):cc.size(0|d+e,0|this._fontClientHeight+f):cc.size(0|d+e,0|this._dimensions.height+f);this.setContentSize(d);this._strokeShadowOffsetX=e;this._strokeShadowOffsetY=f;g=this._anchorPoint;this._anchorPointInPoints.x=0.5*e+(d.width-e)*g.x;this._anchorPointInPoints.y=0.5*f+(d.height-f)*g.y},getContentSize:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype.getContentSize.call(this)},_getWidth:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype._getWidth.call(this)},_getHeight:function(){this._needUpdateTexture&&this._updateTTF();return cc.Sprite.prototype._getHeight.call(this)},_updateTexture:function(){var d=this._getLabelContext(),e=this._labelCanvas,a=this._contentSize;if(0===this._string.length){return e.width=1,e.height=a.height,this.setTextureRect(cc.rect(0,0,1,a.height)),!0}d.font=this._fontStyleStr;this._updateTTF();var b=a.width,a=a.height,c=e.width==b&&e.height==a;e.width=b;e.height=a;c&&d.clearRect(0,0,b,a);this._drawTTFInCanvas(d);this._texture&&this._texture.handleLoadedTexture();this.setTextureRect(cc.rect(0,0,b,a));return !0},visit:function(a){this._string&&""!=this._string&&(this._needUpdateTexture&&(this._needUpdateTexture=!1,this._updateTexture()),cc.Sprite.prototype.visit.call(this,a||cc._renderContext))},draw:null,_setTextureCoords:function(e){var f=this._batchNode?this.textureAtlas.texture:this._texture;if(f){var a=f.pixelsWidth,b=f.pixelsHeight,c,d=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*e.x+1)/(2*a),a=f+(2*e.height-2)/(2*a),c=(2*e.y+1)/(2*b),e=c+(2*e.width-2)/(2*b)):(f=e.x/a,a=(e.x+e.height)/a,c=e.y/b,e=(e.y+e.width)/b),this._flippedX&&(b=c,c=e,e=b),this._flippedY&&(b=f,f=a,a=b),d.bl.texCoords.u=f,d.bl.texCoords.v=c,d.br.texCoords.u=f,d.br.texCoords.v=e,d.tl.texCoords.u=a,d.tl.texCoords.v=c,d.tr.texCoords.u=a,d.tr.texCoords.v=e):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(f=(2*e.x+1)/(2*a),a=f+(2*e.width-2)/(2*a),c=(2*e.y+1)/(2*b),e=c+(2*e.height-2)/(2*b)):(f=e.x/a,a=(e.x+e.width)/a,c=e.y/b,e=(e.y+e.height)/b),this._flippedX&&(b=f,f=a,a=b),this._flippedY&&(b=c,c=e,e=b),d.bl.texCoords.u=f,d.bl.texCoords.v=e,d.br.texCoords.u=a,d.br.texCoords.v=e,d.tl.texCoords.u=f,d.tl.texCoords.v=c,d.tr.texCoords.u=a,d.tr.texCoords.v=c);this._quadDirty=!0}}});cc._renderType===cc._RENDER_TYPE_CANVAS?(_p=cc.LabelTTF.prototype,_p.setColor=function(a){cc.NodeRGBA.prototype.setColor.call(this,a);this._setColorsString()},_p._setColorsString=function(){this._needUpdateTexture=!0;var c=this._displayedColor,d=this._displayedOpacity,a=this._strokeColor,b=this._textFillColor;this._shadowColorStr="rgba("+(0|0.5*c.r)+","+(0|0.5*c.g)+","+(0|0.5*c.b)+","+this._shadowOpacity+")";this._fillColorStr="rgba("+(0|c.r/255*b.r)+","+(0|c.g/255*b.g)+","+(0|c.b/255*b.b)+", "+d/255+")";this._strokeColorStr="rgba("+(0|c.r/255*a.r)+","+(0|c.g/255*a.g)+","+(0|c.b/255*a.b)+", "+d/255+")"},_p.updateDisplayedColor=function(a){cc.NodeRGBA.prototype.updateDisplayedColor.call(this,a);this._setColorsString()},_p.setOpacity=function(a){this._opacity!==a&&(cc.Sprite.prototype.setOpacity.call(this,a),this._setColorsString(),this._needUpdateTexture=!0)},_p.updateDisplayedOpacity=cc.Sprite.prototype.updateDisplayedOpacity,_p.initWithStringAndTextDefinition=function(a,b){this._updateWithTextDefinition(b,!1);this.string=a;return !0},_p.setFontFillColor=function(a){var b=this._textFillColor;if(b.r!=a.r||b.g!=a.g||b.b!=a.b){b.r=a.r,b.g=a.g,b.b=a.b,this._setColorsString(),this._needUpdateTexture=!0}},_p.draw=cc.Sprite.prototype.draw,_p.setTextureRect=function(b,c,a){this._rectRotated=c||!1;this.setContentSize(a||b);this.setVertexRect(b);c=this._textureRect_Canvas;c.x=b.x;c.y=b.y;c.width=b.width;c.height=b.height;c.validRect=!(0===c.width||0===c.height||0>c.x||0>c.y);b=this._unflippedOffsetPositionFromCenter;this._flippedX&&(b.x=-b.x);this._flippedY&&(b.y=-b.y);this._offsetPosition.x=b.x+(this._contentSize.width-this._rect.width)/2;this._offsetPosition.y=b.y+(this._contentSize.height-this._rect.height)/2;this._batchNode&&(this.dirty=!0)},_p=null):(cc.assert("function"===typeof cc._tmp.WebGLLabelTTF,cc._LogInfos.MissingFile,"LabelTTFWebGL.js"),cc._tmp.WebGLLabelTTF(),delete cc._tmp.WebGLLabelTTF);cc.assert("function"===typeof cc._tmp.PrototypeLabelTTF,cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF._checkRegEx=/(.+?)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/;cc.LabelTTF._reverseCheckRegEx=/(.*)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/;cc.LabelTTF._checkEnRegEx=/[\s\-\/\\\:]/;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;cc.LabelTTF.create=function(e,f,a,b,c,d){return new cc.LabelTTF(e,f,a,b,c,d)};cc.LabelTTF._SHADER_PROGRAM=cc.USE_LA88_LABELS?cc.SHADER_POSITION_TEXTURECOLOR:cc.SHADER_POSITION_TEXTUREA8COLOR;cc.LabelTTF.__labelHeightDiv=cc.newElement("div");cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";cc.LabelTTF.__labelHeightDiv.style.position="absolute";cc.LabelTTF.__labelHeightDiv.style.left="-100px";cc.LabelTTF.__labelHeightDiv.style.top="-100px";cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):cc._addEventListener(window,"load",function(){this.removeEventListener("load",arguments.callee,!1);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1);cc.LabelTTF.__getFontHeightByDiv=function(c,d){var a=cc.LabelTTF.__fontHeightCache[c+"."+d];if(0<a){return a}var b=cc.LabelTTF.__labelHeightDiv;b.innerHTML="ajghl~!";b.style.fontFamily=c;b.style.fontSize=d+"px";a=b.clientHeight;cc.LabelTTF.__fontHeightCache[c+"."+d]=a;b.innerHTML="";return a};cc.LabelTTF.__fontHeightCache={};cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.paused=this.currentActionSalvaged=!1;this.hh=null}});cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(b,c){for(var a=0;a<b.length;a++){if(c==b[a].target){return b[a]}}return null},ctor:function(){this._hashTargets={};this._arrayTargets=[];this._currentTarget=null;this._currentTargetSalvaged=!1},addAction:function(c,d,a){if(!c){throw"cc.ActionManager.addAction(): action must be non-null"}if(!d){throw"cc.ActionManager.addAction(): action must be non-null"}var b=this._hashTargets[d.__instanceId];b||(b=new cc.HashElement,b.paused=a,b.target=d,this._hashTargets[d.__instanceId]=b,this._arrayTargets.push(b));this._actionAllocWithHashElement(b);b.actions.push(c);c.startWithTarget(d)},removeAllActions:function(){for(var b=this._arrayTargets,c=0;c<b.length;c++){var a=b[c];a&&this.removeAllActionsFromTarget(a.target,!0)}},removeAllActionsFromTarget:function(b,c){if(null!=b){var a=this._hashTargets[b.__instanceId];a&&(-1!==a.actions.indexOf(a.currentAction)&&!a.currentActionSalvaged&&(a.currentActionSalvaged=!0),a.actions.length=0,this._currentTarget==a&&!c?this._currentTargetSalvaged=!0:this._deleteHashElement(a))}},removeAction:function(b){if(null!=b){var c=b.getOriginalTarget();if(c=this._hashTargets[c.__instanceId]){for(var a=0;a<c.actions.length;a++){if(c.actions[a]==b){c.actions.splice(a,1);break}}}else{cc.log(cc._LogInfos.ActionManager_removeAction)}}},removeActionByTag:function(e,f){e==cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction);cc.assert(f,cc._LogInfos.ActionManager_addAction);var a=this._hashTargets[f.__instanceId];if(a){for(var b=a.actions.length,c=0;c<b;++c){var d=a.actions[c];if(d&&d.getTag()===e&&d.getOriginalTarget()==f){this._removeActionAtIndex(c,a);break}}}},getActionByTag:function(d,e){d==cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var a=this._hashTargets[e.__instanceId];if(a){if(null!=a.actions){for(var b=0;b<a.actions.length;++b){var c=a.actions[b];if(c&&c.getTag()===d){return c}}}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,d)}return null},numberOfRunningActionsInTarget:function(a){return(a=this._hashTargets[a.__instanceId])?a.actions?a.actions.length:0:0},pauseTarget:function(a){if(a=this._hashTargets[a.__instanceId]){a.paused=!0}},resumeTarget:function(a){if(a=this._hashTargets[a.__instanceId]){a.paused=!1}},pauseAllRunningActions:function(){for(var c=[],d=this._arrayTargets,a=0;a<d.length;a++){var b=d[a];b&&!b.paused&&(b.paused=!0,c.push(b.target))}return c},resumeTargets:function(a){if(a){for(var b=0;b<a.length;b++){a[b]&&this.resumeTarget(a[b])}}},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdateForTarget(this)},_removeActionAtIndex:function(a,b){b.actions[a]==b.currentAction&&!b.currentActionSalvaged&&(b.currentActionSalvaged=!0);b.actions.splice(a,1);b.actionIndex>=a&&b.actionIndex--;0==b.actions.length&&(this._currentTarget==b?this._currentTargetSalvaged=!0:this._deleteHashElement(b))},_deleteHashElement:function(a){a&&(delete this._hashTargets[a.target.__instanceId],cc.arrayRemoveObject(this._arrayTargets,a),a.actions=null,a.target=null)},_actionAllocWithHashElement:function(a){null==a.actions&&(a.actions=[])},update:function(d){for(var e=this._arrayTargets,a,b=0;b<e.length;b++){a=this._currentTarget=e[b];if(!a.paused){for(a.actionIndex=0;a.actionIndex<a.actions.length;a.actionIndex++){if(a.currentAction=a.actions[a.actionIndex],a.currentAction){a.currentActionSalvaged=!1;a.currentAction.step(d*(a.currentAction._speedMethod?a.currentAction._speed:1));if(a.currentActionSalvaged){a.currentAction=null}else{if(a.currentAction.isDone()){a.currentAction.stop();var c=a.currentAction;a.currentAction=null;this.removeAction(c)}}a.currentAction=null}}}this._currentTargetSalvaged&&0===a.actions.length&&this._deleteHashElement(a)}}});cc.IMAGE_FORMAT_JPEG=0;cc.IMAGE_FORMAT_PNG=1;cc.IMAGE_FORMAT_RAWDATA=2;cc.NextPOT=function(a){a-=1;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1};cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_cacheCanvas:null,_cacheContext:null,_fBO:0,_depthRenderBuffer:0,_oldFBO:0,_texture:null,_textureCopy:null,_uITextureImage:null,_pixelFormat:cc.Texture2D.PIXEL_FORMAT_RGBA8888,_clearColor:null,clearStencilVal:0,_clearColorStr:null,_className:"RenderTexture",ctor:null,_ctorForCanvas:function(c,d,a,b){cc.Node.prototype.ctor.call(this);this._clearColor=cc.color(255,255,255,255);this._clearColorStr="rgba(255,255,255,1)";this._cacheCanvas=cc.newElement("canvas");this._cacheContext=this._cacheCanvas.getContext("2d");this.anchorY=this.anchorX=0;void 0!==c&&void 0!==d&&(a=a||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(c,d,a,b||0))},_ctorForWebGL:function(c,d,a,b){cc.Node.prototype.ctor.call(this);this._clearColor=cc.color(0,0,0,0);void 0!==c&&void 0!==d&&(a=a||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(c,d,a,b||0))},cleanup:null,_cleanupForCanvas:function(){cc.Node.prototype.onExit.call(this);this._cacheCanvas=this._cacheContext=null},_cleanupForWebGL:function(){cc.Node.prototype.onExit.call(this);this._textureCopy=null;var a=cc._renderContext;a.deleteFramebuffer(this._fBO);this._depthRenderBuffer&&a.deleteRenderbuffer(this._depthRenderBuffer);this._uITextureImage=null},getSprite:function(){return this.sprite},setSprite:function(a){this.sprite=a},initWithWidthAndHeight:null,_initWithWidthAndHeightForCanvas:function(c,d,a,b){a=this._cacheCanvas;b=cc.contentScaleFactor();a.width=0|c*b;a.height=0|d*b;this._cacheContext.translate(0,a.height);c=new cc.Texture2D;c.initWithElement(a);c.handleLoadedTexture();this.sprite=cc.Sprite.create(c);return !0},_initWithWidthAndHeightForWebGL:function(h,k,a,b){a==cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var c=cc._renderContext,d=cc.contentScaleFactor();h=0|h*d;k=0|k*d;this._oldFBO=c.getParameter(c.FRAMEBUFFER_BINDING);var e;cc.configuration.supportsNPOT()?(d=h,e=k):(d=cc.NextPOT(h),e=cc.NextPOT(k));for(var f=new Uint8Array(4*d*e),g=0;g<4*d*e;g++){f[g]=0}this._pixelFormat=a;this._texture=new cc.Texture2D;if(!this._texture){return !1}g=this._texture;g.initWithData(f,this._pixelFormat,d,e,cc.size(h,k));a=c.getParameter(c.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){this._textureCopy=new cc.Texture2D;if(!this._textureCopy){return !1}this._textureCopy.initWithData(f,this._pixelFormat,d,e,cc.size(h,k))}this._fBO=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this._fBO);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,g._webTextureObj,0);0!=b&&(this._depthRenderBuffer=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,this._depthRenderBuffer),c.renderbufferStorage(c.RENDERBUFFER,b,d,e),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._depthRenderBuffer));c.checkFramebufferStatus(c.FRAMEBUFFER)!==c.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer");g.setAliasTexParameters();h=this.sprite=cc.Sprite.create(g);h.scaleY=-1;h.setBlendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);c.bindRenderbuffer(c.RENDERBUFFER,a);c.bindFramebuffer(c.FRAMEBUFFER,this._oldFBO);this.autoDraw=!1;this.addChild(h);return !0},begin:null,_beginForCanvas:function(){cc._renderContext=this._cacheContext;cc.view._setScaleXYForRenderTexture()},_beginForWebGL:function(){cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPushMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPushMatrix();var c=cc.director;c.setProjection(c.getProjection());var d=this._texture.getContentSizeInPixels(),a=cc.director.getWinSizeInPixels(),c=a.width/d.width,a=a.height/d.height,b=cc._renderContext;b.viewport(0,0,d.width,d.height);d=new cc.kmMat4;cc.kmMat4OrthographicProjection(d,-1/c,1/c,-1/a,1/a,-1,1);cc.kmGLMultMatrix(d);this._oldFBO=b.getParameter(b.FRAMEBUFFER_BINDING);b.bindFramebuffer(b.FRAMEBUFFER,this._fBO);cc.configuration.checkForGLExtension("GL_QCOM")&&(b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._textureCopy._webTextureObj,0),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._texture._webTextureObj,0))},beginWithClear:function(d,e,f,g,a,b){var c=cc._renderContext;a=a||c.COLOR_BUFFER_BIT;b=b||c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT;this._beginWithClear(d,e,f,g,a,b,c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)},_beginWithClear:null,_beginWithClearForCanvas:function(d,e,f,g,a,b,c){this.begin();d=d||0;e=e||0;f=f||0;g=isNaN(g)?1:g;a=this._cacheContext;b=this._cacheCanvas;a.save();a.fillStyle="rgba("+(0|d)+","+(0|e)+","+(0|f)+","+g/255+")";a.clearRect(0,0,b.width,-b.height);a.fillRect(0,0,b.width,-b.height);a.restore()},_beginWithClearForWebGL:function(f,g,h,k,m,n,a){this.begin();var b=cc._renderContext,c=[0,0,0,0],d=0,e=0;a&b.COLOR_BUFFER_BIT&&(c=b.getParameter(b.COLOR_CLEAR_VALUE),b.clearColor(f,g,h,k));a&b.DEPTH_BUFFER_BIT&&(d=b.getParameter(b.DEPTH_CLEAR_VALUE),b.clearDepth(m));a&b.STENCIL_BUFFER_BIT&&(e=b.getParameter(b.STENCIL_CLEAR_VALUE),b.clearStencil(n));b.clear(a);a&b.COLOR_BUFFER_BIT&&b.clearColor(c[0],c[1],c[2],c[3]);a&b.DEPTH_BUFFER_BIT&&b.clearDepth(d);a&b.STENCIL_BUFFER_BIT&&b.clearStencil(e)},end:null,_endForCanvas:function(){cc._renderContext=cc._mainRenderContextBackup;cc.view._resetScale()},_endForWebGL:function(){var a=cc._renderContext,b=cc.director;a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO);b.setViewport();cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPopMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPopMatrix()},clear:function(c,d,a,b){this.beginWithClear(c,d,a,b);this.end()},clearRect:null,_clearRectForCanvas:function(c,d,a,b){this._cacheContext.clearRect(c,d,a,-b)},_clearRectForWebGL:function(c,d,a,b){},clearDepth:null,_clearDepthForCanvas:function(a){cc.log("clearDepth isn't supported on Cocos2d-Html5")},_clearDepthForWebGL:function(b){this.begin();var c=cc._renderContext,a=c.getParameter(c.DEPTH_CLEAR_VALUE);c.clearDepth(b);c.clear(c.DEPTH_BUFFER_BIT);c.clearDepth(a);this.end()},clearStencil:null,_clearStencilForCanvas:function(a){cc.log("clearDepth isn't supported on Cocos2d-Html5")},_clearStencilForWebGL:function(b){var c=cc._renderContext,a=c.getParameter(c.STENCIL_CLEAR_VALUE);c.clearStencil(b);c.clear(c.STENCIL_BUFFER_BIT);c.clearStencil(a)},visit:null,_visitForCanvas:function(a){this._visible&&(a=a||cc._renderContext,a.save(),this.draw(a),this.transform(a),this.sprite.visit(),a.restore(),this.arrivalOrder=0)},_visitForWebGL:function(a){if(this._visible){cc.kmGLPushMatrix();var b=this.grid;b&&b.isActive()&&(b.beforeDraw(),this.transformAncestors());this.transform(a);this.sprite.visit();this.draw(a);b&&b.isActive()&&b.afterDraw(this);cc.kmGLPopMatrix();this.arrivalOrder=0}},draw:null,_drawForCanvas:function(d){d=d||cc._renderContext;if(this.autoDraw){this.begin();if(this.clearFlags){var e=this._cacheCanvas;d.save();d.fillStyle=this._clearColorStr;d.clearRect(0,0,e.width,-e.height);d.fillRect(0,0,e.width,-e.height);d.restore()}this.sortAllChildren();d=this._children;for(var e=d.length,a=this.sprite,b=0;b<e;b++){var c=d[b];c!=a&&c.visit()}this.end()}},_drawForWebGL:function(d){d=cc._renderContext;if(this.autoDraw){this.begin();var e=this.clearFlags;if(e){var a=[0,0,0,0],b=0,c=0;e&d.COLOR_BUFFER_BIT&&(a=d.getParameter(d.COLOR_CLEAR_VALUE),d.clearColor(this._clearColor.r/255,this._clearColor.g/255,this._clearColor.b/255,this._clearColor.a/255));e&d.DEPTH_BUFFER_BIT&&(b=d.getParameter(d.DEPTH_CLEAR_VALUE),d.clearDepth(this.clearDepthVal));e&d.STENCIL_BUFFER_BIT&&(c=d.getParameter(d.STENCIL_CLEAR_VALUE),d.clearStencil(this.clearStencilVal));d.clear(e);e&d.COLOR_BUFFER_BIT&&d.clearColor(a[0],a[1],a[2],a[3]);e&d.DEPTH_BUFFER_BIT&&d.clearDepth(b);e&d.STENCIL_BUFFER_BIT&&d.clearStencil(c)}this.sortAllChildren();d=this._children;for(e=0;e<d.length;e++){a=d[e],a!=this.sprite&&a.visit()}this.end()}},newCCImage:function(a){cc.log("saveToFile isn't supported on cocos2d-html5");return null},_memcpy:function(e,f,a,b,c){for(var d=0;d<c;d++){e[f+d]=a[b+d]}},saveToFile:function(a,b){cc.log("saveToFile isn't supported on Cocos2d-Html5")},listenToBackground:function(a){cc.log("listenToBackground isn't supported on Cocos2d-Html5")},listenToForeground:function(a){cc.log("listenToForeground isn't supported on Cocos2d-Html5")},getClearFlags:function(){return this.clearFlags},setClearFlags:function(a){this.clearFlags=a},getClearColor:function(){return this._clearColor},setClearColor:null,_setClearColorForCanvas:function(a){var b=this._clearColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=a.a;this._clearColorStr="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")"},_setClearColorForWebGL:function(a){var b=this._clearColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=a.a},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(a){this.clearDepthVal=a},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(a){this.clearStencilVal=a},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(a){this.autoDraw=a}});_p=cc.RenderTexture.prototype;cc._renderType==cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.cleanup=_p._cleanupForWebGL,_p.initWithWidthAndHeight=_p._initWithWidthAndHeightForWebGL,_p.begin=_p._beginForWebGL,_p._beginWithClear=_p._beginWithClearForWebGL,_p.end=_p._endForWebGL,_p.clearRect=_p._clearRectForWebGL,_p.clearDepth=_p._clearDepthForWebGL,_p.clearStencil=_p._clearStencilForWebGL,_p.visit=_p._visitForWebGL,_p.draw=_p._drawForWebGL,_p.setClearColor=_p._setClearColorForWebGL):(_p.ctor=_p._ctorForCanvas,_p.cleanup=_p._cleanupForCanvas,_p.initWithWidthAndHeight=_p._initWithWidthAndHeightForCanvas,_p.begin=_p._beginForCanvas,_p._beginWithClear=_p._beginWithClearForCanvas,_p.end=_p._endForCanvas,_p.clearRect=_p._clearRectForCanvas,_p.clearDepth=_p._clearDepthForCanvas,_p.clearStencil=_p._clearStencilForCanvas,_p.visit=_p._visitForCanvas,_p.draw=_p._drawForCanvas,_p.setClearColor=_p._setClearColorForCanvas);cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor);cc.RenderTexture.create=function(c,d,a,b){return new cc.RenderTexture(c,d,a,b)};cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_loadedEventListeners:null,_className:"LabelAtlas",ctor:function(d,e,a,b,c){cc.AtlasNode.prototype.ctor.call(this);e&&cc.LabelAtlas.prototype.initWithString.call(this,d,e,a,b,c)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this._loadedEventListeners||(this._loadedEventListeners=[]);this._loadedEventListeners.push({eventCallback:a,eventTarget:b})},_callLoadedEventCallbacks:function(){if(this._loadedEventListeners){this._textureLoaded=!0;for(var c=this._loadedEventListeners,d=0,a=c.length;d<a;d++){var b=c[d];b.eventCallback.call(b.eventTarget,this)}c.length=0}},initWithString:function(h,k,a,b,c){var d=h+"",e,f;if(void 0===a){a=cc.loader.getRes(k);if(1!==parseInt(a.version,10)){return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1}k=cc.path.changeBasename(k,a.textureFilename);b=cc.contentScaleFactor();e=parseInt(a.itemWidth,10)/b;f=parseInt(a.itemHeight,10)/b;a=String.fromCharCode(parseInt(a.firstChar,10))}else{e=a||0,f=b||0,a=c||" "}var g=null,g=k instanceof cc.Texture2D?k:cc.textureCache.addImage(k);(this._textureLoaded=k=g.isLoaded())||g.addLoadedEventListener(function(i){this.initWithTexture(g,e,f,d.length);this.string=d;this._callLoadedEventCallbacks()},this);return this.initWithTexture(g,e,f,d.length)?(this._mapStartChar=a,this.string=d,!0):!1},setColor:function(a){cc.AtlasNode.prototype.setColor.call(this,a);this.updateAtlasValues()},getString:function(){return this._string},draw:function(a){cc.AtlasNode.prototype.draw.call(this,a);cc.LABELATLAS_DEBUG_DRAW&&(a=this.size,a=[cc.p(0,0),cc.p(a.width,0),cc.p(a.width,a.height),cc.p(0,a.height)],cc._drawingUtil.drawPoly(a,4,!0))},_addChildForCanvas:function(b,c,a){b._lateChild=!0;cc.NodeRGBA.prototype.addChild.call(this,b,c,a)},updateAtlasValues:null,_updateAtlasValuesForCanvas:function(){for(var h=this._string,k=h.length,a=this.texture,b=this._itemWidth,c=this._itemHeight,d=0;d<k;d++){var e=h.charCodeAt(d)-this._mapStartChar.charCodeAt(0),f=parseInt(e%this._itemsPerRow,10),e=parseInt(e/this._itemsPerRow,10),f=cc.rect(f*b,e*c,b,c),e=h.charCodeAt(d),g=this.getChildByTag(d);g?32==e?(g.init(),g.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(g.initWithTexture(a,f),g.visible=!0,g.opacity=this._displayedOpacity):(g=new cc.Sprite,32==e?(g.init(),g.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):g.initWithTexture(a,f),cc.NodeRGBA.prototype.addChild.call(this,g,0,d));g.setPosition(d*b+b/2,c/2)}},_updateAtlasValuesForWebGL:function(){var a=this._string,b=a.length,c=this.textureAtlas,d=c.texture,f=d.pixelsWidth,d=d.pixelsHeight,h=this._itemWidth,k=this._itemHeight;this._ignoreContentScaleFactor||(h=this._itemWidth*cc.contentScaleFactor(),k=this._itemHeight*cc.contentScaleFactor());b>c.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var m=c.quads,n=this._displayedColor,n={r:n.r,g:n.g,b:n.b,a:this._displayedOpacity},q=this._itemWidth,r=0;r<b;r++){var s=a.charCodeAt(r)-this._mapStartChar.charCodeAt(0),u=s%this._itemsPerRow,t=0|s/this._itemsPerRow,g;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(u=(2*u*h+1)/(2*f),s=u+(2*h-2)/(2*f),t=(2*t*k+1)/(2*d),g=t+(2*k-2)/(2*d)):(u=u*h/f,s=u+h/f,t=t*k/d,g=t+k/d);var e=m[r],v=e.tl,w=e.tr,x=e.bl,e=e.br;v.texCoords.u=u;v.texCoords.v=t;w.texCoords.u=s;w.texCoords.v=t;x.texCoords.u=u;x.texCoords.v=g;e.texCoords.u=s;e.texCoords.v=g;x.vertices.x=r*q;x.vertices.y=0;x.vertices.z=0;e.vertices.x=r*q+q;e.vertices.y=0;e.vertices.z=0;v.vertices.x=r*q;v.vertices.y=this._itemHeight;v.vertices.z=0;w.vertices.x=r*q+q;w.vertices.y=this._itemHeight;w.vertices.z=0;v.colors=n;w.colors=n;x.colors=n;e.colors=n}0<b&&(c.dirty=!0,a=c.totalQuads,b>a&&c.increaseTotalQuadsWith(b-a))},setString:null,_setStringForCanvas:function(c){c=String(c);var d=c.length;this._string=c;this.width=d*this._itemWidth;this.height=this._itemHeight;if(this._children){c=this._children;for(var d=c.length,a=0;a<d;a++){var b=c[a];b&&!b._lateChild&&(b.visible=!1)}}this.updateAtlasValues();this.quadsToDraw=d},_setStringForWebGL:function(a){a=String(a);var b=a.length;b>this.textureAtlas.totalQuads&&this.textureAtlas.resizeCapacity(b);this._string=a;this.width=b*this._itemWidth;this.height=this._itemHeight;this.updateAtlasValues();this.quadsToDraw=b},setOpacity:null,_setOpacityForCanvas:function(c){if(this._displayedOpacity!==c){cc.AtlasNode.prototype.setOpacity.call(this,c);for(var d=this._children,a=0,b=d.length;a<b;a++){d[a]&&(d[a].opacity=c)}}},_setOpacityForWebGL:function(a){this._opacity!==a&&cc.AtlasNode.prototype.setOpacity.call(this,a)}});_p=cc.LabelAtlas.prototype;cc._renderType===cc._RENDER_TYPE_WEBGL?(_p.updateAtlasValues=_p._updateAtlasValuesForWebGL,_p.setString=_p._setStringForWebGL,_p.setOpacity=_p._setOpacityForWebGL):(_p.updateAtlasValues=_p._updateAtlasValuesForCanvas,_p.setString=_p._setStringForCanvas,_p.setOpacity=_p._setOpacityForCanvas,_p.addChild=_p._addChildForCanvas);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.LabelAtlas.create=function(d,e,a,b,c){return new cc.LabelAtlas(d,e,a,b,c)};cc.ACTION_TAG_INVALID=-1;cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null;this.tag=cc.ACTION_TAG_INVALID},copy:function(){cc.log("copy is deprecated. Please use clone instead.");return this.clone()},clone:function(){var a=new cc.Action;a.originalTarget=null;a.target=null;a.tag=this.tag;return a},isDone:function(){return !0},startWithTarget:function(a){this.target=this.originalTarget=a},stop:function(){this.target=null},step:function(a){cc.log("[Action step]. override me")},update:function(a){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(a){this.target=a},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(a){this.originalTarget=a},getTag:function(){return this.tag},setTag:function(a){this.tag=a},retain:function(){},release:function(){}});cc.Action.create=function(){return new cc.Action};cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this);this._duration=0},getDuration:function(){return this._duration*(this._times||1)},setDuration:function(a){this._duration=a},reverse:function(){cc.log("cocos2d: FiniteTimeAction#reverse: Implement me");return null},clone:function(){return new cc.FiniteTimeAction}});cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._speed=0;this._innerAction=null;a&&this.initWithAction(a,b)},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a},initWithAction:function(a,b){if(!a){throw"cc.Speed.initWithAction(): action must be non nil"}this._innerAction=a;this._speed=b;return !0},clone:function(){var a=new cc.Speed;a.initWithAction(this._innerAction.clone(),this._speed);return a},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(a){this._innerAction.step(a*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return cc.Speed.create(this._innerAction.reverse(),this._speed)},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.Speed.create=function(a,b){return new cc.Speed(a,b)};cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,_worldRect:null,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._followedNode=null;this._boundaryFullyCovered=this._boundarySet=!1;this._fullScreenSize=this._halfScreenSize=null;this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0;this._worldRect=cc.rect(0,0,0,0);a&&(b?this.initWithTarget(a,b):this.initWithTarget(a))},clone:function(){var a=new cc.Follow,b=this._worldRect,b=new cc.Rect(b.x,b.y,b.width,b.height);a.initWithTarget(this._followedNode,b);return a},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(a){this._boundarySet=a},initWithTarget:function(b,c){if(!b){throw"cc.Follow.initWithAction(): followedNode must be non nil"}c=c||cc.rect(0,0,0,0);this._followedNode=b;this._worldRect=c;this._boundarySet=!cc._rectEqualToZero(c);this._boundaryFullyCovered=!1;var a=cc.director.getWinSize();this._fullScreenSize=cc.p(a.width,a.height);this._halfScreenSize=cc.pMult(this._fullScreenSize,0.5);this._boundarySet&&(this.leftBoundary=-(c.x+c.width-this._fullScreenSize.x),this.rightBoundary=-c.x,this.topBoundary=-c.y,this.bottomBoundary=-(c.y+c.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary==this.bottomBoundary&&this.leftBoundary==this.rightBoundary&&(this._boundaryFullyCovered=!0));return !0},step:function(a){a=this._followedNode.x;var b=this._followedNode.y;a=this._halfScreenSize.x-a;b=this._halfScreenSize.y-b;this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(a,this.leftBoundary,this.rightBoundary),cc.clampf(b,this.bottomBoundary,this.topBoundary)):this.target.setPosition(a,b)},isDone:function(){return !this._followedNode.running},stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.Follow.create=function(a,b){return new cc.Follow(a,b)};cc.v2fzero=function(){return{x:0,y:0}};cc.v2f=function(a,b){return{x:a,y:b}};cc.v2fadd=function(a,b){return cc.v2f(a.x+b.x,a.y+b.y)};cc.v2fsub=function(a,b){return cc.v2f(a.x-b.x,a.y-b.y)};cc.v2fmult=function(a,b){return cc.v2f(a.x*b,a.y*b)};cc.v2fperp=function(a){return cc.v2f(-a.y,a.x)};cc.v2fneg=function(a){return cc.v2f(-a.x,-a.y)};cc.v2fdot=function(a,b){return a.x*b.x+a.y*b.y};cc.v2fforangle=function(a){return cc.v2f(Math.cos(a),Math.sin(a))};cc.v2fnormalize=function(a){a=cc.pNormalize(cc.p(a.x,a.y));return cc.v2f(a.x,a.y)};cc.__v2f=function(a){return cc.v2f(a.x,a.y)};cc.__t=function(a){return{u:a.x,v:a.y}};cc.DrawNodeCanvas=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);this._buffer=[];this._drawColor=cc.color(255,255,255,255);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this.init()},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=a.dst):(this._blendFunc.src=a,this._blendFunc.dst=b)},setLineWidth:function(a){this._lineWidth=a},getLineWidth:function(){return this._lineWidth},setDrawColor:function(a){var b=this._drawColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=null==a.a?255:a.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)},drawRect:function(d,e,a,b,c){b=b||this._lineWidth;c=c||this.getDrawColor();null==c.a&&(c.a=255);d=[d,cc.p(e.x,d.y),e,cc.p(d.x,e.y)];e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=d;e.lineWidth=b;e.lineColor=c;e.isClosePolygon=!0;e.isStroke=!0;e.lineCap="butt";if(e.fillColor=a){null==a.a&&(a.a=255),e.isFill=!0}this._buffer.push(e)},drawCircle:function(e,f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);for(var q=2*Math.PI/h,a=[],b=0;b<=h;b++){var c=b*q,d=f*Math.cos(c+g)+e.x,c=f*Math.sin(c+g)+e.y;a.push(cc.p(d,c))}k&&a.push(cc.p(e.x,e.y));e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=a;e.lineWidth=m;e.lineColor=n;e.isClosePolygon=!0;e.isStroke=!0;this._buffer.push(e)},drawQuadBezier:function(f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);for(var a=[],b=0,c=0;c<k;c++){var d=Math.pow(1-b,2)*f.x+2*(1-b)*b*g.x+b*b*h.x,e=Math.pow(1-b,2)*f.y+2*(1-b)*b*g.y+b*b*h.y;a.push(cc.p(d,e));b+=1/k}a.push(cc.p(h.x,h.y));f=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);f.verts=a;f.lineWidth=m;f.lineColor=n;f.isStroke=!0;f.lineCap="round";this._buffer.push(f)},drawCubicBezier:function(e,f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);for(var q=[],a=0,b=0;b<k;b++){var c=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*f.x+3*(1-a)*a*a*g.x+a*a*a*h.x,d=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*f.y+3*(1-a)*a*a*g.y+a*a*a*h.y;q.push(cc.p(c,d));a+=1/k}q.push(cc.p(h.x,h.y));e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=q;e.lineWidth=m;e.lineColor=n;e.isStroke=!0;e.lineCap="round";this._buffer.push(e)},drawCatmullRom:function(c,d,a,b){this.drawCardinalSpline(c,0.5,d,a,b)},drawCardinalSpline:function(g,h,k,m,a){m=m||this._lineWidth;a=a||this.getDrawColor();null==a.a&&(a.a=255);for(var b=[],c,d,e=1/g.length,f=0;f<k+1;f++){d=f/k,1==d?(c=g.length-1,d=1):(c=0|d/e,d=(d-e*c)/e),c=cc.cardinalSplineAt(cc.getControlPointAt(g,c-1),cc.getControlPointAt(g,c-0),cc.getControlPointAt(g,c+1),cc.getControlPointAt(g,c+2),h,d),b.push(c)}g=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);g.verts=b;g.lineWidth=m;g.lineColor=a;g.isStroke=!0;g.lineCap="round";this._buffer.push(g)},drawDot:function(c,d,a){a=a||this.getDrawColor();null==a.a&&(a.a=255);var b=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);b.verts=[c];b.lineWidth=d;b.fillColor=a;this._buffer.push(b)},drawDots:function(d,e,a){if(d&&0!=d.length){a=a||this.getDrawColor();null==a.a&&(a.a=255);for(var b=0,c=d.length;b<c;b++){this.drawDot(d[b],e,a)}}},drawSegment:function(d,e,a,b){a=a||this._lineWidth;b=b||this.getDrawColor();null==b.a&&(b.a=255);var c=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);c.verts=[d,e];c.lineWidth=2*a;c.lineColor=b;c.isStroke=!0;c.lineCap="round";this._buffer.push(c)},drawPoly_:function(d,e,a,b){a=a||this._lineWidth;b=b||this.getDrawColor();null==b.a&&(b.a=255);var c=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);c.verts=d;c.fillColor=e;c.lineWidth=a;c.lineColor=b;c.isClosePolygon=!0;c.isStroke=!0;c.lineCap="round";e&&(c.isFill=!0);this._buffer.push(c)},drawPoly:function(e,f,a,b){for(var c=[],d=0;d<e.length;d++){c.push(cc.p(e[d].x,e[d].y))}return this.drawPoly_(c,f,a,b)},draw:function(b){b=b||cc._renderContext;this._blendFunc&&(this._blendFunc.src==cc.SRC_ALPHA&&this._blendFunc.dst==cc.ONE)&&(b.globalCompositeOperation="lighter");for(var c=0;c<this._buffer.length;c++){var a=this._buffer[c];switch(a.type){case cc.DrawNode.TYPE_DOT:this._drawDot(b,a);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(b,a);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(b,a)}}},_drawDot:function(d,e){var f=e.fillColor,g=e.verts[0],a=e.lineWidth,b=cc.view.getScaleX(),c=cc.view.getScaleY();d.fillStyle="rgba("+(0|f.r)+","+(0|f.g)+","+(0|f.b)+","+f.a/255+")";d.beginPath();d.arc(g.x*b,-g.y*c,a*b,0,2*Math.PI,!1);d.closePath();d.fill()},_drawSegment:function(h,k){var a=k.lineColor,b=k.verts[0],c=k.verts[1],d=k.lineWidth,e=k.lineCap,f=cc.view.getScaleX(),g=cc.view.getScaleY();h.strokeStyle="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")";h.lineWidth=d*f;h.beginPath();h.lineCap=e;h.moveTo(b.x*f,-b.y*g);h.lineTo(c.x*f,-c.y*g);h.stroke()},_drawPoly:function(d,g){var h=g.verts,k=g.lineCap,m=g.fillColor,n=g.lineWidth,q=g.lineColor,s=g.isClosePolygon,a=g.isFill,c=g.isStroke;if(null!=h){var e=h[0],f=cc.view.getScaleX(),b=cc.view.getScaleY();d.lineCap=k;m&&(d.fillStyle="rgba("+(0|m.r)+","+(0|m.g)+","+(0|m.b)+","+m.a/255+")");n&&(d.lineWidth=n*f);q&&(d.strokeStyle="rgba("+(0|q.r)+","+(0|q.g)+","+(0|q.b)+","+q.a/255+")");d.beginPath();d.moveTo(e.x*f,-e.y*b);k=1;for(m=h.length;k<m;k++){d.lineTo(h[k].x*f,-h[k].y*b)}s&&d.closePath();a&&d.fill();c&&d.stroke()}},clear:function(){this._buffer.length=0}});cc.DrawNodeWebGL=cc.Node.extend({_bufferCapacity:0,_buffer:null,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_lineWidth:1,_drawColor:null,_blendFunc:null,_dirty:!1,_className:"DrawNodeWebGL",getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=a.dst):(this._blendFunc.src=a,this._blendFunc.dst=b)},ctor:function(){cc.Node.prototype.ctor.call(this);this._buffer=[];this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this._drawColor=cc.color(255,255,255,255);this.init()},init:function(){return cc.Node.prototype.init.call(this)?(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0):!1},setLineWidth:function(a){this._lineWidth=a},getLineWidth:function(){return this._lineWidth},setDrawColor:function(a){var b=this._drawColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=a.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)},drawRect:function(d,e,a,b,c){b=b||this._lineWidth;c=c||this.getDrawColor();null==c.a&&(c.a=255);d=[d,cc.p(e.x,d.y),e,cc.p(d.x,e.y)];null==a?this._drawSegments(d,b,c,!0):this.drawPoly(d,a,b,c)},drawCircle:function(e,f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);var q=2*Math.PI/h,a=[],b;for(b=0;b<=h;b++){var c=b*q,d=f*Math.cos(c+g)+e.x,c=f*Math.sin(c+g)+e.y;a.push(cc.p(d,c))}k&&a.push(cc.p(e.x,e.y));m*=0.5;b=0;for(e=a.length;b<e-1;b++){this.drawSegment(a[b],a[b+1],m,n)}},drawQuadBezier:function(f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);for(var a=[],b=0,c=0;c<k;c++){var d=Math.pow(1-b,2)*f.x+2*(1-b)*b*g.x+b*b*h.x,e=Math.pow(1-b,2)*f.y+2*(1-b)*b*g.y+b*b*h.y;a.push(cc.p(d,e));b+=1/k}a.push(cc.p(h.x,h.y));this._drawSegments(a,m,n,!1)},drawCubicBezier:function(e,f,g,h,k,m,n){m=m||this._lineWidth;n=n||this.getDrawColor();null==n.a&&(n.a=255);for(var q=[],a=0,b=0;b<k;b++){var c=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*f.x+3*(1-a)*a*a*g.x+a*a*a*h.x,d=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*f.y+3*(1-a)*a*a*g.y+a*a*a*h.y;q.push(cc.p(c,d));a+=1/k}q.push(cc.p(h.x,h.y));this._drawSegments(q,m,n,!1)},drawCatmullRom:function(c,d,a,b){this.drawCardinalSpline(c,0.5,d,a,b)},drawCardinalSpline:function(g,h,k,m,a){m=m||this._lineWidth;a=a||this.getDrawColor();null==a.a&&(a.a=255);for(var b=[],c,d,e=1/g.length,f=0;f<k+1;f++){d=f/k,1==d?(c=g.length-1,d=1):(c=0|d/e,d=(d-e*c)/e),c=cc.cardinalSplineAt(cc.getControlPointAt(g,c-1),cc.getControlPointAt(g,c-0),cc.getControlPointAt(g,c+1),cc.getControlPointAt(g,c+2),h,d),b.push(c)}m*=0.5;g=0;for(h=b.length;g<h-1;g++){this.drawSegment(b[g],b[g+1],m,a)}},_render:function(){var a=cc._renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);a.bindBuffer(a.ARRAY_BUFFER,this._trianglesWebBuffer);this._dirty&&(a.bufferData(a.ARRAY_BUFFER,this._trianglesArrayBuffer,a.STREAM_DRAW),this._dirty=!1);var b=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,b,8);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,b,12);a.drawArrays(a.TRIANGLES,0,3*this._buffer.length);cc.incrementGLDraws(1)},_ensureCapacity:function(d){var e=this._buffer;if(e.length+d>this._bufferCapacity){var a=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;this._bufferCapacity+=Math.max(this._bufferCapacity,d);if(null==e||0===e.length){this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(a*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer)}else{d=[];for(var b=new ArrayBuffer(a*this._bufferCapacity),c=0;c<e.length;c++){d[c]=new cc.V2F_C4B_T2F_Triangle(e[c].a,e[c].b,e[c].c,b,c*a)}this._trianglesReader=new Uint8Array(b);this._trianglesArrayBuffer=b;this._buffer=d}}},draw:function(){cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst);this._shaderProgram.use();this._shaderProgram.setUniformsForBuiltins();this._render()},drawDot:function(e,f,a){a=a||this.getDrawColor();null==a.a&&(a.a=255);var b={r:0|a.r,g:0|a.g,b:0|a.b,a:0|a.a};a={vertices:{x:e.x-f,y:e.y-f},colors:b,texCoords:{u:-1,v:-1}};var c={vertices:{x:e.x-f,y:e.y+f},colors:b,texCoords:{u:-1,v:1}},d={vertices:{x:e.x+f,y:e.y+f},colors:b,texCoords:{u:1,v:1}};e={vertices:{x:e.x+f,y:e.y-f},colors:b,texCoords:{u:1,v:-1}};this._ensureCapacity(6);this._buffer.push(new cc.V2F_C4B_T2F_Triangle(a,c,d,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._buffer.push(new cc.V2F_C4B_T2F_Triangle(a,d,e,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._dirty=!0},drawDots:function(d,e,a){if(d&&0!=d.length){a=a||this.getDrawColor();null==a.a&&(a.a=255);for(var b=0,c=d.length;b<c;b++){this.drawDot(d[b],e,a)}}},drawSegment:function(b,c,e,h){h=h||this.getDrawColor();null==h.a&&(h.a=255);e=e||0.5*this._lineWidth;this._ensureCapacity(18);h={r:0|h.r,g:0|h.g,b:0|h.b,a:0|h.a};var k=cc.__v2f(b),m=cc.__v2f(c);c=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(m,k)));b=cc.v2fperp(c);var n=cc.v2fmult(c,e),q=cc.v2fmult(b,e);e=cc.v2fsub(m,cc.v2fadd(n,q));var r=cc.v2fadd(m,cc.v2fsub(n,q)),s=cc.v2fsub(m,n),m=cc.v2fadd(m,n),d=cc.v2fsub(k,n),f=cc.v2fadd(k,n),a=cc.v2fsub(k,cc.v2fsub(n,q)),k=cc.v2fadd(k,cc.v2fadd(n,q)),n=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,q=this._trianglesArrayBuffer,g=this._buffer;g.push(new cc.V2F_C4B_T2F_Triangle({vertices:e,colors:h,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(c,b)))},{vertices:r,colors:h,texCoords:cc.__t(cc.v2fsub(c,b))},{vertices:s,colors:h,texCoords:cc.__t(cc.v2fneg(c))},q,g.length*n));g.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:h,texCoords:cc.__t(c)},{vertices:r,colors:h,texCoords:cc.__t(cc.v2fsub(c,b))},{vertices:s,colors:h,texCoords:cc.__t(cc.v2fneg(c))},q,g.length*n));g.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:h,texCoords:cc.__t(c)},{vertices:d,colors:h,texCoords:cc.__t(cc.v2fneg(c))},{vertices:s,colors:h,texCoords:cc.__t(cc.v2fneg(c))},q,g.length*n));g.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:h,texCoords:cc.__t(c)},{vertices:d,colors:h,texCoords:cc.__t(cc.v2fneg(c))},{vertices:f,colors:h,texCoords:cc.__t(c)},q,g.length*n));g.push(new cc.V2F_C4B_T2F_Triangle({vertices:a,colors:h,texCoords:cc.__t(cc.v2fsub(b,c))},{vertices:d,colors:h,texCoords:cc.__t(cc.v2fneg(c))},{vertices:f,colors:h,texCoords:cc.__t(c)},q,g.length*n));g.push(new cc.V2F_C4B_T2F_Triangle({vertices:a,colors:h,texCoords:cc.__t(cc.v2fsub(b,c))},{vertices:k,colors:h,texCoords:cc.__t(cc.v2fadd(c,b))},{vertices:f,colors:h,texCoords:cc.__t(c)},q,g.length*n));this._dirty=!0},drawPoly:function(a,b,d,f){if(null==b){this._drawSegments(a,d,f,!0)}else{null==b.a&&(b.a=255);null==f.a&&(f.a=255);d=d||this._lineWidth;d*=0.5;b={r:0|b.r,g:0|b.g,b:0|b.b,a:0|b.a};f={r:0|f.r,g:0|f.g,b:0|f.b,a:0|f.a};var h=[],k,m,n,q,r=a.length;for(k=0;k<r;k++){m=cc.__v2f(a[(k-1+r)%r]);n=cc.__v2f(a[k]);q=cc.__v2f(a[(k+1)%r]);var s=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(n,m)));n=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(q,n)));s=cc.v2fmult(cc.v2fadd(s,n),1/(cc.v2fdot(s,n)+1));h[k]={offset:s,n:n}}s=0<d;this._ensureCapacity(3*(3*r-2));var t=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,e=this._trianglesArrayBuffer,c=this._buffer,u=!1==s?0.5:0;for(k=0;k<r-2;k++){m=cc.v2fsub(cc.__v2f(a[0]),cc.v2fmult(h[0].offset,u)),n=cc.v2fsub(cc.__v2f(a[k+1]),cc.v2fmult(h[k+1].offset,u)),q=cc.v2fsub(cc.__v2f(a[k+2]),cc.v2fmult(h[k+2].offset,u)),c.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:b,texCoords:cc.__t(cc.v2fzero())},{vertices:n,colors:b,texCoords:cc.__t(cc.v2fzero())},{vertices:q,colors:b,texCoords:cc.__t(cc.v2fzero())},e,c.length*t))}for(k=0;k<r;k++){u=(k+1)%r;m=cc.__v2f(a[k]);n=cc.__v2f(a[u]);q=h[k].n;var g=h[k].offset,v=h[u].offset,u=s?cc.v2fsub(m,cc.v2fmult(g,d)):cc.v2fsub(m,cc.v2fmult(g,0.5)),w=s?cc.v2fsub(n,cc.v2fmult(v,d)):cc.v2fsub(n,cc.v2fmult(v,0.5));m=s?cc.v2fadd(m,cc.v2fmult(g,d)):cc.v2fadd(m,cc.v2fmult(g,0.5));n=s?cc.v2fadd(n,cc.v2fmult(v,d)):cc.v2fadd(n,cc.v2fmult(v,0.5));s?(c.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:f,texCoords:cc.__t(cc.v2fneg(q))},{vertices:w,colors:f,texCoords:cc.__t(cc.v2fneg(q))},{vertices:n,colors:f,texCoords:cc.__t(q)},e,c.length*t)),c.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:f,texCoords:cc.__t(cc.v2fneg(q))},{vertices:m,colors:f,texCoords:cc.__t(q)},{vertices:n,colors:f,texCoords:cc.__t(q)},e,c.length*t))):(c.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:b,texCoords:cc.__t(cc.v2fzero())},{vertices:w,colors:b,texCoords:cc.__t(cc.v2fzero())},{vertices:n,colors:b,texCoords:cc.__t(q)},e,c.length*t)),c.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:b,texCoords:cc.__t(cc.v2fzero())},{vertices:m,colors:b,texCoords:cc.__t(q)},{vertices:n,colors:b,texCoords:cc.__t(q)},e,c.length*t)))}this._dirty=!0}},_drawSegments:function(u,v,a,b){v=v||this._lineWidth;a=a||this._drawColor;null==a.a&&(a.a=255);v*=0.5;if(!(0>=v)){a={r:0|a.r,g:0|a.g,b:0|a.b,a:0|a.a};var c=[],e,h,k,n,r=u.length;for(e=0;e<r;e++){h=cc.__v2f(u[(e-1+r)%r]);k=cc.__v2f(u[e]);n=cc.__v2f(u[(e+1)%r]);var d=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(k,h)));k=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(n,k)));n=cc.v2fmult(cc.v2fadd(d,k),1/(cc.v2fdot(d,k)+1));c[e]={offset:n,n:k}}this._ensureCapacity(3*(3*r-2));n=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;var d=this._trianglesArrayBuffer,f=this._buffer;b=b?r:r-1;for(e=0;e<b;e++){var m=(e+1)%r;h=cc.__v2f(u[e]);k=cc.__v2f(u[m]);var g=c[e].n,s=c[e].offset,q=c[m].offset,m=cc.v2fsub(h,cc.v2fmult(s,v)),t=cc.v2fsub(k,cc.v2fmult(q,v));h=cc.v2fadd(h,cc.v2fmult(s,v));k=cc.v2fadd(k,cc.v2fmult(q,v));f.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:a,texCoords:cc.__t(cc.v2fneg(g))},{vertices:t,colors:a,texCoords:cc.__t(cc.v2fneg(g))},{vertices:k,colors:a,texCoords:cc.__t(g)},d,f.length*n));f.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:a,texCoords:cc.__t(cc.v2fneg(g))},{vertices:h,colors:a,texCoords:cc.__t(g)},{vertices:k,colors:a,texCoords:cc.__t(g)},d,f.length*n))}this._dirty=!0}},clear:function(){this._buffer.length=0;this._dirty=!0}});cc.DrawNode=cc._renderType==cc._RENDER_TYPE_WEBGL?cc.DrawNodeWebGL:cc.DrawNodeCanvas;cc.DrawNode.create=function(){return new cc.DrawNode};cc._DrawNodeElement=function(h,k,a,b,c,d,e,f,g){this.type=h;this.verts=k||null;this.fillColor=a||null;this.lineWidth=b||0;this.lineColor=c||null;this.lineCap=d||"butt";this.isClosePolygon=e||!1;this.isFill=f||!1;this.isStroke=g||!1};cc.DrawNode.TYPE_DOT=0;cc.DrawNode.TYPE_SEGMENT=1;cc.DrawNode.TYPE_POLY=2;cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_times:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(a){this._times=this._speed=1;this._repeatForever=!1;this.MAX_VALUE=2;this._speedMethod=this._repeatMethod=!1;cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==a&&this.initWithDuration(a)},getElapsed:function(){return this._elapsed},initWithDuration:function(a){this._duration=0===a?cc.FLT_EPSILON:a;this._elapsed=0;return this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(a){a._repeatForever=this._repeatForever;a._speed=this._speed;a._times=this._times;a._easeList=this._easeList;a._speedMethod=this._speedMethod;a._repeatMethod=this._repeatMethod},_reverseEaseList:function(a){if(this._easeList){a._easeList=[];for(var b=0;b<this._easeList.length;b++){a._easeList.push(this._easeList[b].reverse())}}},clone:function(){var a=new cc.ActionInterval(this._duration);this._cloneDecoration(a);return a},easing:function(a){this._easeList?this._easeList.length=0:this._easeList=[];for(var b=0;b<arguments.length;b++){this._easeList.push(arguments[b])}return this},_computeEaseTime:function(c){var d=this._easeList;if(!d||0===d.length){return c}for(var a=0,b=d.length;a<b;a++){c=d[a].easing(c)}return c},step:function(a){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=a;a=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7);a=1>a?a:1;this.update(0<a?a:0);this._repeatMethod&&(1<this._times&&this.isDone())&&(this._repeatForever||this._times--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,a);this._elapsed=0;this._firstTick=!0},reverse:function(){cc.log("cc.IntervalAction: reverse not implemented.");return null},setAmplitudeRate:function(a){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.");return 0},speed:function(a){if(0>=a){return cc.log("The speed parameter error"),this}this._speedMethod=!0;this._speed*=a;return this},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a;return this},repeat:function(a){a=Math.round(a);if(isNaN(a)||1>a){return cc.log("The repeat parameter error"),this}this._repeatMethod=!0;this._times*=a;return this},repeatForever:function(){this._repeatMethod=!0;this._times=this.MAX_VALUE;this._repeatForever=!0;return this}});cc.ActionInterval.create=function(a){return new cc.ActionInterval(a)};cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(e){cc.ActionInterval.prototype.ctor.call(this);this._actions=[];var f=e instanceof Array?e:arguments,a=f.length-1;0<=a&&null==f[a]&&cc.log("parameters should not be ending with null in Javascript");if(0<=a){for(var b=f[0],c,d=1;d<a;d++){f[d]&&(c=b,b=cc.Sequence.create(),b.initWithTwoActions(c,f[d]))}this.initWithTwoActions(b,f[a])}},initWithTwoActions:function(a,b){if(!a||!b){throw"cc.Sequence.initWithTwoActions(): arguments must all be non nil"}this.initWithDuration(a._duration+b._duration);this._actions[0]=a;this._actions[1]=b;return !0},clone:function(){var a=new cc.Sequence;this._cloneDecoration(a);a.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._split=this._actions[0]._duration/this._duration;this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(d){d=this._computeEaseTime(d);var e=0,a=this._split,b=this._actions,c=this._last;d<a?(d=0!==a?d/a:1,0===e&&1===c&&(b[1].update(0),b[1].stop())):(e=1,d=1===a?1:(d-a)/(1-a),-1===c&&(b[0].startWithTarget(this.target),b[0].update(1),b[0].stop()),c||(b[0].update(1),b[0].stop()));c===e&&b[e].isDone()||(c!==e&&b[e].startWithTarget(this.target),b[e].update(d),this._last=e)},reverse:function(){var a=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.Sequence.create=function(c){var d=c instanceof Array?c:arguments;0<d.length&&null==d[d.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var a=d[0],b=1;b<d.length;b++){d[b]&&(a=cc.Sequence._actionOneTwo(a,d[b]))}return a};cc.Sequence._actionOneTwo=function(b,c){var a=new cc.Sequence;a.initWithTwoActions(b,c);return a};cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithAction(a,b)},initWithAction:function(a,b){return this.initWithDuration(a._duration*b)?(this._times=b,this._innerAction=a,a instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var a=new cc.Repeat;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone(),this._times);return a},startWithTarget:function(a){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(d){d=this._computeEaseTime(d);var e=this._innerAction,a=this._duration,b=this._times,c=this._nextDt;if(d>=c){for(;d>c&&this._total<b;){e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),this._nextDt=c+=e._duration/a}1<=d&&this._total<b&&this._total++;this._actionInstant||(this._total===b?(e.update(1),e.stop()):e.update(d-(c-e._duration/a)))}else{e.update(d*b%1)}},isDone:function(){return this._total==this._times},reverse:function(){var a=cc.Repeat.create(this._innerAction.reverse(),this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.Repeat.create=function(a,b){return new cc.Repeat(a,b)};cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._innerAction=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a){throw"cc.RepeatForever.initWithAction(): action must be non null"}this._innerAction=a;return !0},clone:function(){var a=new cc.RepeatForever;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._innerAction.startWithTarget(a)},step:function(a){var b=this._innerAction;b.step(a);b.isDone()&&(b.startWithTarget(this.target),b.step(b.getElapsed()-b._duration))},isDone:function(){return !1},reverse:function(){var a=cc.RepeatForever.create(this._innerAction.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!=a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.RepeatForever.create=function(a){return new cc.RepeatForever(a)};cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(e){cc.ActionInterval.prototype.ctor.call(this);this._two=this._one=null;var f=e instanceof Array?e:arguments,a=f.length-1;0<=a&&null==f[a]&&cc.log("parameters should not be ending with null in Javascript");if(0<=a){for(var b=f[0],c,d=1;d<a;d++){f[d]&&(c=b,b=cc.Spwan.create(),b.initWithTwoActions(c,f[d]))}this.initWithTwoActions(b,f[a])}},initWithTwoActions:function(d,e){if(!d||!e){throw"cc.Spawn.initWithTwoActions(): arguments must all be non null"}var a=!1,b=d._duration,c=e._duration;this.initWithDuration(Math.max(b,c))&&(this._one=d,this._two=e,b>c?this._two=cc.Sequence._actionOneTwo(e,cc.DelayTime.create(b-c)):b<c&&(this._one=cc.Sequence._actionOneTwo(d,cc.DelayTime.create(c-b))),a=!0);return a},clone:function(){var a=new cc.Spawn;this._cloneDecoration(a);a.initWithTwoActions(this._one.clone(),this._two.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._one.startWithTarget(a);this._two.startWithTarget(a)},stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(a){a=this._computeEaseTime(a);this._one&&this._one.update(a);this._two&&this._two.update(a)},reverse:function(){var a=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.Spawn.create=function(c){var d=c instanceof Array?c:arguments;0<d.length&&null==d[d.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var a=d[0],b=1;b<d.length;b++){null!=d[b]&&(a=this._actionOneTwo(a,d[b]))}return a};cc.Spawn._actionOneTwo=function(b,c){var a=new cc.Spawn;a.initWithTwoActions(b,c);return a};cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(this._dstAngleX=c||0,this._dstAngleY=a||this._dstAngleX,!0):!1},clone:function(){var a=new cc.RotateTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY);return a},startWithTarget:function(b){cc.ActionInterval.prototype.startWithTarget.call(this,b);var c=b.rotationX%360,a=this._dstAngleX-c;180<a&&(a-=360);-180>a&&(a+=360);this._startAngleX=c;this._diffAngleX=a;this._startAngleY=b.rotationY%360;b=this._dstAngleY-this._startAngleY;180<b&&(b-=360);-180>b&&(b+=360);this._diffAngleY=b},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*a,this.target.rotationY=this._startAngleY+this._diffAngleY*a)}});cc.RotateTo.create=function(b,c,a){return new cc.RotateTo(b,c,a)};cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(this._angleX=c||0,this._angleY=a||this._angleX,!0):!1},clone:function(){var a=new cc.RotateBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._angleX,this._angleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startAngleX=a.rotationX;this._startAngleY=a.rotationY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=this._startAngleX+this._angleX*a,this.target.rotationY=this._startAngleY+this._angleY*a)},reverse:function(){var a=cc.RotateBy.create(this._duration,-this._angleX,-this._angleY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.RotateBy.create=function(c,d,a){var b=new cc.RotateBy;b.initWithDuration(c,d,a);return b};cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);this._positionDelta=cc.p(0,0);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);void 0!==c&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(void 0!==c.x&&(a=c.y,c=c.x),this._positionDelta.x=c,this._positionDelta.y=a,!0):!1},clone:function(){var a=new cc.MoveBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._positionDelta);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(e){e=this._computeEaseTime(e);if(this.target){var f=this._positionDelta.x*e;e*=this._positionDelta.y;var a=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var b=this.target.getPositionX(),c=this.target.getPositionY(),d=this._previousPosition;a.x=a.x+b-d.x;a.y=a.y+c-d.y;f+=a.x;e+=a.y;d.x=f;d.y=e;this.target.setPosition(f,e)}else{this.target.setPosition(a.x+f,a.y+e)}}},reverse:function(){var a=cc.MoveBy.create(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.MoveBy.create=function(b,c,a){return new cc.MoveBy(b,c,a)};cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(b,c,a){cc.MoveBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==c&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.MoveBy.prototype.initWithDuration.call(this,b,c,a)?(void 0!==c.x&&(a=c.y,c=c.x),this._endPosition.x=c,this._endPosition.y=a,!0):!1},clone:function(){var a=new cc.MoveTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition);return a},startWithTarget:function(a){cc.MoveBy.prototype.startWithTarget.call(this,a);this._positionDelta.x=this._endPosition.x-a.getPositionX();this._positionDelta.y=this._endPosition.y-a.getPositionY()}});cc.MoveTo.create=function(b,c,a){return new cc.MoveTo(b,c,a)};cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);void 0!==a&&this.initWithDuration(b,c,a)},initWithDuration:function(c,d,a){var b=!1;cc.ActionInterval.prototype.initWithDuration.call(this,c)&&(this._endSkewX=d,this._endSkewY=a,b=!0);return b},clone:function(){var a=new cc.SkewTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endSkewX,this._endSkewY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startSkewX=a.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;180<this._deltaX&&(this._deltaX-=360);-180>this._deltaX&&(this._deltaX+=360);this._startSkewY=a.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;180<this._deltaY&&(this._deltaY-=360);-180>this._deltaY&&(this._deltaY+=360)},update:function(a){a=this._computeEaseTime(a);this.target.skewX=this._startSkewX+this._deltaX*a;this.target.skewY=this._startSkewY+this._deltaY*a}});cc.SkewTo.create=function(b,c,a){return new cc.SkewTo(b,c,a)};cc.SkewBy=cc.SkewTo.extend({ctor:function(b,c,a){cc.SkewTo.prototype.ctor.call(this);void 0!==a&&this.initWithDuration(b,c,a)},initWithDuration:function(c,d,a){var b=!1;cc.SkewTo.prototype.initWithDuration.call(this,c,d,a)&&(this._skewX=d,this._skewY=a,b=!0);return b},clone:function(){var a=new cc.SkewBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._skewX,this._skewY);return a},startWithTarget:function(a){cc.SkewTo.prototype.startWithTarget.call(this,a);this._deltaX=this._skewX;this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var a=cc.SkewBy.create(this._duration,-this._skewX,-this._skewY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.SkewBy.create=function(c,d,a){var b=new cc.SkewBy;b&&b.initWithDuration(c,d,a);return b};cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(d,e,a,b,c){cc.ActionInterval.prototype.ctor.call(this);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);this._delta=cc.p(0,0);void 0!==b&&this.initWithDuration(d,e,a,b,c)},initWithDuration:function(d,e,a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,d)?(void 0===c&&(c=b,b=a,a=e.y,e=e.x),this._delta.x=e,this._delta.y=a,this._height=b,this._jumps=c,!0):!1},clone:function(){var a=new cc.JumpBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._delta,this._height,this._jumps);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(e){e=this._computeEaseTime(e);if(this.target){var f=e*this._jumps%1,f=4*this._height*f*(1-f),f=f+this._delta.y*e;e*=this._delta.x;var a=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var b=this.target.getPositionX(),c=this.target.getPositionY(),d=this._previousPosition;a.x=a.x+b-d.x;a.y=a.y+c-d.y;e+=a.x;f+=a.y;d.x=e;d.y=f;this.target.setPosition(e,f)}else{this.target.setPosition(a.x+e,a.y+f)}}},reverse:function(){var a=cc.JumpBy.create(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.JumpBy.create=function(d,e,a,b,c){return new cc.JumpBy(d,e,a,b,c)};cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(d,e,a,b,c){cc.JumpBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==b&&this.initWithDuration(d,e,a,b,c)},initWithDuration:function(d,e,a,b,c){return cc.JumpBy.prototype.initWithDuration.call(this,d,e,a,b,c)?(void 0===c&&(a=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=a,!0):!1},startWithTarget:function(a){cc.JumpBy.prototype.startWithTarget.call(this,a);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var a=new cc.JumpTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition,this._height,this._jumps);return a}});cc.JumpTo.create=function(d,e,a,b,c){return new cc.JumpTo(d,e,a,b,c)};cc.bezierAt=function(d,e,a,b,c){return Math.pow(1-c,3)*d+3*c*Math.pow(1-c,2)*e+3*Math.pow(c,2)*(1-c)*a+Math.pow(c,3)*b};cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._config=[];this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._config=b,!0):!1},clone:function(){var c=new cc.BezierBy;this._cloneDecoration(c);for(var d=[],a=0;a<this._config.length;a++){var b=this._config[a];d.push(cc.p(b.x,b.y))}c.initWithDuration(this._duration,d);return c},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(e){e=this._computeEaseTime(e);if(this.target){var f=this._config,a=f[0].y,b=f[1].y,c=f[2].y,f=cc.bezierAt(0,f[0].x,f[1].x,f[2].x,e);e=cc.bezierAt(0,a,b,c,e);a=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var b=this.target.getPositionX(),c=this.target.getPositionY(),d=this._previousPosition;a.x=a.x+b-d.x;a.y=a.y+c-d.y;f+=a.x;e+=a.y;d.x=f;d.y=e;this.target.setPosition(f,e)}else{this.target.setPosition(a.x+f,a.y+e)}}},reverse:function(){var a=this._config,a=[cc.pAdd(a[1],cc.pNeg(a[2])),cc.pAdd(a[0],cc.pNeg(a[2])),cc.pNeg(a[2])],a=cc.BezierBy.create(this._duration,a);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.BezierBy.create=function(a,b){return new cc.BezierBy(a,b)};cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(a,b){cc.BezierBy.prototype.ctor.call(this);this._toConfig=[];b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toConfig=b,!0):!1},clone:function(){var a=new cc.BezierTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toConfig);return a},startWithTarget:function(b){cc.BezierBy.prototype.startWithTarget.call(this,b);b=this._startPosition;var c=this._toConfig,a=this._config;a[0]=cc.pSub(c[0],b);a[1]=cc.pSub(c[1],b);a[2]=cc.pSub(c[2],b)}});cc.BezierTo.create=function(a,b){return new cc.BezierTo(a,b)};cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(this._endScaleX=c,this._endScaleY=null!=a?a:c,!0):!1},clone:function(){var a=new cc.ScaleTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startScaleX=a.scaleX;this._startScaleY=a.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*a,this.target.scaleY=this._startScaleY+this._deltaY*a)}});cc.ScaleTo.create=function(c,d,a){var b=new cc.ScaleTo;b.initWithDuration(c,d,a);return b};cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(a){cc.ScaleTo.prototype.startWithTarget.call(this,a);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var a=cc.ScaleBy.create(this._duration,1/this._endScaleX,1/this._endScaleY);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.ScaleBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return a}});cc.ScaleBy.create=function(b,c,a){return new cc.ScaleBy(b,c,a)};cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._times=b,!0):!1},clone:function(){var a=new cc.Blink;this._cloneDecoration(a);a.initWithDuration(this._duration,this._times);return a},update:function(a){a=this._computeEaseTime(a);if(this.target&&!this.isDone()){var b=1/this._times;this.target.visible=a%b>b/2}},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._originalState=a.visible},stop:function(){this.target.visible=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var a=cc.Blink.create(this._duration,this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.Blink.create=function(b,c){var a=new cc.Blink;a.initWithDuration(b,c);return a};cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toOpacity=b,!0):!1},clone:function(){var a=new cc.FadeTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},update:function(a){a=this._computeEaseTime(a);if(this.target.RGBAProtocol){var b=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=b+(this._toOpacity-b)*a}},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this.target.RGBAProtocol&&(this._fromOpacity=a.opacity)}});cc.FadeTo.create=function(a,b){return new cc.FadeTo(a,b)};cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,reverse:function(){var a=new cc.FadeOut;a.initWithDuration(this._duration,0);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeIn;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},startWithTarget:function(a){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity);cc.FadeTo.prototype.startWithTarget.call(this,a)}});cc.FadeIn.create=function(a){return new cc.FadeIn(a,255)};cc.FadeOut=cc.FadeTo.extend({reverse:function(){var a=new cc.FadeIn;a._reverseAction=this;a.initWithDuration(this._duration,255);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeOut;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a}});cc.FadeOut.create=function(a){var b=new cc.FadeOut;b.initWithDuration(a,0);return b};cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(c,d,a,b){cc.ActionInterval.prototype.ctor.call(this);this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);void 0!==b&&this.initWithDuration(c,d,a,b)},initWithDuration:function(c,d,a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,c)?(this._to=cc.color(d,a,b),!0):!1},clone:function(){var a=new cc.TintTo;this._cloneDecoration(a);var b=this._to;a.initWithDuration(this._duration,b.r,b.g,b.b);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this.target.RGBAProtocol&&(this._from=this.target.color)},update:function(b){b=this._computeEaseTime(b);var c=this._from,a=this._to;c&&this.target.RGBAProtocol&&(this.target.color=cc.color(c.r+(a.r-c.r)*b,c.g+(a.g-c.g)*b,c.b+(a.b-c.b)*b))}});cc.TintTo.create=function(c,d,a,b){return new cc.TintTo(c,d,a,b)};cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(c,d,a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(c,d,a,b)},initWithDuration:function(c,d,a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,c)?(this._deltaR=d,this._deltaG=a,this._deltaB=b,!0):!1},clone:function(){var a=new cc.TintBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);a.RGBAProtocol&&(a=a.color,this._fromR=a.r,this._fromG=a.g,this._fromB=a.b)},update:function(a){a=this._computeEaseTime(a);this.target.RGBAProtocol&&(this.target.color=cc.color(this._fromR+this._deltaR*a,this._fromG+this._deltaG*a,this._fromB+this._deltaB*a))},reverse:function(){var a=cc.TintBy.create(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.TintBy.create=function(c,d,a,b){return new cc.TintBy(c,d,a,b)};cc.DelayTime=cc.ActionInterval.extend({update:function(a){},reverse:function(){var a=cc.DelayTime.create(this._duration);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.DelayTime;this._cloneDecoration(a);a.initWithDuration(this._duration);return a}});cc.DelayTime.create=function(a){return new cc.DelayTime(a)};cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._other=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a){throw"cc.ReverseTime.initWithAction(): action must be non null"}if(a==this._other){throw"cc.ReverseTime.initWithAction(): the action was already passed in."}return cc.ActionInterval.prototype.initWithDuration.call(this,a._duration)?(this._other=a,!0):!1},clone:function(){var a=new cc.ReverseTime;this._cloneDecoration(a);a.initWithAction(this._other.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._other.startWithTarget(a)},update:function(a){a=this._computeEaseTime(a);this._other&&this._other.update(1-a)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.ReverseTime.create=function(a){return new cc.ReverseTime(a)};cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._splitTimes=[];a&&this.initWithAnimation(a)},getAnimation:function(){return this._animation},setAnimation:function(a){this._animation=a},initWithAnimation:function(d){if(!d){throw"cc.Animate.initWithAnimation(): animation must be non-NULL"}var e=d.getDuration();if(this.initWithDuration(e*d.getLoops())){this._nextFrame=0;this.setAnimation(d);this._origFrame=null;this._executedLoops=0;var f=this._splitTimes,g=f.length=0,a=e/d.getTotalDelayUnits();d=d.getFrames();cc.arrayVerifyType(d,cc.AnimationFrame);for(var b=0;b<d.length;b++){var c=g*a/e,g=g+d[b].getDelayUnits();f.push(c)}return !0}return !1},clone:function(){var a=new cc.Animate;this._cloneDecoration(a);a.initWithAnimation(this._animation.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._animation.getRestoreOriginalFrame()&&(this._origFrame=a.displayFrame());this._executedLoops=this._nextFrame=0},update:function(d){d=this._computeEaseTime(d);1>d&&(d*=this._animation.getLoops(),(0|d)>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),d%=1);for(var e=this._animation.getFrames(),a=e.length,b=this._splitTimes,c=this._nextFrame;c<a;c++){if(b[c]<=d){this.target.setSpriteFrame(e[c].getSpriteFrame()),this._nextFrame=c+1}else{break}}},reverse:function(){var d=this._animation,e=d.getFrames(),a=[];cc.arrayVerifyType(e,cc.AnimationFrame);if(0<e.length){for(var b=e.length-1;0<=b;b--){var c=e[b];if(!c){break}a.push(c.clone())}}e=cc.Animation.create(a,d.getDelayPerUnit(),d.getLoops());e.setRestoreOriginalFrame(d.getRestoreOriginalFrame());d=cc.Animate.create(e);this._cloneDecoration(d);this._reverseEaseList(d);return d},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}});cc.Animate.create=function(a){return new cc.Animate(a)};cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);b&&this.initWithTarget(a,b)},initWithTarget:function(a,b){return this.initWithDuration(b._duration)?(this._forcedTarget=a,this._action=b,!0):!1},clone:function(){var a=new cc.TargetedAction;this._cloneDecoration(a);a.initWithTarget(this._forcedTarget,this._action.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(a){a=this._computeEaseTime(a);this._action.update(a)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(a){this._forcedTarget!=a&&(this._forcedTarget=a)}});cc.TargetedAction.create=function(a,b){return new cc.TargetedAction(a,b)};cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return !0},step:function(a){this.update(1)},update:function(a){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}});cc.Show=cc.ActionInstant.extend({update:function(a){this.target.visible=!0},reverse:function(){return cc.Hide.create()},clone:function(){return new cc.Show}});cc.Show.create=function(){return new cc.Show};cc.Hide=cc.ActionInstant.extend({update:function(a){this.target.visible=!1},reverse:function(){return cc.Show.create()},clone:function(){return new cc.Hide}});cc.Hide.create=function(){return new cc.Hide};cc.ToggleVisibility=cc.ActionInstant.extend({update:function(a){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}});cc.ToggleVisibility.create=function(){return new cc.ToggleVisibility};cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==a&&this.init(a)},update:function(a){this.target.removeFromParent(this._isNeedCleanUp)},init:function(a){this._isNeedCleanUp=a;return !0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}});cc.RemoveSelf.create=function(a){return new cc.RemoveSelf(a)};cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedX=!1;void 0!==a&&this.initWithFlipX(a)},initWithFlipX:function(a){this._flippedX=a;return !0},update:function(a){this.target.flippedX=this._flippedX},reverse:function(){return cc.FlipX.create(!this._flippedX)},clone:function(){var a=new cc.FlipX;a.initWithFlipX(this._flippedX);return a}});cc.FlipX.create=function(a){return new cc.FlipX(a)};cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedY=!1;void 0!==a&&this.initWithFlipY(a)},initWithFlipY:function(a){this._flippedY=a;return !0},update:function(a){this.target.flippedY=this._flippedY},reverse:function(){return cc.FlipY.create(!this._flippedY)},clone:function(){var a=new cc.FlipY;a.initWithFlipY(this._flippedY);return a}});cc.FlipY.create=function(a){return new cc.FlipY(a)};cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(a,b){cc.FiniteTimeAction.prototype.ctor.call(this);this._y=this._x=0;void 0!==a&&(void 0!==a.x&&(b=a.y,a=a.x),this.initWithPosition(a,b))},initWithPosition:function(a,b){this._x=a;this._y=b;return !0},update:function(a){this.target.setPosition(this._x,this._y)},clone:function(){var a=new cc.Place;a.initWithPosition(this._x,this._y);return a}});cc.Place.create=function(a,b){return new cc.Place(a,b)};cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_callFunc:null,_function:null,_data:null,ctor:function(b,c,a){cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==b&&(void 0===c?this.initWithFunction(b):this.initWithFunction(b,c,a))},initWithFunction:function(b,c,a){c?(this._data=a,this._callFunc=b,this._selectorTarget=c):b&&(this._function=b);return !0},execute:function(){null!=this._callFunc?this._callFunc.call(this._selectorTarget,this.target,this._data):this._function&&this._function.call(null,this.target)},update:function(a){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(a){a!=this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=a)},clone:function(){var a=new cc.CallFunc;this._selectorTarget?a.initWithFunction(this._callFunc,this._selectorTarget,this._data):this._function&&a.initWithFunction(this._function);return a}});cc.CallFunc.create=function(b,c,a){return new cc.CallFunc(b,c,a)};cc.ActionCamera=cc.ActionInterval.extend({_centerXOrig:0,_centerYOrig:0,_centerZOrig:0,_eyeXOrig:0,_eyeYOrig:0,_eyeZOrig:0,_upXOrig:0,_upYOrig:0,_upZOrig:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this);this._upZOrig=this._upYOrig=this._upXOrig=this._eyeZOrig=this._eyeYOrig=this._eyeXOrig=this._centerZOrig=this._centerYOrig=this._centerXOrig=0},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);a=a.getCamera();var b=a.getCenter();this._centerXOrig=b.x;this._centerYOrig=b.y;this._centerZOrig=b.z;b=a.getEye();this._eyeXOrig=b.x;this._eyeYOrig=b.y;this._eyeZOrig=b.z;a=a.getUp();this._upXOrig=a.x;this._upYOrig=a.y;this._upZOrig=a.z},clone:function(){return new cc.ActionCamera},reverse:function(){return cc.ReverseTime.create(this)}});cc.OrbitCamera=cc.ActionCamera.extend({_radius:0,_deltaRadius:0,_angleZ:0,_deltaAngleZ:0,_angleX:0,_deltaAngleX:0,_radZ:0,_radDeltaZ:0,_radX:0,_radDeltaX:0,ctor:function(d,e,f,g,a,b,c){cc.ActionCamera.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(d,e,f,g,a,b,c)},initWithDuration:function(d,e,f,g,a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,d)?(this._radius=e,this._deltaRadius=f,this._angleZ=g,this._deltaAngleZ=a,this._angleX=b,this._deltaAngleX=c,this._radDeltaZ=cc.degreesToRadians(a),this._radDeltaX=cc.degreesToRadians(c),!0):!1},sphericalRadius:function(){var d,e;e=this.target.getCamera();var a=e.getEye();d=e.getCenter();e=a.x-d.x;var b=a.y-d.y;d=a.z-d.z;var a=Math.sqrt(Math.pow(e,2)+Math.pow(b,2)+Math.pow(d,2)),c=Math.sqrt(Math.pow(e,2)+Math.pow(b,2));0===c&&(c=cc.FLT_EPSILON);0===a&&(a=cc.FLT_EPSILON);d=Math.acos(d/a);e=0>e?Math.PI-Math.asin(b/c):Math.asin(b/c);return{newRadius:a/cc.Camera.getZEye(),zenith:d,azimuth:e}},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);a=this.sphericalRadius();isNaN(this._radius)&&(this._radius=a.newRadius);isNaN(this._angleZ)&&(this._angleZ=cc.radiansToDegrees(a.zenith));isNaN(this._angleX)&&(this._angleX=cc.radiansToDegrees(a.azimuth));this._radZ=cc.degreesToRadians(this._angleZ);this._radX=cc.degreesToRadians(this._angleX)},clone:function(){var a=new cc.OrbitCamera;a.initWithDuration(this._duration,this._radius,this._deltaRadius,this._angleZ,this._deltaAngleZ,this._angleX,this._deltaAngleX);return a},update:function(c){c=this._computeEaseTime(c);var d=(this._radius+this._deltaRadius*c)*cc.Camera.getZEye(),a=this._radZ+this._radDeltaZ*c,b=this._radX+this._radDeltaX*c;c=Math.sin(a)*Math.cos(b)*d+this._centerXOrig;b=Math.sin(a)*Math.sin(b)*d+this._centerYOrig;d=Math.cos(a)*d+this._centerZOrig;this.target.getCamera().setEye(c,b,d)}});cc.OrbitCamera.create=function(d,e,f,g,a,b,c){return new cc.OrbitCamera(d,e,f,g,a,b,c)};cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);a&&this.initWithAction(a)},initWithAction:function(a){if(!a){throw"cc.ActionEase.initWithAction(): action must be non nil"}return this.initWithDuration(a.getDuration())?(this._inner=a,!0):!1},clone:function(){var a=new cc.ActionEase;a.initWithAction(this._inner.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop();cc.ActionInterval.prototype.stop.call(this)},update:function(a){this._inner.update(a)},reverse:function(){return cc.ActionEase.create(this._inner.reverse())},getInnerAction:function(){return this._inner}});cc.ActionEase.create=function(a){return new cc.ActionEase(a)};cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(a,b){cc.ActionEase.prototype.ctor.call(this);void 0!==b&&this.initWithAction(a,b)},setRate:function(a){this._rate=a},getRate:function(){return this._rate},initWithAction:function(a,b){return cc.ActionEase.prototype.initWithAction.call(this,a)?(this._rate=b,!0):!1},clone:function(){var a=new cc.EaseRateAction;a.initWithAction(this._inner.clone(),this._rate);return a},reverse:function(){return cc.EaseRateAction.create(this._inner.reverse(),1/this._rate)}});cc.EaseRateAction.create=function(a,b){return new cc.EaseRateAction(a,b)};cc.EaseIn=cc.EaseRateAction.extend({update:function(a){this._inner.update(Math.pow(a,this._rate))},reverse:function(){return cc.EaseIn.create(this._inner.reverse(),1/this._rate)},clone:function(){var a=new cc.EaseIn;a.initWithAction(this._inner.clone(),this._rate);return a}});cc.EaseIn.create=function(a,b){return new cc.EaseIn(a,b)};cc.easeIn=function(a){return{_rate:a,easing:function(b){return Math.pow(b,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}};cc.EaseOut=cc.EaseRateAction.extend({update:function(a){this._inner.update(Math.pow(a,1/this._rate))},reverse:function(){return cc.EaseOut.create(this._inner.reverse(),1/this._rate)},clone:function(){var a=new cc.EaseOut;a.initWithAction(this._inner.clone(),this._rate);return a}});cc.EaseOut.create=function(a,b){return new cc.EaseOut(a,b)};cc.easeOut=function(a){return{_rate:a,easing:function(b){return Math.pow(b,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}};cc.EaseInOut=cc.EaseRateAction.extend({update:function(a){a*=2;1>a?this._inner.update(0.5*Math.pow(a,this._rate)):this._inner.update(1-0.5*Math.pow(2-a,this._rate))},clone:function(){var a=new cc.EaseInOut;a.initWithAction(this._inner.clone(),this._rate);return a},reverse:function(){return cc.EaseInOut.create(this._inner.reverse(),this._rate)}});cc.EaseInOut.create=function(a,b){return new cc.EaseInOut(a,b)};cc.easeInOut=function(a){return{_rate:a,easing:function(b){b*=2;return 1>b?0.5*Math.pow(b,this._rate):1-0.5*Math.pow(2-b,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};cc.EaseExponentialIn=cc.ActionEase.extend({update:function(a){this._inner.update(0===a?0:Math.pow(2,10*(a-1)))},reverse:function(){return cc.EaseExponentialOut.create(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialIn;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialIn.create=function(a){return new cc.EaseExponentialIn(a)};cc._easeExponentialInObj={easing:function(a){return 0===a?0:Math.pow(2,10*(a-1))},reverse:function(){return cc._easeExponentialOutObj}};cc.easeExponentialIn=function(){return cc._easeExponentialInObj};cc.EaseExponentialOut=cc.ActionEase.extend({update:function(a){this._inner.update(1==a?1:-Math.pow(2,-10*a)+1)},reverse:function(){return cc.EaseExponentialIn.create(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialOut;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialOut.create=function(a){return new cc.EaseExponentialOut(a)};cc._easeExponentialOutObj={easing:function(a){return 1==a?1:-Math.pow(2,-10*a)+1},reverse:function(){return cc._easeExponentialInObj}};cc.easeExponentialOut=function(){return cc._easeExponentialOutObj};cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(a){1!=a&&0!==a&&(a*=2,a=1>a?0.5*Math.pow(2,10*(a-1)):0.5*(-Math.pow(2,-10*(a-1))+2));this._inner.update(a)},reverse:function(){return cc.EaseExponentialInOut.create(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialInOut;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialInOut.create=function(a){return new cc.EaseExponentialInOut(a)};cc._easeExponentialInOutObj={easing:function(a){return 1!==a&&0!==a?(a*=2,1>a?0.5*Math.pow(2,10*(a-1)):0.5*(-Math.pow(2,-10*(a-1))+2)):a},reverse:function(){return cc._easeExponentialInOutObj}};cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj};cc.EaseSineIn=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:-1*Math.cos(a*Math.PI/2)+1;this._inner.update(a)},reverse:function(){return cc.EaseSineOut.create(this._inner.reverse())},clone:function(){var a=new cc.EaseSineIn;a.initWithAction(this._inner.clone());return a}});cc.EaseSineIn.create=function(a){return new cc.EaseSineIn(a)};cc._easeSineInObj={easing:function(a){return 0===a||1===a?a:-1*Math.cos(a*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}};cc.easeSineIn=function(){return cc._easeSineInObj};cc.EaseSineOut=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:Math.sin(a*Math.PI/2);this._inner.update(a)},reverse:function(){return cc.EaseSineIn.create(this._inner.reverse())},clone:function(){var a=new cc.EaseSineOut;a.initWithAction(this._inner.clone());return a}});cc.EaseSineOut.create=function(a){return new cc.EaseSineOut(a)};cc._easeSineOutObj={easing:function(a){return 0===a||1==a?a:Math.sin(a*Math.PI/2)},reverse:function(){return cc._easeSineInObj}};cc.easeSineOut=function(){return cc._easeSineOutObj};cc.EaseSineInOut=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:-0.5*(Math.cos(Math.PI*a)-1);this._inner.update(a)},clone:function(){var a=new cc.EaseSineInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseSineInOut.create(this._inner.reverse())}});cc.EaseSineInOut.create=function(a){return new cc.EaseSineInOut(a)};cc._easeSineInOutObj={easing:function(a){return 0===a||1===a?a:-0.5*(Math.cos(Math.PI*a)-1)},reverse:function(){return cc._easeSineInOutObj}};cc.easeSineInOut=function(){return cc._easeSineInOutObj};cc.EaseElastic=cc.ActionEase.extend({_period:0.3,ctor:function(a,b){cc.ActionEase.prototype.ctor.call(this);a&&this.initWithAction(a,b)},getPeriod:function(){return this._period},setPeriod:function(a){this._period=a},initWithAction:function(a,b){cc.ActionEase.prototype.initWithAction.call(this,a);this._period=null==b?0.3:b;return !0},reverse:function(){cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass.");return null},clone:function(){var a=new cc.EaseElastic;a.initWithAction(this._inner.clone(),this._period);return a}});cc.EaseElastic.create=function(a,b){return new cc.EaseElastic(a,b)};cc.EaseElasticIn=cc.EaseElastic.extend({update:function(a){var b=0;0===a||1===a?b=a:(b=this._period/4,a-=1,b=-Math.pow(2,10*a)*Math.sin(2*(a-b)*Math.PI/this._period));this._inner.update(b)},reverse:function(){return cc.EaseElasticOut.create(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticIn;a.initWithAction(this._inner.clone(),this._period);return a}});cc.EaseElasticIn.create=function(a,b){return new cc.EaseElasticIn(a,b)};cc._easeElasticInObj={easing:function(a){if(0===a||1===a){return a}a-=1;return -Math.pow(2,10*a)*Math.sin(2*(a-0.075)*Math.PI/0.3)},reverse:function(){return cc._easeElasticOutObj}};cc.easeElasticIn=function(a){return a&&0.3!==a?{_period:a,easing:function(b){if(0===b||1===b){return b}b-=1;return -Math.pow(2,10*b)*Math.sin(2*(b-this._period/4)*Math.PI/this._period)},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj};cc.EaseElasticOut=cc.EaseElastic.extend({update:function(a){var b=0;0===a||1==a?b=a:(b=this._period/4,b=Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/this._period)+1);this._inner.update(b)},reverse:function(){return cc.EaseElasticIn.create(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticOut;a.initWithAction(this._inner.clone(),this._period);return a}});cc.EaseElasticOut.create=function(a,b){return new cc.EaseElasticOut(a,b)};cc._easeElasticOutObj={easing:function(a){return 0===a||1===a?a:Math.pow(2,-10*a)*Math.sin(2*(a-0.075)*Math.PI/0.3)+1},reverse:function(){return cc._easeElasticInObj}};cc.easeElasticOut=function(a){return a&&0.3!==a?{_period:a,easing:function(b){return 0===b||1===b?b:Math.pow(2,-10*b)*Math.sin(2*(b-this._period/4)*Math.PI/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj};cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(b){var c=0,c=this._period;if(0===b||1==b){c=b}else{c||(c=this._period=0.3*1.5);var a=c/4;b=2*b-1;c=0>b?-0.5*Math.pow(2,10*b)*Math.sin(2*(b-a)*Math.PI/c):0.5*Math.pow(2,-10*b)*Math.sin(2*(b-a)*Math.PI/c)+1}this._inner.update(c)},reverse:function(){return cc.EaseElasticInOut.create(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticInOut;a.initWithAction(this._inner.clone(),this._period);return a}});cc.EaseElasticInOut.create=function(a,b){return new cc.EaseElasticInOut(a,b)};cc.easeElasticInOut=function(a){return{_period:a||0.3,easing:function(d){var b=0,b=this._period;if(0===d||1===d){b=d}else{b||(b=this._period=0.3*1.5);var c=b/4;d=2*d-1;b=0>d?-0.5*Math.pow(2,10*d)*Math.sin(2*(d-c)*Math.PI/b):0.5*Math.pow(2,-10*d)*Math.sin(2*(d-c)*Math.PI/b)+1}return b},reverse:function(){return cc.easeElasticInOut(this._period)}}};cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(a){if(a<1/2.75){return 7.5625*a*a}if(a<2/2.75){return a-=1.5/2.75,7.5625*a*a+0.75}if(a<2.5/2.75){return a-=2.25/2.75,7.5625*a*a+0.9375}a-=2.625/2.75;return 7.5625*a*a+0.984375},clone:function(){var a=new cc.EaseBounce;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseBounce.create(this._inner.reverse())}});cc.EaseBounce.create=function(a){return new cc.EaseBounce(a)};cc.EaseBounceIn=cc.EaseBounce.extend({update:function(a){a=1-this.bounceTime(1-a);this._inner.update(a)},reverse:function(){return cc.EaseBounceOut.create(this._inner.reverse())},clone:function(){var a=new cc.EaseBounceIn;a.initWithAction(this._inner.clone());return a}});cc.EaseBounceIn.create=function(a){return new cc.EaseBounceIn(a)};cc._bounceTime=function(a){if(a<1/2.75){return 7.5625*a*a}if(a<2/2.75){return a-=1.5/2.75,7.5625*a*a+0.75}if(a<2.5/2.75){return a-=2.25/2.75,7.5625*a*a+0.9375}a-=2.625/2.75;return 7.5625*a*a+0.984375};cc._easeBounceInObj={easing:function(a){return 1-cc._bounceTime(1-a)},reverse:function(){return cc._easeBounceOutObj}};cc.easeBounceIn=function(){return cc._easeBounceInObj};cc.EaseBounceOut=cc.EaseBounce.extend({update:function(a){a=this.bounceTime(a);this._inner.update(a)},reverse:function(){return cc.EaseBounceIn.create(this._inner.reverse())},clone:function(){var a=new cc.EaseBounceOut;a.initWithAction(this._inner.clone());return a}});cc.EaseBounceOut.create=function(a){return new cc.EaseBounceOut(a)};cc._easeBounceOutObj={easing:function(a){return cc._bounceTime(a)},reverse:function(){return cc._easeBounceInObj}};cc.easeBounceOut=function(){return cc._easeBounceOutObj};cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(a){var b=0,b=0.5>a?0.5*(1-this.bounceTime(1-2*a)):0.5*this.bounceTime(2*a-1)+0.5;this._inner.update(b)},clone:function(){var a=new cc.EaseBounceInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseBounceInOut.create(this._inner.reverse())}});cc.EaseBounceInOut.create=function(a){return new cc.EaseBounceInOut(a)};cc._easeBounceInOutObj={easing:function(a){return a=0.5>a?0.5*(1-cc._bounceTime(1-2*a)):0.5*cc._bounceTime(2*a-1)+0.5},reverse:function(){return cc._easeBounceInOutObj}};cc.easeBounceInOut=function(){return cc._easeBounceInOutObj};cc.EaseBackIn=cc.ActionEase.extend({update:function(a){this._inner.update(0===a||1==a?a:a*a*(2.70158*a-1.70158))},reverse:function(){return cc.EaseBackOut.create(this._inner.reverse())},clone:function(){var a=new cc.EaseBackIn;a.initWithAction(this._inner.clone());return a}});cc.EaseBackIn.create=function(a){return new cc.EaseBackIn(a)};cc._easeBackInObj={easing:function(a){return 0===a||1===a?a:a*a*(2.70158*a-1.70158)},reverse:function(){return cc._easeBackOutObj}};cc.easeBackIn=function(){return cc._easeBackInObj};cc.EaseBackOut=cc.ActionEase.extend({update:function(a){a-=1;this._inner.update(a*a*(2.70158*a+1.70158)+1)},reverse:function(){return cc.EaseBackIn.create(this._inner.reverse())},clone:function(){var a=new cc.EaseBackOut;a.initWithAction(this._inner.clone());return a}});cc.EaseBackOut.create=function(a){return new cc.EaseBackOut(a)};cc._easeBackOutObj={easing:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},reverse:function(){return cc._easeBackInObj}};cc.easeBackOut=function(){return cc._easeBackOutObj};cc.EaseBackInOut=cc.ActionEase.extend({update:function(a){a*=2;1>a?this._inner.update(a*a*(3.5949095*a-2.5949095)/2):(a-=2,this._inner.update(a*a*(3.5949095*a+2.5949095)/2+1))},clone:function(){var a=new cc.EaseBackInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseBackInOut.create(this._inner.reverse())}});cc.EaseBackInOut.create=function(a){return new cc.EaseBackInOut(a)};cc._easeBackInOutObj={easing:function(a){a*=2;if(1>a){return a*a*(3.5949095*a-2.5949095)/2}a-=2;return a*a*(3.5949095*a+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}};cc.easeBackInOut=function(){return cc._easeBackInOutObj};cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(a){cc.ActionEase.prototype.ctor.call(this,a)},_updateTime:function(d,e,a,b,c){return Math.pow(1-c,3)*d+3*c*Math.pow(1-c,2)*e+3*Math.pow(c,2)*(1-c)*a+Math.pow(c,3)*b},update:function(a){a=this._updateTime(this._p0,this._p1,this._p2,this._p3,a);this._inner.update(a)},clone:function(){var a=new cc.EaseBezierAction;a.initWithAction(this._inner.clone());a.setBezierParamer(this._p0,this._p1,this._p2,this._p3);return a},reverse:function(){var a=cc.EaseBezierAction.create(this._inner.reverse());a.setBezierParamer(this._p3,this._p2,this._p1,this._p0);return a},setBezierParamer:function(c,d,a,b){this._p0=c||0;this._p1=d||0;this._p2=a||0;this._p3=b||0}});cc.EaseBezierAction.create=function(a){return new cc.EaseBezierAction(a)};cc.easeBezierAction=function(c,d,a,b){return{easing:function(e){return cc.EaseBezierAction.prototype._updateTime(c,d,a,b,e)},reverse:function(){return cc.easeBezierAction(b,a,d,c)}}};cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(a){return Math.pow(a,2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuadraticActionIn.create(this._inner.reverse())}});cc.EaseQuadraticActionIn.create=function(a){return new cc.EaseQuadraticActionIn(a)};cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}};cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn};cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(a){return -a*(a-2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionOut;a.initWithAction();return a},reverse:function(){return cc.EaseQuadraticActionOut.create(this._inner.reverse())}});cc.EaseQuadraticActionOut.create=function(a){return new cc.EaseQuadraticActionOut(a)};cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}};cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut};cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(a){var b=a;a*=2;1>a?b=0.5*a*a:(--a,b=-0.5*(a*(a-2)-1));return b},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuadraticActionInOut.create(this._inner.reverse())}});cc.EaseQuadraticActionInOut.create=function(a){return new cc.EaseQuadraticActionInOut(a)};cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}};cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut};cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuarticActionIn.create(this._inner.reverse())}});cc.EaseQuarticActionIn.create=function(a){return new cc.EaseQuarticActionIn(a)};cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}};cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn};cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return -(a*a*a*a-1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuarticActionOut.create(this._inner.reverse())}});cc.EaseQuarticActionOut.create=function(a){return new cc.EaseQuarticActionOut(a)};cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}};cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut};cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a){return 0.5*a*a*a*a}a-=2;return -0.5*(a*a*a*a-2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuarticActionInOut.create(this._inner.reverse())}});cc.EaseQuarticActionInOut.create=function(a){return new cc.EaseQuarticActionInOut(a)};cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}};cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut};cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuinticActionIn.create(this._inner.reverse())}});cc.EaseQuinticActionIn.create=function(a){return new cc.EaseQuinticActionIn(a)};cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}};cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn};cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return a*a*a*a*a+1},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuinticActionOut.create(this._inner.reverse())}});cc.EaseQuinticActionOut.create=function(a){return new cc.EaseQuinticActionOut(a)};cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}};cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut};cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a){return 0.5*a*a*a*a*a}a-=2;return 0.5*(a*a*a*a*a+2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseQuinticActionInOut.create(this._inner.reverse())}});cc.EaseQuinticActionInOut.create=function(a){return new cc.EaseQuinticActionInOut(a)};cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}};cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut};cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(a){return -1*(Math.sqrt(1-a*a)-1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCircleActionIn.create(this._inner.reverse())}});cc.EaseCircleActionIn.create=function(a){return new cc.EaseCircleActionIn(a)};cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}};cc.easeCircleActionIn=function(){return cc._easeCircleActionIn};cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return Math.sqrt(1-a*a)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCircleActionOut.create(this._inner.reverse())}});cc.EaseCircleActionOut.create=function(a){return new cc.EaseCircleActionOut(a)};cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}};cc.easeCircleActionOut=function(){return cc._easeCircleActionOut};cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a){return -0.5*(Math.sqrt(1-a*a)-1)}a-=2;return 0.5*(Math.sqrt(1-a*a)+1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCircleActionInOut.create(this._inner.reverse())}});cc.EaseCircleActionInOut.create=function(a){return new cc.EaseCircleActionInOut(a)};cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}};cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut};cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCubicActionIn.create(this._inner.reverse())}});cc.EaseCubicActionIn.create=function(a){return new cc.EaseCubicActionIn(a)};cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}};cc.easeCubicActionIn=function(){return cc._easeCubicActionIn};cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return a*a*a+1},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCubicActionOut.create(this._inner.reverse())}});cc.EaseCubicActionOut.create=function(a){return new cc.EaseCubicActionOut(a)};cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}};cc.easeCubicActionOut=function(){return cc._easeCubicActionOut};cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a){return 0.5*a*a*a}a-=2;return 0.5*(a*a*a+2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return cc.EaseCubicActionInOut.create(this._inner.reverse())}});cc.EaseCubicActionInOut.create=function(a){return new cc.EaseCubicActionInOut(a)};cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}};cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut};cc.cardinalSplineAt=function(g,h,k,m,a,b){var c=b*b,d=c*b,e=(1-a)/2;a=e*(-d+2*c-b);var f=e*(-d+c)+(2*d-3*c+1);b=e*(d-2*c+b)+(-2*d+3*c);c=e*(d-c);return cc.p(g.x*a+h.x*f+k.x*b+m.x*c,g.y*a+h.y*f+k.y*b+m.y*c)};cc.reverseControlPoints=function(b){for(var c=[],a=b.length-1;0<=a;a--){c.push(cc.p(b[a].x,b[a].y))}return c};cc.copyControlPoints=function(b){for(var c=[],a=0;a<b.length;a++){c.push(cc.p(b[a].x,b[a].y))}return c};cc.getControlPointAt=function(b,c){var a=Math.min(b.length-1,Math.max(c,0));return b[a]};cc.reverseControlPointsInline=function(d){for(var e=d.length,a=0|e/2,b=0;b<a;++b){var c=d[b];d[b]=d[e-b-1];d[e-b-1]=c}};cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);this._points=[];void 0!==a&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){if(!c||0==c.length){throw"Invalid configuration. It must at least have one control point"}return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(this.setPoints(c),this._tension=a,!0):!1},clone:function(){var a=new cc.CardinalSplineTo;a.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._deltaT=1/(this._points.length-1);this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY());this._accumulatedDiff=cc.p(0,0)},update:function(c){c=this._computeEaseTime(c);var d,a=this._points;if(1==c){d=a.length-1,c=1}else{var b=this._deltaT;d=0|c/b;c=(c-b*d)/b}d=cc.cardinalSplineAt(cc.getControlPointAt(a,d-1),cc.getControlPointAt(a,d-0),cc.getControlPointAt(a,d+1),cc.getControlPointAt(a,d+2),this._tension,c);if(cc.ENABLE_STACKABLE_ACTIONS&&(a=this.target.getPositionX()-this._previousPosition.x,c=this.target.getPositionY()-this._previousPosition.y,0!=a||0!=c)){b=this._accumulatedDiff,a=b.x+a,c=b.y+c,b.x=a,b.y=c,d.x+=a,d.y+=c}this.updatePosition(d)},reverse:function(){var a=cc.reverseControlPoints(this._points);return cc.CardinalSplineTo.create(this._duration,a,this._tension)},updatePosition:function(a){this.target.setPosition(a);this._previousPosition=a},getPoints:function(){return this._points},setPoints:function(a){this._points=a}});cc.CardinalSplineTo.create=function(b,c,a){return new cc.CardinalSplineTo(b,c,a)};cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(b,c,a){cc.CardinalSplineTo.prototype.ctor.call(this);this._startPosition=cc.p(0,0);void 0!==a&&this.initWithDuration(b,c,a)},startWithTarget:function(a){cc.CardinalSplineTo.prototype.startWithTarget.call(this,a);this._startPosition.x=a.getPositionX();this._startPosition.y=a.getPositionY()},reverse:function(){for(var c=this._points.slice(),d,a=c[0],b=1;b<c.length;++b){d=c[b],c[b]=cc.pSub(d,a),a=d}c=cc.reverseControlPoints(c);a=c[c.length-1];c.pop();a.x=-a.x;a.y=-a.y;c.unshift(a);for(b=1;b<c.length;++b){d=c[b],d.x=-d.x,d.y=-d.y,d.x+=a.x,d.y+=a.y,a=c[b]=d}return cc.CardinalSplineBy.create(this._duration,c,this._tension)},updatePosition:function(b){var c=this._startPosition,a=b.x+c.x;b=b.y+c.y;this._previousPosition.x=a;this._previousPosition.y=b;this.target.setPosition(a,b)},clone:function(){var a=new cc.CardinalSplineBy;a.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return a}});cc.CardinalSplineBy.create=function(b,c,a){return new cc.CardinalSplineBy(b,c,a)};cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(a,b){b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,a,b,0.5)},clone:function(){var a=new cc.CatmullRomTo;a.initWithDuration(this._duration,cc.copyControlPoints(this._points));return a}});cc.CatmullRomTo.create=function(a,b){return new cc.CatmullRomTo(a,b)};cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(a,b){cc.CardinalSplineBy.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,a,b,0.5)},clone:function(){var a=new cc.CatmullRomBy;a.initWithDuration(this._duration,cc.copyControlPoints(this._points));return a}});cc.CatmullRomBy.create=function(a,b){return new cc.CatmullRomBy(a,b)};cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(a,b){}});cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(c,d,a,b){cc.ActionInterval.prototype.ctor.call(this);this.key="";void 0!==b&&this.initWithDuration(c,d,a,b)},initWithDuration:function(c,d,a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,c)?(this.key=d,this.to=b,this.from=a,!0):!1},startWithTarget:function(a){if(!a||!a.updateTweenAction){throw"cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function"}cc.ActionInterval.prototype.startWithTarget.call(this,a);this.delta=this.to-this.from},update:function(a){this.target.updateTweenAction(this.to-this.delta*(1-a),this.key)},reverse:function(){return cc.ActionTween.create(this.duration,this.key,this.to,this.from)},clone:function(){var a=new cc.ActionTween;a.initWithDuration(this._duration,this.key,this.from,this.to);return a}});cc.ActionTween.create=function(d,e,a,b){var c=new cc.ActionTween;return c.initWithDuration(d,e,a,b)?c:null};cc.action=cc.Action.create;cc.speed=cc.Speed.create;cc.follow=cc.Follow.create;cc.orbitCamera=cc.OrbitCamera.create;cc.cardinalSplineTo=cc.CardinalSplineTo.create;cc.cardinalSplineBy=cc.CardinalSplineBy.create;cc.catmullRomTo=cc.CatmullRomTo.create;cc.catmullRomBy=cc.CatmullRomBy.create;cc.show=cc.Show.create;cc.hide=cc.Hide.create;cc.toggleVisibility=cc.ToggleVisibility.create;cc.removeSelf=cc.RemoveSelf.create;cc.flipX=cc.FlipX.create;cc.flipY=cc.FlipY.create;cc.place=cc.Place.create;cc.callFunc=cc.CallFunc.create;cc.actionInterval=cc.ActionInterval.create;cc.sequence=cc.Sequence.create;cc.repeat=cc.Repeat.create;cc.repeatForever=cc.RepeatForever.create;cc.spawn=cc.Spawn.create;cc.rotateTo=cc.RotateTo.create;cc.rotateBy=cc.RotateBy.create;cc.moveBy=cc.MoveBy.create;cc.moveTo=cc.MoveTo.create;cc.skewTo=cc.SkewTo.create;cc.skewBy=cc.SkewBy.create;cc.jumpBy=cc.JumpBy.create;cc.jumpTo=cc.JumpTo.create;cc.bezierBy=cc.BezierBy.create;cc.bezierTo=cc.BezierTo.create;cc.scaleTo=cc.ScaleTo.create;cc.scaleBy=cc.ScaleBy.create;cc.blink=cc.Blink.create;cc.fadeTo=cc.FadeTo.create;cc.fadeIn=cc.FadeIn.create;cc.fadeOut=cc.FadeOut.create;cc.tintTo=cc.TintTo.create;cc.tintBy=cc.TintBy.create;cc.delayTime=cc.DelayTime.create;cc.reverseTime=cc.ReverseTime.create;cc.animate=cc.Animate.create;cc.targetedAction=cc.TargetedAction.create;cc.actionTween=cc.ActionTween.create;cc.ProgressTimer=cc.NodeRGBA.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(a){this._midPoint=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(a){this._barChangeRate=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(a){this._percentage!=a&&(this._percentage=cc.clampf(a,0,100),this._updateProgress())},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return !1},isReverseDirection:function(){return this._reverseDirection},_boundaryTexCoord:function(a){if(a<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var b=cc.ProgressTimer.TEXTURE_COORDS;return this._reverseDirection?cc.p(b>>7-(a<<1)&1,b>>7-((a<<1)+1)&1):cc.p(b>>(a<<1)+1&1,b>>(a<<1)&1)}return cc.p(0,0)},_origin:null,_startAngle:270,_endAngle:270,_radius:0,_counterClockWise:!1,_barRect:null,_vertexDataCount:0,_vertexData:null,_vertexArrayBuffer:null,_vertexWebGLBuffer:null,_vertexDataDirty:!1,ctor:null,_ctorForCanvas:function(){cc.NodeRGBA.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=!1;this._sprite=null;this._origin=cc.p(0,0);this._endAngle=this._startAngle=270;this._radius=0;this._counterClockWise=!1;this._barRect=cc.rect(0,0,0,0)},_ctorForWebGL:function(){cc.NodeRGBA.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=!1;this._sprite=null;this._vertexWebGLBuffer=cc._renderContext.createBuffer();this._vertexDataCount=0;this._vertexArrayBuffer=this._vertexData=null;this._vertexDataDirty=!1},setColor:function(a){this._sprite.color=a;this._updateColor()},setOpacity:function(a){this._sprite.opacity=a;this._updateColor()},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:null,_setReverseProgressForCanvas:function(a){this._reverseDirection!==a&&(this._reverseDirection=a)},_setReverseProgressForWebGL:function(a){this._reverseDirection!==a&&(this._reverseDirection=a,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0)},setSprite:null,_setSpriteForCanvas:function(a){this._sprite!=a&&(this._sprite=a,this.width=this._sprite.width,this.height=this._sprite.height)},_setSpriteForWebGL:function(a){a&&this._sprite!=a&&(this._sprite=a,this.width=a.width,this.height=a.height,this._vertexData&&(this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0))},setType:null,_setTypeForCanvas:function(a){a!==this._type&&(this._type=a)},_setTypeForWebGL:function(a){a!==this._type&&(this._vertexData&&(this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0),this._type=a)},setReverseDirection:null,_setReverseDirectionForCanvas:function(a){this._reverseDirection!==a&&(this._reverseDirection=a)},_setReverseDirectionForWebGL:function(a){this._reverseDirection!==a&&(this._reverseDirection=a,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0)},_textureCoordFromAlphaPoint:function(c){var d=this._sprite;if(!d){return{u:0,v:0}}var a=d.quad,b=cc.p(a.bl.texCoords.u,a.bl.texCoords.v),a=cc.p(a.tr.texCoords.u,a.tr.texCoords.v);d.textureRectRotated&&(d=c.x,c.x=c.y,c.y=d);return{u:b.x*(1-c.x)+a.x*c.x,v:b.y*(1-c.y)+a.y*c.y}},_vertexFromAlphaPoint:function(b){if(!this._sprite){return{x:0,y:0}}var c=this._sprite.quad,a=cc.p(c.bl.vertices.x,c.bl.vertices.y),c=cc.p(c.tr.vertices.x,c.tr.vertices.y);return{x:a.x*(1-b.x)+c.x*b.x,y:a.y*(1-b.y)+c.y*b.y}},initWithSprite:null,_initWithSpriteForCanvas:function(a){this.percentage=0;this.anchorY=this.anchorX=0.5;this._type=cc.ProgressTimer.TYPE_RADIAL;this._reverseDirection=!1;this.midPoint=cc.p(0.5,0.5);this.barChangeRate=cc.p(1,1);this.sprite=a;return !0},_initWithSpriteForWebGL:function(a){this.percentage=0;this._vertexArrayBuffer=this._vertexData=null;this._vertexDataCount=0;this.anchorY=this.anchorX=0.5;this._type=cc.ProgressTimer.TYPE_RADIAL;this._reverseDirection=!1;this.midPoint=cc.p(0.5,0.5);this.barChangeRate=cc.p(1,1);this.sprite=a;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);return !0},draw:null,_drawForCanvas:function(f){f=f||cc._renderContext;var g=this._sprite;g._isLighterMode&&(f.globalCompositeOperation="lighter");var h=cc.view.getScaleX(),k=cc.view.getScaleY();f.globalAlpha=g._displayedOpacity/255;var m=g._rect,n=g._contentSize,a=g._offsetPosition,b=g._drawSize_Canvas,c=0|a.x,d=-a.y-m.height,e=g._textureRect_Canvas;b.width=m.width*h;b.height=m.height*k;f.save();g._flippedX&&(c=-a.x-m.width,f.scale(-1,1));g._flippedY&&(d=a.y,f.scale(1,-1));c*=h;d*=k;this._type==cc.ProgressTimer.TYPE_BAR?(m=this._barRect,f.beginPath(),f.rect(m.x*h,m.y*k,m.width*h,m.height*k),f.clip(),f.closePath()):this._type==cc.ProgressTimer.TYPE_RADIAL&&(m=this._origin.x*h,a=this._origin.y*k,f.beginPath(),f.arc(m,a,this._radius*k,Math.PI/180*this._startAngle,Math.PI/180*this._endAngle,this._counterClockWise),f.lineTo(m,a),f.clip(),f.closePath());g._texture&&e.validRect?(h=g._texture.getHtmlElementObj(),this._colorized?f.drawImage(h,0,0,e.width,e.height,c,d,b.width,b.height):f.drawImage(h,e.x,e.y,e.width,e.height,c,d,b.width,b.height)):0!==n.width&&(b=this.color,f.fillStyle="rgba("+b.r+","+b.g+","+b.b+",1)",f.fillRect(c,d,n.width*h,n.height*k));f.restore();cc.incrementGLDraws(1)},_drawForWebGL:function(a){a=a||cc._renderContext;if(this._vertexData&&this._sprite){cc.nodeDrawSetup(this);var b=this._sprite.getBlendFunc();cc.glBlendFunc(b.src,b.dst);cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX);cc.glBindTexture2D(this._sprite.texture);a.bindBuffer(a.ARRAY_BUFFER,this._vertexWebGLBuffer);this._vertexDataDirty&&(a.bufferData(a.ARRAY_BUFFER,this._vertexArrayBuffer,a.DYNAMIC_DRAW),this._vertexDataDirty=!1);b=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,b,8);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,b,12);this._type===cc.ProgressTimer.TYPE_RADIAL?a.drawArrays(a.TRIANGLE_FAN,0,this._vertexDataCount):this._type==cc.ProgressTimer.TYPE_BAR&&(this._reverseDirection?(a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount/2),a.drawArrays(a.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount));cc.g_NumberOfDraws++}},_updateRadial:function(){if(this._sprite){var g,h=this._midPoint;g=this._percentage/100;var k=2*cc.PI*(this._reverseDirection?g:1-g),m=cc.p(h.x,1),a=cc.pRotateByAngle(m,h,k),k=0;if(0==g){a=m,k=0}else{if(1==g){a=m,k=4}else{var b=cc.FLT_MAX,c=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(g=0;g<=c;++g){var d=(g+(c-1))%c,e=this._boundaryTexCoord(g%c),d=this._boundaryTexCoord(d);0==g?d=cc.pLerp(e,d,1-h.x):4==g&&(e=cc.pLerp(e,d,1-h.x));var f=cc.p(0,0);if(cc.pLineIntersect(e,d,h,a,f)&&(!(0==g||4==g)||0<=f.x&&1>=f.x)&&0<=f.y&&f.y<b){b=f.y,k=g}}a=cc.pAdd(h,cc.pMult(cc.pSub(a,h),b))}}b=!0;this._vertexDataCount!=k+3&&(b=!1,this._vertexArrayBuffer=this._vertexData=null,this._vertexDataCount=0);if(!this._vertexData){c=this._vertexDataCount=k+3;e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(c*e);d=[];for(g=0;g<c;g++){d[g]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,g*e)}this._vertexData=d;if(!this._vertexData){cc.log("cc.ProgressTimer._updateRadial() : Not enough memory");return}}this._updateColor();c=this._vertexData;if(!b){c[0].texCoords=this._textureCoordFromAlphaPoint(h);c[0].vertices=this._vertexFromAlphaPoint(h);c[1].texCoords=this._textureCoordFromAlphaPoint(m);c[1].vertices=this._vertexFromAlphaPoint(m);for(g=0;g<k;g++){h=this._boundaryTexCoord(g),c[g+2].texCoords=this._textureCoordFromAlphaPoint(h),c[g+2].vertices=this._vertexFromAlphaPoint(h)}}c[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(a);c[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(a)}},_updateBar:function(){if(this._sprite){var d,e=this._percentage/100,a=this._barChangeRate,a=cc.pMult(cc.p(1-a.x+e*a.x,1-a.y+e*a.y),0.5),e=cc.pSub(this._midPoint,a),a=cc.pAdd(this._midPoint,a);0>e.x&&(a.x+=-e.x,e.x=0);1<a.x&&(e.x-=a.x-1,a.x=1);0>e.y&&(a.y+=-e.y,e.y=0);1<a.y&&(e.y-=a.y-1,a.y=1);if(this._reverseDirection){if(!this._vertexData){this._vertexDataCount=8;var b=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*b);var c=[];for(d=0;8>d;d++){c[d]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,d*b)}c[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1));c[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1));c[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0));c[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0));c[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1));c[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1));c[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,0));c[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0));this._vertexData=c}d=this._vertexData;d[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(e.x,a.y));d[2].vertices=this._vertexFromAlphaPoint(cc.p(e.x,a.y));d[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(e.x,e.y));d[3].vertices=this._vertexFromAlphaPoint(cc.p(e.x,e.y));d[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,a.y));d[4].vertices=this._vertexFromAlphaPoint(cc.p(a.x,a.y));d[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,e.y));d[5].vertices=this._vertexFromAlphaPoint(cc.p(a.x,e.y))}else{if(!this._vertexData){this._vertexDataCount=4;b=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(4*b);this._vertexData=[];for(d=0;4>d;d++){this._vertexData[d]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,d*b)}}d=this._vertexData;d[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(e.x,a.y));d[0].vertices=this._vertexFromAlphaPoint(cc.p(e.x,a.y));d[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(e.x,e.y));d[1].vertices=this._vertexFromAlphaPoint(cc.p(e.x,e.y));d[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,a.y));d[2].vertices=this._vertexFromAlphaPoint(cc.p(a.x,a.y));d[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(a.x,e.y));d[3].vertices=this._vertexFromAlphaPoint(cc.p(a.x,e.y))}this._updateColor()}},_updateColor:function(){if(this._sprite&&this._vertexData){for(var c=this._sprite.quad.tl.colors,d=this._vertexData,a=0,b=this._vertexDataCount;a<b;++a){d[a].colors=c}this._vertexDataDirty=!0}},_updateProgress:null,_updateProgressForCanvas:function(){var c=this._sprite,d=c.width,e=c.height,f=this._midPoint;if(this._type==cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(d*d+e*e));var g,h=!1,a=this._origin;a.x=d*f.x;a.y=-e*f.y;this._reverseDirection?(g=270,f=270-3.6*this._percentage):(f=-90,g=-90+3.6*this._percentage);c._flippedX&&(a.x-=d*2*this._midPoint.x,f=-f-180,g=-g-180,h=!h);c._flippedY&&(a.y+=e*2*this._midPoint.y,h=!h,f=-f,g=-g);this._startAngle=f;this._endAngle=g;this._counterClockWise=h}else{g=this._barChangeRate;a=this._percentage/100;h=this._barRect;g=cc.size(d*(1-g.x),e*(1-g.y));var a=cc.size((d-g.width)*a,(e-g.height)*a),a=cc.size(g.width+a.width,g.height+a.height),b=cc.p(d*f.x,e*f.y);g=b.x-a.width/2;0.5<f.x&&a.width/2>=d-b.x&&(g=d-a.width);d=b.y-a.height/2;0.5<f.y&&a.height/2>=e-b.y&&(d=e-a.height);h.x=0;e=1;c._flippedX&&(h.x-=a.width,e=-1);0<g&&(h.x+=g*e);h.y=0;e=1;c._flippedY&&(h.y+=a.height,e=-1);0<d&&(h.y-=d*e);h.width=a.width;h.height=-a.height}},_updateProgressForWebGL:function(){var a=this._type;a===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():a===cc.ProgressTimer.TYPE_BAR&&this._updateBar();this._vertexDataDirty=!0}});_p=cc.ProgressTimer.prototype;cc._renderType==cc._RENDER_TYPE_WEBGL?(_p.ctor=_p._ctorForWebGL,_p.setReverseProgress=_p._setReverseProgressForWebGL,_p.setSprite=_p._setSpriteForWebGL,_p.setType=_p._setTypeForWebGL,_p.setReverseDirection=_p._setReverseDirectionForWebGL,_p.initWithSprite=_p._initWithSpriteForWebGL,_p.draw=_p._drawForWebGL,_p._updateProgress=_p._updateProgressForWebGL):(_p.ctor=_p._ctorForCanvas,_p.setReverseProgress=_p._setReverseProgressForCanvas,_p.setSprite=_p._setSpriteForCanvas,_p.setType=_p._setTypeForCanvas,_p.setReverseDirection=_p._setReverseDirectionForCanvas,_p.initWithSprite=_p._initWithSpriteForCanvas,_p.draw=_p._drawForCanvas,_p._updateProgress=cc.ProgressTimer.prototype._updateProgressForCanvas);cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint);cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate);cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite);cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection);cc.ProgressTimer.create=function(a){var b=new cc.ProgressTimer;return b.initWithSprite(a)?b:null};cc.ProgressTimer.TEXTURE_COORDS_COUNT=4;cc.ProgressTimer.TEXTURE_COORDS=75;cc.ProgressTimer.TYPE_RADIAL=0;cc.ProgressTimer.TYPE_BAR=1;cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=b,!0):!1},clone:function(){var a=new cc.ProgressTo;a.initWithDuration(this._duration,this._to);return a},reverse:function(){cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported.");return null},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._from=a.percentage;100==this._from&&(this._from=0)},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.ProgressTo.create=function(a,b){return new cc.ProgressTo(a,b)};cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(b,c,a){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==a&&this.initWithDuration(b,c,a)},initWithDuration:function(b,c,a){return cc.ActionInterval.prototype.initWithDuration.call(this,b)?(this._to=a,this._from=c,!0):!1},clone:function(){var a=new cc.ProgressFromTo;a.initWithDuration(this._duration,this._from,this._to);return a},reverse:function(){return cc.ProgressFromTo.create(this._duration,this._to,this._from)},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a)},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.ProgressFromTo.create=function(b,c,a){return new cc.ProgressFromTo(b,c,a)};cc.SCENE_FADE=4208917214;cc.TransitionEaseScene=cc.Class.extend({easeActionWithAction:function(){}});cc.TRANSITION_ORIENTATION_LEFT_OVER=0;cc.TRANSITION_ORIENTATION_RIGHT_OVER=1;cc.TRANSITION_ORIENTATION_UP_OVER=0;cc.TRANSITION_ORIENTATION_DOWN_OVER=1;cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_className:"TransitionScene",ctor:function(a,b){cc.Scene.prototype.ctor.call(this);void 0!==a&&void 0!==b&&this.initWithDuration(a,b)},_setNewScene:function(a){this.unschedule(this._setNewScene);a=cc.director;this._isSendCleanupToScene=a.isSendCleanupToScene();a.runScene(this._inScene);cc.eventManager.setEnabled(!0);this._outScene.visible=!0},_sceneOrder:function(){this._isInSceneOnTop=!0},draw:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit())},onEnter:function(){cc.Node.prototype.onEnter.call(this);cc.eventManager.setEnabled(!1);this._outScene.onExitTransitionDidStart();this._inScene.onEnter()},onExit:function(){cc.Node.prototype.onExit.call(this);cc.eventManager.setEnabled(!0);this._outScene.onExit();this._inScene.onEnterTransitionDidFinish()},cleanup:function(){cc.Node.prototype.cleanup.call(this);this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(a,b){if(!b){throw"cc.TransitionScene.initWithDuration(): Argument scene must be non-nil"}if(this.init()){this._duration=a;this.attr({x:0,y:0,anchorX:0,anchorY:0});this._inScene=b;this._outScene=cc.director.getRunningScene();this._outScene||(this._outScene=cc.Scene.create(),this._outScene.init());if(this._inScene==this._outScene){throw"cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene"}this._sceneOrder();return !0}return !1},finish:function(){this._inScene.attr({visible:!0,x:0,y:0,scale:1,rotation:0});cc._renderType===cc._RENDER_TYPE_WEBGL&&this._inScene.getCamera().restore();this._outScene.attr({visible:!1,x:0,y:0,scale:1,rotation:0});cc._renderType===cc._RENDER_TYPE_WEBGL&&this._outScene.getCamera().restore();this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=!0;this._outScene.visible=!1}});cc.TransitionScene.create=function(a,b){return new cc.TransitionScene(a,b)};cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,initWithDuration:function(b,c,a){cc.TransitionScene.prototype.initWithDuration.call(this,b,c)&&(this._orientation=a);return !0}});cc.TransitionSceneOriented.create=function(c,d,a){var b=new cc.TransitionSceneOriented;b.initWithDuration(c,d,a);return b};cc.TransitionRotoZoom=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:0.001,anchorX:0.5,anchorY:0.5});this._outScene.attr({scale:1,anchorX:0.5,anchorY:0.5});var a=cc.Sequence.create(cc.Spawn.create(cc.ScaleBy.create(this._duration/2,0.001),cc.RotateBy.create(this._duration/2,720)),cc.DelayTime.create(this._duration/2));this._outScene.runAction(a);this._inScene.runAction(cc.Sequence.create(a.reverse(),cc.CallFunc.create(this.finish,this)))}});cc.TransitionRotoZoom.create=function(b,c){var a=new cc.TransitionRotoZoom;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionJumpZoom=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b=cc.director.getWinSize();this._inScene.attr({scale:0.5,x:b.width,y:0,anchorX:0.5,anchorY:0.5});this._outScene.anchorX=0.5;this._outScene.anchorY=0.5;var c=cc.JumpBy.create(this._duration/4,cc.p(-b.width,0),b.width/4,2),a=cc.ScaleTo.create(this._duration/4,1),b=cc.ScaleTo.create(this._duration/4,0.5),b=cc.Sequence.create(b,c),c=cc.Sequence.create(c,a),a=cc.DelayTime.create(this._duration/2);this._outScene.runAction(b);this._inScene.runAction(cc.Sequence.create(a,c,cc.CallFunc.create(this.finish,this)))}});cc.TransitionJumpZoom.create=function(b,c){var a=new cc.TransitionJumpZoom;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionMoveInL=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var a=this.action();this._inScene.runAction(cc.Sequence.create(this.easeActionWithAction(a),cc.CallFunc.create(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width,0)},action:function(){return cc.MoveTo.create(this._duration,cc.p(0,0))},easeActionWithAction:function(a){return cc.EaseOut.create(a,2)}});cc.TransitionMoveInL.create=function(b,c){var a=new cc.TransitionMoveInL;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionMoveInR=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width,0)}});cc.TransitionMoveInR.create=function(b,c){var a=new cc.TransitionMoveInR;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionMoveInT=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height)}});cc.TransitionMoveInT.create=function(b,c){var a=new cc.TransitionMoveInT;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionMoveInB=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(0,-cc.director.getWinSize().height)}});cc.TransitionMoveInB.create=function(b,c){var a=new cc.TransitionMoveInB;return null!=a&&a.initWithDuration(b,c)?a:null};cc.ADJUST_FACTOR=0.5;cc.TransitionSlideInL=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var a=this.action(),b=this.action(),a=this.easeActionWithAction(a),b=cc.Sequence.create(this.easeActionWithAction(b),cc.CallFunc.create(this.finish,this));this._inScene.runAction(a);this._outScene.runAction(b)},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width+cc.ADJUST_FACTOR,0)},action:function(){return cc.MoveBy.create(this._duration,cc.p(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(a){return cc.EaseOut.create(a,2)}});cc.TransitionSlideInL.create=function(b,c){var a=new cc.TransitionSlideInL;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionSlideInR=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.MoveBy.create(this._duration,cc.p(-(cc.director.getWinSize().width-cc.ADJUST_FACTOR),0))}});cc.TransitionSlideInR.create=function(b,c){var a=new cc.TransitionSlideInR;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionSlideInB=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR)))}});cc.TransitionSlideInB.create=function(b,c){var a=new cc.TransitionSlideInB;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionSlideInT=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR))}});cc.TransitionSlideInT.create=function(b,c){var a=new cc.TransitionSlideInT;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionShrinkGrow=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:0.001,anchorX:2/3,anchorY:0.5});this._outScene.attr({scale:1,anchorX:1/3,anchorY:0.5});var a=cc.ScaleTo.create(this._duration,0.01),b=cc.ScaleTo.create(this._duration,1);this._inScene.runAction(this.easeActionWithAction(b));this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(a),cc.CallFunc.create(this.finish,this)))},easeActionWithAction:function(a){return cc.EaseOut.create(a,2)}});cc.TransitionShrinkGrow.create=function(b,c){var a=new cc.TransitionShrinkGrow;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,a,b,0,0),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,0,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionFlipX.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var b=new cc.TransitionFlipX;b.initWithDuration(c,d,a);return b};cc.TransitionFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation==cc.TRANSITION_ORIENTATION_UP_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,a,b,90,0),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,90,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionFlipY.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_UP_OVER);var b=new cc.TransitionFlipY;b.initWithDuration(c,d,a);return b};cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,a,b,-45,0),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,45,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionFlipAngular.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var b=new cc.TransitionFlipAngular;b.initWithDuration(c,d,a);return b};cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,a,b,0,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,0,0),cc.ScaleTo.create(this._duration/2,0.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.scale=0.5;this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionZoomFlipX.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var b=new cc.TransitionZoomFlipX;b.initWithDuration(c,d,a);return b};cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,a,b,90,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,90,0),cc.ScaleTo.create(this._duration/2,0.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.scale=0.5;this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionZoomFlipY.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_UP_OVER);var b=new cc.TransitionZoomFlipY;b.initWithDuration(c,d,a);return b};cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var b,c;this._inScene.visible=!1;var a;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(b=90,a=270,c=90):(b=-90,a=90,c=-90);b=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,a,b,-45,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.Show.create(),cc.CallFunc.create(this.finish,this));c=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,0,c,45,0),cc.ScaleTo.create(this._duration/2,0.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2));this._inScene.scale=0.5;this._inScene.runAction(b);this._outScene.runAction(c)}});cc.TransitionZoomFlipAngular.create=function(c,d,a){null==a&&(a=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var b=new cc.TransitionZoomFlipAngular;b.initWithDuration(c,d,a);return b};cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(){cc.TransitionScene.prototype.ctor.call(this);this._color=cc.color()},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.LayerColor.create(this._color);this._inScene.visible=!1;this.addChild(a,2,cc.SCENE_FADE);var a=this.getChildByTag(cc.SCENE_FADE),b=cc.Sequence.create(cc.FadeIn.create(this._duration/2),cc.CallFunc.create(this.hideOutShowIn,this),cc.FadeOut.create(this._duration/2),cc.CallFunc.create(this.finish,this));a.runAction(b)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this);this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(b,c,a){a=a||cc.color.BLACK;cc.TransitionScene.prototype.initWithDuration.call(this,b,c)&&(this._color.r=a.r,this._color.g=a.g,this._color.b=a.b,this._color.a=0);return !0}});cc.TransitionFade.create=function(c,d,a){var b=new cc.TransitionFade;b.initWithDuration(c,d,a);return b};cc.TransitionCrossFade=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var c=cc.color(0,0,0,0),d=cc.director.getWinSize(),c=cc.LayerColor.create(c),a=cc.RenderTexture.create(d.width,d.height);if(null!=a){a.sprite.anchorX=0.5;a.sprite.anchorY=0.5;a.attr({x:d.width/2,y:d.height/2,anchorX:0.5,anchorY:0.5});a.begin();this._inScene.visit();a.end();var b=cc.RenderTexture.create(d.width,d.height);b.setPosition(d.width/2,d.height/2);b.sprite.anchorX=b.anchorX=0.5;b.sprite.anchorY=b.anchorY=0.5;b.begin();this._outScene.visit();b.end();a.sprite.setBlendFunc(cc.ONE,cc.ONE);b.sprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);c.addChild(a);c.addChild(b);a.sprite.opacity=255;b.sprite.opacity=255;d=cc.Sequence.create(cc.FadeTo.create(this._duration,0),cc.CallFunc.create(this.hideOutShowIn,this),cc.CallFunc.create(this.finish,this));b.sprite.runAction(d);this.addChild(c,2,cc.SCENE_FADE)}},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1);cc.TransitionScene.prototype.onExit.call(this)},draw:function(){}});cc.TransitionCrossFade.create=function(b,c){var a=new cc.TransitionCrossFade;a.initWithDuration(b,c);return a};cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.director.getWinSize(),a=cc.TurnOffTiles.create(this._duration,cc.size(0|12*(a.width/a.height),12)),a=this.easeActionWithAction(a);this._outScene.runAction(cc.Sequence.create(a,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(a){return a}});cc.TransitionTurnOffTiles.create=function(b,c){var a=new cc.TransitionTurnOffTiles;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionSplitCols=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.visible=!1;var a=this.action(),a=cc.Sequence.create(a,cc.CallFunc.create(this.hideOutShowIn,this),a.reverse());this.runAction(cc.Sequence.create(this.easeActionWithAction(a),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(a){return cc.EaseInOut.create(a,3)},action:function(){return cc.SplitCols.create(this._duration/2,3)}});cc.TransitionSplitCols.create=function(b,c){var a=new cc.TransitionSplitCols;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionSplitRows=cc.TransitionSplitCols.extend({action:function(){return cc.SplitRows.create(this._duration/2,3)}});cc.TransitionSplitRows.create=function(b,c){var a=new cc.TransitionSplitRows;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionFadeTR=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.director.getWinSize(),a=this.actionWithSize(cc.size(0|12*(a.width/a.height),12));this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(a),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(a){return a},actionWithSize:function(a){return cc.FadeOutTRTiles.create(this._duration,a)}});cc.TransitionFadeTR.create=function(b,c){var a=new cc.TransitionFadeTR;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionFadeBL=cc.TransitionFadeTR.extend({actionWithSize:function(a){return cc.FadeOutBLTiles.create(this._duration,a)}});cc.TransitionFadeBL.create=function(b,c){var a=new cc.TransitionFadeBL;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionFadeUp=cc.TransitionFadeTR.extend({actionWithSize:function(a){return cc.FadeOutUpTiles.create(this._duration,a)}});cc.TransitionFadeUp.create=function(b,c){var a=new cc.TransitionFadeUp;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionFadeDown=cc.TransitionFadeTR.extend({actionWithSize:function(a){return cc.FadeOutDownTiles.create(this._duration,a)}});cc.TransitionFadeDown.create=function(b,c){var a=new cc.TransitionFadeDown;return null!=a&&a.initWithDuration(b,c)?a:null};cc.SCENE_RADIAL=49153;cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",_setAttrs:function(b,c,a){b.attr({x:c,y:a,anchorX:0.5,anchorY:0.5})},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._setupTransition();var a=cc.director.getWinSize(),b=cc.RenderTexture.create(a.width,a.height);b.sprite.anchorX=0.5;b.sprite.anchorY=0.5;this._setAttrs(b,a.width/2,a.height/2);b.clear(0,0,0,1);b.begin();this._sceneToBeModified.visit();b.end();this._sceneToBeModified==this._outScene&&this.hideOutShowIn();a=this._progressTimerNodeWithRenderTexture(b);b=cc.Sequence.create(cc.ProgressFromTo.create(this._duration,this._from,this._to),cc.CallFunc.create(this.finish,this));a.runAction(b);this.addChild(a,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!0);cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene;this._from=100;this._to=0},_progressTimerNodeWithRenderTexture:function(a){cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass");return null},_sceneOrder:function(){this._isInSceneOnTop=!1}});cc.TransitionProgress.create=function(b,c){var a=new cc.TransitionProgress;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_RADIAL;a.reverseDir=!1;a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});cc.TransitionProgressRadialCCW.create=function(b,c){var a=new cc.TransitionProgressRadialCCW;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_RADIAL;a.reverseDir=!0;a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});cc.TransitionProgressRadialCW.create=function(b,c){var a=new cc.TransitionProgressRadialCW;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(1,0);a.barChangeRate=cc.p(1,0);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});cc.TransitionProgressHorizontal.create=function(b,c){var a=new cc.TransitionProgressHorizontal;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressVertical=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0,0);a.barChangeRate=cc.p(0,1);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});cc.TransitionProgressVertical.create=function(b,c){var a=new cc.TransitionProgressVertical;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressInOut=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0.5,0.5);a.barChangeRate=cc.p(1,1);a.percentage=0;this._setAttrs(a,b.width/2,b.height/2);return a},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene;this._from=0;this._to=100}});cc.TransitionProgressInOut.create=function(b,c){var a=new cc.TransitionProgressInOut;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionProgressOutIn=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=cc.ProgressTimer.create(a.sprite);cc._renderType===cc._RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0.5,0.5);a.barChangeRate=cc.p(1,1);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});cc.TransitionProgressOutIn.create=function(b,c){var a=new cc.TransitionProgressOutIn;return null!=a&&a.initWithDuration(b,c)?a:null};cc.TransitionPageTurn=cc.TransitionScene.extend({_back:!0,_className:"TransitionPageTurn",initWithDuration:function(b,c,a){this._back=a;cc.TransitionScene.prototype.initWithDuration.call(this,b,c);return !0},actionWithSize:function(a){return this._back?cc.ReverseTime.create(cc.PageTurn3D.create(this._duration,a)):cc.PageTurn3D.create(this._duration,a)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.director.getWinSize(),b;a.width>a.height?(a=16,b=12):(a=12,b=16);a=this.actionWithSize(cc.size(a,b));this._back?(this._inScene.visible=!1,this._inScene.runAction(cc.Sequence.create(cc.Show.create(),a,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))):this._outScene.runAction(cc.Sequence.create(a,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},_sceneOrder:function(){this._isInSceneOnTop=this._back}});cc.TransitionPageTurn.create=function(c,d,a){var b=new cc.TransitionPageTurn;b.initWithDuration(c,d,a);return b};